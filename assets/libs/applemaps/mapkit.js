/*! Copyright © Apple Inc. All rights reserved. See LICENSE for additional license information. */
(()=>{"use strict";const e={version:"5.79.95",build:"25.22-2",cdnBase:"//cdn.apple-mapkit.com",cdnVersion:"5.79.95"},t=27,i=32,s=37,o=38,n=39,a=40,r=()=>{},l=(e,t)=>e-t*Math.floor(e/t),h=e=>Math.log2(e),c=(e,t,i)=>Math.max(t,Math.min(e,i)),d=(e,t)=>Object.keys(t).some((i=>t[i]===e)),u=(e,t,i)=>{if(void 0===e||(i?.checkNull??!0)&&null===e)throw new Error(t||"Missing parameter")},p=(e,t,i)=>{if(typeof e!==t)throw new TypeError(i||`Expected \`${t}\` but got \`${typeof e}\``);if("number"===t&&Number.isNaN(e))throw new TypeError(i||`Expected \`${t}\` but got \`NaN\``);if("object"===t&&e instanceof Array)throw new TypeError(i||"Expected a non-array object but got an array")},m=(e,t,i)=>{if(!(e instanceof t))throw new Error(i||"Unexpected object instance")},g=(e,t)=>{if(!Array.isArray(e))throw new Error(t||"Expected an array")},_=(e,t)=>null==e?{}:(p(e,"object",t||"[MapKit] The `options` parameter is not a valid object."),e),f=(e,t,i)=>e.replace(/{{(.*?)}}/g,((e,s)=>{const o=t[s];if(i&&null==o)throw new Error("fillTemplate: Missing value for parameter: "+s);return o??""})),y=()=>Math.floor(1e15*(9*Math.random()+1));class v{constructor(e,t,i){var s;this.language=e.toLowerCase(),this.region=t?t.toUpperCase():null,this.script=i?(s=i)?s[0].toUpperCase()+s.substr(1).toLowerCase():s:null}get tag(){return this.region?`${this.language}-${this.region}`:this.script?`${this.language}-${this.script}`:this.language}toString(){return`{ ${`language: ${this.language}`}${this.region?`, region: ${this.region}`:""}${this.script?`, script: ${this.script}`:""} }`}static parse(e){let t,i;if(e&&"string"==typeof e){if(-1!==e.indexOf("_"))return console.warn("Invalid character: '_'"),null;const s=e.split("-"),o=s[0];if(o.length<2||o.length>4)return console.warn("Invalid language:",e),null;if(!(s.length<4))return console.warn("Don't know how to parse language tags with more than 3 parts:",e),null;for(let o=1;o<s.length;o+=1){const n=s[o];if(4===n.length)i=n;else{if(!(n.length>1&&n.length<4))return console.warn("Don't know how to parse:",e),null;t=n}}return new v(o,t,i)}return null}}const b=(e,t)=>{if(!e)return;const{language:i,region:s,script:o}=e;t[i]=t[i]||{regions:[],scripts:[]},s&&t[i].regions.push(s),o&&t[i].scripts.push(o)};const w={zh:{CN:"Hans",HK:"Hant",TW:"Hant"}},C={"en-AU":"en-GB","en-IE":"en-GB","en-IN":"en-GB","en-NZ":"en-GB","en-SG":"en-GB","en-ZA":"en-GB","es-LA":"es-MX","es-XL":"es-MX","nn-NO":"nb-NO","no-NO":"nb-NO","vi-VI":"vi-VN",iw:"he-IL"};function k(e,t){0}function S(e,t){0}function M(e,t,i){0}const L=["bn-BD","gu-IN","kn-IN","ml-IN","mr-IN","or-IN","pa-IN","ta-IN","te-IN","ur-PK"],x=L.map((e=>e.split("-")[0]));function A(e,t,i,s){for(const o of e){const e=t.indexOf(o);k(),t.splice(e,1);const n=o.split("-")[0];s[n]=i[n],delete i[n]}}function E(e,t,i,s){t.splice(0,0,...e),t.sort();for(const[e,t]of Object.entries(s))i[e]=t}const T=new class{constructor(e){this.supportMap={},this.delegate=e;for(const e of this.delegate.supportedLocales)b(v.parse(e),this.supportMap)}bestMatch(e,t){let i=v.parse(e),s=null;if(i&&this.delegate.localesMap){const e=this.delegate.localesMap;e[i.tag]?i=v.parse(e[i.tag]):e[i.language]&&(i=v.parse(e[i.language]))}return t=t||null,i&&(s=((e,t,i)=>{const{language:s,region:o,script:n}=e;let a=n;const r=i[s];if(!r)return null;if(o){const i=r.regions.find((t=>t.toUpperCase()===e.region?.toUpperCase()));if(i)return new v(s,i);const n=t[s];n&&n[o.toUpperCase()]&&(e.script=a=n[o.toUpperCase()])}if(a){const t=r.scripts.find((t=>t.toUpperCase()===e.script?.toUpperCase()));return new v(s,null,t)}return new v(s)})(i,this.delegate.regionToScriptMap,this.supportMap)),s?s.tag:t}}({supportedLocales:["ar","bn","ca","cs","da","de","el","en-AU","en-GB","en","es-MX","es-US","es","fi","fr-CA","fr","gu","he","hi","hr","hu","id","it","ja","kn","ko","ml","mr","ms","nb","nl","or","pa","pl","pt-PT","pt","ro","ru","sk","sl","sv","ta","te","th","tr","uk","ur","vi","zh-Hans","zh-Hant","zh-HK"],regionToScriptMap:w,localesMap:C}),I=Object.create(null);A(x,T.delegate.supportedLocales,T.supportMap,I);const O=function(){E(x,T.delegate.supportedLocales,T.supportMap,I)},R=T;class P{_listeners=void 0;addEventListener(e,t,i){i=i??null,this._listeners||(this._listeners={});const s=this._listeners[e]??[];this._listeners[e]=s;for(const{listener:e,thisObject:o}of s)if(e===t&&o===i)return!1;return s.push({thisObject:i,listener:t}),!0}removeEventListener(e,t,i){if(i=i??null,!this._listeners)return!1;if("string"!=typeof e){for(const e in this._listeners)this.removeEventListener(e,t,i);return!1}const s=this._listeners[e];if(!s)return!1;const o=s.findIndex((({listener:e,thisObject:s})=>t===e&&i===s||!t&&i&&i===s));return o>-1&&s.splice(o,1),0===s.length&&delete this._listeners[e],o>-1}dispatchEvent(e){if(e.target=this,!this._listeners)return!0;const t=this._listeners[e.type];if(!t||e._stoppedPropagation)return!0;const i=t.slice(0);for(const{listener:t,thisObject:s}of i)if("function"==typeof t?t.call(s,e):s||t.handleEvent.call(t,e),e._stoppedPropagation)break;return!e.defaultPrevented}}class D{target;type;defaultPrevented=!1;_stoppedPropagation=!1;constructor(e){this.target=null,this.type=e,this._stoppedPropagation=!1}stopPropagation(){this._stoppedPropagation=!0}preventDefault(){this.defaultPrevented=!0}}const z=P,N=D,F={EventTarget:P,Event:D};function U(e){return Object.keys(e)}function G(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const W=Object.freeze({LOAD:"load",LOADEND:"loadend",LOAD_ERROR:"load-error"});class B extends D{constructor(e){super(K.Events.LOAD),G(this,"jsModules",void 0),this.jsModules=e}}class Z extends D{constructor(e){super(K.Events.LOADEND),G(this,"libraryNames",void 0),this.libraryNames=e}}const K=new class extends P{constructor(...e){super(...e),G(this,"Libraries",[]),G(this,"loadedLibraries",[]),G(this,"IS_CHUNKED",!1),G(this,"Events",W),G(this,"jsModules",{mapkit:{}}),G(this,"load",void 0),G(this,"loadAll",void 0)}_chunkLoaded(e,t){U(e).forEach((t=>{if("mapkit"!==t)this.jsModules[t]=e[t];else{U(e.mapkit).forEach((t=>{const i=Object.getOwnPropertyDescriptor(e.mapkit,t);k(),Object.defineProperty(this.jsModules.mapkit,t,i)}))}}));const i=new B(e);this.dispatchEvent(i),t?.()}_dispatchLoadEndEvent(e){const t=new Z(e);this.dispatchEvent(t)}},j=K;class H{constructor(){this.loggers=[]}appendLogger(e){this.loggers.push(e)}_invoke(e,t){if(this.loggers.length)for(const i of this.loggers)i[e]&&i[e].apply(i,t);else"error"!==e&&"warn"!==e||console[e].apply(console,t)}error(){this._invoke("error",Array.from(arguments))}warn(){this._invoke("warn",Array.from(arguments))}log(){this._invoke("log",Array.from(arguments))}info(){this._invoke("info",Array.from(arguments))}debug(){this._invoke("debug",Array.from(arguments))}}const q=new H;H.sharedLogger=q;const V=function(e){return String.fromCharCode.apply(String,e.split("").map((e=>(e.codePointAt(0)+242)%255)))},Y=Symbol(),X=Object.freeze({Highest:0,High:1,Medium:2,Low:3}),$=X,J={[$.Highest]:12,[$.High]:12,[$.Medium]:4,[$.Low]:1},Q={[$.Highest]:[],[$.High]:[],[$.Medium]:[],[$.Low]:[]},ee={[$.Highest]:0,[$.High]:0,[$.Medium]:0,[$.Low]:0},te=()=>{for(const e of Object.values($)){if(Q[e].length>0){const t=J[e];return ee[e]===t?null:Q[e][0]}if(ee[e]>0)return null}return null},ie=()=>{for(const e of Object.values($))if(Q[e].length>0)return Q[e].shift(),!0;return!1},se=e=>{for(const t of Object.values($)){const i=Q[t].indexOf(e);if(-1!==i)return Q[t].splice(i,1),!0}return!1},oe=()=>{let e=te();for(;e;)ee[e.priority]+=1,ie(),e._loaderWillStart.call(e),e=te()},ne=e=>{Q[e.priority].push(e),oe()},ae=e=>se(e),re=e=>{ee[e.priority]-=1,oe()},le=((()=>{if(/iP(hone|od|ad)/.test(navigator.platform)){const e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e?.[1]??"0",10),parseInt(e?.[2]??"0",10),parseInt(e?.[3]??"0",10)]}})(),(e,t)=>{if(!he(e))throw new Error(t||"Expected an Element")}),he=e=>e instanceof window.Node&&e.nodeType===window.Node.ELEMENT_NODE,ce=(window.XMLHttpRequest,e=>{const t=new window.XMLHttpRequest;return t.addEventListener("load",e),t.addEventListener("error",e),t.addEventListener("timeout",e),t}),de=()=>document.createElement("canvas"),ue=Object.freeze({Unscheduled:0,Waiting:1,Loading:2,Canceled:3,Succeeded:4,Failed:5});Object.freeze(Object.values(ue));const pe=class{constructor(e,t){this._state=ue.Unscheduled,this._retries=0,this._unscheduled=!1,this._delay=null,this._timeoutId=void 0,this.priority=e,this._delegate=t,this._init(e,t)}_getDelegate(){return this._delegate}_isUnscheduled(){return this._unscheduled}get state(){return this._state}schedule(){this._state===ue.Unscheduled&&(this._state=ue.Waiting,ne(this))}unschedule(){let e=!1;if(this._state===ue.Waiting)e=ae(this);else{if(this._state!==ue.Loading)return!1;re(this),e=!0}return this._unscheduled=e,this._state=ue.Canceled,"function"==typeof this._delegate.loaderDidCancel&&this._delegate.loaderDidCancel(this),this._reset(),e}_loaderWillStart(){this._state=ue.Loading,"function"==typeof this._delegate.loaderWillStart&&this._delegate.loaderWillStart(this)}_loaderDidSucceed(e){this._state=ue.Succeeded,re(this),"function"==typeof this._delegate.loaderDidSucceed&&this._delegate.loaderDidSucceed(this,e),this._reset()}_loaderDidFail(e){this._state=ue.Failed,re(this),"function"==typeof this._delegate.loaderDidFail&&this._delegate.loaderDidFail(this,e),this._reset()}_init(e,t){this.priority=e,this._state=ue.Unscheduled,this._delegate=t,this._retries=0,this._timeoutId=void 0,this._delay=null,this._unscheduled=!1}_reload(e){if(this._retries++,this._retries<3){const e=this._delay??1e4;this._timeoutId=setTimeout((()=>this._loaderWillStart()),e)}else this._loaderDidFail(e)}_reset(){clearTimeout(this._timeoutId)}};class me extends pe{constructor(e,t,i){super(i?.priority??X.Highest,t),this._origin=null,this._xhr=null,this._xhrData=void 0,this._headers=i?.headers??null,this._method=i?.method??"GET",this._retry=i?.retry??!1,this._timeout=i?.timeout??0,this._withCredentials=i?.withCredentials??!1,this._responseType=i?.responseType??void 0,this._url=e,this._delay=i?.delay??null}get xhr(){return this._xhr}get url(){return this._url}get xhrData(){return this._xhrData}unschedule(){return this._xhr?.abort(),super.unschedule()}_loaderWillStart(){if(super._loaderWillStart(),this._xhr=ce(this),this._xhr.open(this._method,this.url,!0),this._xhr.timeout=this._timeout,this._xhr.withCredentials=this._withCredentials,this._origin&&(this._xhr.setDisableHeaderCheck(!0),this._xhr.setRequestHeader("Origin",this._origin)),this._headers)for(const[e,t]of Object.entries(this._headers))this._xhr.setRequestHeader(e,t);if(this._responseType&&(this._xhr.responseType=this._responseType),"POST"===this._method&&!this._xhrData){const e=this._getDelegate(),t=e.getDataToSend?.(this._xhr);if(!t)return;this._xhrData=t}this._xhr.send(this._xhrData)}handleEvent(e){const t=e.target,i=e.type;if("error"===i||"timeout"===i||200!==t.status)this._retry?this._reload(t):this._loaderDidFail(t);else if("load"===i)this._loaderDidSucceed(t);else{const e=t.status??-1;console.log(`Unhandled XHR event type: ${i} status: ${e}`)}}}const ge=me,_e="function"==typeof ErrorEvent;function fe(e,t,i,s){if(!_e)return i?e.apply(t,i):e.call(t);try{return i?e.apply(t,i):e.call(t)}catch(e){console.error(e);const t=new ErrorEvent("error",{message:e instanceof Error?e.message:e instanceof Object?e.toString():"(Unknown error)",filename:e instanceof Error?e.fileName||e.stack:"(Unknown filename)",lineno:e instanceof Error?e.lineNumber:void 0,colno:e instanceof Error?e.columnNumber:void 0,error:e});return window.dispatchEvent(t),s}}function ye(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function ve(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function be(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,we(e,t,"set"),i),i}function we(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}J[$.Highest]*=10,J[$.High]*=10,J[$.Medium]*=10,J[$.Low]*=10;const Ce="https:",ke={url:`${Ce}${e.cdnBase}/ma/bootstrap`,apiVersion:"2",accessKeyExpirationBiasMS:3e4},Se={OK:200,MULTIPLE_CHOICES:300,BAD_REQUEST:400,UNAUTHORIZED:401,TOO_MANY_REQUESTS:429},Me=["language","countryCode","madabaBaseUrl","authorizationCallback","libraries","logger","_showMapsLogo","_showLegalLink","bootstrapTimeout","_shadowDOMMode","_showsTileInfo","_distUrl","_syrupUrl","_uiBaseUrl","_mmanBaseUrl","_teamId","_previewLoCSR","_forcedRenderingMode","_proxyPrefixes","_shouldLogin","_disableWebGLCheck","_enableExperimentalLanguages"],Le="R`ha\\aHe_";Me.push(Le);const xe=Object.freeze({READY:0,PENDING:1,ERROR:2,UNINITIALIZED:3}),Ae=Object.freeze({Initialized:"Initialized",Refreshed:"Refreshed"}),Ee=Object.freeze({Initialized:"configuration-init",Changed:"configuration-change",Error:"error"}),Te=Object.freeze({BadRequest:"Bad Request",Unauthorized:"Unauthorized",TooManyRequests:"Too Many Requests",MalformedResponse:"Malformed Response",Timeout:"Timeout",NetworkError:"Network Error",Unknown:"Unknown"}),Ie="Bearer {{token}}",Oe=Object.freeze({Apple:"Apple",AutoNavi:"AutoNavi"});let Re=!1;const Pe=new WeakMap,De=window.location.hostname,ze=window.location.href;class Ne{constructor(e){this.bootstrap=e,this.countryCode=null}setForcedCountryCode(e){return!e||De.endsWith(".apple.com")||De.endsWith(".autonavi.com")||console.error("[MapKit] Not allowed."),this.setForcedCountryCodeUnrestricted(e)}setForcedCountryCodeUnrestricted(e){if(e!==this.countryCode&&(e&&(p(e,"string","[MapKit] `countryCode` must be a string or `null`."),e=e.toUpperCase()),this.countryCode=e,e&&this.bootstrap._setLocaleWithCountryCode&&(delete this.bootstrap._setLocaleWithCountryCode,this.bootstrap.language="zh-"+this.countryCode),this.bootstrap.ready)){for(const e of this.bootstrap.resetHooks)e();this.bootstrap._loadFromServer()}}}class Fe extends D{constructor(e,t){super(Ee.Changed),this.status=e,this.responseIdentifier=t}}class Ue extends D{constructor(e,t,i){super(Ee.Error),this.status=e,this.message=t,this.responseIdentifier=i}}var Ge=new WeakMap;class We extends P{constructor(){super(),ve(this,"HTTP",Se),ve(this,"ErrorStatus",Te),ve(this,"TileProviders",Oe),ve(this,"Events",Ee),ve(this,"States",xe),ve(this,"state",xe.UNINITIALIZED),ve(this,"enableSourceMap",!1),ve(this,"authorizationCallback",null),ve(this,"tileProvider",null),ve(this,"_showMapsLogo",!0),ve(this,"_showLegalLink",!0),ve(this,"shadowDOMMode",void 0),ve(this,"_madabaBaseUrl",null),ve(this,"customMadabaUrl",!1),ve(this,"_madabaDomains",null),ve(this,"_proxyPrefixMap",[]),ve(this,"_proxyPrefixes",{}),ve(this,"_disableCsr",!1),ve(this,"_accessKey",null),ve(this,"_accessToken",null),ve(this,"_distUrl",null),ve(this,"_syrupUrl",null),ve(this,"apiBaseUrl",null),ve(this,"mmanBaseUrl",null),ve(this,"customMmanBaseUrl",!1),ve(this,"apiBaseUrlOverride",null),ve(this,"_showsTileInfo",!1),ve(this,"_messagePrefix","[MapKit] "),ve(this,"nonce",""),ve(this,"scriptBaseUrl",void 0),ve(this,"expiresInSeconds",void 0),ve(this,"expiresAt",void 0),ve(this,"expiresIn",void 0),ve(this,"_forcedRenderingMode",void 0),ye(this,Ge,{writable:!0,value:!1}),ve(this,"_language",null),ve(this,"resetHooks",[]),ve(this,"_syrupRequestedFallback",!1),ve(this,"_syrupRequestedFallbackType",void 0),ve(this,"tileGroup",void 0),ve(this,"types",{}),ve(this,"rasterTilesForSyrup",void 0),this._jwtTokensToCheck=[],this.componentVersions=new Map,this.performanceMarkers={},this.language=null,Pe.set(this,new Ne(this))}_c(e){if(e!==Y)throw new Error("Invalid key.");return Pe.get(this)}get showMapsLogo(){return this._showMapsLogo}get showLegalLink(){return this._showLegalLink}get showsTileInfo(){return this._showsTileInfo}get forcedRenderingMode(){return this._forcedRenderingMode}get distUrl(){return this._distUrl}isUrlTrusted(e){const t=new URL(e,ze);if(window.location.origin&&t.origin===window.location.origin)return!0;if(this.scriptBaseUrl){const e=new URL(this.scriptBaseUrl,ze);if(e.origin&&t.origin===e.origin)return!0}return!1}get buildTags(){let e="";return[...this.componentVersions.entries()].forEach((([t,i])=>e+=" ("+t+": "+i+")")),e}get _initMessagePrefix(){return this._messagePrefix+"mapkit.init(): "}get proxyPrefixes(){return this._proxyPrefixes}getProxyPrefix(e=ke.url){const t=this._proxyPrefixMap.find((t=>t[0].test(e)));return t?.[1]}applyProxyPrefix(e){if(null==e)return e;const t=e.startsWith("//")?Ce+e:e,i=this.getProxyPrefix(t);return i?i+e:t}urlWithCredentials(e){return!!e&&/\bproxy\b.*\.geo\.apple\.com\b/.test(e)}get loginPromise(){if(!this._loginPromise)if(this._shouldLogin){const t=this.getProxyPrefix();this._loginPromise=t&&this.urlWithCredentials(t)?(e=t)?fetch(e,{mode:"no-cors",credentials:"include"}).then((()=>{})):Promise.resolve():Promise.resolve()}else this._loginPromise=Promise.resolve();var e;return this._loginPromise}init(e,t=!1){Re&&performance.mark("mapkit-init-start"),u(e,this._initMessagePrefix+"`options` object is required.",{checkNull:!0}),p(e,"object",this._initMessagePrefix+"`options` object is invalid.");const i={};if(e.logger&&q.appendLogger(e.logger),Object.keys(e).forEach((e=>{const t=-1!==Me.indexOf(V(e));t||-1!==Me.indexOf(e)||console.warn(this._initMessagePrefix+"ignoring invalid option: `"+e+"`."),t&&(i[V(e)]=e)})),t||this.authorizationCallback&&void 0===e.authorizationCallback||(u(e.authorizationCallback,this._initMessagePrefix+"`options` is missing `authorizationCallback`.",{checkNull:!0}),p(e.authorizationCallback,"function",this._initMessagePrefix+"`authorizationCallback` in `options` must be a function.")),e.language&&p(e.language,"string",this._initMessagePrefix+"`language` in `options` must be a string."),this._userInitializedInit)return void console.warn(this._initMessagePrefix+"already initialized; ignoring.");t||(this._userInitializedInit=!0),void 0!==e._previewLoCSR&&e._previewLoCSR&&(this._forcedRenderingMode="HYBRID"),void 0!==e._forcedRenderingMode&&(this._forcedRenderingMode=e._forcedRenderingMode);const s=e._proxyPrefixes;if(void 0!==s)if("object"!=typeof s)console.warn("mapkit.init() is getting a _proxyPrefixes that is not an object or array.");else{this._proxyPrefixes=Array.isArray(s)?{"*":s[0]}:s;const e=Object.entries(this._proxyPrefixes).map((([e,t])=>[new RegExp("^https?:\\/\\/"+e.replace(/[-/\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,"[^/]*")+"(\\/|$)"),t]));0,this._proxyPrefixMap=e}void 0!==e._distUrl&&(this._distUrl=e._distUrl??null),void 0!==e._syrupUrl&&(this._syrupUrl=e._syrupUrl),this._shouldLogin=this.urlWithCredentials(this.getProxyPrefix()),void 0===e._shouldLogin||e._shouldLogin||(this._shouldLogin=!!e._shouldLogin),i[Le]&&void 0!==e[i[Le]]&&(this[Le]=e[i[Le]]);const o=(this.state===xe.UNINITIALIZED||this.state===xe.ERROR)&&e.authorizationCallback;o&&(this.state=xe.PENDING),e.authorizationCallback&&(this.authorizationCallback=e.authorizationCallback);const n=Pe.get(this);S(),void 0!==e.countryCode&&null===n.countryCode&&n.setForcedCountryCodeUnrestricted(e.countryCode),e._enableExperimentalLanguages&&(be(this,Ge,!0),O(),this._language=null,this.language=null,this._l10nEnableExperimentalLocales?.()),void 0!==e.language?this.language=e.language:this._l10n&&(this._l10n.localeId=this.language),void 0!==e._showMapsLogo&&(this._showMapsLogo=!!e._showMapsLogo),void 0!==e._showLegalLink&&(this._showLegalLink=!!e._showLegalLink),void 0!==e._shadowDOMMode&&(this.shadowDOMMode=e._shadowDOMMode),e.bootstrapTimeout&&(this._bootstrapTimeout=e.bootstrapTimeout),e.madabaBaseUrl&&(this._madabaBaseUrl=e.madabaBaseUrl,this.customMadabaUrl=!0),e._uiBaseUrl&&(this.uiBaseUrl=e._uiBaseUrl,this.customUiBaseUrl=!0),e._mmanBaseUrl&&(this.mmanBaseUrl=e._mmanBaseUrl,this.customMmanBaseUrl=!0),e._showsTileInfo&&(this._showsTileInfo=e._showsTileInfo),e._teamId&&(this.analyticsTeamId=e._teamId),void 0!==e._disableWebGLCheck&&(this._disableWebGLCheck=e._disableWebGLCheck),o&&(this._shouldLogin?this.loginPromise.then((()=>{this._loadFromServer()}),(()=>{this._loadFailed(Te.NetworkError,"Initialization failed because of network error connecting to proxy.")})):this._loadFromServer()),e.libraries;const a=new D(this.Events.Initialized);this.dispatchEvent(a)}login(){const e=this.getProxyPrefix();e&&this.urlWithCredentials(e)&&(e=>{if(!e)return Promise.resolve();const t=window.open((e=>e.replace(/\/proxy\?$/,"/login"))(e),"_blank","popup=yes,width=700,height=700");return new Promise(((e,i)=>{t||i();const s=o=>{o.source===t&&(window.removeEventListener("message",s),o.data&&o.data.login?e(void 0):i())};window.addEventListener("message",s)}))})(e).then((()=>{this.reloadFromServer()}),(()=>console.error("[MapKit] There is a problem triggering login popup.")))}reloadFromServer(){this._loadFromServer()}get accessKey(){return this._accessKey}get accessToken(){return this._accessToken}accessKeyMayBeExpired(){k(this.ready),(!this.expiresAt||Date.now()>this.expiresAt)&&this.accessKeyHasExpired()}accessKeyHasExpired(){this._loadFromServer($.Highest)}get ready(){return this.state===xe.READY}get error(){return this.state===xe.ERROR}get language(){return S(this._language),this._language}set language(e){e===this._language&&null!==this._language||(delete this._setLocaleWithCountryCode,e?(p(e,"string","[MapKit] `language` must be a string or `null`."),e.startsWith("x-")&&(e=e.substring(2),be(this,Ge,!0),O(),this._l10nEnableExperimentalLocales?.()),"zh"===e.toLowerCase()&&(console.warn("[MapKit] `zh` is an ambiguous language ID. Please specify a script or reginal variant: `zh-Hans`, `zh-Hant`, or `zh-HK`."),Pe.get(this)?.countryCode?e="zh-"+Pe.get(this)?.countryCode:this._setLocaleWithCountryCode=!0)):e=this._getClientLanguage(),this._language=R.bestMatch(e,"en"),this.state!==xe.UNINITIALIZED&&this._l10n&&(this._l10n.localeId=e))}get countryCode(){return Pe.get(this)?.countryCode}get isAutoNavi(){return this.tileProvider===Oe.AutoNavi||this.state===xe.PENDING&&"CN"===Pe.get(this)?.countryCode}appendAuthOptions(e,t){const i=t||(this.accessToken&&!this.isAutoNavi?this.accessToken:null);return i&&(e.headers=e.headers||{},e.headers.Authorization=f(Ie,{token:i})),e}setL10n(e,t){var i;k(this._l10n),this._l10n=e,this._l10nEnableExperimentalLocales=t,function(e,t){return t.get?t.get.call(e):t.value}(i=this,we(i,Ge,"get"))&&t(),this.state!==xe.UNINITIALIZED&&(this._l10n.localeId=this.language)}setPerformanceMarkers(e){if(!e)return;const t=e.split(",").map((e=>e.trim()));for(const e of t)this.performanceMarkers[e]=!0;Re=this.performanceMarkers.loading}handleEvent(e){switch(e.type){case"visibilitychange":"visible"===document.visibilityState&&this.ready&&this.accessKeyMayBeExpired();break;case"online":this.ready?this.accessKeyMayBeExpired():this.error&&this.reloadFromServer()}}loaderWillStart(e){this._xhrLoader===e&&(this.state=xe.PENDING)}loaderDidSucceed(e,t){this._xhrLoader===e&&(this._requestDidLoad(t),Re&&this.state===xe.PENDING&&performance.measure("mapkit-init","mapkit-init-start"),this._xhrLoader=void 0)}loaderDidFail(e,t){this._xhrLoader===e&&(this._parseError(e.xhr),this._xhrLoader=void 0)}_loadFromServer(t){let i=new URL(ke.url,ze);i.searchParams.append("apiVersion",ke.apiVersion);const s=Pe.get(this)?.countryCode;s&&i.searchParams.append("countryCode",s),i.searchParams.append("mkjsVersion",e.version),i.searchParams.append("poi","1"),i=new URL(this.applyProxyPrefix(i.toString()),ze);const o=this.getProxyPrefix(),n=this.urlWithCredentials(o),a={retry:!0,delay:0,priority:t,timeout:this._bootstrapTimeout,withCredentials:n};n&&!/\bapple\.com$/.test(window.location.hostname)&&o&&/\bapple\.com\b/.test(o)&&console.warn("[MapKit] Request with credentials may fail if the page is not hosted on the same domain as the proxy."),S(this.authorizationCallback),fe(this.authorizationCallback,null,[e=>{e&&(this._checkJwtToken?this._checkJwtToken(e):this._jwtTokensToCheck.push(e)),this.appendAuthOptions(a,e),this.accessToken&&(a.headers=a.headers??{},a.headers["X-Maps-Access-Token"]=f(Ie,{token:this.accessToken}));const t=new me(i.toString(),this,a);this._xhrLoader&&this._xhrLoader.unschedule(),t.schedule(),this._xhrLoader=t}])}_requestDidLoad(e){const t=e.getResponseHeader("x-rid")??void 0;if(!this._parseError(e,t))if(e.responseText)try{const i=JSON.parse(e.responseText);this._processLoadedData(i,t)}catch(e){if(!(e instanceof SyntaxError))throw e;this._loadFailed(Te.MalformedResponse,"Initialization failed because of incorrect server response.")}else this._loadFailed(Te.MalformedResponse,"Initialization failed because of incorrect server response.")}_resetReloadTimer(e){clearTimeout(this._reloadTimerId),this._reloadTimerId=setTimeout((()=>{delete this._reloadTimerId,this.accessKeyHasExpired()}),e)}_loadSucceeded(e,t){setTimeout((()=>{this.state=xe.READY;const i=new Fe(e?Ae.Refreshed:Ae.Initialized,t);this.dispatchEvent(i)}),0)}_loadFailed(e,t,i){console.error(this._messagePrefix+t),setTimeout((()=>{this.state=xe.ERROR,clearTimeout(this._reloadTimerId),delete this._reloadTimerId,this.expiresInSeconds=void 0,this.expiresAt=void 0,this.expiresIn=void 0;const s=new Ue(e,this._messagePrefix+t,i);this.dispatchEvent(s)}),0)}_processLoadedData(e,t){const i=!!this._accessToken;this._parseData(e),this.expiresIn&&this._resetReloadTimer(this.expiresIn),Pe.get(this)?.countryCode&&this._setLocaleWithCountryCode&&(delete this._setLocaleWithCountryCode,this.language="zh-"+Pe.get(this)?.countryCode),document.addEventListener("visibilitychange",this),window.addEventListener("online",this),this._loadSucceeded(i,t)}_parseData(t){t.apiBaseUrl;const i=Pe.get(this);if(S(),i.countryCode=t.countryCode&&"unknown"!==t.countryCode?t.countryCode:null,i.countryCode&&"zh"===this.language&&(this.language="zh-"+i.countryCode),this.environment=t.environment,this.apiBaseUrl=this.applyProxyPrefix(this.apiBaseUrlOverride||(t.apiBaseUrl??null)),t.analytics){const e=t.analytics;this.analytics={...e,analyticsUrl:this.applyProxyPrefix(e.analyticsUrl),errorUrl:this.applyProxyPrefix(e.errorUrl)}}t.authInfo&&t.authInfo.team_id&&(this.teamId=t.authInfo.team_id),t.locationShiftUrl&&(this.locationShiftUrl=this.applyProxyPrefix(t.locationShiftUrl)),this.expiresInSeconds=t.expiresInSeconds,this.expiresIn=1e3*this.expiresInSeconds-ke.accessKeyExpirationBiasMS,this.expiresAt=Date.now()+this.expiresIn;const s=t.tileSources.some((e=>e.needsLocationShift));t.accessKey&&(this._accessKey=t.accessKey),t.authInfo&&t.authInfo.access_token&&(this._accessToken=t.authInfo.access_token),this.tileProvider=s?We.TileProviders.AutoNavi:We.TileProviders.Apple,this._data=t,this.customUiBaseUrl||(this.uiBaseUrl=t.uiBaseUrl),this.customMmanBaseUrl||(this.mmanBaseUrl=t.mmanPath?e.cdnBase+t.mmanPath:null),this._parseMapData?.()}_parseError(e,t){const i=e.status;let s,o;if(i>=Se.OK&&i<Se.MULTIPLE_CHOICES)return!1;if(this._userInitializedInit=!1,e.readyState!==e.DONE)o=Te.Timeout,s="Initialization failed because the request timed out after "+this._bootstrapTimeout+" ms.";else if(i===Se.UNAUTHORIZED){o=Te.Unauthorized,s="Initialization failed because the authorization token is invalid.";try{const t=e.responseText?JSON.parse(e.responseText):void 0;t&&t.error&&t.error.details&&Array.isArray(t.error.details)&&t.error.details.forEach((e=>{e&&"ORIGIN_CHECK_FAILURE"===e.errorType&&e.message&&(s+=" "+e.message)}))}catch(e){if(!(e instanceof SyntaxError))throw e}}else i===Se.TOO_MANY_REQUESTS?(o=Te.TooManyRequests,s="Initialization failed because the daily usage limit has exceeded."):0===i?(o=Te.NetworkError,s="Initialization failed because of network error."):(o=Te.Unknown,s="Initialization failed because the server returned error "+i+" ("+e.statusText+").");return this._loadFailed(o,s,t),!0}_getClientLanguage(){return window.navigator.languages?window.navigator.languages[0]:window.navigator.language}_restore(){this._syrupUrl&&console.warn("[MapKit] mapkit.restore() cannot unset _syrupUrl."),this[Le]&&console.warn("[MapKit] mapkit.restore() cannot unset "+Le);for(const e of this.resetHooks)e();this._proxyPrefixMap=[],this._proxyPrefixes={},delete this._forcedRenderingMode,delete this._userInitializedInit,delete this._loginPromise,this._distUrl=null,this.authorizationCallback=null,this.apiBaseUrl=null,this.apiBaseUrlOverride=null,this.mmanBaseUrl=null,this.state=xe.UNINITIALIZED,this._listeners={},clearTimeout(this._reloadTimerId),delete this._reloadTimerId,document.removeEventListener("visibilitychange",this),window.removeEventListener("online",this)}_debugInfo(){return{ready:this.ready,state:this.state,_countryCode:this.countryCode,tileProvider:this.tileProvider,apiBaseUrl:this.apiBaseUrl,language:this.language,_getClientLanguage:this._getClientLanguage(),types:this.types}}get didFallback(){return this._syrupRequestedFallback}get fallbackType(){return this._syrupRequestedFallbackType}}ve(We,"ChangeStatus",Ae),ve(We,"PROTOCOL",Ce),ve(We,"TileProviders",Oe);const Be=We;const Ze=new class extends Be{};class Ke extends P{dispatchEvent(e){return fe(super.dispatchEvent,this,[e],!0)}}const je={EventTarget:Ke,Event:D},He={Airport:"Airport",AirportGate:"AirportGate",AirportTerminal:"AirportTerminal",AmusementPark:"AmusementPark",AnimalService:"AnimalService",Aquarium:"Aquarium",ATM:"ATM",AutomotiveRepair:"AutomotiveRepair",Bakery:"Bakery",Bank:"Bank",Baseball:"Baseball",Basketball:"Basketball",Beach:"Beach",Beauty:"Beauty",Bowling:"Bowling",Brewery:"Brewery",Cafe:"Cafe",Campground:"Campground",CarRental:"CarRental",Castle:"Castle",ConventionCenter:"ConventionCenter",Distillery:"Distillery",EVCharger:"EVCharger",Fairground:"Fairground",FireStation:"FireStation",Fishing:"Fishing",FitnessCenter:"FitnessCenter",FoodMarket:"FoodMarket",Fortress:"Fortress",GasStation:"GasStation",GoKart:"GoKart",Golf:"Golf",Hiking:"Hiking",Hospital:"Hospital",Hotel:"Hotel",Kayaking:"Kayaking",Landmark:"Landmark",Laundry:"Laundry",Library:"Library",Mailbox:"Mailbox",Marina:"Marina",MiniGolf:"MiniGolf",MovieTheater:"MovieTheater",Museum:"Museum",MusicVenue:"MusicVenue",NationalMonument:"NationalMonument",NationalPark:"NationalPark",Nightlife:"Nightlife",Park:"Park",Parking:"Parking",Pharmacy:"Pharmacy",Planetarium:"Planetarium",Playground:"Playground",Police:"Police",PostOffice:"PostOffice",PublicTransport:"PublicTransport",ReligiousSite:"ReligiousSite",Restaurant:"Restaurant",Restroom:"Restroom",RockClimbing:"RockClimbing",RVPark:"RVPark",School:"School",SkatePark:"SkatePark",Skating:"Skating",Skiing:"Skiing",Soccer:"Soccer",Spa:"Spa",Stadium:"Stadium",Store:"Store",Surfing:"Surfing",Swimming:"Swimming",Tennis:"Tennis",Theater:"Theater",University:"University",Volleyball:"Volleyball",Winery:"Winery",Zoo:"Zoo"};function qe(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ve(e){return e.map((e=>{if(!d(e,He))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.PointOfInterestCategory.");return e}))}class Ye{constructor(e){if(qe(this,"_includes",null),qe(this,"_excludes",null),void 0!==(e=_(e)).includes&&void 0!==e.excludes)throw new Error("[MapKit] `includes` and `excludes` may not be specified at the same time.");if(void 0===e.includes&&void 0===e.excludes)throw new Error("[MapKit] Either `includes` or `excludes` should be specified.");void 0!==e.includes&&(this._includes=Ve(e.includes)),void 0!==e.excludes&&(this._excludes=Ve(e.excludes))}includesCategory(e){if(!d(e,He))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.PointOfInterestCategory.");return this._includes?-1!==this._includes.indexOf(e):this._excludes?-1===this._excludes.indexOf(e):void 0}excludesCategory(e){if(!d(e,He))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.PointOfInterestCategory.");return this._includes?-1===this._includes.indexOf(e):this._excludes?-1!==this._excludes.indexOf(e):void 0}static including(e){return g(e,"[MapKit] PointOfInterestFilter.including expected an array of categories."),new Ye({includes:e})}static excluding(e){return g(e,"[MapKit] PointOfInterestFilter.excluding expected an array of categories."),new Ye({excludes:e})}}const Xe=function(){throw new Error("[MapKit] `PointOfInterestFilter` may not be constructed directly. Use the mapkit.PointOfInterestFilter.including or the mapkit.PointOfInterestFilter.excluding methods.")};Ye.prototype.constructor=Xe,Xe.prototype=Ye.prototype,Ye.exposedConstructor=Xe,Object.defineProperties(Ye,{filterIncludingAllCategories:{get:function(){const e=this.excluding([]);return Object.defineProperty(this,"filterIncludingAllCategories",{value:e,configurable:!0}),e},configurable:!0},filterExcludingAllCategories:{get:function(){const e=this.including([]);return Object.defineProperty(this,"filterExcludingAllCategories",{value:e,configurable:!0}),e},configurable:!0}}),Object.defineProperties(Xe,{including:{get:function(){return Ye.including},configurable:!0},excluding:{get:function(){return Ye.excluding},configurable:!0},includingAllCategories:{get:()=>Ye.filterIncludingAllCategories},excludingAllCategories:{get:()=>Ye.filterExcludingAllCategories}});const $e=Ye;const Je=Object.freeze({Dark:"dark",Light:"light",Adaptive:"adaptive"});class Qe extends P{}const et=new class{constructor(){this._queryList=window.matchMedia("(prefers-color-scheme: dark)"),this._handles=new Set,this._boundQueryListDidChange=()=>this._queryListDidChange()}addHandle(){const e=new Qe;return this._handles.add(e),1===this._handles.size&&this._addListener(),e}removeHandle(e){k(this._handles.has(e)),this._handles.delete(e),0===this._handles.size&&this._removeListener()}get currentColorScheme(){return this._queryList.matches?Je.Dark:Je.Light}get isDarkMode(){return this._queryList.matches}_addListener(){this._queryList.addListener(this._boundQueryListDidChange)}_removeListener(){this._queryList.removeListener(this._boundQueryListDidChange)}_queryListDidChange(){for(const e of this._handles.values()){const t=new D("change");e.dispatchEvent(t)}}};const tt={SCREEN_SIZE:function(e){const t={device_pixel_ratio:window.devicePixelRatio};return e._isInternalClient?(t.width=screen.width,t.height=screen.height,t):t},DEVICE_IDENTIFIER:function(e,t){S(t.uaParserInfo);const i={device_platform:t.uaParserInfo.deviceInfo.platform,device_os_version:t.uaParserInfo.deviceInfo.os};return void 0!==e._isInternalServer&&(i.is_internal_server=e._isInternalServer),i},BROWSER_INFO:function(e,t){let i;return S(t.uaParserInfo),S(t.uaParserInfo.browserInfo),i={browser_language:navigator.language,prefers_color_scheme:et.isDarkMode?"DARK":"LIGHT",browser_name:t.uaParserInfo.browserInfo.name,browser_version:t.uaParserInfo.browserInfo.version},e._isInternalClient?i.browser_origin=location.protocol+"//"+location.host:i.browser_origin=e.getReduceHostPlaceholder("ProtocolPlusHost"),e._isInternalClient&&(i.browser_referer=e.getReduceHostPlaceholder("ReferrerHost")),t.browserDefaultFontSize&&(i.browser_default_font_size=t.browserDefaultFontSize),t.browserInfoValues&&Object.assign(i,t.browserInfoValues),i},APPLICATION_IDENTIFIER:function(t){const i={mkjs_version:e.version};return t._isInternalClient&&window.placecard&&window.placecard.version&&(i.placecard_version=window.placecard.version),i.team_id=t._teamId,t._isInternalClient?i.host=location.host:i.host=t.getReduceHostPlaceholder("Host"),i.tile_provider=t.tileProvider,null!==t._serverEnvironment&&(i.server_environment=t._serverEnvironment),i},BROWSER_WINDOW_SIZE:function(e){if(!e._isInternalClient)return;return{width:window.innerWidth,height:window.innerHeight}},URL:function(e){const t={};return e._isInternalClient&&(t.path=location.pathname),t},MAP_VIEW:function(e,t){S(t.map);const i=t.map.region.toBoundingRegion(),s=t.map.ensureRenderingFrame().size;return{display_map_region:{eastLng:Math.round(i.eastLongitude),northLat:Math.round(i.northLatitude),southLat:Math.round(i.southLatitude),westLng:Math.round(i.westLongitude)},zoom_level:t.map.zoomLevel,map_type:`MAP_TYPE_${t.map.mapType.toUpperCase()}`,size:{width:s.width,height:s.height},color_scheme:t.map.colorScheme.toUpperCase()}},USER_SESSION:function(e){return S(e._sessionId),S(e._sequenceNumber),S(e._relativeTimestamp),{session_id:e._sessionId,sequence_number:e._sequenceNumber,relative_timestamp:e._relativeTimestamp}},TILES:function(e,t){return S(t.map),{rendering:t.map._mapNodeController&&t.map._mapNodeController.renderingMode}}},it="other";function st(e){e=e.toLowerCase();const t={name:it,version:it};try{if(e.includes("sogou"))t.name="Sogou",t.version=(/SogouMSE\/(\d+(\.?\d)*)/i.exec(e)??[])[1];else if(e.includes("ucbrowser"))t.name="UCBrowser",t.version=(/UCBrowser\/(\d+(\.?\d)*)/i.exec(e)??[])[1];else if(e.includes("qqbrowser"))t.name="QQBrowser",t.version=(/QQBrowser\/(\d+(\.?\d)*)/i.exec(e)??[])[1];else if(e.includes("metasr"))t.name="Sogou",t.version=(/MetaSr\s(\d+(\.?\d)*)/i.exec(e)??[])[1];else if(e.includes("edg")&&!e.includes("edgios")){t.name="Edge";const i=/edg(?:e|ios|a|i)?\/(\d+\.?\d*)/gi;t.version=(i.exec(e)??[])[1]}else!e.includes("safari")||e.includes("chrome")||e.includes("crios")||e.includes("gsa")||e.includes("fxios")||e.includes("duckduckgo")||e.includes("edg")?!e.includes("chrome")&&!e.includes("crios")||e.includes("chromium")||e.includes("edg")||e.includes("samsungbrowser")?!e.includes("firefox")&&!e.includes("fxios")||e.includes("seamonkey")?e.includes("msie")||e.includes("trident")&&e.includes("rv")?(t.name="Internet Explorer",t.version=e.includes("msie")?(/msie\s(\d+\.?\d*)/gi.exec(e)??[])[1]:(/rv:(\d+\.?\d*)/gi.exec(e)??[])[1]):e.includes("gsa")&&(t.name="Google Search App",t.version=(/gsa\/(\d+\.?\d*)/i.exec(e)??[])[1]):(t.name="Firefox",t.version=e.includes("firefox")?(/firefox\/(\d+\.?\d*)/gi.exec(e)??[])[1]:(/fxios\/(\d+\.?\d*)/gi.exec(e)??[])[1]):(t.name="Chrome",t.version=e.includes("chrome")?(/chrome\/([\d.]+)/gi.exec(e)??[])[1]:(/crios\/([\d.]+)/gi.exec(e)??[])[1]):(t.name="Safari",t.version=(/version\/(\d+(\.\d+)*)/i.exec(e)??[])[1]);return S(t.name),S(t.version),t}catch(e){return t}}function ot(e){let t,i;e=e.toLowerCase();let s=null;try{if(e.includes("ipad")){t="iPad";const o=(/os\s+(.*?)[^_.\d]/i.exec(e)??[])[1];S(),i="iOS "+o,s=o.replace(/_/g,".")}else if(e.includes("iphone")&&!e.includes("ipad")){t="iPhone";const o=(/os\s+(.*?)[^_.\d]+/i.exec(e)??[])[1];S(),i="iOS "+o,s=o.replace(/_/g,".")}else if(e.includes("macintosh")){t="Macintosh";const o=(/mac os x (.*?)[^_.\d]/i.exec(e)??[])[1];S(),i="Mac OS X "+o,s=o.replace(/_/g,".")}else if(e.includes("windows")){t="Windows";const o=(/windows nt (.*?)[^._\d]/i.exec(e)??[])[1];S(),i="Windows NT "+o,s=o}else if(e.includes("android")){t="Android";const o=(/android (.*?)[^._\d]/i.exec(e)??[])[1];S(),i="Android "+o,s=o.replace(/_/g,".")}else e.includes("linux")&&!e.includes("android")?(t="Linux",i="Linux"):e.includes("cros")?(t="Chrome OS",i="Chrome OS"):(t=it,i=it);return{platform:t,os:i,version:s}}catch(e){return{platform:it,os:it,version:null}}}class nt{constructor(){this._startTime=Date.now(),this._budget=10,this.didTimeout=!1}timeRemaining(){return Math.max(0,this._budget-(Date.now()-this._startTime))}}const at=function(e,t){return"undefined"!=typeof requestIdleCallback?requestIdleCallback(e,t):function(e){return setTimeout((function(){const t=new nt;e(t)}))}(e)},rt=function(e){return"undefined"!=typeof cancelIdleCallback?cancelIdleCallback(e):clearTimeout(e)},lt=Object.freeze({Highest:0,High:1,Medium:2,Low:3}),ht=lt,ct=Object.freeze([{timeout:600},{timeout:1e3},{timeout:3e3},{}]),dt=[function(e){mt(e,ht.Highest)},function(e){mt(e,ht.High)},function(e){mt(e,ht.Medium)},function(e){mt(e,ht.Low)}],ut=[-1,-1,-1,-1],pt=[];for(const e of Object.values(ht))pt[e]=[];function mt(e,t){for(;(e.timeRemaining()>0||e.didTimeout)&&pt[t].length;){const e=pt[t].shift();"function"==typeof e?e():e&&"object"==typeof e&&"function"==typeof e.performScheduledTask&&e.performScheduledTask()}pt[t].length?ut[t]=at(dt[t],ct[t]):-1!==ut[t]&&(rt(ut[t]),ut[t]=-1)}const gt={schedule:function(e,t){pt[t].push(e),-1===ut[t]&&(ut[t]=at(dt[t],ct[t]))}};let _t=-1,ft=[],yt=[],vt=[];const bt=Object.freeze({Idle:0,Updating:1,Drawing:2,Flushing:3});let wt=bt.Idle;function Ct(e){-1!==_t&&(wt===bt.Flushing&&("undefined"!=typeof cancelAnimationFrame?cancelAnimationFrame(_t):clearTimeout(_t)),_t=-1),function(e){wt=bt.Updating;for(;ft.length>0;){const t=ft;ft=[];for(let i=0,s=t.length;i<s;++i){const s=t[i];"function"==typeof s?s():s&&"object"==typeof s&&"function"==typeof s.performScheduledUpdate&&s.performScheduledUpdate(e)}}ft=yt,yt=[]}(e),function(e){wt=bt.Drawing;const t=vt;vt=[];for(let i=0,s=t.length;i<s;++i){const s=t[i];"function"==typeof s?s():s&&"object"==typeof s&&"function"==typeof s.performScheduledDraw&&s.performScheduledDraw(e)}}(e),wt=bt.Idle}function kt(e,t){return-1===e.indexOf(t)&&(e.push(t),!0)}function St(){_t="undefined"!=typeof requestAnimationFrame?requestAnimationFrame(Ct):setTimeout(Ct)}const Mt={scheduleASAP:function(e){kt(ft,e)&&-1===_t&&wt!==bt.Updating&&St()},scheduleOnNextFrame:function(e){kt(wt===bt.Updating?yt:ft,e)&&-1===_t&&St()},scheduleDraw:function(e){kt(vt,e)&&-1===_t&&St()},flush:function(){wt>bt.Idle||(wt=bt.Flushing,Ct())},Priority:lt,scheduleInBackground:function(e,t){gt.schedule(e,void 0!==t?t:lt.Low)}},Lt=new WeakMap;const xt=function(e,t,i){const s=function(...o){const n=o;clearTimeout(Lt.get(s));const a=setTimeout((function(){Lt.delete(s),e.apply(i,n)}),t||0);Lt.set(s,a)};return s},At=/^.*(?=\/mapkit([.a-z-]*)\.js)/;function Et(e){const t=At.exec(e.src);return t?t[0]:null}const Tt={_baseUrl:void 0,_versionSuffix:"",scriptBaseUrl:void 0,getBaseUrl:function(){return Ze.distUrl?Ze.distUrl:e.useLocalResources&&(void 0===this.scriptBaseUrl&&this.findScriptAndSetBasePath(),void 0!==this.scriptBaseUrl)?this.scriptBaseUrl:Ze.applyProxyPrefix([e.cdnBase,"mk",e.cdnVersion].join("/"))},getVersionSuffix:function(){return Ze.distUrl||e.useLocalResources?"?mkjsVersion="+e.cdnVersion:""},createUrl:function(e,t){void 0!==this._baseUrl&&void 0!==this._versionSuffix||(k((Ze.state,Ze.States.UNINITIALIZED)),this._baseUrl=this.getBaseUrl(),this._versionSuffix=this.getVersionSuffix()),e=e&&e.replace(/^\//,"")||"";let i=this._versionSuffix;return("__mapkitSourceMap"in window||Ze.enableSourceMap)&&(i+=(i?"&":"?")+"sourcemap=1"),[this._baseUrl,e].join("/")+i},isUrlTrusted:function(){return Ze.isUrlTrusted(this.getBaseUrl())},createImageUrl:function(e){return this.createUrl("images/"+e)},findScriptAndSetBasePath:function(){if(document.currentScript){const e=Et(document.currentScript);if(e)return Tt.scriptBaseUrl=e,document.currentScript}for(let e=document.scripts,t=0,i=e.length;t<i;++t){const i=Et(e[t]);if(null!==i)return this.scriptBaseUrl=i,e[t]}return null},createSyrupUrl(){let t;k((Ze.state,Ze.States.UNINITIALIZED));return t=Ze._syrupUrl?Ze._syrupUrl:Ze.applyProxyPrefix(e.cdnBase+"/ti/csr/1.x.x"),[t,"mk-csr.js?mapkitVersion="+e.version+(Ze.enableSourceMap?"&sourcemap=1":"")].join("/")},isSyrupUrlTrusted:e=>!Ze._syrupUrl&&Ze.isUrlTrusted(e)};e.useLocalResources&&"undefined"!=typeof window&&void 0!==window.document&&Tt.findScriptAndSetBasePath(),Ze.addEventListener(Ze.Events.Initialized,(()=>{Tt._baseUrl=void 0,Tt._versionSuffix=""}));const It=Tt,Ot=["ac.com","aws.sagemaker","biz.orx","cloud.jele","com.amazonaws","com.amazoncognito","com.est-a-la-masion","com.onthewifi","dev.curv","host.freesite","it.barletta-trani-andria","it.trento","jp.chiba","jp.fukushima","jp.hokkaido","jp.hyogo","jp.kanagawa","jp.miyazaki","jp.niigata","jp.saga","jp.tochigi","jp.xn--7t0a264c","lv.mil","net.homeunix","no.fuossko","no.smola","no.xn--sandy-yua","pa.ac","py.org","tj.ac","us.mi","zm.edu"],Rt=me,Pt=$,Dt=["alt","arpa","example","invalid","local","localhost","onion","test"],zt=[];function Nt(e,t){const i=t.length,s=e.length;if(i>s)return!1;for(let o=0;o<i;o++)if("*"!==t[i-1-o]&&t[i-1-o]!==e[s-1-o])return!1;return!0}function Ft(e){let t=e[0];for(let i=1;i<e.length;i++){const s=e[i];s.length>t.length&&(t=s)}return t}const Ut={getRegisterableDomain:async function(e){if(!e||e.includes(":")||/^[\d.]+$/.test(e))return null;const t=e.endsWith(".")?".":"";t&&(e=e.substring(0,e.length-1));const i=e.split("."),s=i.slice(-1)[0],o=1===i.length?null:i.slice(-2)[0];if(!o||Dt.includes(s))return null;const n=[].concat(Ot),a=`${s}.${o}`;n.push(a),n.sort();const r=n.lastIndexOf(a);if(0===r)return`${o}.${s}${t}`;const l=await(h=r-1,zt[h]||(zt[h]=new Promise((e=>{const t=It.createUrl("psl/"+h+".txt"),i=new Rt(t,{loaderDidSucceed(t,i){if(i.status<200||i.status>=300)return void e(null);S(i.responseText);const s=i.responseText.split("\n").map((e=>e.trim())).filter((e=>!!e));e(s)},loaderDidFail(){e(null)}},{priority:Pt.Low,withCredentials:Ze.urlWithCredentials(t)});i.schedule()}))),zt[h]);var h;return l?function(e,t){let i="";const s=[],o=[];for(const i of t)if(i.startsWith("!")){const t=i.substring(1).split(".");Nt(e,t)&&o.push(t)}else{const t=i.split(".");Nt(e,t)&&s.push(t)}let n=["*"];0!==o.length?(n=Ft(o),n=n.slice(1)):0!==s.length&&(n=Ft(s));return i=e.slice(-n.length-1).join("."),i}(i,l)+t:`${o}.${s}${t}`}},Gt=Ut;function Wt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Bt(e,t,i){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),function(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}const Zt=me,Kt=$,jt=Object.freeze({ScreenSize:"SCREEN_SIZE",DeviceIdentifier:"DEVICE_IDENTIFIER",BrowserInfo:"BROWSER_INFO",ApplicationIdentifier:"APPLICATION_IDENTIFIER",BrowserWindowSize:"BROWSER_WINDOW_SIZE",Url:"URL",MapView:"MAP_VIEW",UserSession:"USER_SESSION",Tiles:"TILES"}),Ht={MapUserActionStates:[jt.ScreenSize,jt.DeviceIdentifier,jt.BrowserInfo,jt.ApplicationIdentifier,jt.BrowserWindowSize,jt.Url,jt.MapView,jt.UserSession,jt.Tiles],SessionLessMapUserActionStates:[jt.ScreenSize,jt.DeviceIdentifier,jt.BrowserInfo,jt.ApplicationIdentifier,jt.BrowserWindowSize,jt.Url,jt.MapView,jt.Tiles],GeneralUserActionStates:[jt.ScreenSize,jt.DeviceIdentifier,jt.BrowserInfo,jt.ApplicationIdentifier,jt.BrowserWindowSize,jt.Url,jt.UserSession],SessionLessGeneralUserActionStates:[jt.ScreenSize,jt.DeviceIdentifier,jt.BrowserInfo,jt.ApplicationIdentifier,jt.BrowserWindowSize,jt.Url],NetworkStates:[jt.DeviceIdentifier,jt.BrowserInfo,jt.ApplicationIdentifier,jt.UserSession]},qt=Object.freeze({UserAction:"USER_ACTION",Network:"NETWORK"}),Vt=["OPEN_APPLE_MAPS"],Yt={Zoom:{name:"ZOOM",states:Ht.MapUserActionStates,type:qt.UserAction},MapsLoad:{name:"MAPS_LOAD",states:Ht.MapUserActionStates,type:qt.UserAction},AnnotationClick:{name:"ANNOTATION_CLICK",states:Ht.MapUserActionStates,type:qt.UserAction},MapFeatureSelect:{name:"TAP_POI",states:Ht.MapUserActionStates,type:qt.UserAction,valueMap:{Poi:"POINT_OF_INTEREST",Territory:"TERRITORY",PhysicalFeature:"PHYSICAL_FEATURE"}},MapTypeChange:{name:"MAP_TYPE_CHANGE",states:Ht.MapUserActionStates,type:qt.UserAction},MapNodeReady:{name:"MAP_NODE_READY",states:Ht.MapUserActionStates,type:qt.UserAction},Pan:{name:"PAN",states:Ht.MapUserActionStates,type:qt.UserAction},PlaceAccessoryReveal:{name:"REVEAL",states:Ht.MapUserActionStates,type:qt.UserAction},PlaceAccessoryOpenAppleMaps:{name:"OPEN_APPLE_MAPS",states:Ht.SessionLessMapUserActionStates,type:qt.UserAction},PlaceDetailReveal:{name:"REVEAL",states:Ht.GeneralUserActionStates,type:qt.UserAction},PlaceDetailOpenAppleMaps:{name:"OPEN_APPLE_MAPS",states:Ht.SessionLessGeneralUserActionStates,type:qt.UserAction},Search:{name:"SEARCH",states:Ht.NetworkStates,type:qt.Network},SearchAC:{name:"SEARCH_AC",states:Ht.NetworkStates,type:qt.Network},PlaceLookup:{name:"PLACE_LOOKUP",states:Ht.NetworkStates,type:qt.Network},ForwardGeocoder:{name:"FORWARD_GEOCODER",states:Ht.NetworkStates,type:qt.Network},ReverseGeocoder:{name:"REVERSE_GEOCODER",states:Ht.NetworkStates,type:qt.Network},Directions:{name:"DIRECTIONS",states:Ht.NetworkStates,type:qt.Network},PointsOfInterestSearch:{name:"POINTS_OF_INTEREST_SEARCH",states:Ht.NetworkStates,type:qt.Network}};class Xt{constructor(){var e;Wt(this,"_queuedMessages",[]),Wt(this,"_queuedSessionLessMessages",[]),Wt(this,"_shortSessionLoader",null),Wt(this,"_sessionLessLoader",null),Wt(this,"_analyticsUrl",null),Wt(this,"_errorUrl",null),Wt(this,"_sessionId",null),Wt(this,"_sessionTimerStart",null),Wt(this,"_sessionTimeToExpire",null),Wt(this,"_sequenceNumber",null),Wt(this,"_relativeTimestamp",null),Wt(this,"_isCustomSession",!1),Wt(this,"_refreshCustomSession",null),Wt(this,"_enableServerAnalytics",!1),Wt(this,"_serverEnvironment",null),Wt(this,"_isInternalServer",void 0),Wt(this,"_trackPanEvent",!1),Wt(this,"_handleAnalyticsTrackingResponse",null),Wt(this,"_registerableHostDomain",""),Wt(this,"_registerableReferrerDomain",""),Wt(this,"_reducedHostPlaceholders",{ProtocolPlusHost:null,Host:null,ReferrerHost:null}),Wt(this,"States",jt),Wt(this,"Events",Yt),Wt(this,"EventTarget","UI_TARGET_UNKNOWN"),Wt(this,"tileProvider",Bt(Xt,Xt,$t)),Wt(this,"_teamId",Bt(Xt,Xt,Jt)),this._isInternalClient=/\.apple\.com$/.test(window.origin)||/\.icloud\.com$/.test(window.origin)||/\.filemaker\.com$/.test(window.origin)||/\.apple-mapkit\.com$/.test(window.origin)||/\.tryrating\.com$/.test(window.origin),Ze.addEventListener(Ze.Events.Changed,this),Ze.ready&&this._configurationBecameAvailable(),this.uaParserInfo={browserInfo:st(e=navigator.userAgent),deviceInfo:ot(e)},this._debouncedQueueAsBackgroundTask=xt(this._queueAsBackgroundTask,5e3,this),window.addEventListener("pagehide",this),document.addEventListener("visibilitychange",this)}log(e,t={}){this._enableServerAnalytics;const i=(new Date).getTime();(!this._sessionId||!this._sessionTimeToExpire||i>this._sessionTimeToExpire)&&(this._isCustomSession&&this._refreshCustomSession?this._refreshCustomSession():this._initSession()),S(this._sessionTimerStart),this._relativeTimestamp=((new Date).getTime()-this._sessionTimerStart)/1e3,this._sequenceNumber=Math.ceil(1e4*this._relativeTimestamp),this.uaParserInfo&&(t.uaParserInfo=this.uaParserInfo),Vt.includes(e.name)||t?.isEventSessionLess?this._queuedSessionLessMessages.push(this._createMessage(e,t)):this._queuedMessages.push(this._createMessage(e,t)),Ze.analytics&&(S(this._analyticsUrl),S(this._debouncedQueueAsBackgroundTask),this._debouncedQueueAsBackgroundTask())}initCustomSession(e){this._isCustomSession=!0,this._sessionId=e.sessionId,this._sessionTimerStart=e.sessionStartTime,this._sessionTimeToExpire=this._sessionTimerStart+e.sessionDurationMs}manageAnalyticsTrackingResponse(e,t,i=!1){if(!this._handleAnalyticsTrackingResponse)return;let s;if(i)s={eventCount:t,sentViaSendBeacon:i};else{S(),S(e.xhrData);const t=e.xhr?.status,o=(e.xhrData?JSON.parse(e.xhrData):{}).analytics_event;s={eventCount:o&&Array.isArray(o)?o.length:0,responseCode:t,sentViaSendBeacon:i}}this._handleAnalyticsTrackingResponse(s),i&&(0!==this._queuedMessages.length&&this._queuedMessages.forEach((e=>{e.sent_via_send_beacon=!0})),0!==this._queuedSessionLessMessages.length&&this._queuedSessionLessMessages.forEach((e=>{e.sent_via_send_beacon=!0})))}setEventTarget(e){this.EventTarget=e}getDataToSend(e){return 0===this._queuedMessages.length?(S(this._shortSessionLoader),this._shortSessionLoader.unschedule(),!1):(e.setRequestHeader("Content-Type","text/plain"),this._createShortSessionJson())}loaderDidSucceed(e){this.manageAnalyticsTrackingResponse(e),this._shortSessionLoader=null}loaderDidFail(e){S(e.xhrData),this._queuedMessages=this._queuedMessages.concat(JSON.parse(e.xhrData).analytics_event),this.manageAnalyticsTrackingResponse(e),this._shortSessionLoader=null}getSessionLessDataToSend(e){return 0===this._queuedSessionLessMessages.length?(S(this._sessionLessLoader),this._sessionLessLoader.unschedule(),!1):(e.setRequestHeader("Content-Type","text/plain"),this._createSessionLessJson())}sessionLessLoaderDidSucceed(e){this.manageAnalyticsTrackingResponse(e),this._sessionLessLoader=null}sessionLessLoaderDidFail(e){S(e.xhrData),this._queuedSessionLessMessages=this._queuedSessionLessMessages.concat(JSON.parse(e.xhrData).analytics_event),this.manageAnalyticsTrackingResponse(e),this._sessionLessLoader=null}handleEvent(e){switch(e.type){case Ze.Events.Changed:this._configurationBecameAvailable();break;case"pagehide":this._sendPendingData();break;case"visibilitychange":"hidden"===document.visibilityState&&this._sendPendingData()}}getReduceHostPlaceholder(e){return this._reducedHostPlaceholders[e]||(this._reducedHostPlaceholders[e]=Symbol()),S(this._reducedHostPlaceholders[e]),this._reducedHostPlaceholders[e]}_createMessage(e,t){let i;switch(e.type){case qt.UserAction:i=this._createUserActionMessage(e,t);break;case qt.Network:i=this._createNetworkMessage(e,t)}S();const s=[].concat(e.states?e.states:[],t.states?Object.keys(t.states):[]);return i.analytic_tag={high:y(),low:y()},i.analytics_state=this._createStateMessages(s,t),i.sent_via_send_beacon=!1,i}_createUserActionMessage(e,t){const i={event_type:qt.UserAction,user_action_event:{user_action_event_key:e.name}};return(t.eventValue||0===t.eventValue)&&(i.user_action_event.user_action_event_value=e.valueMap?e.valueMap[t.eventValue]:t.eventValue),t.eventTarget&&(i.user_action_event.user_action_event_target=t.eventTarget),t.eventModule&&(i.user_action_event.user_action_event_module=t.eventModule),i}_createNetworkMessage(e,t){const i={event_type:qt.Network,network_event:{network_service:e.name}},s="number"==typeof t.responseCode?t.responseCode:"string"==typeof t.responseCode?parseInt(t.responseCode):void 0;return s&&!isNaN(s)&&(i.network_event.http_response_code=s),i}_initSession(){this._isCustomSession=!1,this._sessionId={high:y(),low:y()},this._sessionTimerStart=(new Date).getTime(),this._sessionTimeToExpire=this._sessionTimerStart+9e5}_createStateMessages(e,t){return e.map((e=>{const i={state_type:e};return tt[e]?i[e.toLowerCase()]=tt[e](this,t):(S(t.states),t.states[e]&&(i[e.toLowerCase()]=t.states[e](t))),i}))}_createShortSessionJson(){const e=this._createJson({analytics_message_type:"SHORT_SESSION_USAGE",analytics_event:this._queuedMessages});return this._queuedMessages=[],e}_createSessionLessJson(){const e=this._createJson({analytics_message_type:"SESSIONLESS_USAGE",analytics_event:this._queuedSessionLessMessages});return this._queuedSessionLessMessages=[],e}_createJson(e){return JSON.stringify(e,((e,t)=>{switch(t){case Bt(Xt,Xt,$t):return this.tileProvider;case Bt(Xt,Xt,Jt):return this._teamId;case this._reducedHostPlaceholders.Host:return this._registerableHostDomain;case this._reducedHostPlaceholders.ProtocolPlusHost:return this._registerableHostDomain?window.location.protocol+"//"+this._registerableHostDomain:"";case this._reducedHostPlaceholders.ReferrerHost:return this._registerableReferrerDomain;default:return t}}))}_configurationBecameAvailable(){Ze.analytics&&(this._analyticsUrl=Ze.analytics.analyticsUrl,this._withCredentials=Ze.urlWithCredentials(this._analyticsUrl)),this._teamId=Ze.analyticsTeamId??Ze.teamId??void 0,Ze.tileProvider===Ze.TileProviders.Apple?this.tileProvider=0:Ze.tileProvider===Ze.TileProviders.AutoNavi?this.tileProvider=1:this.tileProvider=void 0}_scheduleLoaderRequest(){S(this._analyticsUrl),this._shortSessionLoader||0===this._queuedMessages.length||(this._shortSessionLoader=new Zt(this._analyticsUrl,this,{method:"POST",priority:Kt.Low,retry:!0,withCredentials:this._withCredentials}),this._shortSessionLoader.schedule()),this._sessionLessLoader||0===this._queuedSessionLessMessages.length||(this._sessionLessLoader=new Zt(this._analyticsUrl,{getDataToSend:e=>this.getSessionLessDataToSend(e),loaderDidSucceed:e=>{this.sessionLessLoaderDidSucceed(e)},loaderDidFail:e=>{this.sessionLessLoaderDidFail(e)}},{method:"POST",priority:Kt.Low,retry:!0,withCredentials:this._withCredentials}),this._sessionLessLoader.schedule())}_scheduleLoader(){this._resolveRegisterableDomains().then((()=>{this._scheduleLoaderRequest()}))}_queueAsBackgroundTask(){Mt.scheduleInBackground((()=>this._scheduleLoader()),Mt.Priority.Medium)}_resolveRegisterableDomains(){const e=!!this._reducedHostPlaceholders.ProtocolPlusHost||!!this._reducedHostPlaceholders.Host,t=!!this._reducedHostPlaceholders.ReferrerHost&&document.referrer?new URL(document.referrer):null,i=t?t.hostname:null;return Promise.all([e?Gt.getRegisterableDomain(window.location.hostname):"",Gt.getRegisterableDomain(i)]).then((([e,i])=>{this._registerableHostDomain=e?window.location.port?`${e}:${window.location.port}`:e:"",this._registerableReferrerDomain=i?t&&t.port?`${i}:${t.port}`:i:""}))}_sendPendingData(){if(S(this._analyticsUrl),0!==this._queuedMessages.length){const e=this._queuedMessages.length;if(this.manageAnalyticsTrackingResponse(null,e,!0),"function"==typeof navigator.sendBeacon)navigator.sendBeacon(this._analyticsUrl,this._createShortSessionJson());else{const e=new XMLHttpRequest;e.open("POST",this._analyticsUrl,!1),e.send(this._createShortSessionJson())}}if(0!==this._queuedSessionLessMessages.length){const e=this._queuedSessionLessMessages.length;if(this.manageAnalyticsTrackingResponse(null,e,!0),"function"==typeof navigator.sendBeacon)navigator.sendBeacon(this._analyticsUrl,this._createSessionLessJson());else{const e=new XMLHttpRequest;e.open("POST",this._analyticsUrl,!1),e.send(this._createSessionLessJson())}}}}var $t={writable:!0,value:Symbol()},Jt={writable:!0,value:Symbol()};const Qt=new Xt;function ei(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const ti=Math.PI/180,ii=Math.PI/4,si=2*Math.PI,oi=12,ni=256,ai=Math.PI/3,ri=Math.tan(ai/2);function li(e){const t=c(e,1e-8-90,90-1e-8)*ti;return.5+Math.log(Math.tan(ii-t/2))/si}function hi(e){const t=Math.pow(Math.E,2*Math.PI*(e-.5));return-2*(Math.atan(t)-Math.PI/4)/Math.PI*180}function ci(e){return l(e/360+.5,1)}function di(e){return 360*(l(e,1)-.5)}function ui(e){return l(180+e,360)-180}function pi(e){const t=e*ti,i=111132.92+-559.82*Math.cos(2*t)+1.175*Math.cos(4*t)+-.0023*Math.cos(6*t),s=li(e-.5),o=li(e+.5);return Math.abs(s-o)/i}const mi=1e-8,gi=hi(0),_i=hi(1);function fi(e,t){const i=e.toCoordinate(),s=t.toCoordinate();return o=i.latitude,n=i.longitude,a=s.latitude,r=s.longitude,function(e,t,i,s,o){const n=(i-e)*ti,a=(s-t)*ti,r=Math.pow(Math.sin(n/2),2)+Math.cos(e*ti)*Math.cos(i*ti)*Math.pow(Math.sin(a/2),2),l=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r));return o*l}(o,n,a,r,6378160-21e3*Math.sin(o*ti));var o,n,a,r}class yi{constructor(e,t){if(ei(this,"center",void 0),ei(this,"span",void 0),void 0===e&&(e=new bi),void 0===t&&(t=new vi),!(e instanceof bi))throw Error("[MapKit] `center` is not a Coordinate.");if(!(t instanceof vi))throw Error("[MapKit] `span` is not a CoordinateSpan.");this.center=new bi(e.latitude,e.longitude),this.span=new vi(t.latitudeDelta,t.longitudeDelta)}copy(){return new yi(this.center.copy(),this.span.copy())}toString(){return["CoordinateRegion(","\tlatitude: "+this.center.latitude,"\tlongitude: "+this.center.longitude,"\tlatitudeDelta: "+this.span.latitudeDelta,"\tlongitudeDelta: "+this.span.longitudeDelta,")"].join("\n")}equals(e){return this.center.equals(e.center)&&this.span.equals(e.span)}toBoundingRegion(){const e=this.span.latitudeDelta/2,t=this.span.longitudeDelta/2;return new wi(this.center.latitude+e,ui(this.center.longitude+t),this.center.latitude-e,ui(this.center.longitude-t))}toMapRect(){if(this.span.latitudeDelta<0)this.span.latitudeDelta=0;else{const e=li(Math.abs(this.center.latitude)),t=gi-hi(2*e);this.span.latitudeDelta>t&&(this.span.latitudeDelta=t)}const e=ui(this.center.longitude),t=this.span.longitudeDelta/2;let i=e-t,s=e+t,o=!1;i<-180&&(i+=360,o=!0);let n=!1;s>180&&(s-=360,n=!0);const a=new bi(this.center.latitude,i),r=new bi(this.center.latitude,s),l=a.toMapPoint(),h=r.toMapPoint();o&&(l.x-=1),n&&(h.x+=1);const c=new Si;let d,u;if(0===this.center.latitude)return d=new bi(this.center.latitude+this.span.latitudeDelta/2,this.center.longitude),u=new bi(this.center.latitude-this.span.latitudeDelta/2,this.center.longitude),c.origin.x=l.x,c.size.width=h.x-c.origin.x,c.origin.y=d.toMapPoint().y,c.size.height=u.toMapPoint().y-c.origin.y,c;const p=this.copy();p.center.latitude=_i+this.span.latitudeDelta/2;let m=10,g=new bi;const _=new Ci;d=new bi,u=new bi,d.longitude=this.center.longitude,u.longitude=this.center.longitude;let f=0;do{if(p.center.latitude>gi&&p.center.latitude>this.center.latitude||p.center.latitude<_i&&p.center.latitude<this.center.latitude)p.center.latitude-=m,m*=.1;else if(p.center.latitude>gi||p.center.latitude<_i)return new Si(0,0,1,1);if(f>500)return new Si(0,0,1,1);d.latitude=p.center.latitude+p.span.latitudeDelta/2,u.latitude=p.center.latitude-p.span.latitudeDelta/2,c.origin.x=l.x,c.size.width=h.x-c.origin.x,c.origin.y=d.toMapPoint().y,c.size.height=u.toMapPoint().y-c.origin.y,_.x=c.midX(),_.y=c.midY(),g=_.toCoordinate(),(m>0&&g.latitude>this.center.latitude||m<0&&g.latitude<this.center.latitude)&&(m*=-.1),p.center.latitude+=m,f++}while(Math.abs(g.latitude-this.center.latitude)>=mi);return c}get radius(){const e=this.toMapRect();let t,i;return e.size.width>e.size.height?(t=new Ci(e.minX(),e.midY()),i=new Ci(e.maxX(),e.midY())):(t=new Ci(e.midX(),e.minY()),i=new Ci(e.midX(),e.maxY())),fi(t,i)/2}}class vi{constructor(e,t){if(ei(this,"latitudeDelta",void 0),ei(this,"longitudeDelta",void 0),void 0===e&&(e=0),void 0===t&&(t=0),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] `latitudeDelta` is not a number.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] `longitudeDelta` is not a number.");this.latitudeDelta=Math.max(e,0),this.longitudeDelta=Math.max(t,0)}copy(){return new vi(this.latitudeDelta,this.longitudeDelta)}equals(e){return Math.abs(this.latitudeDelta-e.latitudeDelta)<mi&&Math.abs(this.longitudeDelta-e.longitudeDelta)<mi}toString(){return["CoordinateSpan(","\tlatitudeDelta: "+this.latitudeDelta,"\tlongitudeDelta: "+this.longitudeDelta,")"].join("\n")}}class bi{constructor(e,t){if(ei(this,"latitude",void 0),ei(this,"longitude",void 0),void 0===e&&(e=0),void 0===t&&(t=0),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] `latitude` is not a number.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] `longitude` is not a number.");this.latitude=e,this.longitude=t}copy(){return new bi(this.latitude,this.longitude)}equals(e){return Math.abs(this.latitude-e.latitude)<mi&&Math.abs(this.longitude-e.longitude)<mi}toMapPoint(){return new Ci(ci(this.longitude),li(this.latitude))}toUnwrappedMapPoint(){return new Ci(this.longitude/360+.5,li(this.latitude))}toString(){return["Coordinate(","latitude:"+this.latitude.toFixed(oi),",longitude:"+this.longitude.toFixed(oi),")"].join("")}}class wi{constructor(e,t,i,s){if(ei(this,"northLatitude",void 0),ei(this,"eastLongitude",void 0),ei(this,"southLatitude",void 0),ei(this,"westLongitude",void 0),arguments.length<4&&(s=0,arguments.length<3&&(i=0,arguments.length<2&&(t=0,arguments.length<1&&(e=0)))),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] Expected a number for `northLatitude` in BoundingRegion constructor but got `"+e+"` instead.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] Expected a number for `eastLongitude` in BoundingRegion constructor but got `"+t+"` instead.");if("number"!=typeof i||isNaN(i))throw new TypeError("[MapKit] Expected a number for `southLatitude` in BoundingRegion constructor but got `"+i+"` instead.");if("number"!=typeof s||isNaN(s))throw new TypeError("[MapKit] Expected a number for `westLongitude` in BoundingRegion constructor but got `"+s+"` instead.");this.northLatitude=e,this.eastLongitude=t,this.southLatitude=i,this.westLongitude=s}copy(){return new wi(this.northLatitude,this.eastLongitude,this.southLatitude,this.westLongitude)}toString(){return["BoundingRegion(","\tnorthLatitude: "+this.northLatitude,"\teastLongitude: "+this.eastLongitude,"\tsouthLatitude: "+this.southLatitude,"\twestLongitude: "+this.westLongitude,")"].join("\n")}toCoordinateRegion(){let e=ui(this.eastLongitude);const t=ui(this.westLongitude);e<t&&(e+=360);const i=this.northLatitude-this.southLatitude,s=e-t;return new yi(new bi(this.southLatitude+i/2,ui(t+s/2)),new vi(i,s))}}class Ci{constructor(e,t){if(ei(this,"x",void 0),ei(this,"y",void 0),ei(this,"z",void 0),ei(this,"w",void 0),arguments.length<2&&(t=0,arguments.length<1&&(e=0)),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] Expected a number for `x` in MapPoint constructor but got `"+e+"` instead.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] Expected a number for `y` in MapPoint constructor but got `"+t+"` instead.");this.x=e,this.y=t,this.z=0,this.w=1}toString(){return"MapPoint("+this.x+", "+this.y+")"}copy(){return new Ci(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}toCoordinate(){return new bi(hi(this.y),ui(di(this.x)))}}class ki{constructor(e,t){if(ei(this,"width",void 0),ei(this,"height",void 0),arguments.length<2&&(t=0,arguments.length<1&&(e=0)),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] Expected a number for `width` in MapSize constructor but got `"+e+"` instead.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] Expected a number for `height` in MapSize constructor but got `"+t+"` instead.");this.width=e,this.height=t}toString(){return"MapSize("+this.width+", "+this.height+")"}copy(){return new ki(this.width,this.height)}equals(e){return this.width===e.width&&this.height===e.height}}class Si{constructor(e,t,i,s){if(ei(this,"origin",void 0),ei(this,"size",void 0),arguments.length<4&&(s=0,arguments.length<3&&(i=0,arguments.length<2&&(t=0,arguments.length<1&&(e=0)))),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] Expected a number for `x` in MapRect constructor but got `"+e+"` instead.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] Expected a number for `y` in MapRect constructor but got `"+t+"` instead.");if("number"!=typeof i||isNaN(i))throw new TypeError("[MapKit] Expected a number for `width` in MapRect constructor but got `"+i+"` instead.");if("number"!=typeof s||isNaN(s))throw new TypeError("[MapKit] Expected a number for `height` in MapRect constructor but got `"+s+"` instead.");this.origin=new Ci(e,t),this.size=new ki(i,s)}toString(){return"MapRect("+[this.origin.x.toFixed(oi),this.origin.y.toFixed(oi),this.size.width.toFixed(oi),this.size.height.toFixed(oi)].join(", ")+")"}copy(){return new Si(this.origin.x,this.origin.y,this.size.width,this.size.height)}equals(e){return this.origin.equals(e.origin)&&this.size.equals(e.size)}minX(){return this.origin.x}minY(){return this.origin.y}midX(){return this.origin.x+this.size.width/2}midY(){return this.origin.y+this.size.height/2}maxX(){return this.origin.x+this.size.width}maxY(){return this.origin.y+this.size.height}scale(e,t){if("number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] The `scaleFactor` parameter passed to `MapRect.scale()` is not a number.");const i=this.size.width*e,s=this.size.height*e;if(!t)return new Si(this.midX()-i/2,this.midY()-s/2,i,s);if(!(t instanceof Ci))throw Error("[MapKit] The `scaleCenter` parameter passed to `MapRect.scale()` is not a MapPoint.");return new Si(t.x-e*(t.x-this.origin.x),t.y-e*(t.y-this.origin.y),i,s)}toCoordinateRegion(){const e=this.origin.toCoordinate(),t=new Ci(this.maxX(),this.maxY()).toCoordinate(),i=Math.abs(t.latitude-e.latitude);let s=t.longitude-e.longitude;return t.longitude<e.longitude&&(s+=360),new yi(new Ci(this.midX(),this.midY()).toCoordinate(),new vi(i,s))}}class Mi{constructor(e,t){if(ei(this,"_minCameraDistance",void 0),ei(this,"_maxCameraDistance",void 0),null==t)if("number"==typeof e)t=1/0;else{const i=null==e?{}:e;e="minCameraDistance"in i?i.minCameraDistance:0,t="maxCameraDistance"in i?i.maxCameraDistance:1/0}if("number"!=typeof e||e<0)throw new Error("[MapKit] The `minCameraDistance` property of CameraZoomRange must be a number >= 0");if("number"!=typeof t||t<0)throw new Error("[MapKit] The `maxCameraDistance` property of CameraZoomRange must be a number >= 0");if(t<e)throw new Error("[MapKit] The `maxCameraDistance` property of CameraZoomRange must be greater than the `minCameraDistance` property.");this._minCameraDistance=e,this._maxCameraDistance=t}get minCameraDistance(){return this._minCameraDistance}get maxCameraDistance(){return this._maxCameraDistance}copy(){return new Mi(this._minCameraDistance,this._maxCameraDistance)}}const Li={tileSize:ni,convertLatitudeToY:li,convertYToLatitude:hi,convertLongitudeToX:ci,convertXToLongitude:di,wrapLongitude:ui,wrapX:function(e,t){let i=1.5,s=e;for(let o=-1;o<=1;++o){const n=Math.abs(e+o-t);n<i&&(i=n,s=e+o)}return s},zoomLevelForMapRectInViewport:function(e,t,i){const s=t.width/(i*e.size.width),o=t.height/(i*e.size.height);return Math.log2(Math.min(s,o))},mapUnitsPerMeterAtLatitude:pi,pointsPerAxis:function(e){return Math.pow(2,e)*ni},zoomLevelForCameraDistanceAtLatitudeAndViewportWidth:function(e,t,i){const s=2*(ri*e)*pi(t);return Math.log2(i/s/ni)},CameraZoomRange:Mi,CoordinateRegion:yi,CoordinateSpan:vi,Coordinate:bi,BoundingRegion:wi,MapPoint:Ci,MapRect:Si,MapSize:ki};function xi(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function Ai(e,t){var i=function(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}(e,t,"get");return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}var Ei=new WeakMap;class Ti{_(e,t){if(e!==Y)throw new Error("");return Ai(this,Ei)}constructor(e){let t,i;xi(this,Ei,{writable:!0,value:{resultProviderId:void 0,formattedAddressLines:void 0}}),e.id&&(this.id=e.id,this.alternateIds=e.alternateIds||[]),e.muid&&(this.muid=e.muid),e.mapsId?.resultProviderId&&(Ai(this,Ei).resultProviderId=e.mapsId.resultProviderId),e.placecardUrl&&(this._wpURL=e.placecardUrl),e.style&&e.style.attributes&&(this._styleAttributes=e.style.attributes.map((e=>e.key+":"+e.value)).join(","),e.poiCategory&&-1!==Object.keys(He).indexOf(e.poiCategory)&&(this.pointOfInterestCategory=He[e.poiCategory])),e.name&&(this.name=e.name),e.attribution&&(this._providerId=e.attribution.vendorId,this._providerItemId=e.attribution.externalItemId),e.displayMapRegion&&(t=e.displayMapRegion,i=new wi(t.northLat,t.eastLng,t.southLat,t.westLng),this.region=i.toCoordinateRegion(),this.coordinate=this.region.center),e.formattedAddressLines&&(this.formattedAddress=e.formattedAddressLines.join(", "),Ai(this,Ei).formattedAddressLines=[...e.formattedAddressLines]),e.center&&(this.coordinate=new bi(e.center.lat,e.center.lng)),e.countryCode&&(this.countryCode=e.countryCode),this.telephone=e.telephone,this.urls=e.urls||[],this.country=e.country,this.administrativeArea=e.administrativeArea,this.administrativeAreaCode=e.administrativeAreaCode,this.locality=e.locality,this.postCode=e.postCode,this.subLocality=e.subLocality,this.thoroughfare=e.thoroughfare,this.subThoroughfare=e.subThoroughfare,this.fullThoroughfare=e.fullThoroughfare,this.areasOfInterest=e.areasOfInterest,this.dependentLocalities=e.dependentLocalities,this.timezone=e.timezone,this.timezoneSecondsFromGmt=e.timezoneSecondsFromGmt}}Ti.isConstructable=!1;const Ii=function(e){if(Ti.isConstructable)return new Ti(e);throw new TypeError("[MapKit] Place may not be constructed.")};Ti.prototype.constructor=Ii,Ii.prototype=Ti.prototype;const Oi=Ti;class Ri{constructor(e,t,i,s){this.localeId=e,this._dict=t||{},this.ready=!!t,this.delegate=i,this.rtl=i.rtlLocales.indexOf(e)>-1,this.dow=s}get(e,t){const i=this._dict[e];return i?f(i,t??{},!0):`[${e}]`}load(e){const t=this.localeId,i=this.delegate.localeUrl.replace(/{{(.*?)}}/,t),s=new me(i,{loaderDidSucceed:(i,s)=>{if(s.status<200||s.status>=300){const i=new Error(`HTTP error ${s.status} loading strings for locale: ${t}`);e(i,this)}else{try{this._dict=JSON.parse(s.responseText??"")}catch(i){const s=new Error(`Failed to parse response for locale: ${t}`);return void e(s,this)}this.ready=!0,e(null,this)}},loaderDidFail:(i,s)=>{const o=new Error(`Network error loading strings for locale: ${t}`);e(o,this)}},{withCredentials:this.delegate.withCredentials});s.schedule()}}const Pi=Object.freeze({"ar-SA":6,"ca-ES":1,"cs-CZ":1,"da-DK":1,"de-DE":1,"el-GR":1,"en-AU":1,"en-GB":1,"en-US":0,"en-ZA":0,"es-ES":1,"es-MX":1,"fi-FI":1,"fr-CA":0,"fr-FR":1,"he-IL":0,"hi-IN":0,"hr-HR":1,"hu-HU":1,"id-ID":1,"it-IT":1,"ja-JP":0,"ko-KR":0,"ms-MY":1,"nb-NO":1,"nl-NL":1,"pl-PL":1,"pt-BR":0,"pt-PT":1,"ro-RO":1,"ru-RU":1,"sk-SK":1,"sv-SE":1,"th-TH":0,"tr-TR":1,"uk-UA":1,"vi-VN":1,"zh-CN":1,"zh-HK":0,"zh-TW":0}),Di=["0","1","2","3","4","5","6","7","8","9"],zi={"ar-SA":["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"],"hi-IN":["०","१","२","३","४","५","६","७","८","९"]},Ni=",",Fi={"ca-ES":Ni,"ca-CZ":Ni,"da-DK":Ni,"da-DE":Ni,"el-GR":Ni,"en-ZA":Ni,"es-ES":Ni,"fi-FI":Ni,"fr-CA":Ni,"fr-FR":Ni,"hr-HR":Ni,"hu-HU":Ni,"it-IT":Ni,"nb-NO":Ni,"nl-NL":Ni,"pl-PL":Ni,"pt-BR":Ni,"pt-PT":Ni,"ro-RO":Ni,"ru-RU":Ni,"sk-SK":Ni,"sv-SE":Ni,"tr-TR":Ni,"uk-UA":Ni};const Ui="en-US",Gi=new WeakSet,Wi=new WeakSet,Bi=(e,t)=>{const{language:i,region:s}=t;e.supportMap[i]=e.supportMap[i]||[],s&&-1!==e.delegate.primaryLocales.indexOf(t.tag)?e.supportMap[i].splice(0,0,s):s&&e.supportMap[i].push(s)},Zi=(e,t,i)=>new Ri(t,i??null,e.delegate,e.dowForBestMatch(t)),Ki=(e,t)=>{e.locales[t.localeId]||(e.locales[t.localeId]=t),e.activeLocale=t,e.dispatchEvent(new Hi(t))},ji=(e,t)=>-1!==e.delegate.supportedLocales.indexOf(t);class Hi extends N{constructor(e){super(qi.Events.LocaleChanged),this.locale=e}}class qi extends z{constructor(e){super(),this.delegate=e,this._requestedLocaleId="",this.locales=e.localesCache||Object.create(null),this.supportMap=e.supportCache||Object.create(null),this.scriptMap=e.scriptCache||Object.create(null),this.Events=qi.Events,(e=>{if(!Gi.has(e.supportMap)){Gi.add(e.supportMap);for(const t of e.delegate.supportedLocales){const i=v.parse(t);i&&Bi(e,i)}}})(this);const t=this.locales[Ui]||Zi(this,Ui,this.delegate.enUSDictionary);this.locales[t.localeId]||(this.locales[t.localeId]=t),this.activeLocale=t,(e=>{if(Wi.has(e.scriptMap))return;Wi.add(e.scriptMap);const t=e.delegate.regionToScriptMap;for(const[i,s]of Object.entries(t)){e.scriptMap[i]={};for(const[t,o]of Object.entries(s))e.scriptMap[i][o.toLowerCase()]=t}})(this)}get(e,t){return this.activeLocale.get(e,t)??`[${e}]`}get localeId(){return this.activeLocale.localeId??""}set localeId(e){this._requestedLocaleId!==e&&((e,t)=>{e._requestedLocaleId=t;let i=t;if(ji(e,t)||(i=e.bestMatch(t,Ui)),e.activeLocale.localeId===i)return;let s=i?e.locales[i]:null;s||!i||(s=Zi(e,i),s.ready)?s&&Ki(e,s):s.load(((i,s)=>{if(e._requestedLocaleId===t)return i?(e._requestedLocaleId=Ui,void Ki(e,e.locales[Ui])):void Ki(e,s)}))})(this,e)}get loaded(){return!!this._requestedLocaleId&&this.bestMatch(this._requestedLocaleId,Ui)===this.localeId}get requestedLocaleId(){return this._requestedLocaleId}set requestedLocaleId(e){console.warn("l10n: requestedLocaleId can't be set, use localeId.")}get localeIds(){return Object.keys(this.locales)}get supportedLocaleIds(){return this.delegate.supportedLocales}bestMatch(e,t){let i="string"==typeof e?v.parse(e):null,s=null;if(i&&this.delegate.localesMap){const e=this.delegate.localesMap;e[i.tag]?i=v.parse(e[i.tag]):e[i.language]&&(i=v.parse(e[i.language]))}return t=t||null,i&&(s=((e,t)=>{const{language:i,region:s,script:o}=t;let n;const a=e.supportMap[i];if(!a)return null;if(s&&(n=a.find((e=>e.toUpperCase()===t.region?.toUpperCase()))),!n&&o){const t=e.scriptMap[i]?.[o.toLowerCase()];n=t??n}return n||(n=a[0]),new v(i,n)})(this,i)),s?s.tag:t}dowForBestMatch(e,t){const i=this.bestMatch(e,t);return i&&i in Pi?Pi[i]:0}digits(e){return function(e,t){const i=zi[t]||Di,s=Fi[t]||".";let o="";const n=e.toString();for(let e=0,t=n.length;e<t;++e){const t=n.charAt(e);o+="."===t?s:i[parseInt(t,10)]||t}return o}(e,this.localeId)}}qi.Events=Object.freeze({LocaleChanged:"locale-changed"}),qi.Days=Object.freeze({Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6}),qi.LocaleChangedEvent=Hi;const Vi=["AS","BS","BZ","DM","FK","GB","GD","GU","KN","KY","LC","LR","MM","MP","SH","TC","US","VC","VG","VI","WS"],Yi=e=>{const t=e.region;return t?Vi.indexOf(t)<0:"en"!==e.language&&"my"!==e.language},Xi={supportedLocales:["ar-SA","bn-BD","ca-ES","cs-CZ","da-DK","de-DE","el-GR","en-GB","en-US","es-ES","es-MX","fi-FI","fr-CA","fr-FR","gu-IN","he-IL","hi-IN","hr-HR","hu-HU","id-ID","it-IT","ja-JP","kn-IN","ko-KR","ml-IN","mr-IN","ms-MY","nb-NO","nl-NL","or-IN","pa-IN","pl-PL","pt-BR","pt-PT","ro-RO","ru-RU","sk-SK","sl-SI","sv-SE","ta-IN","te-IN","th-TH","tr-TR","uk-UA","ur-PK","vi-VN","zh-CN","zh-HK","zh-TW"],primaryLocales:["en-US","fr-FR","pt-BR","zh-CN"],localesMap:C,regionToScriptMap:w,rtlLocales:["ar-SA","he-IL","ur-PK"],enUSDictionary:{"Annotation.Clustering.AccessibilityLabel":"{{n}} locations, {{title}}, {{subtitle}}","Annotation.Clustering.More":"+{{n}} more","Annotation.Clustering.More.Plural":"+{{n}} more","Annotation.Clustering.NoTitle.AccessibilityLabel":"{{n}} locations, {{subtitle}}","Annotation.Generic.AccessibilityLabel":"{{title}}, {{subtitle}}","Annotation.Marker.AccessibilityLabel":"Marker","Annotation.Pin.AccessibilityLabel":"Pin","Annotation.Pin.Green.AccessibilityLabel":"Green Pin","Annotation.Pin.Purple.AccessibilityLabel":"Purple Pin","Annotation.Pin.Red.AccessibilityLabel":"Red Pin",Compass:"Compass","Compass.Degrees.Plural":"{{n}} degrees","Compass.Degrees.Single":"{{n}} degree","Compass.EastIndicator":"E","Compass.Heading":"Heading: {{heading}}","Compass.NorthIndicator":"N","Compass.SouthIndicator":"S","Compass.Tooltip":"Rotate the map","Compass.Tooltip.Reset":"Reset heading","Compass.WestIndicator":"W",Done:"Done","Legal.Apple.URL":"https://www.apple.com/legal/internet-services/maps/legal-en.html","Legal.Label":"Legal","Legal.Label.Imagery":"Imagery","Legal.Label.Report":"Report","Location.Error.Message":"Your location can only be shown when location services are enabled and you are connected to the Internet.","Location.Error.Support.Label":"Learn more","Location.Subtitle":"Unknown Address","Location.Title":"Current Location","Logo.Apple.Tooltip":"Apple Maps","Logo.AutoNavi.Tooltip":"AutoNavi Maps","LookAround.Error.Unavailable":"Imagery is not available","LookAround.Label":"Look Around","MapType.Tooltip":"Change the map type","Mode.Hybrid":"Hybrid","Mode.Satellite":"Satellite","Mode.Standard":"Standard","OpenDialog.Enter":"Enter Fullscreen Mode","OpenDialog.Exit":"Exit Fullscreen Mode","OpenInAppleMaps.Label":"Open in Apple Maps","Place.Error.Message":"Could not load place details.","Place.Error.Title":"Place Unavailable","Scale.Feet.Short":"ft","Scale.Kilometer.Short":"km","Scale.Meter.Short":"m","Scale.Mile.Short":"mi","Track.User.Location.Tooltip":"Show your current location","Zoom.In.Tooltip":"Zoom In","Zoom.Out.Tooltip":"Zoom Out"},get localeUrl(){return It.createUrl("locales/{{locale}}/strings.json")},get withCredentials(){return Ze.urlWithCredentials(this.localeUrl)}},$i=new qi(Xi),Ji=Object.create(null);A(L,Xi.supportedLocales,$i.supportMap,Ji);let Qi=!1;$i.addEventListener(qi.Events.LocaleChanged,(()=>{const e=v.parse($i.requestedLocaleId);Qi=Yi(e)}));Ze.setL10n($i,(function(){E(L,Xi.supportedLocales,$i.supportMap,Ji)}));const es=$i,ts=(e,t)=>{const i=new Uint8Array(atob(e).split("").map((e=>e.charCodeAt(0)))),s=new Uint8Array(atob(t).split("").map((e=>e.charCodeAt(0))));return btoa(String.fromCharCode(...i.map(((e,t)=>e^s[t%s.length]))))},is=btoa("Copyright (c) Apple Inc. All rights reserved."),ss=new WeakMap;class os{constructor(e,t){this._delegate=t,this._handleConfigChangedListener=()=>this._handleConfigChanged(),Ze.addEventListener(Ze.Events.Changed,this._handleConfigChangedListener),this._handleLocaleChangedListener=e=>this._handleLocaleChanged(e),es.addEventListener(es.Events.LocaleChanged,this._handleLocaleChangedListener),this._container=e}update(){this._delegate.place&&Ze.ready?this._renderPlaceIframe():this._removeIframeElement()}destroy(){this._removeIframeElement(),Ze.removeEventListener(Ze.Events.Changed,this._handleConfigChangedListener),es.removeEventListener(es.Events.LocaleChanged,this._handleLocaleChangedListener)}_handleLocaleChanged(){this.update()}_handleConfigChanged(){this.update()}_getPlaceAsUrlParams(){const t=this._delegate.place,i=new URLSearchParams;return i.append("uiStyle",this._delegate.uiStyle),t.muid&&i.append("auid",t.muid),t.formattedAddress&&i.append("address",t.formattedAddress),t.coordinate&&i.append("ll",`${t.coordinate.latitude},${t.coordinate.longitude}`),t.name&&i.append("q",t.name),i.append("countryCode",Ze.countryCode||""),i.append("lang",es.localeId),i.append("mapkitVersion",e.version),Ze.enableSourceMap&&i.append("sourcemap","1"),`${Ze.uiBaseUrl}/v1/place?${i.toString()}`}_renderPlaceIframe(){this._iframeElement||(this._iframeElement=document.createElement("iframe"),this._container.appendChild(this._iframeElement),this._handleMessageEventListener=e=>this._handleMessageEvent(e),window.addEventListener("message",this._handleMessageEventListener),this._iframeElement.style.display="block",this._iframeElement.style.width="100%",this._iframeElement.style.height="0",this._iframeElement.style.border="none","standalone"===this._delegate.uiStyle&&(this._iframeElement.style.maxWidth="380px",this._iframeElement.style.minWidth="240px",this._iframeElement.style.margin="0 auto",this._iframeElement.style.borderRadius="18px"),this._iframeContentWindowReady=!1);const t=this._getPlaceAsUrlParams();t!==this._iframeElement.src?(this._iframeElement.src=t,this._iframeLoadingTimeout=window.setTimeout((()=>this._frameLoadingDidFail()),3e4)):(k("standalone"===this._delegate.uiStyle||this._delegate.colorScheme),this._postMessage({action:"set-options",placeKey:ss.get(this),mapkitVersion:e.version,colorScheme:this._delegate.colorScheme,displaysMap:this._delegate.displaysMap}))}_postMessage(e){if(!this._iframeContentWindowReady)return;const t=this._iframeElement.contentWindow;t&&t.postMessage(e,new URL(this._iframeElement.src).origin)}_handleMessageEvent(t){if(t.source===this._iframeElement.contentWindow)switch(t.data.action&&(clearTimeout(this._iframeLoadingTimeout),this._iframeContentWindowReady=!0),t.data.action){case"ready":{const i=ts(is,t.data.key);ss.set(this,i),k("standalone"===this._delegate.uiStyle||this._delegate.colorScheme);const s={action:"render-place",placeKey:i,accessToken:Ze.accessToken,mapkitVersion:e.version,colorScheme:this._delegate.colorScheme,displaysMap:this._delegate.displaysMap};Ze._showMapsLogo||(s.showMapsLogo=!1),this._postMessage(s);break}case"update-size":{const e=t.data.width,i=t.data.height;this._iframeElement.style.height=`${i}px`,this._delegate.placeCardSizeDidChange&&this._delegate.placeCardSizeDidChange(e,i);break}case"place-card-did-reveal":this._delegate.placeCardDidReveal&&this._delegate.placeCardDidReveal(t.data.analyticsState);break;case"open-in-maps-clicked":this._delegate.placeCardOpenInMapsClicked&&this._delegate.placeCardOpenInMapsClicked(t.data.analyticsState)}}_frameLoadingDidFail(){this._delegate.loadingDidFail&&this._delegate.loadingDidFail()}_removeIframeElement(){this._iframeElement&&(this._container.removeChild(this._iframeElement),window.removeEventListener("message",this._handleMessageEventListener),clearTimeout(this._iframeLoadingTimeout),this._iframeElement=void 0)}}const ns=[];class as{constructor(e,t=null,i={}){if(!e||!he(e))throw new Error("[MapKit] `parent` must be a DOM element.");const s=this;this._impl={controllerDelegate:{get colorScheme(){return s._impl.colorScheme},get displaysMap(){return s._impl.displaysMap},get place(){return s._impl.place},uiStyle:"standalone",placeCardDidReveal(e){Qt.log(Qt.Events.PlaceDetailReveal,{eventValue:"LARGE",eventTarget:"PLACECARD_TRAY",states:{PLACE_CARD:()=>e}})},placeCardOpenInMapsClicked(e){Qt.log(Qt.Events.PlaceDetailOpenAppleMaps,{eventTarget:"PLACECARD_TRAY",states:{PLACE_CARD:()=>e}})}},element:e,shadowRoot:e.attachShadow({mode:Ze.shadowDOMMode||"closed"}),controller:void 0,colorScheme:void 0,displaysMap:void 0,place:null,destroyed:!1},this._impl.controller=new os(this._impl.shadowRoot,this._impl.controllerDelegate),void 0!==i.colorScheme?this.colorScheme=i.colorScheme:this.colorScheme=Je.Light,void 0!==i.displaysMap?this.displaysMap=i.displaysMap:this.displaysMap=!0,this.place=t,ns.push(this)}get element(){return this._impl.element}get place(){return this._impl.place}set place(e){this._impl.destroyed||e!==this._impl.place&&(null!==e&&m(e,Oi,"[MapKit] The `place` parameter must be a Place."),this._impl.place=e,this._impl.controller.update())}get colorScheme(){return this._impl.colorScheme}set colorScheme(e){if(!this._impl.destroyed&&e!==this._impl.colorScheme){if(!d(e,Je))throw new Error("[MapKit] Unknown value for `colorScheme`. Choose from `PlaceDetail.ColorSchemes`.");this._impl.colorScheme=e,this._impl.controller.update()}}get displaysMap(){return this._impl.displaysMap}set displaysMap(e){this._impl.destroyed||e!==this._impl.displaysMap&&(this._impl.displaysMap=!!e,this._impl.controller.update())}destroy(){this._impl.destroyed||(this._impl.destroyed=!0,this._impl.controller.destroy(),ns.splice(ns.indexOf(this),1))}}as.ColorSchemes=Je;class rs{static Zero=new rs;width;height;constructor(e,t){this.width=e??0,this.height=t??0}toString(){return`Size[${this.width}, ${this.height}]`}copy(){return new rs(this.width,this.height)}equals(e){return this.width===e.width&&this.height===e.height}}const ls=rs;class hs{static Zero=new hs;x;y;z;constructor(e,t,i){this.x=e??0,this.y=t??0,this.z=i??0}toString(){return`Point[${this.x}, ${this.y}, ${this.z}]`}copy(){return new hs(this.x,this.y,this.z)}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}distanceToPoint(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)+Math.pow(this.z-e.z,2))}}const cs=hs;class ds{static Zero=new ds;origin;size;constructor(e,t,i,s){this.origin=new hs(e,t),this.size=new rs(i,s)}static rectFromClientRect(e){const{left:t,top:i,width:s,height:o}=e;return new ds(t,i,s,o)}static unionOfRects(e){return e.reduce(((e,t)=>e._updateToUnion(t)),e[0].copy())}_update(e,t,i,s){return this.origin.x=e,this.origin.y=t,this.size.width=i,this.size.height=s,this}_updateToIntersect(e){const t=Math.max(this.minX(),e.minX()),i=Math.min(this.maxX(),e.maxX());if(t>i)return this._update(0,0,0,0);const s=Math.max(this.minY(),e.minY()),o=Math.min(this.maxY(),e.maxY());return s>o?this._update(0,0,0,0):this._update(t,s,i-t,o-s)}_updateToUnion(e){const t=Math.min(this.minX(),e.minX()),i=Math.min(this.minY(),e.minY()),s=Math.max(this.maxX(),e.maxX())-t,o=Math.max(this.maxY(),e.maxY())-i;return this._update(t,i,s,o)}toString(){const{x:e,y:t}=this.origin,{width:i,height:s}=this.size;return`Rect[${e}, ${t}, ${i}, ${s}]`}copy(){return new ds(this.origin.x,this.origin.y,this.size.width,this.size.height)}equals(e){return this.origin.equals(e.origin)&&this.size.equals(e.size)}inset(e,t,i,s){return new ds(this.origin.x+e,this.origin.y+t,this.size.width-e-i,this.size.height-t-s)}pad(e){return new ds(this.origin.x-e,this.origin.y-e,this.size.width+2*e,this.size.height+2*e)}minX(){return this.origin.x}minY(){return this.origin.y}midX(){return this.origin.x+this.size.width/2}midY(){return this.origin.y+this.size.height/2}maxX(){return this.origin.x+this.size.width}maxY(){return this.origin.y+this.size.height}intersectionWithRect(e){return this.copy()._updateToIntersect(e)}unionWithRect(e){return this.copy()._updateToUnion(e)}round(){return new ds(Math.floor(this.origin.x),Math.floor(this.origin.y),Math.ceil(this.size.width),Math.ceil(this.size.height))}}const us=ds;class ps{_data;constructor(e,t,i,s,o,n,a,r,l,h,c,d,u,p,m,g){this._data=ms();const _="string"==typeof e,f=Array.isArray(e);if(_||f){const t="none"===e?[]:f?e:(e.match(/\bmatrix(?:3d)?\(([^)]+)\)/)?.[1]??"").split(",").map((e=>parseFloat(e)));16===t.length?(this.m11=t[0],this.m12=t[1],this.m13=t[2],this.m14=t[3],this.m21=t[4],this.m22=t[5],this.m23=t[6],this.m24=t[7],this.m31=t[8],this.m32=t[9],this.m33=t[10],this.m34=t[11],this.m41=t[12],this.m42=t[13],this.m43=t[14],this.m44=t[15]):6===t.length&&(this.a=t[0],this.b=t[1],this.c=t[2],this.d=t[3],this.e=t[4],this.f=t[5])}else{const _=void 0!==o&&void 0!==n,f=void 0!==e&&void 0!==t&&void 0!==i&&void 0!==s;f&&(_&&void 0!==a&&void 0!==r)&&(void 0!==l&&void 0!==h&&void 0!==c&&void 0!==d)&&(void 0!==u&&void 0!==p&&void 0!==m&&void 0!==g)?(this.m11=e,this.m12=t,this.m13=i,this.m14=s,this.m21=o,this.m22=n,this.m23=a,this.m24=r,this.m31=l,this.m32=h,this.m33=c,this.m34=d,this.m41=u,this.m42=p,this.m43=m,this.m44=g):f&&_&&(this.a=e,this.b=t,this.c=i,this.d=s,this.e=o,this.f=n)}}get a(){return this._data[0][0]}get b(){return this._data[0][1]}get c(){return this._data[1][0]}get d(){return this._data[1][1]}get e(){return this._data[3][0]}get f(){return this._data[3][1]}get m11(){return this._data[0][0]}get m12(){return this._data[0][1]}get m13(){return this._data[0][2]}get m14(){return this._data[0][3]}get m21(){return this._data[1][0]}get m22(){return this._data[1][1]}get m23(){return this._data[1][2]}get m24(){return this._data[1][3]}get m31(){return this._data[2][0]}get m32(){return this._data[2][1]}get m33(){return this._data[2][2]}get m34(){return this._data[2][3]}get m41(){return this._data[3][0]}get m42(){return this._data[3][1]}get m43(){return this._data[3][2]}get m44(){return this._data[3][3]}set a(e){this._data[0][0]=e}set b(e){this._data[0][1]=e}set c(e){this._data[1][0]=e}set d(e){this._data[1][1]=e}set e(e){this._data[3][0]=e}set f(e){this._data[3][1]=e}set m11(e){this._data[0][0]=e}set m12(e){this._data[0][1]=e}set m13(e){this._data[0][2]=e}set m14(e){this._data[0][3]=e}set m21(e){this._data[1][0]=e}set m22(e){this._data[1][1]=e}set m23(e){this._data[1][2]=e}set m24(e){this._data[1][3]=e}set m31(e){this._data[2][0]=e}set m32(e){this._data[2][1]=e}set m33(e){this._data[2][2]=e}set m34(e){this._data[2][3]=e}set m41(e){this._data[3][0]=e}set m42(e){this._data[3][1]=e}set m43(e){this._data[3][2]=e}set m44(e){this._data[3][3]=e}translate(e,t,i){e=e||0,t=t||0,i=i||0;const[s,o,n,a]=this._data[0],[r,l,h,c]=this._data[1],[d,u,p,m]=this._data[2];return this._data[3][0]+=e*s+t*r+i*d,this._data[3][1]+=e*o+t*l+i*u,this._data[3][2]+=e*n+t*h+i*p,this._data[3][3]+=e*a+t*c+i*m,this}scale(e,t,i){return e=e||1,t=t||e,i=i||1,this._data[0][0]*=e,this._data[0][1]*=e,this._data[0][2]*=e,this._data[0][3]*=e,this._data[1][0]*=t,this._data[1][1]*=t,this._data[1][2]*=t,this._data[1][3]*=t,this._data[2][0]*=i,this._data[2][1]*=i,this._data[2][2]*=i,this._data[2][3]*=i,this}rotate(e){return this.rotateAxisAngle(0,0,1,e)}rotateAxisAngle(e,t,i,s){0===e&&0===t&&0===i&&(i=1);const o=Math.sqrt(e*e+t*t+i*i);1!==o&&(e/=o,t/=o,i/=o),s=gs(s);const n=Math.sin(s),a=Math.cos(s),r=new ps;if(1===e&&0===t&&0===i)r._data[0][0]=1,r._data[0][1]=0,r._data[0][2]=0,r._data[1][0]=0,r._data[1][1]=a,r._data[1][2]=n,r._data[2][0]=0,r._data[2][1]=-n,r._data[2][2]=a,r._data[0][3]=r._data[1][3]=r._data[2][3]=0,r._data[3][0]=r._data[3][1]=r._data[3][2]=0,r._data[3][3]=1;else if(0===e&&1===t&&0===i)r._data[0][0]=a,r._data[0][1]=0,r._data[0][2]=-n,r._data[1][0]=0,r._data[1][1]=1,r._data[1][2]=0,r._data[2][0]=n,r._data[2][1]=0,r._data[2][2]=a,r._data[0][3]=r._data[1][3]=r._data[2][3]=0,r._data[3][0]=r._data[3][1]=r._data[3][2]=0,r._data[3][3]=1;else if(0===e&&0===t&&1===i)r._data[0][0]=a,r._data[0][1]=n,r._data[0][2]=0,r._data[1][0]=-n,r._data[1][1]=a,r._data[1][2]=0,r._data[2][0]=0,r._data[2][1]=0,r._data[2][2]=1,r._data[0][3]=r._data[1][3]=r._data[2][3]=0,r._data[3][0]=r._data[3][1]=r._data[3][2]=0,r._data[3][3]=1;else{const s=1-a;r._data[0][0]=a+e*e*s,r._data[0][1]=t*e*s+i*n,r._data[0][2]=i*e*s-t*n,r._data[1][0]=e*t*s-i*n,r._data[1][1]=a+t*t*s,r._data[1][2]=i*t*s+e*n,r._data[2][0]=e*i*s+t*n,r._data[2][1]=t*i*s-e*n,r._data[2][2]=a+i*i*s,r._data[0][3]=r._data[1][3]=r._data[2][3]=0,r._data[3][0]=r._data[3][1]=r._data[3][2]=0,r._data[3][3]=1}return this.multiply(r)}multiply(e){const[t,i,s,o]=e._data[0],[n,a,r,l]=e._data[1],[h,c,d,u]=e._data[2],[p,m,g,_]=e._data[3],[f,y,v,b]=this._data[0],[w,C,k,S]=this._data[1],[M,L,x,A]=this._data[2],[E,T,I,O]=this._data[3];return this._data[0][0]=t*f+i*w+s*M+o*E,this._data[0][1]=t*y+i*C+s*L+o*T,this._data[0][2]=t*v+i*k+s*x+o*I,this._data[0][3]=t*b+i*S+s*A+o*O,this._data[1][0]=n*f+a*w+r*M+l*E,this._data[1][1]=n*y+a*C+r*L+l*T,this._data[1][2]=n*v+a*k+r*x+l*I,this._data[1][3]=n*b+a*S+r*A+l*O,this._data[2][0]=h*f+c*w+d*M+u*E,this._data[2][1]=h*y+c*C+d*L+u*T,this._data[2][2]=h*v+c*k+d*x+u*I,this._data[2][3]=h*b+c*S+d*A+u*O,this._data[3][0]=p*f+m*w+g*M+_*E,this._data[3][1]=p*y+m*C+g*L+_*T,this._data[3][2]=p*v+m*k+g*x+_*I,this._data[3][3]=p*b+m*S+g*A+_*O,this}skewX(e){return this._skew(e,0)}skewY(e){return this._skew(0,e)}isAffine(){return 0===this._data[0][2]&&0===this._data[0][3]&&0===this._data[1][2]&&0===this._data[1][3]&&0===this._data[2][0]&&0===this._data[2][1]&&1===this._data[2][2]&&0===this._data[2][3]&&0===this._data[3][2]&&1===this._data[3][3]}inverse(){if(this._isIdentityOrTranslation())return 0===this._data[3][0]&&0===this._data[3][1]&&0===this._data[3][2]||(this._data[3][0]*=-1,this._data[3][1]*=-1,this._data[3][2]*=-1),this;const e=new ps;return ps._inverse(this,e)?e:new ps}transformPoint(e){const[t,i,s]=this._data[0],[o,n,a]=this._data[1],[r,l,h]=this._data[2],[c,d,u]=this._data[3],{x:p,y:m,z:g}=e;return new hs(t*p+o*m+r*g+c,i*p+n*m+l*g+d,s*p+a*m+h*g+u)}toString(){if(this.isAffine()){const[e,t]=this._data[0],[i,s]=this._data[1],[o,n]=this._data[3];return`matrix(${e}, ${t}, ${i}, ${s}, ${o}, ${n})`}return`matrix3d(${this._data.map((e=>e.join(", "))).join(", ")})`}_isIdentityOrTranslation(){return 1===this._data[0][0]&&0===this._data[0][1]&&0===this._data[0][2]&&0===this._data[0][3]&&0===this._data[1][0]&&1===this._data[1][1]&&0===this._data[1][2]&&0===this._data[1][3]&&0===this._data[2][0]&&0===this._data[2][1]&&1===this._data[2][2]&&0===this._data[2][3]&&1===this._data[3][3]}_skew(e,t){const i=new ps;return i._data[0][1]=Math.tan(gs(t)),i._data[1][0]=Math.tan(gs(e)),this.multiply(i)}_determinant(){const[e,t,i,s]=this._data[0],[o,n,a,r]=this._data[1],[l,h,c,d]=this._data[2],[u,p,m,g]=this._data[3];return e*fs(n,h,p,a,c,m,r,d,g)-t*fs(o,l,u,a,c,m,r,d,g)+i*fs(o,l,u,n,h,p,r,d,g)-s*fs(o,l,u,n,h,p,a,c,m)}static _inverse(e,t){ps._adjoint(e,t);const i=e._determinant();if(Math.abs(i)<1e-8)return!1;for(let e=0;e<4;e+=1)for(let s=0;s<4;s+=1)t._data[e][s]=t._data[e][s]/i;return!0}static _adjoint(e,t){const[i,s,o,n]=e._data[0],[a,r,l,h]=e._data[1],[c,d,u,p]=e._data[2],[m,g,_,f]=e._data[3];t._data[0][0]=+fs(r,d,g,l,u,_,h,p,f),t._data[1][0]=-fs(a,c,m,l,u,_,h,p,f),t._data[2][0]=+fs(a,c,m,r,d,g,h,p,f),t._data[3][0]=-fs(a,c,m,r,d,g,l,u,_),t._data[0][1]=-fs(s,d,g,o,u,_,n,p,f),t._data[1][1]=+fs(i,c,m,o,u,_,n,p,f),t._data[2][1]=-fs(i,c,m,s,d,g,n,p,f),t._data[3][1]=+fs(i,c,m,s,d,g,o,u,_),t._data[0][2]=+fs(s,r,g,o,l,_,n,h,f),t._data[1][2]=-fs(i,a,m,o,l,_,n,h,f),t._data[2][2]=+fs(i,a,m,s,r,g,n,h,f),t._data[3][2]=-fs(i,a,m,s,r,g,o,l,_),t._data[0][3]=-fs(s,r,d,o,l,u,n,h,p),t._data[1][3]=+fs(i,a,c,o,l,u,n,h,p),t._data[2][3]=-fs(i,a,c,s,r,d,n,h,p),t._data[3][3]=+fs(i,a,c,s,r,d,o,l,u)}}const ms=()=>[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],gs=e=>e/180*Math.PI,_s=(e,t,i,s)=>e*s-t*i,fs=(e,t,i,s,o,n,a,r,l)=>e*_s(o,n,r,l)-s*_s(t,i,r,l)+a*_s(t,i,o,n),ys=ps;function vs(e){const t=e.getBoundingClientRect(),i=e.offsetWidth,s=e.offsetHeight,o=[new hs(0,0),new hs(i,0),new hs(i,s),new hs(0,s)];let n=new ps;const a=e.ownerDocument.defaultView;let r,l=e;for(;a&&l.nodeType===Node.ELEMENT_NODE&&(r=a.getComputedStyle(e),n=new ps(r.transform).multiply(n),l.parentNode);)l=l.parentNode;let h=1/0,c=1/0;o.forEach((function(e){const t=n.transformPoint(e);h=Math.min(h,t.x),c=Math.min(c,t.y)}));const d=window.pageXOffset+t.left-h,u=window.pageYOffset+t.top-c;return(new ps).translate(d,u).multiply(n)}function bs(e,t){return vs(e).inverse().transformPoint(t)}function ws(e,t){return vs(e).transformPoint(t)}const Cs={fromPageToElement:bs,fromElementToPage:ws};let ks=[],Ss=!1;function Ms(){const e=ks;ks=[];const t=[];for(let i=0,s=e.length;i<s;++i){const s=e[i].scene;if(s&&Ls(t,s)){const e=s.performanceMeasureName?performance.now():void 0;s.renderer.update(),s.performanceMeasureName&&performance.measure(s.performanceMeasureName,{start:e}),s.sceneDidUpdate&&s.sceneDidUpdate(s,Ss)}}}function Ls(e,t){return-1===e.indexOf(t)&&(e.push(t),!0)}const xs={scheduleNode(e){Ls(ks,e)&&1===ks.length&&Mt.scheduleDraw(Ms)},flush(e){Ss=!0;const t=ks;ks=[];const i=[];for(let s=0,o=t.length;s<o;++s)t[s].scene===e?ks.push(t[s]):i.push(t[s]);Ms(),Ss=!1,ks=i}};function As(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function Es(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ts(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}const Is=(new ys).toString();var Os=new WeakSet;class Rs{constructor(){As(this,Os),Es(this,"_parent",null),Es(this,"_children",[]),Es(this,"_renderer",null),Es(this,"_opacity",1),Es(this,"_size",new ls),Es(this,"_position",new cs),Es(this,"_transform",new ys),Es(this,"_frozen",!1),Es(this,"_keyForFrozenLayer",""),Es(this,"_wantsLayerBacking",!1),Es(this,"animators",void 0),Es(this,"repeatOffset",void 0),Es(this,"isScene",!1),Es(this,"_element",void 0)}get element(){return this._element}set element(e){this._element=e}stringInfo(){return"BaseNode"}extraInfo(){return[]}get scene(){let e;for(e=this;e;e=e._parent)if(e.isScene)return e}get renderer(){return this._renderer}get wantsLayerBacking(){return!!this.keyForFrozenLayer||this._frozen||this._wantsLayerBacking||this._needsLayerBacking()}set wantsLayerBacking(e){e!==this._wantsLayerBacking&&(this._wantsLayerBacking=e,this.needsDisplay=!0)}get frozen(){return!!this.keyForFrozenLayer||this._frozen}set frozen(e){e!==this._frozen&&(this._frozen=e,this.needsDisplay=!0)}get keyForFrozenLayer(){return this._keyForFrozenLayer}set keyForFrozenLayer(e){e!==this._keyForFrozenLayer&&(this._keyForFrozenLayer=e,this.needsDisplay=!0)}get opacity(){return this._opacity}set opacity(e){(e=Math.min(Math.max(0,e),1))!==this._opacity&&(this._opacity=e,this.needsDisplay=!0)}get position(){return this._position}set position(e){e.equals(this._position)||(this._position=e.copy(),this.needsDisplay=!0)}get transform(){return this._transform}set transform(e){this._transform=e,this.needsDisplay=!0}get size(){return this._size}set size(e){this._size=e||new ls,this.needsDisplay=!0}get bounds(){return new us(this._position.x,this._position.y,this.size.width,this.size.height)}get layerBounds(){let e=new us(0,0,this.size.width,this.size.height);const t=this._children;for(let i=0,s=t.length;i<s;++i){const s=t[i],o=s.layerBounds;o.origin.x+=s._position.x,o.origin.y+=s._position.y;const n=s.transform,a=[n.transformPoint(new cs(o.minX(),o.minY())),n.transformPoint(new cs(o.maxX(),o.minY())),n.transformPoint(new cs(o.maxX(),o.maxY())),n.transformPoint(new cs(o.minX(),o.maxY()))];let r=a[0].x,l=a[0].y,h=a[0].x,c=a[0].y;for(let e=1;e<a.length;++e){const t=a[e];t.x<r&&(r=t.x),t.x>h&&(h=t.x),t.y<l&&(l=t.y),t.y>c&&(c=t.y)}e=e.unionWithRect(new us(r,l,h-r,c-l))}return e}set needsDisplay(e){e&&xs.scheduleNode(this)}get parent(){return this._parent}get children(){return this._children}set children(e){let t=0,i=0;const s=[...this._children];for(;t<e.length;)s[i]!==e[t]?s[i]&&-1===e.indexOf(s[i])?(k(s[i]._parent),this.removeChild(s[i]),i++):(e[t]._parent===this&&(k(s.indexOf(e[t])),s.splice(s.indexOf(e[t]),1)),this.addChild(e[t],t),t++):(k(e[t]._parent),t++,i++);for(;i<s.length;)k(e.indexOf(s[i])),this.removeChild(s[i]),i++}get childCount(){return this._children.length}get firstChild(){return this._children[0]||null}get lastChild(){return this._children[this._children.length-1]||null}get previousSibling(){if(!this._parent)return null;const e=this._parent._children,t=e.indexOf(this);return t>0?e[t-1]:null}get nextSibling(){if(!this._parent)return null;const e=this._parent._children,t=e.indexOf(this);return-1!==t&&t<e.length-1?e[t+1]:null}isTainted(){return this._children.some((e=>e.isTainted()))}hasPixels(){return!(null===this.renderer||!this.renderer.hasPixels)||this._children.some((e=>e.hasPixels()))}toString(){let e="";return this.element&&(e+="🏷 "),this.wantsLayerBacking&&(e+="🏁 "),this.frozen&&(e+="❄️ ",this.keyForFrozenLayer&&(e+="<"+this.keyForFrozenLayer+">")),this.stringInfo&&"function"==typeof this.stringInfo?e+=this.stringInfo():e+="UnknownNode",0===this.position.x&&0===this.position.y||(e+=" ("+this.position.x+", "+this.position.y+")"),"number"==typeof this.repeatOffset&&(e+=(this.repeatOffset>0?"+":"")+this.repeatOffset+" "),0===this.size.width&&0===this.size.height||(e+=" "+this.size.width+"x"+this.size.height),1!==this.opacity&&(e+=" [opacity:"+this.opacity+"]"),this.transform.toString()!==Is&&(e+=" ["+this.transform.toString()+"]"),this.animators&&this.animators.forEach((t=>{e+=" "+t.stringInfo()})),e}dump(e,t){return void 0===e&&(e=1/0),zs(this,"",-1,e,!!t)}addChild(e,t){return e.remove(),(void 0===t||t<0||t>this._children.length)&&(t=this._children.length),this._children.splice(t,0,e),e._parent=this,this.needsDisplay=!0,e}insertBefore(e,t){return this.addChild(e,this._children.indexOf(t))}insertAfter(e,t){return this.addChild(e,this._children.indexOf(t)+1)}removeChild(e){if(e._parent!==this)return;const t=this._children.indexOf(e);return-1!==t?(this._children.splice(t,1),Ts(this,Os,Ps).call(this,e),this.needsDisplay=!0,e):void 0}replaceChild(e,t){if(!t||t._parent!==this)return;const i=this._children.indexOf(t);return k(),e.remove(),this._children.splice(i,1,e),Ts(this,Os,Ps).call(this,t),e._parent=this,this.needsDisplay=!0,t}remove(){if(this._parent instanceof Rs)return this._parent.removeChild(this)}wasRemoved(){}convertPointFromPage(e){if(this.element)return bs(this.element,e);const t=Ds(this),i=bs(t.element,e);return new cs(i.x+t.offsetX,i.y+t.offsetY)}convertPointToPage(e){if(this.element)return ws(this.element,e);const t=Ds(this),i=ws(t.element,e);return new cs(i.x-t.offsetX,i.y-t.offsetY)}_needsLayerBacking(){return this.opacity<1&&(this._children.length>1||1===this._children.length&&this._children[0]._children.length>0)}}function Ps(e){e._parent=null;const t=[e];for(;t.length>0;){const e=t.pop();e&&(e.wasRemoved(),e._renderer&&"function"==typeof e._renderer.nodeWasRemoved&&e._renderer.nodeWasRemoved(),t.push(...e.children))}}function Ds(e){let t,i=0,s=0,o=e;for(;o&&!t;){const e=o.transform.transformPoint(o.position);i-=e.x,s-=e.y,o=o.parent,t=o?.element}if(!t)throw new Error("Couldn't find nodes element. Expected that at least scene will have one.");return{element:t,offsetX:i,offsetY:s}}function zs(e,t,i,s,o){let n="";if(n+=t,o&&(n+=function(e){return e<0?"":e+":"}(i)),n+=e.toString(),n+=function(e){return e.childCount<1?"":" ⤵︎ "+e.childCount}(e),e.extraInfo&&"function"==typeof e.extraInfo&&e.extraInfo().forEach((e=>{n+="\n"+t+"| "+e})),0===s)return n;const a=e.children;for(let i=0,r=a.length;i<r;++i){const r=e.childCount<1?-1:i;n+="\n",n+=zs(a[i],t+"    ",r,s-1,o)}return n}const Ns=Rs,Fs=Object.freeze({Dark:"dark",Light:"light"}),Us=Object.freeze({NETWORK_ERROR:"NETWORK_ERROR",BROWSER_SUPPORT_ERROR:"BROWSER_SUPPORT_ERROR",FEATURE_ERROR:"FEATURE_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR",CONFIG_CHANGE:"CONFIGURATION_CHANGE_FALLBACK",CONFIG_MISSING:"CONFIGURATION_MISSING_FALLBACK"}),Gs=Object.freeze({blue:[0,122,255],green:[52,199,89],indigo:[88,86,214],orange:[255,149,0],pink:[255,45,85],purple:[175,82,222],red:[255,59,48],teal:[90,200,250],yellow:[255,204,0],gray:[142,142,147],gray2:[174,174,178],gray3:[199,199,204],gray4:[209,209,214],gray5:[229,229,234],gray6:[242,242,247]}),Ws=Object.freeze({blue:[10,132,255],green:[48,209,88],indigo:[94,92,230],orange:[255,159,10],pink:[255,55,95],purple:[191,90,242],red:[255,69,58],teal:[100,210,255],yellow:[255,214,10],gray:[142,142,147],gray2:[99,99,102],gray3:[72,72,74],gray4:[58,58,60],gray5:[44,44,46],gray6:[28,28,30]}),Bs=Object.freeze({Satellite:"satellite",Hybrid:"hybrid",MutedStandard:"mutedStandard",Standard:"standard"}),Zs=Object.freeze({Hybrid:"46",Standard:"1"}),Ks=(Object.freeze({WebGL:"webgl",WebGL2:"webgl2"}),Object.freeze({Adaptive:"adaptive",Metric:"metric",Imperial:"imperial"})),js=Object.freeze({BaseMap:"basemap",Roads:"roads",Borders:"borders",Buildings:"buildings",Icons:"icons",Labels:"labels"}),Hs=Object.freeze({Normal:"normal",Multiply:"multiply",HardLight:"hard-light",SoftLight:"soft-light"}),qs=Object.freeze({Normal:"normal",Grayscale:"grayscale"}),Vs=Object.freeze({LandCover:"LandCover",PointsOfInterest:"PointsOfInterest",None:null}),Ys=Object.freeze({Muted:"muted",Standard:"standard"}),Xs=Object.freeze({Adaptive:"adaptive",Hidden:"hidden",Visible:"visible"}),$s=Object.freeze({default:Gs,light:Gs,dark:Ws}),Js='"SFProRegular", "-apple-system", "BlinkMacSystemFont", "Helvetica Neue", Helvetica, Arial, sans-serif',Qs=Object.freeze({Button:"BUTTON",Scroll:"SCROLL",DoubleTap:"DOUBLE_TAP",Pinch:"PINCH"}),eo={minimumSizeToShowControls:new ls(306,220),minimumSizeToShowLogo:new ls(200,100),minimumSizeToShowLogoWithReducedMargin:new ls(100,100),maximumSizeControlsNormal:new ls(1024,0)};class to{x;y;z;constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}toString(){const{x:e,y:t,z:i}=this;return!e||t||i?!t||e||i?!i||e||t?i?`translate3d(${e}px, ${t}px, ${i}px)`:`translate(${e}px, ${t}px)`:`translateZ(${i}px)`:`translateY(${t}px)`:`translateX(${e}px)`}}class io{x;y;z;constructor(e=1,t=e,i=1){this.x=e,this.y=t,this.z=i}toString(){const{x:e,y:t,z:i}=this;return 1!==e&&1===t&&1===i?`scaleX(${e})`:1!==t&&1===e&&1===i?`scaleY(${t})`:1!==i&&1===e&&1===t?`scaleZ(${i})`:1===i&&e===t?`scale(${e})`:1===i?`scale(${e}, ${t})`:`scale3d(${e}, ${t}, ${i})`}}class so{angle;constructor(e=0){this.angle=e}toString(){return`rotate(${this.angle}deg)`}}class oo{x;y;constructor(e=0,t=0){this.x=e,this.y=t}toString(){const{x:e,y:t}=this;return 0!==e&&0===t?`skewX(${e}deg)`:0!==t&&0===e?`skewY(${t}deg)`:`skew(${e}deg, ${t}deg)`}}class no{x;y;z;angle;constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.angle=s}toString(){return`rotate3d(${this.x}, ${this.y}, ${this.z}, ${this.angle}deg)`}}const ao=class{_operations;constructor(){this._operations=[]}translate(e=0,t=0,i=0){return this._operations.push(new to(e,t,i)),this}scale(e=1,t=e,i=1){return this._operations.push(new io(e,t,i)),this}rotate(e=0){return this._operations.push(new so(e)),this}rotate3d(e=0,t=0,i=0,s=0){return this._operations.push(new no(e,t,i,s)),this}skew(e=0,t=0){return this._operations.push(new oo(e,t)),this}transform(e){return Array.isArray(e)?this._operations.push(...e):this._operations.push(e),this}toString(){return this._operations.map((e=>e.toString())).join(" ")}};function ro(...e){if(1===e.length){const[t]=e;return e=>ro(e,t)}const[t,i]=e;return t instanceof i}function lo(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let ho=[],co=[];const uo=Object.freeze({None:0,Removal:1,Addition:2,AttachAsShadowRoot:3});let po;class mo{constructor(){lo(this,"_parent",null),lo(this,"_children",[]),lo(this,"_dirtyAttributes",{}),lo(this,"_dirtyProperties",[]),lo(this,"_doNotNotifyParentChange",!1),lo(this,"domNode",null),lo(this,"_pendingDOMManipulation",uo.None)}get parent(){return this._parent}get children(){return this._children}set children(e){const t=this._children;for(;t.length;)this.removeChild(t[0]);e.forEach((e=>{this.addChild(e)}))}get childCount(){return this._children.length}get firstChild(){return this._children[0]||null}get lastChild(){return this._children[this._children.length-1]||null}get previousSibling(){if(!this._parent)return null;const e=this._parent._children,t=e.indexOf(this);return t>0?e[t-1]:null}get nextSibling(){if(!this._parent)return null;const e=this._parent._children,t=e.indexOf(this);return-1!==t&&t<e.length-1?e[t+1]:null}addChild(e,t){if(0===t&&this._children[0]&&ro(this._children[0],go))throw new TypeError("");return M(),e.willMoveToParent?.(this),e._doNotNotifyParentChange=!0,e.remove(),delete e._doNotNotifyParentChange,(void 0===t||t<0||t>this._children.length)&&(t=this._children.length),this._children.splice(t,0,e),e._parent=this,e.didMoveToParent?.(this),this.didAddChild?.(e),e._markNodeManipulation(uo.Addition),e}insertBefore(e,t){return this.addChild(e,t?this._children.indexOf(t):-1)}insertAfter(e,t){const i=t?this._children.indexOf(t):-1;return this.addChild(e,-1!==i?i+1:0)}removeChild(e){if(e._parent!==this)return;const t=this._children.indexOf(e);return-1!==t?(M(),this.willRemoveChild?.(e),e._doNotNotifyParentChange||e.willMoveToParent?.(null),this._children.splice(t,1),e._parent=null,e._doNotNotifyParentChange||e.didMoveToParent?.(null),e._markNodeManipulation(uo.Removal),e):void 0}remove(){if(this._parent instanceof mo)return this._parent.removeChild(this)}dump(e){return ko(this,"",-1,e)}_markNodeManipulation(e){this._pendingDOMManipulation=e,this._updateNodeDirtiness()}_updateNodeDirtiness(){var e;e=this,this._pendingDOMManipulation!==uo.None||this._dirtyProperties.length>0||Object.getOwnPropertyNames(this._dirtyAttributes).length>0?(wo(ho,e),Mt.scheduleDraw(fo)):Co(ho,e)}}class go extends mo{constructor(e="closed"){super(),lo(this,"shadowRootMode",void 0),lo(this,"domNode",null),lo(this,"_pendingDOMManipulation",uo.None),this.shadowRootMode=e}toString(){return this.stringInfo()+" ["+this.shadowRootMode+"]"}stringInfo(){return"#shadow-root"}}class _o extends mo{constructor(e){let t;super(),lo(this,"domNode",void 0),lo(this,"_opacity",1),lo(this,"_color",""),lo(this,"_size",new ls),lo(this,"_position",new cs),lo(this,"_transform",new ao),lo(this,"_backgroundImages",[]),lo(this,"_classList",new So(this)),lo(this,"_wantsHardwareCompositing",!1),lo(this,"_pendingDOMManipulation",uo.None),e instanceof HTMLElement||e instanceof SVGElement?t=e:(k(),t=document.createElement("div")),this.domNode=t}get element(){return this.domNode}set element(e){this.domNode=e}get classList(){return this._classList}get wantsHardwareCompositing(){return this._wantsHardwareCompositing}set wantsHardwareCompositing(e){e!==this._wantsHardwareCompositing&&(this._wantsHardwareCompositing=e,this._markDirtyProperty("will-change"))}get opacity(){return this._opacity}set opacity(e){(e=Math.min(Math.max(0,e),1))!==this._opacity&&(this._opacity=e,this._markDirtyProperty("opacity"))}get color(){return this._color}set color(e){e!==this._color&&(this._color=e,this._markDirtyProperty("color"))}get position(){return this._position}set position(e){this._position=e,this._markDirtyProperty("position")}get transform(){return this._transform}set transform(e){this._transform=e,this._markDirtyProperty("transform")}get backgroundImages(){return this._backgroundImages}set backgroundImages(e){this._backgroundImages=e||[],this._markDirtyProperty("backgroundImages")}get size(){return this._size}set size(e){this._size=e||new ls,this._markDirtyProperty("size")}setAttribute(e,t){this._dirtyAttributes[e]=t,this._updateNodeDirtiness()}removeAttribute(e){this._dirtyAttributes[e]=null,this._updateNodeDirtiness()}createAndAddShadowRootChild(e){if(M(this.domNode,HTMLElement),this._children[0]&&ro(this._children[0],go))throw new Error("");const t=new go(e);return this._children.unshift(t),t._parent=this,this.didAddChild?.(t),t._markNodeManipulation(uo.AttachAsShadowRoot),t}convertPointFromPage(e){return M(this.domNode,HTMLElement),bs(this.domNode,e)}convertPointToPage(e){return M(this.domNode,HTMLElement),ws(this.domNode,e)}toString(){let e="";return this._wantsHardwareCompositing&&(e+="🏁 "),e+=this.stringInfo(),this.classList.toString()&&(e+=this.classList._classes().map((e=>"."+e)).join(", ")),0===this.position.x&&0===this.position.y||(e+=" ("+this.position.x+", "+this.position.y+")"),0===this.size.width&&0===this.size.height||(e+=" "+this.size.width+"x"+this.size.height),1!==this.opacity&&(e+=" [opacity:"+this.opacity+"]"),this.transform.toString()&&(e+=" ["+this.transform.toString()+"]"),e}stringInfo(){return"<"+this.domNode.tagName.toLowerCase()+">"}_markDirtyProperty(e,t){let i;i=void 0===t||t?wo(this._dirtyProperties,e):Co(this._dirtyProperties,e),i&&this._updateNodeDirtiness()}}function fo(){const e=po?performance.now():void 0;ho.forEach(yo),ho=[],co.forEach(vo),co=[],_o.updates++,Mo.dispatchEvent(new D("update")),po&&performance.measure(po,{start:e})}function yo(e){if(e._pendingDOMManipulation===uo.Removal){const t=e.domNode?.parentNode;t&&e.domNode&&t.removeChild(e.domNode)}if(e._dirtyProperties.length&&(M(),e._dirtyProperties.forEach((t=>{!function(e,t){const i=e.domNode;if(!(i instanceof HTMLElement||i instanceof SVGElement))return;const s=i.style;switch(t){case"opacity":s.opacity=e._opacity.toString();break;case"color":s.color=e._color;break;case"size":s.width=e._size.width+"px",s.height=e._size.height+"px";break;case"will-change":s.willChange=e._wantsHardwareCompositing?"transform":"";break;case"position":case"transform":{const t=(new ao).translate(bo(e._position.x),bo(e._position.y)).transform(e._transform.toString());s.transform=t.toString();break}case"backgroundImages":!function(e){if(!(e.domNode instanceof HTMLElement||e.domNode instanceof SVGElement))return;const t=e.domNode.style;if(!e._backgroundImages.length)return t.removeProperty("background-image"),t.removeProperty("background-position"),void t.removeProperty("background-size");const i=[],s=[],o=[],n=e._backgroundImages;for(let e=n.length-1;e>=0;--e){const t=n[e];i.push("url("+t.url+")"),s.push(t.position.x+"px "+t.position.y+"px"),o.push(t.size.width+"px "+t.size.height+"px")}t.backgroundImage=i.join(","),t.backgroundPosition=s.join(","),t.backgroundSize=o.join(",")}(e);break;case"classList":i.setAttribute("class",e._classList.toString()),e._classList.reset();break;default:;}}(e,t)})),e._dirtyProperties=[]),Object.keys(e._dirtyAttributes).length){M();const t=e.domNode;Object.getOwnPropertyNames(e._dirtyAttributes).forEach((i=>{const s=e._dirtyAttributes[i];null===s?t.removeAttribute(i):t.setAttribute(i,s)})),e._dirtyAttributes={}}e._pendingDOMManipulation!==uo.Addition&&e._pendingDOMManipulation!==uo.AttachAsShadowRoot||wo(co,e.parent)}function vo(e){let t=null;const i=e.domNode;S();for(let s=e.children.length-1;s>=0;--s){const o=e.children[s],n=o.domNode;switch(o._pendingDOMManipulation){case uo.Addition:M(),i.insertBefore(o.domNode,t),o._pendingDOMManipulation=uo.None;break;case uo.AttachAsShadowRoot:{M(),M(0,HTMLElement);const e=i.attachShadow({mode:o.shadowRootMode});o.domNode=e,o._pendingDOMManipulation=uo.None;break}}t=n}}function bo(e){const t=Math.max(Math.round(window.devicePixelRatio),1);return Math.round(e*t)/t}function wo(e,t){return-1===e.indexOf(t)&&(e.push(t),!0)}function Co(e,t){const i=e.indexOf(t);return-1!==i&&(e.splice(i,1),!0)}function ko(e,t,i,s){let o="";o+=t,s&&(o+=function(e){return e<0?"":e+":"}(i)),o+=e.toString(),o+=function(e){return e.childCount<1?"":" ⤵︎ "+e.childCount}(e);const n=e.children;for(let i=0,a=n.length;i<a;++i){const a=e.childCount<1?-1:i;o+="\n",o+=ko(n[i],t+"    ",a,s)}return o}lo(_o,"updates",0);class So{constructor(e){lo(this,"_node",void 0),lo(this,"_additions",[]),lo(this,"_removals",[]),lo(this,"__classes",[]),lo(this,"_populateClasses",!0),this._node=e}add(e){this._add(e)}remove(e){this._remove(e)}contains(e){return-1!==this._classes().indexOf(e)}toggle(e,t){if(arguments.length>1)return t?this._add(e):this._remove(e),!!t;this._add(e)||this._remove(e)}toString(){return this._classes().join(" ")}_classes(){if(this._populateClasses){const e=this._node.domNode;let t="";e instanceof HTMLElement?t=e.className:e instanceof SVGElement&&e.className instanceof SVGAnimatedString&&(t=e.className.baseVal),this.__classes=t.split(/[ ]+/).filter(Boolean),delete this._populateClasses}return this.__classes}reset(){this._additions=[],this._removals=[],this.__classes=[],this._populateClasses=!0}_add(e){if(!e)return!1;const t=wo(this._classes(),e);return t&&(Co(this._removals,e)||wo(this._additions,e),this._updateNodeDirtiness()),t}_remove(e){if(!e)return!1;const t=Co(this._classes(),e);return t&&(Co(this._additions,e)||wo(this._removals,e),this._updateNodeDirtiness()),t}_updateNodeDirtiness(){this._node._markDirtyProperty("classList",this._additions.length>0||this._removals.length>0)}}const Mo=new class extends P{constructor(){super(),lo(this,"Node",_o),lo(this,"Point",cs),lo(this,"Transform",ao)}setPerformanceMeasureName(e){po=e}},Lo=Mo;class xo extends z{constructor(){super(),this.modifierKeys={alt:!1,ctrl:!1,meta:!1,shift:!1},this.useGestures=!1,this._targetTouches=[],this._lastKnownEventLocation=null,this._shouldHandleTrackingEvents=!1,this._domEvents=[],this.events=void 0,this._mode=void 0,this.mode=xo.Modes.Adaptive,this._enabled=!0,this._target=null,this.state=xo.States.Possible,this.delegate=null,this.allowsRightMouseButton=!1}get mode(){return this._mode}set mode(e){if(this._mode!==e){if(this._targetTouches.length)throw new Error("");switch(this._removeBaseListeners(),e){case xo.Modes.Adaptive:xo.SupportsPointerEvents?this.events=Po.Pointer:xo.SupportsTouches?this.events=Po.Touch:this.events=Po.Mouse;break;case xo.Modes.Pointer:this.events=Po.Pointer;break;case xo.Modes.Touch:this.events=Po.Touch;break;case xo.Modes.Mouse:this.events=Po.Mouse}this._mode=e,this._updateBaseListeners()}}get currentMode(){if(this._mode===xo.Modes.Adaptive)switch(this.events){case Po.Pointer:return xo.Modes.Pointer;case Po.Touch:return xo.Modes.Touch;case Po.Mouse:return xo.Modes.Mouse}return this._mode}get target(){return this._target}set target(e){this._target!==e&&(this._removeBaseListeners(),e&&(this._target=e,this._initRecognizer()))}get numberOfTouches(){return this._targetTouches.length}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,e||(0===this.numberOfTouches?(this._removeTrackingListeners(),this.reset()):this.enterCancelledState()),this._updateBaseListeners())}get domEvents(){return this._domEvents}reset(){}preventDefault(e){"touchmove"!==e.type&&"pointer"!==e.type.substr(0,7)&&e.preventDefault()}locationInElement(e){const t=new cs,i=this._targetTouches;if(this._lastKnownEventLocation)t.x=this._lastKnownEventLocation.pageX,t.y=this._lastKnownEventLocation.pageY;else{const e=i.length;for(let s=0;s<e;++s){const e=i[s];t.x+=e.pageX,t.y+=e.pageY}t.x/=e,t.y/=e}return e?Cs.fromPageToElement(e,t):t}locationInClient(){const e=new cs,t=this._targetTouches;if(this._lastKnownEventLocation)e.x=this._lastKnownEventLocation.clientX,e.y=this._lastKnownEventLocation.clientY;else{const i=t.length;for(let s=0;s<i;++s){const i=t[s];e.x+=i.clientX,e.y+=i.clientY}e.x/=i,e.y/=i}return e}locationOfTouchInElement(e,t){const i=this._targetTouches[e];if(!i)return new cs;const s=new cs(i.pageX,i.pageY);return t?Cs.fromPageToElement(t,s):s}touchesBegan(e){e.currentTarget===this._target&&(this._shouldHandleTrackingEvents=!0,window.addEventListener(this.events.Move,this,!0),window.addEventListener(this.events.End,this,!0),this.events.Cancel&&window.addEventListener(this.events.Cancel,this,!0),this.enterPossibleState())}touchesMoved(e){}touchesEnded(e){}touchesCancelled(e){}gestureBegan(e){e.currentTarget===this._target&&(window.addEventListener(this.events.GestureChange,this,!0),window.addEventListener(this.events.GestureEnd,this,!0),this.enterPossibleState())}gestureChanged(e){}gestureEnded(e){}enterPossibleState(){this._setStateAndNotifyOfChange(xo.States.Possible)}enterBeganState(){!this.delegate||"function"!=typeof this.delegate.gestureRecognizerShouldBegin||this.delegate.gestureRecognizerShouldBegin(this)?this._setStateAndNotifyOfChange(xo.States.Began):this.enterFailedState()}enterEndedState(){this._setStateAndNotifyOfChange(xo.States.Ended),this._removeTrackingListeners(),this.reset()}enterCancelledState(){this._setStateAndNotifyOfChange(xo.States.Cancelled),this._removeTrackingListeners(),this.reset()}enterFailedState(){this._setStateAndNotifyOfChange(xo.States.Failed),this._removeTrackingListeners(),this.reset()}enterChangedState(){this._setStateAndNotifyOfChange(xo.States.Changed)}enterRecognizedState(){this._setStateAndNotifyOfChange(xo.States.Recognized)}handleEvent(e){this._shouldCountAndHandleTouch(e)&&(this.lastEventTimeStamp=e.timeStamp,this._updateTargetTouches(e),this._updateKeyboardModifiers(e),this._handleTouches(e))}_handleTouches(e){if(this._shouldHandleTouch(e))switch(e.type){case this.events.Start:this.touchesBegan(e);break;case this.events.Move:this.touchesMoved(e);break;case this.events.End:this.touchesEnded(e);break;case this.events.Cancel:this.touchesCancelled(e);break;case this.events.GestureStart:this.gestureBegan(e);break;case this.events.GestureChange:this.gestureChanged(e);break;case this.events.GestureEnd:this.gestureEnded(e)}}_shouldCountAndHandleTouch(e){if(this.events!==Po.Pointer)return!0;if(!(e instanceof PointerEvent))return!0;if("mouse"===e.pointerType&&e.button>0&&!this.allowsRightMouseButton)return!1;const t=this._targetTouches[0];return!(t&&t instanceof PointerEvent&&e.pointerType!==t.pointerType&&t.pointerId!==e.pointerId)}_shouldHandleTouch(e){return this.events!==Po.Pointer||(e.type===this.events.Start||e.type===this.events.GestureStart||e.type===this.events.GestureChange||e.type===this.events.GestureEnd||this._shouldHandleTrackingEvents)}_initRecognizer(){this.reset(),this.state=xo.States.Possible,this._updateBaseListeners()}_removeBaseListeners(){this._target&&(this._target.removeEventListener(this.events.Start,this),this.useGestures&&this._target.removeEventListener(this.events.GestureStart,this),this.events===Po.Pointer&&(this._targetTouches=[],window.removeEventListener(this.events.End,this,!0),window.removeEventListener(this.events.Cancel,this,!0)))}_updateBaseListeners(){this._target&&(this._enabled?(this._target.addEventListener(this.events.Start,this),this.useGestures&&this._target.addEventListener(this.events.GestureStart,this),this.events===Po.Pointer&&(window.addEventListener(this.events.End,this,!0),window.addEventListener(this.events.Cancel,this,!0))):this._removeBaseListeners())}_removeTrackingListeners(){this._shouldHandleTrackingEvents=!1,window.removeEventListener(this.events.Move,this,!0),this.events!==Po.Pointer&&(window.removeEventListener(this.events.End,this,!0),this.events.Cancel&&window.removeEventListener(this.events.Cancel,this,!0)),window.removeEventListener(this.events.GestureChange,this,!0),window.removeEventListener(this.events.GestureEnd,this,!0)}_setStateAndNotifyOfChange(e){this.state=e,this.dispatchEvent(new N(this.events.StateChange))}_setLastKnownSinglePointLocation(e){this._lastKnownEventLocation={clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY}}_updateTargetTouches(e){if(e.type===this.events.GestureStart||e.type===this.events.GestureChange||e.type===this.events.GestureEnd){const t=e;return void this._setLastKnownSinglePointLocation(t)}if(this.events===Po.Mouse){const t=e;return void(e.type===this.events.End?(this._targetTouches=[],this._setLastKnownSinglePointLocation(t)):(this._targetTouches=[t],this._lastKnownEventLocation=null))}let t,i,s;if(this.events===Po.Touch){const o=e,n=this._targetTouches;if(o.type===this.events.Start){for(this._targetTouches=[],t=o.targetTouches,i=0,s=t.length;i<s;++i)this._targetTouches.push(t[i]);return void(this._lastKnownEventLocation=null)}if(o.type===this.events.Move){const e=n.map((e=>e.identifier));for(this._targetTouches=[],t=o.touches,i=0,s=t.length;i<s;++i){const s=t[i];-1!==e.indexOf(s.identifier)&&this._targetTouches.push(s)}return void(this._lastKnownEventLocation=null)}const a=o.touches,r=[];for(i=0,s=a.length;i<s;++i)r.push(a[i].identifier);return this._targetTouches=n.filter((e=>-1!==r.indexOf(e.identifier))),void(0===this._targetTouches.length?this._setLastKnownSinglePointLocation(a[0]):this._lastKnownEventLocation=null)}if(this.events===Po.Pointer){const t=e,i=this._targetTouches;return e.type===this.events.Start?(this._targetTouches.push(t),void(this._lastKnownEventLocation=null)):e.type===this.events.Move?(this._targetTouches=i.map((e=>e.pointerId!==t.pointerId?e:t)),void(this._lastKnownEventLocation=null)):(this._targetTouches=i.filter((e=>e.pointerId!==t.pointerId)),void(0===this._targetTouches.length?this._setLastKnownSinglePointLocation(t):this._lastKnownEventLocation=null))}throw new Error("")}_updateKeyboardModifiers(e){this.modifierKeys.alt=e.altKey,this.modifierKeys.ctrl=e.ctrlKey,this.modifierKeys.meta=e.metaKey,this.modifierKeys.shift=e.shiftKey}_distance(){if(2!==this.numberOfTouches)return 0;const e=this._targetTouches[0],t=new cs(e.pageX,e.pageY),i=this._targetTouches[1],s=new cs(i.pageX,i.pageY);return t.distanceToPoint(s)}}xo.Modes=Object.freeze({Adaptive:"adaptive",Pointer:"pointer",Touch:"touch",Mouse:"mouse"});const Ao="PointerEvent"in window;xo.SupportsPointerEvents=Ao;const Eo="ontouchmove"in document;xo.SupportsTouches=Eo;const To=!!window.GestureEvent;let Io,Oo;xo.SupportsGestures=To,xo.SupportsGestures?xo.SupportsPointerEvents?Io=Oo=!xo.SupportsTouches:(Io=!xo.SupportsTouches,Oo=!0):(Io=!1,Oo=!1),xo.UseGesturesForRotation=Io,xo.UseGesturesForPinch=Oo;const Ro=Object.freeze({Possible:"possible",Began:"began",Changed:"changed",Ended:"ended",Cancelled:"cancelled",Failed:"failed",Recognized:"ended"});xo.States=Ro;const Po=Object.freeze({Pointer:{Start:"pointerdown",Move:"pointermove",End:"pointerup",Cancel:"pointercancel",GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend",StateChange:"statechange"},Touch:{Start:"touchstart",Move:"touchmove",End:"touchend",Cancel:"touchcancel",GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend",StateChange:"statechange"},Mouse:{Start:"mousedown",Move:"mousemove",End:"mouseup",Cancel:void 0,GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend",StateChange:"statechange"}}),Do=xo,zo=Do.SupportsTouches,No=Do.SupportsPointerEvents,Fo=Do.SupportsGestures,Uo="ShadowRoot"in window;function Go(e,t,...i){const s=window.document.createElementNS(e,t);let o=0;if("object"==typeof i[0]&&null!=i[0]&&!(i[0]instanceof window.Node)){++o;for(const e in i[0])"nonce"===e&&(s.nonce=i[0][e]),s.setAttribute(e,i[0][e])}for(let e=o,t=i.length;e<t;++e){const t=i[e];t instanceof window.Node?s.appendChild(t):"string"==typeof t&&s.appendChild(document.createTextNode(t))}return s}const Wo={focusColor:"rgb(0, 122, 255)",get devicePixelRatio(){return window.devicePixelRatio||1},get imagePixelRatio(){return Math.max(Math.round(window.devicePixelRatio),1)||1},roundToDevicePixel:function(e,t){const i=t||this.devicePixelRatio;return Math.round(e*i)/i},supportsTouches:zo,supportsPointerEvents:No,supportsGestureEvents:Fo,startEventType:No?"pointerdown":zo?"touchstart":"mousedown",moveEventType:No?"pointermove":zo?"touchmove":"mousemove",endEventType:No?"pointerup":zo?"touchend":"mouseup",cancelEventType:No?"pointercancel":zo?"touchcancel":void 0,supportsForceTouch:!zo&&"webkitForce"in MouseEvent.prototype,htmlElement:(e,...t)=>Go("http://www.w3.org/1999/xhtml",e,...t),svgElement:(e,...t)=>Go("http://www.w3.org/2000/svg",e,...t),supportsShadowDOM:Uo,insideIframe:window.top!==window,getShadowDOMTargetFromEvent:function(e,t){const i=this.containingDocumentOrShadowRoot(e);if(i===document)return t.target;const s="changedTouches"in t?t.changedTouches[0]:t,o=i.elementFromPoint(s.clientX,s.clientY);return o||document.body},containingDocumentOrShadowRoot:function(e){return this.supportsShadowDOM?e.getRootNode():document},addShadowRootChild:function(e,t,i,s){let o;this.supportsShadowDOM?o=e.createAndAddShadowRootChild(t):(o=e.addChild(new _o),i=function(e){let t,i="";for(;t=e.match(/:host\(/);){i+=e.substr(0,t.index),e=e.substr(t.index+t[0].length);let s=1;for(;t=e.match(/^([^()]*)([()])?/);){if(e=e.substr(t[0].length),"("===t[2])s+=1;else if(")"===t[2]&&(s-=1,0===s)){i+=t[1];break}if(i+=t[0],!t[2])break}}return i+e}(i));const n=this.htmlElement("style",i);return s&&(n.nonce=s),o.addChild(new _o(n)),o},parentNodeForSvgTarget:function(e){return e.tagName&&"div"!==e.tagName.toLowerCase()?this.parentNodeForSvgTarget(e.parentNode):e},imagePathForDevice:function(e,t,i){const s=Math.floor(this.devicePixelRatio);let o;return k(([].concat(e).sort().join(","),e.join(","))),o=-1!==e.indexOf(s)?s:s>e[e.length-1]?e[e.length-1]:e[0],t+(o>1?"_"+o+"x":"")+(i=i||".png")},parseQueryString:function(e){const t={};let i;const s=/\+/g,o=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(s," "))};if("string"==typeof e)for(;null!==(i=o.exec(e));)t[n(i[1])]=n(i[2]);return t},createSVGIcon:function(e,t){let i="mk-icon";t.class&&(i+=" "+t.class,delete t.class);const s=this.svgElement("svg",t);return s.setAttribute("class",i),s.setAttribute("focusable","false"),s.appendChild(this.svgElement("g")).appendChild(e),s},convertColorToRGB:function(e){const t=document.createElement("div");return t.style.setProperty("color",e),t.style.color},isValidCSSColor:function(e){return""!==this.convertColorToRGB(e)},updateLabel:function(e,t){e.setAttribute("title",t),e.setAttribute("aria-label",t)},easeInOut:function(e){const t=Math.pow(e,2);return t/(t+Math.pow(1-e,2))},lerp:function(e,t,i){return(1-e)*t+e*i},darkColorScheme:function(e){return e===Fs.Dark},restrictRotation:function(e){return e<180?Math.min(e,30):Math.max(e,330)},getIntegralZoom:function(e){return Math.floor(e+1e-6)}},Bo=Wo;var Zo;function Ko(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function jo(e,t,i,s){return Vo(e,t),qo(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,s),s}function Ho(e,t,i){return Vo(e,t),qo(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}function qo(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Vo(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}let Yo={};class Xo{constructor(e){Ko(this,"_node",void 0),Ko(this,"_layer",void 0),Ko(this,"_frozenLayer",void 0),Ko(this,"_sharedLayer",void 0),this._node=e}get hasPixels(){return this.draw!==Xo.prototype.draw}get node(){return this._node}get shouldDraw(){const e=this._node.keyForFrozenLayer;return!(this._frozenLayer&&(!this._sharedLayer||this._sharedLayer.key===e)||e&&Yo[e])}get layer(){const e=this._node,t=e.frozen,i=e.keyForFrozenLayer;if(t){if(this._frozenLayer){if(!i||!this._sharedLayer||this._sharedLayer.key===i)return this._frozenLayer;this.releaseLayer()}if(i){const e=Yo[i];if(e&&e.key===i)return this._sharedLayer=e,this._layer=this._frozenLayer=e.canvas,++e.count,e.canvas}}delete this._frozenLayer,this._layer||(this._layer=this.createCanvas(),this._layer.hidden=!0,i&&(this._sharedLayer=Yo[i]={canvas:this._layer,count:1,key:i}));const s=Bo.devicePixelRatio,o=e.layerBounds;this._layer.width=Math.ceil(o.size.width*s),this._layer.height=Math.ceil(o.size.height*s);const n=this._layer.getContext("2d");return n&&(n.scale(s,s),n.translate(-o.origin.x,-o.origin.y)),t&&(this._frozenLayer=this._layer),this._layer}releaseLayer(e){this._layer&&(this._sharedLayer?e||(--this._sharedLayer.count,0===this._sharedLayer.count&&(delete Yo[this._sharedLayer.key],this._layer.width=0,this._layer.parentNode&&this._layer.parentNode.removeChild(this._layer))):(this._layer.width=0,this._layer.parentNode&&this._layer.parentNode.removeChild(this._layer)),delete this._sharedLayer,delete this._frozenLayer,delete this._layer)}nodeWasRemoved(){var e,t,i;this._layer&&(e=Xo,t=Xo,i=$o,Vo(e,t),i).call(Xo,this)}createCanvas(){return de()}draw(e){}static releaseSharedLayers(){Object.keys(Yo).forEach((e=>{const t=Yo[e];t&&(t.canvas.width=0,delete t.key,delete t.canvas)})),Yo={}}}function $o(e){0===Ho(Zo,Zo,Jo).length&&setTimeout((()=>{Ho(Zo,Zo,Jo).forEach((e=>{e._node.scene||e.releaseLayer()})),jo(Zo,Zo,Jo,[])}),0),Ho(Zo,Zo,Jo).push(e)}Zo=Xo;var Jo={writable:!0,value:[]};const Qo=Xo;function en(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function tn(e,t,i,s,o,n){if(!t||0===e.opacity)return;const a=e.renderer;S(),o&&a.releaseLayer(!0);const r=a.shouldDraw,l=e.wantsLayerBacking?a.layer:null;if(l||e.frozen||a.releaseLayer(),e.wantsLayerBacking&&!l)return;const h=function(h){if(t.save(),t.translate(h,d),t.transform(u.a,u.b,u.c,u.d,u.e,u.f),t.globalAlpha=n,r||!e.frozen){const r=l?l.getContext("2d"):t;S(),l&&t.canvas&&"appendChild"in t.canvas&&t.canvas.appendChild(l),a.draw(r);const h=e.children;for(let e=0,t=h.length;e<t;++e)tn(h[e],r,i,s,o,l?1:n)}l&&0!==l.width&&0!==l.height&&t.drawImage(l,e.layerBounds.origin.x,e.layerBounds.origin.y,l.width/s,l.height/s),t.restore()},c=e.position.x,d=e.position.y,u=e.transform;n*=e.opacity,h(c),e.repeatOffset&&h(c+e.repeatOffset)}const sn=class extends Qo{constructor(e){super(e),en(this,"_canvas",void 0),en(this,"_ctx",void 0),en(this,"_previousSize",void 0),en(this,"_previousScale",void 0),this._canvas=this.createCanvas();const t=this._canvas.getContext("2d");if(!t)throw new Error("Failed to obtain 2D context from canvas");this._ctx=t}get ctx(){return S(this._ctx),this._ctx}get element(){return this._canvas}set element(e){this._canvas=e}update(){if(!this._ctx)return;const e=this._node,t=e.size,i=Bo.devicePixelRatio,s=!this._previousScale||this._previousScale!==i;s&&Qo.releaseSharedLayers(),!s&&this._previousSize&&this._previousSize.equals(t)?this._ctx.clearRect(0,0,t.width*i,t.height*i):(this._canvas.style.width=t.width+"px",this._canvas.style.height=t.height+"px",this._canvas.width=Math.round(t.width*i),this._canvas.height=Math.round(t.height*i),this._previousSize=t.copy(),this._previousScale=i),this._ctx.scale(i,i),tn(this.node,this._ctx,new us(-e.position.x,-e.position.y,t.width,t.height),i,s,1),this._ctx.scale(1/i,1/i)}destroy(){this._ctx=null,this._canvas.width=this._canvas.height=0}};function on(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const nn=class extends Ns{constructor(){super(),on(this,"_renderer",void 0),on(this,"sceneDidUpdate",void 0),on(this,"isScene",!0),on(this,"performanceMeasureName",void 0),on(this,"_isTainted",!1),this._renderer=new sn(this)}get element(){return this._renderer.element}set element(e){this._renderer.element=e}get contextForMeasurement(){return this._renderer.ctx}get renderer(){return this._renderer}isTainted(){if(this._isTainted)return this._isTainted;const e=super.isTainted();return e&&(this._isTainted=!0),e}destroy(){this.children=[],this._renderer.destroy()}flush(){xs.flush(this)}stringInfo(){return"Scene"}};const an=class extends Ns{constructor(){super();const e=new Qo(this);this._renderer=e}stringInfo(){return"GroupNode"}};const rn=class extends Qo{draw(e){this._node.image&&e.drawImage(this._node.image,0,0,this._node.size.width,this._node.size.height)}};function ln(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const hn=class extends Ns{constructor(){super(),ln(this,"_image",void 0),ln(this,"_url",void 0),this._image=null,this._url=null,this._renderer=new rn(this)}get image(){return this._image}get url(){return this._url}setImage(e,t){this._image=e,this._url=t,null!=e&&this.size.equals(ls.Zero)&&(S(this._image),this.size=new ls(this._image.width,this._image.height)),this.needsDisplay=!0}isTainted(){return this._image instanceof Image&&null===this._image.crossOrigin}stringInfo(){let e=this._url;return e?(e=new URL(e,window.location.href).href,"ImageNode<src:"+e+">"):"ImageNode"}};var cn;function dn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class un{constructor(e){dn(this,"node",void 0),dn(this,"duration",void 0),dn(this,"from",void 0),dn(this,"to",void 0),dn(this,"done",void 0),dn(this,"startTime",null),dn(this,"beginDate",void 0),dn(this,"ended",void 0),dn(this,"_p",void 0),this.node=e.node,this.node.animators||(this.node.animators=[]),this.node.animators.push(this),this.duration=e.duration,this.from=e.from??0,this.to=e.to??1,this.done=e.done??r}begin(){return this.startTime=null,this._p=0,Mt.scheduleASAP(this),this}end(){if(this.ended=!0,this.node.animators){const e=this.node.animators.indexOf(this);e>=0&&(this.node.animators.splice(e,1),0===this.node.animators.length&&delete this.node.animators)}this.done(this)}performScheduledUpdate(e){this.ended||(null!=e&&(this.beginDate||(this.beginDate=e),this._p=Math.min((e-this.beginDate)/this.duration,1),this.update(this._p)),"number"==typeof this._p&&this._p<1?Mt.scheduleOnNextFrame(this):this.end())}update(e){}valueAt(e){const t=this.from;return t+e*(this.to-t)}stringInfo(e,t){let i="🏇"+e+"<"+this.duration+"ms; "+this.from+"→"+this.to;return"number"==typeof this._p&&this._p>=0&&(i+="/"+Math.round(100*this._p)+"%"),this.done!==r&&(i+="*"),i+(t||"")+">"}}class pn extends un{update(e){this.node.opacity=this.valueAt(e)}stringInfo(){return super.stringInfo("opacity")}}class mn extends un{constructor(e){super({...e,from:e.from??new cs(0,0),to:e.to??new cs(0,0)}),dn(this,"springSolver",void 0),e.pop&&(this.springSolver=new _n(1,mn.STIFFNESS,mn.DAMPING,0))}update(e){this.springSolver&&(e=this.springSolver.solve(e)),this.node.transform=(new ys).translate(this.from.x+e*(this.to.x-this.from.x),this.from.y+e*(this.to.y-this.from.y))}end(){this.node.transform=(new ys).translate(this.to.x,this.to.y),super.end()}stringInfo(){return super.stringInfo("translation")}}dn(mn,"STIFFNESS",100),dn(mn,"DAMPING",10);class gn extends un{constructor(e){const t=e.done||r;e.duration*=gn.FLOAT_DURATION_SCALE,delete e.done,super(e),dn(this,"center",void 0),dn(this,"floatCenter",void 0),dn(this,"swayAmplitude",0),dn(this,"popAnimationDone",void 0),dn(this,"popSpringSolver",void 0),dn(this,"rotateSpringSolver",void 0),dn(this,"popAnimationDoneCalled",void 0),this.popAnimationDone=t,this.center=e.center??new cs(0,0),e.floatCenter&&(this.floatCenter=e.floatCenter),this.popSpringSolver=new _n(1,gn.SCALE_STIFFNESS,gn.SCALE_DAMPING,0),e.to>e.from&&(this.swayAmplitude=(Math.random()<.5?-1:1)*(3+3*Math.random()),this.rotateSpringSolver=new _n(1,gn.ROTATE_STIFFNESS,gn.ROTATE_DAMPING,0))}scaleAndRotate(e,t){const i=this.center.x,s=this.center.y;this.floatCenter?this.node.transform=(new ys).translate(this.floatCenter.x,this.floatCenter.y).rotate(t).translate(-this.floatCenter.x,-this.floatCenter.y).translate(i,s).scale(e).translate(-i,-s):this.node.transform=(new ys).translate(i,s).scale(e).rotate(t).translate(-i,-s)}update(e){const t=e*gn.FLOAT_DURATION_SCALE,i=this.valueAt(this.popSpringSolver.solve(t));let s=0;this.rotateSpringSolver&&(s=(this.rotateSpringSolver.solve(e)-1)*this.swayAmplitude),this.scaleAndRotate(i,s),t>1&&!this.popAnimationDoneCalled&&(this.popAnimationDoneCalled=!0,this.popAnimationDone(this))}end(){this.scaleAndRotate(this.to,0),super.end(),this.popAnimationDoneCalled||this.popAnimationDone(this)}stringInfo(){let e="";0===this.center.x&&0===this.center.y||(e+=" ("+this.center.x+", "+this.center.y+")");let t="float";return this.popAnimationDoneCalled&&(t+=" (swing)"),super.stringInfo(t,e)}}cn=gn,dn(gn,"SCALE_STIFFNESS",100),dn(gn,"SCALE_DAMPING",10),dn(gn,"FLOAT_DURATION_SCALE",4.2),dn(gn,"ROTATE_DAMPING",5),dn(gn,"ROTATE_STIFFNESS",.25*(cn.ROTATE_DAMPING*cn.ROTATE_DAMPING+483.611));class _n{constructor(e,t,i,s){dn(this,"w0",void 0),dn(this,"zeta",void 0),dn(this,"wd",void 0),dn(this,"A",void 0),dn(this,"B",void 0),this.w0=Math.sqrt(t/e),this.zeta=i/(2*Math.sqrt(t*e)),this.zeta<1?(this.wd=this.w0*Math.sqrt(1-this.zeta*this.zeta),this.A=1,this.B=(this.zeta*this.w0-s)/this.wd):(this.wd=0,this.A=1,this.B=-s+this.w0)}solve(e){return 1-(e=this.zeta<1?Math.exp(-e*this.zeta*this.w0)*(this.A*Math.cos(this.wd*e)+this.B*Math.sin(this.wd*e)):(this.A+this.B*e)*Math.exp(-e*this.w0))}}const fn={Basic:un,Opacity:pn,Translation:mn,Scale:class extends un{constructor(e){super(e),dn(this,"center",void 0),this.center=e.center??new cs(0,0)}scale(e){const t=this.center.x,i=this.center.y;this.node.transform=(new ys).translate(t,i).scale(e).translate(-t,-i)}update(e){this.scale(this.valueAt(e))}stringInfo(){let e="";return 0===this.center.x&&0===this.center.y||(e+=" ("+this.center.x+", "+this.center.y+")"),super.stringInfo("scale",e)}},Float:gn},yn=fn,vn=(Li.Coordinate,Li.CoordinateRegion,Li.CoordinateSpan,Li.MapRect),bn=function(e,t){p(t,"object","[MapKit] MapRect.pad expects a padding object with top, left, bottom, right but got `"+t+"` instead");const i=t.left||0,s=t.top||0;return new vn(e.origin.x-i,e.origin.y-s,e.size.width+i+(t.right||0),e.size.height+s+(t.bottom||0))},wn=function(e,t){const i=t.origin.x,s=t.origin.y,o=e.maxX(),n=e.maxY();return i>=e.origin.x&&i<=o&&s>=e.origin.y&&s<=n&&t.maxX()<=o&&t.maxY()<=n},Cn=function(e){if(0===e.length)return new vn;if(1===e.length){const t=e[0].minX();return t>=0&&t<1?e[0]:new vn(l(t,1),e[0].minY(),e[0].size.width,e[0].size.height)}const t=[[e[0].minX(),e[0].maxX()]];let i=e[0].minY(),s=e[0].maxY();for(let o=1,n=e.length,a=0;o<n;++o){const n=t[a],r=e[o];i=Math.min(i,r.minY()),s=Math.max(s,r.maxY()),r.minX()<=n[1]?t[a]=[n[0],Math.max(n[1],r.maxX())]:(t.push([r.minX(),r.maxX()]),++a)}const o=t.length;if(1===o)return new vn(t[0][0],i,Math.min(t[0][1]-t[0][0],1),s-i);let n=1+t[0][0]-t[o-1][1],a=t[0][0];for(let e=1;e<o;++e){const i=t[e][0]-t[e-1][1];i>n&&(n=i,a=t[e][0])}return new vn(l(a,1),i,1-n,s-i)};function kn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Sn{constructor(){kn(this,"top",0),kn(this,"right",0),kn(this,"bottom",0),kn(this,"left",0);const e=arguments.length;if(1===e&&"object"==typeof arguments[0]){this.top=0,this.right=0,this.bottom=0,this.left=0;const e=arguments[0];Object.keys(e).forEach((t=>{"top"===t||"right"===t||"bottom"===t||"left"===t?this[t]=e[t]:console.warn("[MapKit] Unknown property `"+t+"` for Padding constructor.")}))}else this.top=e>0?arguments[0]:0,this.right=e>1?arguments[1]:0,this.bottom=e>2?arguments[2]:0,this.left=e>3?arguments[3]:0;p(this.top,"number","[MapKit] Expected a number for `top` in Padding constructor but got `"+this.top+"` instead."),p(this.left,"number","[MapKit] Expected a number for `left` in Padding constructor but got `"+this.left+"` instead."),p(this.bottom,"number","[MapKit] Expected a number for `bottom` in Padding constructor but got `"+this.bottom+"` instead."),p(this.right,"number","[MapKit] Expected a number for `right` in Padding constructor but got `"+this.right+"` instead.")}toString(){return"Padding("+[this.top,this.right,this.bottom,this.left].join(", ")+")"}copy(){return new Sn(this.top,this.right,this.bottom,this.left)}equals(e){return this.top===e.top&&this.right===e.right&&this.bottom===e.bottom&&this.left===e.left}}kn(Sn,"Zero",new Sn);const Mn=Sn;function Ln(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const xn=class{constructor(e,t){Ln(this,"_speed",.03),Ln(this,"_startTime",0),Ln(this,"_shouldStop",!1),Ln(this,"_animating",!1),this._delegate=t,this._snapsToIntegralZoomLevels=e}start(e,t){const i=Date.now();return this._gasPedalValue=0,this._startTime=i,this._shouldStop&&this._cleanUp(),this._shouldStop=!1,this.zoomsIn=!!t,Bo.supportsForceTouch&&window.addEventListener("webkitmouseforcechanged",this),!this._animating&&(this._animating=!0,this._zoomLevel=e,this._timeAtLastFrame=i,Mt.scheduleOnNextFrame(this),!0)}stop(){this._shouldStop=!0,Bo.supportsForceTouch&&(window.removeEventListener("webkitmouseforcechanged",this),this._speed=.03)}set snapsToIntegralZoomLevels(e){this._snapsToIntegralZoomLevels=!!e}performScheduledUpdate(){let e=!0;const t=Date.now(),i=t-this._timeAtLastFrame,s=this._speed*(this.zoomsIn?1:-1);this._zoomLevel+=60*i*h(1+s)/1e3,this._timeAtLastFrame=t,this._shouldStop&&t-this._startTime>=250&&(this._zoomLevelAtWhichToStop?(e=this.zoomsIn&&this._zoomLevel<this._zoomLevelAtWhichToStop||!this.zoomsIn&&this._zoomLevel>this._zoomLevelAtWhichToStop,e||(this._zoomLevel=this._zoomLevelAtWhichToStop)):this._snapsToIntegralZoomLevels?this._zoomLevelAtWhichToStop=this.zoomsIn?Math.ceil(this._zoomLevel):Math.floor(this._zoomLevel):e=!1),this._delegate&&this._delegate.linearZoomControllerDidZoom(this._zoomLevel),e?Mt.scheduleOnNextFrame(this):this._cleanUp()}handleEvent(e){this._handleForceChangedEvent(e)}_handleForceChangedEvent(e){const t=c(e.webkitForce,MouseEvent.WEBKIT_FORCE_AT_MOUSE_DOWN,MouseEvent.WEBKIT_FORCE_AT_FORCE_MOUSE_DOWN)-MouseEvent.WEBKIT_FORCE_AT_MOUSE_DOWN;Math.abs(t-this._gasPedalValue)>.01&&(this._gasPedalValue=t),this._speed=.01+this._gasPedalValue*(.06-.01)}_cleanUp(){this._animating=!1,this._shouldStop=!1,delete this._zoomLevelAtWhichToStop,this._delegate&&this._delegate.linearZoomControllerDidStop()}mapWasDestroyed(){this._delegate=null}};class An extends xo{constructor(){super(),this.numberOfTapsRequired=1,this.numberOfTouchesRequired=1,this._taps=0}touchesBegan(e){e.currentTarget===this.target&&("button"in e&&2===e.button&&!this.allowsRightMouseButton||(super.touchesBegan(e),this.numberOfTouches===this.numberOfTouchesRequired?(this._domEvents.push(e),this._startPoint=super.locationInElement(),this._startClientPoint=super.locationInClient(),this._rewindTimer(750)):this.enterFailedState()))}touchesMoved(e){let t;switch(this.preventDefault(e),this.currentMode){case xo.Modes.Pointer:t="touch"===e.pointerType?40:2;break;case xo.Modes.Touch:t=40;break;case xo.Modes.Mouse:t=2}void 0!==t&&(!this._startPoint||this._startPoint.distanceToPoint(super.locationInElement())>t)&&this.enterFailedState()}touchesEnded(e){this._taps++,this._domEvents.push(e),this._taps===this.numberOfTapsRequired&&(this.preventDefault(e),this.enterRecognizedState(),this.reset()),this._rewindTimer(350)}reset(){this._taps=0,this._clearTimer(),this._domEvents=[]}locationInElement(e){const t=this._startPoint||new cs;return e?Cs.fromPageToElement(e,t):t}locationInClient(){return this._startClientPoint||new cs}_clearTimer(){window.clearTimeout(this._timerId),delete this._timerId}_rewindTimer(e){this._clearTimer(),this._timerId=window.setTimeout(this._timerFired.bind(this),e)}_timerFired(){this.enterFailedState()}}class En extends xo{constructor(){super(),this.allowableMovement=10,this.minimumPressDuration=500,this.numberOfTouchesRequired=1,this._startPoint=void 0}touchesBegan(e){e.currentTarget===this.target&&("button"in e&&e.button>0&&!this.allowsRightMouseButton||(super.touchesBegan(e),this.numberOfTouches===this.numberOfTouchesRequired?(this._startPoint=this.locationInElement(),this._timerId=window.setTimeout(this.enterRecognizedState.bind(this),this.minimumPressDuration)):this.enterFailedState()))}touchesMoved(e){this.preventDefault(e),void 0!==this._startPoint&&this._startPoint.distanceToPoint(this.locationInElement())>this.allowableMovement&&this.enterFailedState()}touchesCancelled(e){this.touchesEnded(e)}touchesEnded(e){this.state===xo.States.Recognized?(this.preventDefault(e),this.numberOfTouches!==this.numberOfTouchesRequired&&this.enterFailedState()):this.enterFailedState()}reset(){window.clearTimeout(this._timerId),delete this._timerId}}const Tn=.75;function In(){return{start:new cs,end:new cs,dt:0}}function On(e){return e.dt<1?new cs:new cs((e.end.x-e.start.x)/e.dt*1e3,(e.end.y-e.start.y)/e.dt*1e3)}class Rn extends xo{constructor(){super(),this.minimumNumberOfTouches=1,this.maximumNumberOfTouches=1e5,this.translationThreshold=10,this._traveledMinimumDistance=!1,this._previousVelocitySample=In(),this._velocitySample=In(),this.translation=new cs}get velocity(){if(void 0===this._lastTouchTime)return new cs;if(performance.now()-this._lastTouchTime>100)return new cs;const e=On(this._velocitySample);if(xo.SupportsTouches&&this._previousVelocitySample.dt>0){const t=On(this._previousVelocitySample);e.x=.25*e.x+Tn*t.x,e.y=.25*e.y+Tn*t.y}return e}touchesBegan(e){e.currentTarget===this.target&&(e instanceof MouseEvent&&0!==e.button||(super.touchesBegan(e),this._numberOfTouchesIsAllowed()?(this._lastTouchTime=e.timeStamp,this._resetTrackedLocations(),1===this.numberOfTouches&&(this._traveledMinimumDistance=!1)):this.enterFailedState()))}touchesMoved(e){this.preventDefault(e);const t=e.timeStamp,i=this.locationInElement();if(void 0===this._lastTouchTime||void 0===this._lastTouchLocation||void 0===this._translationOrigin)return;const s=t-this._lastTouchTime;s>8&&(this._previousVelocitySample.start=this._velocitySample.start.copy(),this._previousVelocitySample.end=this._velocitySample.end.copy(),this._previousVelocitySample.dt=this._velocitySample.dt,this._velocitySample.start=this._lastTouchLocation.copy(),this._velocitySample.end=i,this._velocitySample.dt=s),this._traveledMinimumDistance?(this.translation.x+=i.x-this._lastTouchLocation.x,this.translation.y+=i.y-this._lastTouchLocation.y,this.enterChangedState()):this._canBeginWithTraveledDistance(new cs(i.x-this._translationOrigin.x,i.y-this._translationOrigin.y))&&(this._traveledMinimumDistance=!0,this.enterBeganState()),this._lastTouchTime=t,this._lastTouchLocation=i}touchesEnded(e){this._numberOfTouchesIsAllowed()?this._resetTrackedLocations():this._traveledMinimumDistance?this.enterEndedState():this.enterFailedState()}reset(){this._velocitySample=In(),this._previousVelocitySample=In(),this.translation=new cs,this._traveledMinimumDistance=!1}_canBeginWithTraveledDistance(e){return Math.abs(e.x)>=this.translationThreshold||Math.abs(e.y)>=this.translationThreshold}_numberOfTouchesIsAllowed(){return this.numberOfTouches>=this.minimumNumberOfTouches&&this.numberOfTouches<=this.maximumNumberOfTouches}_resetTrackedLocations(){const e=this.locationInElement();this._lastTouchLocation=e,this._translationOrigin=e}}class Pn extends xo{constructor(){super(),this.scaleThreshold=0,this.useGestures=xo.UseGesturesForPinch,this._scaledMinimumAmount=!1,this.scale=1,this._velocity=0,this._gestures=[],this._startDistance=0}get velocity(){const e=this._gestures[this._gestures.length-1];if(!e)return this._velocity;const t=performance.now()-(e.timeStamp+100);if(t<=0)return this._velocity;const i=Math.max((500-t)/500,0);return this._velocity*i}touchesBegan(e){if(e.currentTarget===this.target){if(this.useGestures){if(2!==this.numberOfTouches)return}else{if(this.numberOfTouches>2)return void this.enterFailedState();if(2!==this.numberOfTouches)return;this._startDistance=this._distance(),this._recordGesture(e.timeStamp,1),this._scaledMinimumAmount=!1,this._updateStateWithEvent(e)}super.touchesBegan(e)}}touchesMoved(e){this.useGestures||2===this.numberOfTouches&&this._updateStateWithEvent(e)}touchesEnded(e){this.useGestures||this.numberOfTouches>=2||!this._startDistance||(this._scaledMinimumAmount?this.enterEndedState():this.enterFailedState())}gestureBegan(e){super.gestureBegan(e),this._recordGesture(e.timeStamp,e.scale),this._scaledMinimumAmount=!1,this._updateStateWithEvent(e),this.preventDefault(e)}gestureChanged(e){this.preventDefault(e),this._updateStateWithEvent(e)}gestureEnded(e){this._scaledMinimumAmount?this.enterEndedState():this.enterFailedState()}reset(){this.scale=1,this._velocity=0,this._gestures=[],this._startDistance=0}_recordGesture(e,t){const i=e,s=this._gestures.push({scale:t,timeStamp:i});if(s<=2)return;const o=this._gestures[s-1].scale>=this._gestures[s-2].scale;let n;for(n=s-3;n>=0;--n){const e=this._gestures[n];if(i-e.timeStamp>100||this._gestures[n+1].scale>=e.scale!==o)break}n>0&&(this._gestures=this._gestures.slice(n+1))}_updateStateWithEvent(e){const t=this.useGestures?e.scale:0!==this._startDistance?this._distance()/this._startDistance:1;if(!isFinite(t)||t<=0)return void this.enterFailedState();if(!this._scaledMinimumAmount)return void(Math.abs(1-t)>=this.scaleThreshold&&(this._scaledMinimumAmount=!0,this.scale=1,this.enterBeganState()));this._recordGesture(e.timeStamp,t);const i=this._gestures[0],s=t-i.scale,o=e.timeStamp-i.timeStamp;this._velocity=0===o?0:s/o*1e3,this.scale*=t/this._gestures[this._gestures.length-2].scale,this.enterChangedState()}}class Dn extends xo{constructor(){super(),this._rotation=0,this.rotation=0,this._velocity=0,this._lastEventData=null,this._startAngle=null,this.useGestures=xo.UseGesturesForRotation}get velocity(){return this._velocity}get rotation(){return this._rotation}set rotation(e){this._rotation=function(e){for(;e>180;)e-=360;for(;e<-180;)e+=360;return e}(e)}touchesBegan(e){this.useGestures||e.currentTarget===this.target&&2===this.numberOfTouches&&(super.touchesBegan(e),this.numberOfTouches>2?this.enterFailedState():(this._startAngle=this._angle(),this._startDistance=this._distance(),this.rotation=0,this._lastEventData={rotation:0,scale:1,timeStamp:e.timeStamp}))}touchesMoved(e){this.useGestures||2===this.numberOfTouches&&null!==this._startAngle&&void 0!==this._startDistance&&this._handleEvent(e,{rotation:this._angle()-this._startAngle,scale:0===this._startDistance?1:this._distance()/this._startDistance})}touchesEnded(e){this.useGestures||this.numberOfTouches>=2||null===this._startAngle||(this.state===xo.States.Changed?this.enterEndedState():this.enterFailedState())}gestureBegan(e){this.useGestures&&(super.gestureBegan(e),this.preventDefault(e),this.rotation=0,this._lastEventData={rotation:0,scale:1,timeStamp:e.timeStamp})}gestureChanged(e){this.useGestures&&(this.preventDefault(e),this._handleEvent(e))}gestureEnded(e){this.useGestures&&this.enterEndedState()}reset(){this.rotation=0,this._velocity=0,this._lastEventData=null,this._startAngle=null}_handleEvent(e,t){const i="rotation"in e?e.rotation:t?t.rotation:NaN,s="scale"in e?e.scale:t?t.scale:NaN,o=this._lastEventData;if(!o||isNaN(i)||isNaN(s))throw new Error("");const n=i-o.rotation,a=s-o.scale,r=e.timeStamp-o.timeStamp;if(this._lastEventData={rotation:i,scale:s,timeStamp:e.timeStamp},this.state!==xo.States.Possible)r>0&&(this._velocity=n/r*1e3),this.rotation+=n,this.enterChangedState();else{const e=Math.abs(i)<8,t=Math.abs(n/90)<Math.abs(a),s=Math.abs(n)>=135;if(e||t||s)return;this.enterBeganState()}}_angle(){if(2!==this.numberOfTouches)return 0;const e=this._targetTouches[0],t=new cs(e.pageX,e.pageY),i=this._targetTouches[1],s=new cs(i.pageX,i.pageY);return 180*Math.atan2(t.y-s.y,t.x-s.x)/Math.PI}}const zn=100;class Nn extends xo{constructor(){super(),this.numberOfTouchesRequired=1,this.direction=Nn.Directions.Right}touchesBegan(e){e.currentTarget===this.target&&(this.numberOfTouchesRequired===this.numberOfTouches?(super.touchesBegan(e),this._translationOrigin=this.locationInElement()):this.enterFailedState())}touchesMoved(e){if(this.numberOfTouchesRequired!==this.numberOfTouches)return void this.enterFailedState();if(this.preventDefault(e),void 0===this._translationOrigin)return;const t=this.locationInElement(),i=new cs(t.x-this._translationOrigin.x,t.y-this._translationOrigin.y);this.state!==xo.States.Recognized&&this.direction===Nn.Directions.Right&&i.x>zn&&Math.abs(i.x)>Math.abs(i.y)&&this.enterRecognizedState(),this.state!==xo.States.Recognized&&this.direction===Nn.Directions.Left&&i.x<-100&&Math.abs(i.x)>Math.abs(i.y)&&this.enterRecognizedState(),this.state!==xo.States.Recognized&&this.direction===Nn.Directions.Up&&i.y<-100&&Math.abs(i.y)>Math.abs(i.x)&&this.enterRecognizedState(),this.state!==xo.States.Recognized&&this.direction===Nn.Directions.Down&&i.y>zn&&Math.abs(i.y)>Math.abs(i.x)&&this.enterRecognizedState()}touchesEnded(e){this.enterFailedState()}}Nn.Directions=Object.freeze({Right:1,Left:2,Up:4,Down:8});xo.SupportsTouches,xo.SupportsPointerEvents;const Fn=xo.States;const Un=class extends En{constructor(){super(),this.minimumPressDuration=500}touchesBegan(e){super.touchesBegan(e),this._domEvents.push(e),this.translation=new cs,this._translationOrigin=this._lastTouchLocation=this.locationInElement()}enterRecognizedState(){super.enterBeganState()}touchesMoved(e){S(this._lastTouchLocation),S(this.translation),this.preventDefault(e);const t=this.locationInElement();if(this.state===Fn.Possible)super.touchesMoved(e);else if(this.state===Fn.Began||this.state===Fn.Changed){const e=this.translation;e.x+=t.x-this._lastTouchLocation.x,e.y+=t.y-this._lastTouchLocation.y,this.enterChangedState()}this._lastTouchLocation=t}touchesCanceled(e){this.interruptGesture()}touchesEnded(e){this.state===Fn.Changed?(this.preventDefault(e),this.enterEndedState()):this.enterFailedState()}interruptGesture(){this.state===Fn.Changed?this.enterEndedState():this.state===Fn.Began&&this.enterFailedState()}reset(){super.reset(),delete this._translationOrigin,delete this._lastTouchLocation,this._domEvents=[]}},Gn="mk-disable-all-gestures",Wn="mk-disable-pan-gestures",Bn="mk-disable-pinch-gestures",Zn="mk-disable-zoom-gestures";const Kn=class{constructor(e,t){this._target=e,this._delegate=t,this._touchCount=0,this.initialEventTargetForCurrentInteraction=null,this._doubleTapWithOneFingerRecognizer=this._addGestureRecognizer(An),this._doubleTapWithOneFingerRecognizer.numberOfTouchesRequired=1,this._doubleTapWithOneFingerRecognizer.numberOfTapsRequired=2,this._singleTapWithOneFingerRecognizer=this._addGestureRecognizer(An),this._longPressAndPanRecognizer=this._addGestureRecognizer(Un),this._longPressAndPanRecognizer.delegate=this,e.addEventListener(Bo.startEventType,this),e.addEventListener("dragstart",this),this.updateGestureEnableState()}handleEvent(e){const t=this._delegate;switch(S(),e.type){case"pointerdown":this._installEndListeners(),this._touchCount++,this.initialEventTargetForCurrentInteraction=t.getEventTargetFromSubShadowDOM(e);break;case"pointerup":case"pointercancel":this._touchCount--,0===this._touchCount&&(this._removeEndListeners(),this.initialEventTargetForCurrentInteraction=null);break;case"dragstart":t.elementShouldPreventDragstart(e.target)&&e.preventDefault();break;case"mousedown":this._installEndListeners(),this.initialEventTargetForCurrentInteraction=t.getEventTargetFromSubShadowDOM(e);break;case"mouseup":this._removeEndListeners(),this.initialEventTargetForCurrentInteraction=null;break;case"touchstart":e.touches.length===e.changedTouches.length&&(this._installEndListeners(),this.initialEventTargetForCurrentInteraction=t.getEventTargetFromSubShadowDOM(e),t.elementWantsDefaultBrowserBehavior(this.initialEventTargetForCurrentInteraction,e,e.touches.length)||e.preventDefault());break;case"touchend":case"touchcancel":0===e.touches.length&&(this._removeEndListeners(),this.initialEventTargetForCurrentInteraction=null);break;case"statechange":this._handleStatechange(e)}}_handleStatechange(e){switch(e.target){case this._doubleTapWithOneFingerRecognizer:this._handleDoubleTapWithOneFingerChange(e);break;case this._singleTapWithOneFingerRecognizer:this._handleSingleTapWithOneFingerChange(e);break;case this._longPressAndPanRecognizer:this._handleLongPressAndPanChange(e)}}gestureRecognizerShouldBegin(e){return S(this._delegate),this._delegate.userDidLongPress(e)}updateGestureEnableState(){const e=this._delegate;S();const t=(e.isScrollEnabled?1:0)|(e.isRotationEnabled?2:0)|(e.isZoomEnabled?4:0),i=[void 0,Wn,Bn,Gn,Zn,Gn,Bn,Gn];e.rootNode.classList.remove(Gn),e.rootNode.classList.remove(Wn),e.rootNode.classList.remove(Bn),e.rootNode.classList.remove(Zn),i[t]&&e.rootNode.classList.add(i[t])}mapWasDestroyed(){S(this._longPressAndPanRecognizer),S(this._singleTapWithOneFingerRecognizer),S(this._doubleTapWithOneFingerRecognizer),S(this._target),this._removeEndListeners(),this._target.removeEventListener(Bo.startEventType,this),this._target.removeEventListener("dragstart",this),this._doubleTapWithOneFingerRecognizer.removeEventListener("statechange",this),this._doubleTapWithOneFingerRecognizer.enabled=!1,this._doubleTapWithOneFingerRecognizer=null,this._singleTapWithOneFingerRecognizer.removeEventListener("statechange",this),this._singleTapWithOneFingerRecognizer.enabled=!1,this._singleTapWithOneFingerRecognizer=null,this._longPressAndPanRecognizer.removeEventListener("statechange",this),this._longPressAndPanRecognizer.enabled=!1,this._longPressAndPanRecognizer.delegate=null,this._longPressAndPanRecognizer=null,window.clearTimeout(this._delayedSingleTapRecognizerTimeoutID),this.initialEventTargetForCurrentInteraction=null,this._target=null,this._delegate=null}_addGestureRecognizer(e){const t=new e;return t.target=this._target,t.addEventListener("statechange",this),t}_handleDoubleTapWithOneFingerChange(e){const t=e.target;M();const i=this._delegate;S(),S(this._singleTapWithOneFingerRecognizer),S(this._doubleTapWithOneFingerRecognizer),t.state===Fn.Recognized&&(this._delayedSingleTapRecognizerTimeoutID&&(i.userCanceledTap(),window.clearTimeout(this._delayedSingleTapRecognizerTimeoutID),delete this._delayedSingleTapRecognizerTimeoutID),this._singleTapWithOneFingerRecognizer.enabled=!1,i.userDidDoubleTap(t))}_handleSingleTapWithOneFingerChange(e){const t=e.target;M();const i=this._delegate;if(S(),S(this._singleTapWithOneFingerRecognizer),this._singleTapWithOneFingerRecognizer.enabled&&t.state===Fn.Recognized){i.userWillTap(t);const e=i.shouldDelaySingleTap()?350:0;this._delayedSingleTapRecognizerTimeoutID=setTimeout((()=>{delete this._delayedSingleTapRecognizerTimeoutID,i.userDidTap()}),e)}}_handleLongPressAndPanChange(e){const t=e.target;M();const i=this._delegate;switch(S(),S(this._singleTapWithOneFingerRecognizer),S(this._doubleTapWithOneFingerRecognizer),t.state){case Fn.Possible:i.userMayStartPanningAfterLongPress();break;case Fn.Began:this._singleTapWithOneFingerRecognizer.enabled=!1,this._doubleTapWithOneFingerRecognizer.enabled=!1,this._doubleTapWithOneFingerRecognizer.enabled=!0;break;case Fn.Changed:S(t.translation),i.userDidPanAfterLongPress(t.translation);break;case Fn.Ended:case Fn.Failed:this._singleTapWithOneFingerRecognizer.enabled=!0,i.userDidStopPanningAfterLongPress(t.state!==Fn.Failed)}}_stopDraggingAnnotation(){S(this._longPressAndPanRecognizer),this._longPressAndPanRecognizer.interruptGesture()}_installEndListeners(){window.addEventListener(Bo.endEventType,this),Bo.cancelEventType&&window.addEventListener(Bo.cancelEventType,this)}_removeEndListeners(){window.removeEventListener(Bo.endEventType,this),Bo.cancelEventType&&window.removeEventListener(Bo.cancelEventType,this)}},jn=100,Hn=Math.log(10)/Math.log(2);function qn(e,t,i,s,o,n){i=l(i,t),s=l(s,t),o=Math.ceil(o),n=Math.ceil(n);const a=Math.ceil(o/t),r=Math.ceil(n/t);for(let s=0;s<a;++s)e.fillRect(i+s*t,0,1,n);for(let i=0;i<r;++i)e.fillRect(0,s+i*t,o,1)}function Vn(e){return"rgb("+e.join(",")+")"}function Yn(e,t,i){return Math.round(t*i+e*(1-i))}const Xn=class extends Qo{draw(e,t){const i=this.node,s=i.zoom,o=Math.pow(2,s%Hn),n=jn*o,a=n/10,r=Math.min(a,jn),h=a<10?0:(r-10)/90,c=i.origin,d=Li.pointsPerAxis(s),u=new cs(-c.x*d,-c.y*d),p=l(u.x,n)-n,m=l(u.y,n)-n,g=this.node.theme;if(e.fillStyle=Vn(g.fillColor),e.fillRect(0,0,i.size.width,i.size.height),i.initialRendering)return;const _=1-Math.pow(1-h,2);_>0&&(e.fillStyle=Vn(function(e,t,i){if(0===i)return e;if(1===i)return t;return[Yn(e[0],t[0],i),Yn(e[1],t[1],i),Yn(e[2],t[2],i)]}(g.fillColor,g.lineColor,_)),qn(e,a,p,m,i.size.width,i.size.height)),e.fillStyle=Vn(g.lineColor),qn(e,n,p,m,i.size.width,i.size.height)}};const $n={light:{fillColor:[248,245,236],lineColor:[149,148,144]},dark:{fillColor:[44,45,47],lineColor:[56,64,66]}};const Jn=class extends Ns{constructor(){var e,t,i;super(),i=!1,(t="initialRendering")in(e=this)?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,this._renderer=new Xn(this),this._theme=$n.light}get size(){return this.parent.size}get zoom(){return this.parent.zoomLevel}get origin(){return this.parent.visibleMapRect.origin}get theme(){return this._theme}updateThemeFromTint(e){const t=$n[e];t!==this._theme&&(this._theme=t,this.needsDisplay=!0)}stringInfo(){return"BackgroundGridNode"+(this.initialRendering?"!":"")+(this._theme===$n.light?"":"<dark>")}},Qn=Symbol(),ea=Symbol();function ta(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const ia=class extends an{constructor(...e){super(...e),ta(this,"delegate",null),ta(this,"addEventListener",P.prototype.addEventListener),ta(this,"removeEventListener",P.prototype.removeEventListener),ta(this,"dispatchEvent",P.prototype.dispatchEvent)}deactivate(){this._impl.deactivate()}destroy(e){this._impl.destroy(e)}get element(){return this._impl.element}get camera(){return this._impl.camera}get minZoomLevel(){return this._impl.currentMinZoomLevel}get maxZoomLevel(){return this._impl.currentMaxZoomLevel}get usesInteractionCenter(){return this._impl.usesInteractionCenter}set usesInteractionCenter(e){this._impl.usesInteractionCenter=e}get currentGestureType(){return this._impl.currentGestureType}set currentGestureType(e){this._impl.currentGestureType=e}get configuration(){return this._impl.configuration}set configuration(e){this._impl.configuration=e}get tint(){return this._impl.tint}get tileTint(){return this._impl.tileTint}get emphasis(){return this._impl.emphasis}get language(){return this._impl.language}set language(e){this._impl.language=e}get allowWheelToZoom(){return this._impl.allowWheelToZoom}set allowWheelToZoom(e){this._impl.allowWheelToZoom=e}get allowWheelToZoom2(){return this._impl.allowWheelToZoom2}set allowWheelToZoom2(e){this._impl.allowWheelToZoom2=e}get pointOfInterestFilter(){return this._impl.pointOfInterestFilter}set pointOfInterestFilter(e){this._impl.pointOfInterestFilter=e}setPoiFiltered(e,t){this._impl.setPoiFiltered&&this._impl.setPoiFiltered(e,t)}get backgroundGridTheme(){return this._impl.backgroundGridTheme}set backgroundGridTheme(e){this._impl.backgroundGridTheme=e}get size(){return this._impl.size}set size(e){this._impl.size=e}get rotation(){return this._impl.rotation}set rotation(e){this._impl.rotation=e}getRotation(){return this._impl.rotation}get isRotationEnabled(){return this._impl.isRotationEnabled}set isRotationEnabled(e){this._impl.isRotationEnabled=e}get isRotationLocked(){return this._impl.isRotationLocked}get cameraIsPanning(){return this._impl.cameraIsPanning}get pannable(){return this._impl.pannable}set pannable(e){this._impl.pannable=e}get cameraIsZooming(){return this._impl.cameraIsZooming}get zoomable(){return this._impl.zoomable}set zoomable(e){this._impl.zoomable=e}get cameraIsRotating(){return this._impl.cameraIsRotating}get cameraIsAnimating(){return!!this._impl.cameraAnimation}get zoomLevel(){return this._impl.zoomLevel}set zoomLevel(e){this._impl.setZoomLevelAnimated(e)}set fontSizeRatio(e){this._impl.fontSizeRatio=e}setZoomLevelAnimated(e,t){this._impl.setZoomLevelAnimated(e,t)}setCameraDistanceAnimated(e,t){this._impl.setCameraDistanceAnimated(e,t)}getCurrentCameraDistance(){return this._impl.getCurrentCameraDistance()}get cameraZoomRange(){return this._impl.cameraZoomRange}setCameraZoomRangeAnimated(e,t){this._impl.setCameraZoomRangeAnimated(e,t)}setCameraZoomLevelLimitAnimated(e,t){this._impl.setCameraZoomLevelLimitAnimated(e,t)}zoomLevelForCameraDistanceAtY(e,t){return this._impl.zoomLevelForCameraDistanceAtY(e,t)}get visibleMapRect(){return this._impl.visibleMapRect}set visibleMapRect(e){this._impl.setVisibleMapRectAnimated(e)}setVisibleMapRectAnimated(e,t){this._impl.setVisibleMapRectAnimated(e,t)}setCenterAnimated(e,t){this._impl.setCenterAnimated(e,t)}setCameraBoundaryAnimated(e,t){this._impl.setCameraBoundaryAnimated(e,t)}isMapPointWithinBounds(e){return this._impl.isMapPointWithinBounds(e)}get showsDefaultTiles(){return this._impl.showsDefaultTiles}set showsDefaultTiles(e){this._impl.showsDefaultTiles=e}get tileOverlays(){return this._impl.tileOverlays}set tileOverlays(e){this._impl.tileOverlays=e}addTileOverlay(e){return this._impl.addTileOverlay(e)}addTileOverlays(e){return this._impl.addTileOverlays(e)}removeTileOverlay(e){return this._impl.removeTileOverlay(e)}removeTileOverlays(e){return this._impl.removeTileOverlays(e)}adjustMapItemPoint(e){return this._impl.adjustMapItemPoint(e)}cameraWillStartZooming(e,t,i){return this._impl.cameraWillStartZooming(e,t,i)}cameraDidStopZooming(){this._impl.cameraDidStopZooming()}get fullyRendered(){return this._impl.fullyRendered}devicePixelRatioDidChange(){return this._impl.devicePixelRatioDidChange()}stringInfo(){return this._impl.stringInfo()}get snapsToIntegralZoomLevels(){return this._impl.snapsToIntegralZoomLevels}set snapsToIntegralZoomLevels(e){this._impl.snapsToIntegralZoomLevels=e}migrateStateTo(e){return this._impl.migrateStateTo(e)}needsReplacing(e){return this._impl.needsReplacing(e)}createLabelRegion(){return this._impl.createLabelRegion()}updatedLabelRegion(){this._impl.updatedLabelRegion()}unregisterLabelRegion(e){this._impl.unregisterLabelRegion(e)}setCameraAnimated(e,t,i){this._impl.setCameraAnimated(e,t,i)}setTintAndEmphasis(e,t,i){this._impl.setTintAndEmphasis(e,t,i)}compassRotationWillStart(){return this._impl.compassRotationWillStart()}compassRotationDidEnd(){this._impl.compassRotationDidEnd()}forceRerender(){}forceDraw(){}requireRender(){}getMemoryStatistics(){return{}}get[Qn](){return this._impl[Qn]}set[Qn](e){this._impl[Qn]=e}[ea](e){return this._impl[ea](e)}};class sa{constructor(e,t,i,s){this.center=e||new Ci(.5,.5),this._zoom=t||3,this._pointsPerAxis=Li.pointsPerAxis(this._zoom),this.zoom=t||3,this.viewportSize=i||new ls,this._rotation=s||0}get zoom(){return this._zoom}set zoom(e){this._zoom!==e&&(this._zoom=e||3,this._pointsPerAxis=Li.pointsPerAxis(this._zoom))}get worldSize(){return this._pointsPerAxis}get rotation(){return this._rotation}set rotation(e){const t=l(e,360);this._rotation=t}minX(){if(0===this._pointsPerAxis)return 0;const e=this.viewportSize.width/this._pointsPerAxis;return this.center.x-e/2}minY(){if(0===this._pointsPerAxis)return 0;const e=this.viewportSize.height/this._pointsPerAxis;return this.center.y-e/2}maxX(){if(0===this._pointsPerAxis)return 0;const e=this.viewportSize.width/this._pointsPerAxis;return this.center.x+e/2}maxY(){if(0===this._pointsPerAxis)return 0;const e=this.viewportSize.height/this._pointsPerAxis;return this.center.y+e/2}equals(e){return this.zoom===e.zoom&&this.center.equals(e.center)&&this.viewportSize.equals(e.viewportSize)&&this.rotation===e.rotation}copy(){return new sa(this.center,this.zoom,this.viewportSize,this.rotation)}toString(){return"Camera("+["center: ["+this.center.x+", "+this.center.y+"]","zoom: "+this.zoom,"viewportSize: "+this.viewportSize.toString(),"rotation: "+this.rotation].join(", ")+")"}toMapRect(){if(0===this._pointsPerAxis)return new Si(this.center.x,this.center.y,0,0);const e=this.viewportSize.width/this._pointsPerAxis,t=this.viewportSize.height/this._pointsPerAxis,i=Object.create(Ci.prototype);i.x=this.center.x-e/2,i.y=this.center.y-t/2;const s=Object.create(ki.prototype);s.width=e,s.height=t;const o=Object.create(Si.prototype);return o.origin=i,o.size=s,o}toRenderingMapRect(){let e=[new cs(this.minX(),this.minY()),new cs(this.maxX(),this.minY()),new cs(this.maxX(),this.maxY()),new cs(this.minX(),this.maxY())];if(0!==this.rotation){const t=(new ys).rotate(this.rotation);e=e.map((e=>t.transformPoint(e)))}let t=e[0].x,i=e[0].y,s=e[0].x,o=e[0].y;for(let n=1;n<e.length;++n){const a=e[n];a.x<t&&(t=a.x),a.x>s&&(s=a.x),a.y<i&&(i=a.y),a.y>o&&(o=a.y)}const n=s-t,a=o-i;return new Si(this.center.x-n/2,this.center.y-a/2,n,a)}translate(e){if(0===this._pointsPerAxis)return this.copy();if(0!==this.rotation){e=(new ys).rotate(-this.rotation).transformPoint(e)}const t=Math.round(e.x)/this._pointsPerAxis,i=Math.round(e.y)/this._pointsPerAxis,s=Object.create(Ci.prototype);s.x=l(this.center.x-t,1),s.y=l(this.center.y-i,1);const o=Object.create(sa.prototype);return o.center=s,o._zoom=this._zoom,o._pointsPerAxis=this._pointsPerAxis,o.viewportSize=this.viewportSize,o._rotation=this._rotation,o}transformMapPoint(e){const t=this.viewportSize.width,i=this.viewportSize.height,s=this._pointsPerAxis,o=(new ys).translate(-this.minX()*s,-this.minY()*s).scale(s).transformPoint(new cs(e.x,e.y)),n=(new ys).translate(t/2,i/2).rotate(this.rotation).translate(t/-2,i/-2).transformPoint(o);return new Ci(n.x,n.y)}transformGestureCenter(e){if(0===this.rotation)return e;const t=this.viewportSize.width,i=this.viewportSize.height;return(new ys).translate(t/2,i/2).rotate(-this.rotation).translate(-t/2,-i/2).transformPoint(e)}rotateAroundCenter(e,t){const i=(new ys).translate(e.x,e.y).rotate(-t).translate(-e.x,-e.y).transformPoint(new cs(this.center.x,this.center.y));this.center=new Li.MapPoint(i.x,i.y),this.rotation+=t}withNewMapRect(e,t,i){i=i||this.viewportSize;const s=Li.zoomLevelForMapRectInViewport(e,i,Li.tileSize);return new sa(new Li.MapPoint(e.midX(),e.midY()),t?Math.floor(s):s,i,this.rotation)}}const oa=sa;function na(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const aa=class{constructor(e,t,i,s){na(this,"unconstrained",!1),na(this,"_zoomIsAdditive",!1),this.map=e,this._startCamera=t,this._endCamera=i,this._duration=250,this._rotationCenter=s,e.snapsToIntegralZoomLevels&&(i.zoom=Math.round(i.zoom)),this._updateAnimationRects(),this._startTime=null,this._schedule()}cancel(){this._canceled=!0}get zooming(){return this._startCamera.zoom!==this._endCamera.zoom}set additiveZoom(e){this._zoomIsAdditive=!0,this._endCamera.zoom=e,this._updateAnimationRects()}get zoomIsAdditive(){return this._zoomIsAdditive}get rotating(){return this._startCamera.rotation!==this._endCamera.rotation}adjustRotation(e,t){this._startCamera.rotateAroundCenter(e,t),this._endCamera.rotateAroundCenter(e,t),this._updateAnimationRects()}updateViewportSize(e){this._startCamera=new oa(this._startCamera.center,this._startCamera.zoom,e,this._startCamera.rotation),this._endCamera=new oa(this._endCamera.center,this._endCamera.zoom,e,this._endCamera.rotation),this._updateAnimationRects()}performScheduledUpdate(e){this._canceled||(null==e?this._animationDidProgress(1):null==this._startTime?(this._startTime=e,this._schedule()):this._animationDidProgress(Math.min((e-this._startTime)/this._duration,1)))}_updateAnimationRects(){if(this._rotationDelta=this._endCamera.rotation-this._startCamera.rotation,Math.abs(this._rotationDelta)>180&&(this._rotationDelta=this._endCamera.rotation+360-this._startCamera.rotation),this._rotationCenter)return;this._startRect=this._startCamera.toMapRect(),this._animatedEndRect=this._endCamera.toMapRect();const e=this._startCamera.center.x-this._endCamera.center.x;Math.abs(e)>.5&&(e<0?this._startRect.origin.x+=1:this._animatedEndRect.origin.x+=1)}_schedule(){Mt.scheduleOnNextFrame(this)}_animationDidProgress(e){if(1===e)return this.map.snapsToIntegralZoomLevels&&(this._endCamera.zoom=Math.round(this._endCamera.zoom)),this.map.cameraAnimationDidProgress(this._endCamera),void this.map.cameraAnimationDidEnd();this._rotationCenter?this._animateAroundCenter(e):this._animateRects(e),this._schedule()}_animateAroundCenter(e){const t=this._startCamera.copy();t.rotateAroundCenter(this._rotationCenter,e*this._rotationDelta),this.map.cameraAnimationDidProgress(t)}_animateRects(e){const t=this._startRect,i=this._animatedEndRect,s=t.origin.x,o=t.origin.y,n=t.size.width,a=t.size.height,r=i.origin.x-t.origin.x,l=i.origin.y-t.origin.y,h=i.size.width-t.size.width,c=i.size.height-t.size.height;let d=this._endCamera.rotation-this._startCamera.rotation;Math.abs(d)>180&&(d=this._endCamera.rotation+360-this._startCamera.rotation);const u=new Li.MapRect(s+r*e,o+l*e,n+h*e,a+c*e),p=this._startCamera.withNewMapRect(u);this.map.cameraAnimationDidProgress(p,this.unconstrained),this.map.rotation=this._startCamera.rotation+this._rotationDelta*e}};const ra=class{constructor(e,t){this._map=e,this._startEventType=Ao?"pointerdown":Eo?"touchstart":"mousedown",this._map.element.addEventListener(this._startEventType,this)}handleEvent(e){("mousedown"===e.type||"touchstart"===e.type&&e.touches.length===e.changedTouches.length||"pointerdown"===e.type&&e.isPrimary)&&this._map.interactionDidStart()}destroy(){this._map.element.removeEventListener(this._startEventType,this)}};const la=class{constructor(e){this._map=e,this._recognizers=[]}get map(){return this._map}canTrustGestureCenter(e){return 1===e.numberOfTouchesRequired||!(Bo.supportsGestureEvents&&!Bo.supportsTouches&&Bo.insideIframe)}addRecognizer(e){return this._recognizers.push(e),e.target=this.map.node.element,e.addEventListener("statechange",this),e}interrupt(){this._recognizers.forEach((e=>{e.enabled=!1,e.enabled=!0}))}centerForGesture(e){const t=this.map;return t.usesInteractionCenter||!this.canTrustGestureCenter(e)?t.interactionCenter:this._centerWithRecognizer(e)}destroy(){for(;this._recognizers.length;){const e=this._recognizers.pop();e.enabled=!1,e.target=null,e.removeEventListener("statechange",this)}}};const ha=Ze.performanceMarkers.interactions,ca=Math.pow(1e-4,2.5);function da(e){return e.state===Ro.Began||e.state===Ro.Changed}const ua=class extends la{constructor(e){var t,i,s;super(e),s=!1,(i="decelerating")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,this._pinchRecognizer=this.addRecognizer(new Pn),this._pinchRecognizer.scaleThreshold=.1,this._doubleTapWithOneFingerRecognizer=this.addRecognizer(new An),this._doubleTapWithOneFingerRecognizer.numberOfTouchesRequired=1,this._doubleTapWithOneFingerRecognizer.numberOfTapsRequired=2,this._singleTapWithTwoFingersRecognizer=this.addRecognizer(new An),this._singleTapWithTwoFingersRecognizer.numberOfTouchesRequired=2,this._singleTapWithTwoFingersRecognizer.numberOfTapsRequired=1}stopDecelerating(){this.decelerating&&this._decelerationEnded()}destroy(){super.destroy(),delete this._pinchRecognizer,delete this._doubleTapWithOneFingerRecognizer,delete this._singleTapWithTwoFingersRecognizer,this.stopDecelerating()}get active(){return da(this._pinchRecognizer)||da(this._doubleTapWithOneFingerRecognizer)||da(this._singleTapWithTwoFingersRecognizer)}handleEvent(e){const t=e.target;switch(t){case this._pinchRecognizer:this._handlePinchChange(t);break;case this._doubleTapWithOneFingerRecognizer:this._handleDoubleTapWithOneFingerChange(t);break;case this._singleTapWithTwoFingersRecognizer:this._handleSingleTapWithTwoFingersChange(t)}ha&&performance.measure("mapkit-map-zoom-interaction",{start:t.lastEventTimeStamp,detail:t.state})}performScheduledUpdate(e){const t=ha?performance.now():void 0;if(!this.decelerating)return;if(null==e)return void this._decelerationEnded();const i=this.map,s=e-this._startTime;if(s>=this._decelerationDuration)return i.scaleCameraAroundMapPoint(this._adjustedScaleAtDecelerationEnd/this._scale,this._lastScaleCenter),this._decelerationEnded(),void(ha&&performance.measure("mapkit-map-zoom-deceleration",{start:t}));let o=this._scaleAtTime(s);const n=(o-this._initialScale)/(this._scaleAtDecelerationEnd-this._initialScale);o+=this._scaleAdjustment*n,i.scaleCameraAroundMapPoint(o/this._scale,this._lastScaleCenter);const a=i.camera.zoom;a===i.currentMinZoomLevel||a===this.currentMaxZoomLevel?this.stopDecelerating():(this._scale=o,this._schedule()),ha&&performance.measure("mapkit-map-zoom-deceleration",{start:t})}_centerWithRecognizer(e){const t=this.map,i=e.locationInElement();let s=t.node.convertPointFromPage(i);s=t.camera.transformGestureCenter(s);const o=t.visibleMapRect,n=t.camera.viewportSize;return new Li.MapPoint(o.minX()+s.x/n.width*o.size.width,o.minY()+s.y/n.height*o.size.height)}_handlePinchChange(e){const t=this.map,i=t.camera,s=i.zoom;if(e.state===Ro.Began)this._singleTapWithTwoFingersRecognizer.enabled=!1,this.map.currentGestureType="pinch",t.cameraWillStartZooming(Qs.Pinch);else if(e.state===Ro.Ended||e.state===Ro.Changed){const i=e.scale;this._lastScaleCenter=this.centerForGesture(e),(i>1&&s!==t.currentMaxZoomLevel||i<1&&s!==t.currentMinZoomLevel)&&(t.scaleCameraAroundMapPoint(i,this._lastScaleCenter),e.scale=1)}if((e.state===Ro.Ended||e.state===Ro.Failed)&&(this._singleTapWithTwoFingersRecognizer.enabled=!0,this._startDeceleratingWithVelocity(e),!this.decelerating)){const e=t.snapsToIntegralZoomLevels?Math.round(s):s,o=c(e,t.currentMinZoomLevel,t.currentMaxZoomLevel);s===o?t.cameraDidStopZooming():this._lastScaleCenter?t.scaleCameraAroundMapPoint(Math.pow(2,o-s),this._lastScaleCenter,!0):t.setCameraAnimated(new oa(i.center,o,i.viewportSize,i.rotation),!0)}}_handleDoubleTapWithOneFingerChange(e){e.state===Ro.Recognized&&this._zoomWithTapRecognizer(e,e.modifierKeys.alt)}_handleSingleTapWithTwoFingersChange(e){e.state===Ro.Recognized&&this._zoomWithTapRecognizer(e,!0)}_zoomWithTapRecognizer(e,t){const i=this.map,s=i.camera.zoom,o=t?-1:1,n=(t?Math.floor(s+.5):Math.ceil(s-.5))+o,a=s-c(n,i.currentMinZoomLevel,i.currentMaxZoomLevel);this.map.currentGestureType="double-tap",Math.abs(a)<.5||!i.cameraWillStartZooming(Qs.DoubleTap,!0,!0)||(i.setCameraAnimated(i.camera.withNewMapRect(i.visibleMapRect.scale(Math.pow(2,a),this.centerForGesture(e))),!0),ha&&performance.measure("mapkit-map-zoom-interaction",{start:e.lastEventTimeStamp,detail:e.state}))}_startDeceleratingWithVelocity(e){let t=e.velocity;Math.abs(t)<1||(8<t&&(t=8),t<-8&&(t=-8),this.decelerating=!0,this._startTime=e.lastEventTimeStamp,this._initialScale=this._scale=1,this._initialVelocity=t/1e3,this._decelerationFactor=.98875,this._decelerationDuration=Math.log(ca/Math.pow(this._initialVelocity,2))/(2*Math.log(this._decelerationFactor)),this._scaleAtDecelerationEnd=this._scaleAtTime(this._decelerationDuration),this._adjustedScaleAtDecelerationEnd=this._adjustScaleAtDecelerationEnd(this._scaleAtDecelerationEnd/this._scale),this._scaleAdjustment=this._adjustedScaleAtDecelerationEnd-this._scaleAtDecelerationEnd,this._schedule())}_adjustScaleAtDecelerationEnd(e){const t=this.map,i=t.camera.zoom;let s=i+h(e);if(t.snapsToIntegralZoomLevels){let e=Math.round(s);s>i&&e<=i?e=Math.ceil(s):s<i&&e>=i&&(e=Math.floor(s)),s=e}const o=c(s,t.currentMinZoomLevel,t.currentMaxZoomLevel);return Math.pow(2,o-i)}_schedule(){Mt.scheduleOnNextFrame(this)}_scaleAtTime(e){return Math.max(this._initialScale+this._decelerationFactor*this._initialVelocity*(Math.pow(this._decelerationFactor,e)-1)/(this._decelerationFactor-1),0)}_decelerationEnded(){this.decelerating=!1;const e=this.map;if(e.snapsToIntegralZoomLevels){const t=e.camera,i=e.snapsToIntegralZoomLevels?Math.round(t.zoom):t.zoom;e.setCameraAnimated(new oa(t.center,i,t.viewportSize,t.rotation))}e.cameraDidStopZooming()}};const pa=1e8,ma=.995,ga=Ze.performanceMarkers.interactions;const _a=class extends la{constructor(e){var t,i,s;super(e),s=!1,(i="decelerating")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s;this.addRecognizer(new Rn).maximumNumberOfTouches=2}stopDecelerating(){this.decelerating&&this._decelerationEnded()}destroy(){super.destroy(),this.stopDecelerating()}handleEvent(e){const t=e.target,i=this.map;i.usesInteractionCenter&&i.cameraIsZooming||(t.state===Ro.Began?(this.map.currentGestureType="drag",i.cameraWillStartPanning()):t.state!==Ro.Ended&&t.state!==Ro.Changed||(this._panMapCameraBy(t.translation),t.translation=new cs),t.state===Ro.Ended&&(this._startDeceleratingWithVelocity(t),this.decelerating||i.cameraDidStopPanning()),ga&&performance.measure("mapkit-map-pan-interaction",{start:t.lastEventTimeStamp,detail:t.state}))}performScheduledUpdate(e){const t=ga?performance.now():void 0;if(!this.decelerating)return;if(null==e)return void this._decelerationEnded();const i=e-this._timeAtPreviousFrame;if(i>300)return void this._decelerationEnded();const s=Math.exp(Math.log(ma)*i),o=ma*((1-s)/.0050000000000000044);if(this._panMapCameraBy(new cs(this._velocity.x/1e3*o,this._velocity.y/1e3*o)),this._velocity.x*=s,this._velocity.y*=s,Math.abs(this._velocity.x)<=10&&Math.abs(this._velocity.y)<=10)return this._decelerationEnded(),void(ga&&performance.measure("mapkit-map-pan-deceleration",{start:t}));this._timeAtPreviousFrame=e,this._schedule(),ga&&performance.measure("mapkit-map-pan-deceleration",{start:t})}_panMapCameraBy(e){const t=this.map;t.setCameraAnimated(t.camera.translate(e))}_startDeceleratingWithVelocity(e){const t=e.velocity;this._velocity=t,this.map.cameraWillStopPanning();const i=Math.pow(t.x,2)+Math.pow(t.y,2);if(!(i<62500)){if(i>pa){const e=Math.sqrt(pa/i);this._velocity={x:t.x*e,y:t.y*e}}this.decelerating=!0,this._timeAtPreviousFrame=e.lastEventTimeStamp,this._schedule()}}_schedule(){Mt.scheduleOnNextFrame(this)}_decelerationEnded(){this.decelerating=!1,this.map.cameraDidStopPanning()}};const fa={getCorsAttribute:function(e){return e?"use-credentials":"anonymous"}},ya=Object.freeze({None:"None",CORS:"CORS",Unsupported:"Unsupported"}),va="function"==typeof ImageBitmap;const ba=class extends pe{constructor(e,t){super(e,t),this.crossOrigin=null,this._request=null}get image(){return this._request?.imageBitmap??null}get url(){return this._request?.url??null}get fallbackType(){return this._request?.fallbackType??ya.None}reuse(e,t){this._init(e,t)}async _loaderWillStart(){super._loaderWillStart();const e=this._getDelegate().urlForImageLoader;if(!e)return void this._loaderDidFail(null);const t={imageBitmap:null,url:e,abortController:"function"==typeof AbortController?new AbortController:null,fallbackType:ya.None},i=()=>{t===this._request&&this._loaderDidFail(null)};if(this._request=t,!va)return t.fallbackType=ya.Unsupported,void i();let s;try{s=await fetch(e,{signal:t.abortController?.signal})}catch{return void i()}if(s.ok){if("opaque"===s.type)return t.fallbackType=ya.CORS,void i();try{const e=await s.blob();t.imageBitmap=await createImageBitmap(e)}catch{return void i()}(()=>{t===this._request&&this._loaderDidSucceed(t.imageBitmap)})()}else i()}_reset(){const e=this._request;this._request=null,e?.abortController?.abort(),super._reset()}static get FallbackType(){return ya}static get isSupported(){return va}};const wa=class extends pe{constructor(e,t){super(e,t),this._image=null,this.crossOrigin=null}get image(){return this._image}get url(){return this._image?.src??null}reuse(e,t){this._init(e,t)}_loaderWillStart(){super._loaderWillStart(),this._image||(this._image=document.createElement("img"));const e=this._getDelegate().urlForImageLoader;this._image.crossOrigin=this.crossOrigin,this._image.src=e,this._image.addEventListener("load",this),this._image.addEventListener("error",this)}handleEvent(e){switch(e.type){case"error":this._loaderDidFail(this._image);break;case"load":this._loaderDidSucceed(null)}}_reset(){this._image&&(this._image.removeEventListener("load",this),this._image.removeEventListener("error",this)),super._reset()}},Ca={},ka=ba.isSupported?ba:wa;let Sa=ka,Ma=!1;const La=class{constructor(e,t,i,s,o,n,a,r,l,h,c){this.x=e,this.y=t,this.z=i,this.tileSource=s,this.tint=o,this.emphasis=n,this.language=a,this.poi=r?1:0,this.labels=l?1:0,this.resolution=h,this._priority=c,this._loader=null}get preferredOpacity(){return"number"==typeof this.tileSource.opacity?this.tileSource.opacity:1}get loaderState(){return this._loader?this._loader.state:ue.Unscheduled}schedule(){var e,t;this._loader||(this._loader=(e=this._priority,(t=this).tileSource.crossOrigin?new Sa(e,t):new ka(e,t)),this._setLoaderCrossOriginMode()),this._loader.state>ue.Unscheduled||this._loader.schedule()}unschedule(){if(!this._loader)return;this._loader.unschedule()&&(this._loader=null)}whenDoneLoading(e){k(this._loader&&(this._loader.state,ue.Loading)),this._doneLoadingCallback=e}get urlForImageLoader(){const e=this.tileSource;if("function"==typeof e.urlForImageLoader)return e.urlForImageLoader(this.x,this.y,this.z,this.resolution);const t=e.domains,i=e.protocol,s=e.supportedResolutions[0],o=e.supportedResolutions[e.supportedResolutions.length-1],n=c(this.resolution,s,o);let a=1;if("satellite"===e.name){const t=e.supportedSizes.length-1,i=e.supportedSizes[0],s=e.supportedSizes[t];a=c(this.resolution,i,s)}let r=f(e.path,{x:this.x,y:this.y,z:this.z,resolution:n,tileSizeIndex:a,lang:this.language,poi:this.poi});"satellite"!==e.name&&(0===this.labels?r+="&labels=0&tint="+this.tint+"&emphasis="+this.emphasis:r+="&emphasis="+this.emphasis+"&tint="+this.tint);let l=Ca[r];if(l)return l;const h=t[Math.floor(76731.36742*(this.x+this.y))%t.length];return l=Ze.applyProxyPrefix(i+"//"+h+r),Ca[r]=l,l}loaderDidSucceed(e){this._loaderDidComplete()}loaderDidFail(e){e.fallbackType===ba.FallbackType.CORS?(Ma||(Ma=!0,console.warn(`Opaque response detected when loading image from ${e.url}. This may occur if the resource does not support CORS. Loading images this way will not be supported in future releases of MapKit JS.`)),Sa=wa,this._loader=null,this.schedule()):this._loaderDidComplete()}_setLoaderCrossOriginMode(){this.tileSource.crossOrigin&&(this._loader.crossOrigin=fa.getCorsAttribute(this.tileSource.withCredentials))}_loaderDidComplete(){this.image=this._loader.image,this.url=this._loader.url,"function"==typeof this._doneLoadingCallback&&(this._doneLoadingCallback(this),delete this._doneLoadingCallback)}};function xa(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Aa extends P{constructor(e,t,i,s,o,n,a){super(),xa(this,"loading",!1),xa(this,"loaded",!1),this.key=e,this.x=t,this.y=i,this.z=s,this.settings=o,this.resolution=n,this.priority=a,this.tileImages=[]}get tileSources(){return(this.settings.showsDefaultTiles?this.settings.configuration.tileSources:[]).concat(this.settings.tileOverlays.map((e=>e._impl)).filter((function(e){return!!e.urlForImageLoader(this.x,this.y,this.z,this.resolution)}),this)).filter((function(e){return(this.z>=e.minZoomLevel||"number"!=typeof e.minZoomLevel)&&(this.z<=e.maxZoomLevel||"number"!=typeof e.maxZoomLevel)}),this)}schedule(){this.loaded||(this.tileImages.forEach((e=>{e.schedule()})),this.loading=!0)}unschedule(){this.tileImages.forEach((e=>{e.unschedule()})),this.loading=!1}_loadTileImages(){if(this.loading)return;if(this.loaded){if(!this._containsCanceledTileImages())return;this.tileImages=[],this.loaded=!1}this.loading=!0;const e=this.tileSources;0!==e.length?(this._pendingTileImageLoads=e.length,e.forEach(this._loadTileImage,this)):this._allTileImagesDoneLoading()}_loadTileImage(e){const t=this.settings,i=new La(this.x,this.y,this.z,e,t.tint,t.emphasis,t.language,t.showsPOI,t.showsLabels,this.resolution,this.priority);i.schedule(),this.tileImages.push(i),i.whenDoneLoading((()=>this._tileImageDoneLoading(e,i)))}_requestTileImageLoadStatus(e,t){const i=ce(t,e.url);i.open("GET",e.url,!0),i.send()}_tileImageDoneLoading(e,t){if(t._loader.state===ue.Failed)if("function"==typeof e.dispatchErrorForURL)e.dispatchErrorForURL(t._loader.url);else{const e=new D(Aa.Events.LoadFail);e.tileImage=t,this.dispatchEvent(e)}this._pendingTileImageLoads--,0===this._pendingTileImageLoads&&this._allTileImagesDoneLoading()}_allTileImagesDoneLoading(){delete this._pendingTileImageLoads,this.loading=!1,this.loaded=!0,this._containsCanceledTileImages()||this.dispatchEvent(new D(Aa.Events.LoadSuccess))}_containsCanceledTileImages(){return this.tileImages.some((e=>e.loaderState===ue.Canceled))}}xa(Aa,"Events",{LoadSuccess:"tile-load-success",LoadFail:"tile-load-fail"});const Ea=Aa,Ta={},Ia={tilesForTileData:function(e){const t=e.range,i=t.min.z,s=Math.pow(2,i),o=t.min,n=t.denormalize().max,a=new cs((o.x+n.x)/2,(o.y+n.y)/2),r=[],h=Math.min(n.x,o.x+s-1);for(let e=o.x;e<=h;++e)for(let t=o.y;t<=n.y;++t)r.push(new cs(e,t));return r.sort(((e,t)=>{const i=e.distanceToPoint(a)-t.distanceToPoint(a);return 0===i?e.x-t.x==0?e.y-t.y:e.x-t.x:i})),r.map((t=>function(e,t,i,s,o){const n=Oa(e,t,i,s);let a=Ta[n];a?a.schedule():(a=new Ea(n,e,t,i,s.settings,s.resolution,o),a.addEventListener(Ea.Events.LoadSuccess,Ra),a.addEventListener(Ea.Events.LoadFail,Pa),Ta[n]=a,a._refCount=0,a._loadTileImages());return a._refCount++,a}(l(t.x,s),t.y,i,e,$.High)))},releaseTile:function(e,t){if(e._refCount--,0===e._refCount){e.unschedule();const i=Oa(e.x,e.y,e.z,t);delete Ta[i]}}};function Oa(e,t,i,s){return s.settings.configuration.provider+s.settings.configuration.countryCode+s.settings.configuration.name+e+"-"+t+"-"+i+s.settings.tint+s.settings.emphasis+s.settings.language+s.settings.showsPOI+s.settings.showsLabels+s.settings.showsDefaultTiles+s.settings.showsTileInfo+s.resolution+s.settings.tileOverlays.map((s=>s._impl.keyForTile(e,t,i))).join("-")}function Ra(e){const t=e.target;t.removeEventListener(Ea.Events.LoadSuccess,Ra),t.removeEventListener(Ea.Events.LoadFail,Pa)}function Pa(e){const t=e.target;delete Ta[t.key],t.removeEventListener(Ea.Events.LoadSuccess,Ra),t.removeEventListener(Ea.Events.LoadFail,Pa)}const Da=Ia;class za{constructor(e,t){this.min=e,this.max=t}denormalize(){const e=this.min.copy(),t=this.max.copy();return t.x<e.x&&(t.x+=Math.pow(2,e.z)),new za(e,t)}toString(){return this.min.toString()+" -> "+this.max.toString()}equals(e){const t=this.denormalize(),i=e.denormalize();return i.min.x===t.min.x&&i.min.y===t.min.y&&i.max.x===t.max.x&&i.max.y===t.max.y&&i.min.z===t.min.z&&i.max.z===t.max.z}}const Na=za;const Fa=class{constructor(e,t){const i=Bo.getIntegralZoom(e.zoom),s=Math.pow(2,i),o=Math.pow(2,e.zoom)*Li.tileSize,n=e.viewportSize.width/o/2,a=e.viewportSize.height/o/2,r=new Li.MapPoint(e.center.x-n,e.center.y-a),l=new Li.MapPoint(e.center.x+n,e.center.y+a),h=s-1,d=Math.floor(r.x*s),u=Math.floor(l.x*s),p=c(Math.floor(r.y*s),0,h),m=c(Math.floor(l.y*s),0,h);this.range=new Na(new cs(d,p,i),new cs(u,m,i)),this.settings=t,this.resolution=Bo.imagePixelRatio,this.zoom=i,this.mapRect=new Li.MapRect(d/s,p/s,(u-d)/s,(m-p)/s),this.mapRect.size.width<0&&this.mapRect.size.width++}equals(e){return this.sameSettings(e)&&this.resolution===e.resolution&&this.range.equals(e.range)}sameSettings(e){const t=this.settings,i=e.settings;return t.configuration===i.configuration&&t.tint===i.tint&&t.emphasis===i.emphasis&&t.showsPOI===i.showsPOI&&t.showsLabels===i.showsLabels&&t.language===i.language&&t.showsDefaultTiles===i.showsDefaultTiles&&t.showsTileInfo===i.showsTileInfo&&this.sameTileOverlays(e)}sameTileOverlays(e){return this.settings.tileOverlays.length===e.settings.tileOverlays.length&&this.settings.tileOverlays.every(((t,i)=>t===e.settings.tileOverlays[i]&!t._impl.stale),this)}sharesTileSourcesWithTileData(e){if(this.settings.tint!==e.settings.tint||this.settings.emphasis!==e.settings.emphasis)return!1;const t=this.settings.configuration.tileSources,i=e.settings.configuration.tileSources;return!("AutoNavi"!==this.settings.configuration.provider||"AutoNavi"!==e.settings.configuration.provider||1!==t.length||1!==i.length||"satellite"!==t[0].name&&"hybrid"!==t[0].name||"satellite"!==i[0].name&&"hybrid"!==i[0].name)||i.some((e=>-1!==t.indexOf(e)))}load(){this._tiles||(this._tiles=Da.tilesForTileData(this))}cancel(){if(!this._canceled&&(this._canceled=!0,this._tiles))for(let e=0,t=this._tiles,i=t.length;e<i;++e)t[e].unschedule()}releaseTiles(){if(this._tiles)for(let e=0,t=this._tiles,i=t.length;e<i;++e)Da.releaseTile(t[e],this)}get tiles(){return this.load(),this._tiles}};function Ua(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Ga=["minimumZ","maximumZ","opacity","data"];class Wa{constructor(e,t,i){Ua(this,"_minimumZ",null),Ua(this,"_maximumZ",null),Ua(this,"_data",{}),Ua(this,"withCredentials",!1),Ua(this,"crossOrigin",!1),this._public=e,i=_(i),Ga.forEach((function(e){void 0!==i[e]&&(this[e]=i[e])}),this),Object.keys(i).forEach((e=>{Ga.indexOf(e)<0&&console.warn("[MapKit] Unknown option: "+e+". Use the data property to store custom data.")})),this.urlTemplate=t,void 0===this.opacity&&(this.opacity=1),this.stale=!1}get urlTemplate(){return this._urlTemplate}set urlTemplate(e){const t=typeof e;if("function"!==t&&"string"!==t){throw new TypeError("[MapKit] TileOverlay.urlTemplate expected a function or a string, but got `"+e+"` instead.")}this._urlTemplate=e}keyForTile(e,t,i){return this._minimumZ+"-"+this._maximumZ+"-"+this.urlForImageLoader(e,t,i,1)}get minimumZ(){return this._minimumZ}get minZoomLevel(){return this._minimumZ}set minimumZ(e){p(e,"number","[MapKit] TileOverlay.minimumZ expected a number, but got `"+e+"` instead."),this._minimumZ=Math.floor(e)}get maximumZ(){return this._maximumZ}get maxZoomLevel(){return this._maximumZ}set maximumZ(e){p(e,"number","[MapKit] TileOverlay.maximumZ expected a number, but got `"+e+"` instead."),this._maximumZ=Math.ceil(e)}get opacity(){return this._opacity}set opacity(e){p(e,"number","[MapKit] TileOverlay.opacity expected a number, but got `"+e+"` instead."),this._opacity=c(e,0,1);const t=new je.Event(Wa.OPACITY_EVENT);t.tileOverlay=this,t.opacity=this._opacity,this._public.dispatchEvent(t)}get data(){return this._data}set data(e){p(e,"object","[MapKit] TileOverlay.data expected an Object, but got `"+e+"` instead."),this._data=e}reload(){this.stale=!0;const e=new je.Event(Wa.RELOAD_EVENT);e.tileOverlay=this,this._public.dispatchEvent(e)}reloadComplete(){this.stale=!1}urlForImageLoader(e,t,i,s){if(!this._urlTemplate)return;if("function"==typeof this._urlTemplate)return fe(this._urlTemplate,null,[e,t,i,s,this._data]);const o=this._urlTemplate.replace(/\{/g,"{{").replace(/\}/g,"}}");const n={};return this._data&&Object.keys(this._data).forEach((e=>{n[e]=this._data[e]})),n.x=e,n.y=t,n.z=i,n.scale=s,f(o,n)}dispatchErrorForURL(e){const t=new je.Event(Wa.ERROR_EVENT);t.tileOverlay=this._public,t.tileUrl=e,this._public.dispatchEvent(t)}}Ua(Wa,"RELOAD_EVENT","tile-overlay-reload"),Ua(Wa,"OPACITY_EVENT","tile-overlay-opacity-changed"),Ua(Wa,"ERROR_EVENT","tile-error");const Ba=Wa;const Za=class extends Ke{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new Ba(this,e,t)})}get urlTemplate(){return this._impl.urlTemplate}set urlTemplate(e){this._impl.urlTemplate=e}get minimumZ(){return this._impl.minimumZ}set minimumZ(e){this._impl.minimumZ=e}get maximumZ(){return this._impl.maximumZ}set maximumZ(e){this._impl.maximumZ=e}get opacity(){return this._impl.opacity}set opacity(e){this._impl.opacity=e}get data(){return this._impl.data}set data(e){this._impl.data=e}reload(){this._impl.reload()}},Ka=(e,t)=>{let i=e;for(;i.parentNode!==document.body;){i=i.parentNode,window.ShadowRoot&&i instanceof window.ShadowRoot&&(i=i.host);const e=window.getComputedStyle(i);switch(t){case"x":if(["auto","scroll"].includes(e.overflowX)&&i.scrollWidth-1>i.clientWidth)return!0;break;case"y":if(["auto","scroll"].includes(e.overflowY)&&i.scrollHeight-1>i.clientHeight)return!0}if("fixed"===e.position)return!1}switch(t){case"x":{const e=window.getComputedStyle(document.body).overflowX,t=window.getComputedStyle(document.documentElement).overflowX;if(["auto","scroll","visible"].includes(e)&&["auto","scroll","visible"].includes(t)&&("CSS1Compat"===document.compatMode?document.documentElement.scrollWidth-1>document.documentElement.clientWidth:document.body.scrollWidth-1>document.body.clientWidth))return!0;break}case"y":{const e=window.getComputedStyle(document.body).overflowY,t=window.getComputedStyle(document.documentElement).overflowY;if(["auto","scroll","visible"].includes(e)&&["auto","scroll","visible"].includes(t)&&("CSS1Compat"===document.compatMode?document.documentElement.scrollHeight-1>document.documentElement.clientHeight:document.body.scrollHeight-1>document.body.clientHeight))return!0;break}}return!1};function ja(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ha(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function qa(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Ya(e,t,"set"),i),i}function Va(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Ya(e,t,"get"))}function Ya(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}const Xa=.0075,$a=100;function Ja(e,t){switch(t){case WheelEvent.DOM_DELTA_LINE:e*=100/3*window.devicePixelRatio;break;case WheelEvent.DOM_DELTA_PAGE:e*=100*window.devicePixelRatio;break;case WheelEvent.DOM_DELTA_PIXEL:break;default:k()}return e}var Qa=new WeakMap,er=new WeakMap,tr=new WeakMap,ir=new WeakMap;class sr{constructor(){Ha(this,Qa,{writable:!0,value:!1}),Ha(this,er,{writable:!0,value:!1}),ja(this,"allowWheelToZoom",!1),ja(this,"allowWheelToZoom2",!0),ja(this,"pannable",!1),ja(this,"zoomable",!1),ja(this,"element",void 0),Ha(this,tr,{writable:!0,value:void 0}),Ha(this,ir,{writable:!0,value:void 0})}classifyWheelEvent(e){if(!Va(this,Qa)&&!Va(this,er)&&!e.ctrlKey&&!e.shiftKey&&this.allowWheelToZoom2){const t=e.target;if(e.deltaX&&Ka(t,"x"))return;if(e.deltaY&&Ka(t,"y"))return}const t=!Va(this,Qa)&&!Va(this,er),i=function(e){return e.ctrlKey}(e),s=this.allowWheelToZoom||this.allowWheelToZoom2;if(!i&&!e.shiftKey&&!s)return;const o=function(e){const t=e.shiftKey&&!!e.deltaX&&!e.deltaY;let i=t?e.deltaX:e.deltaY;return i=Ja(i,e.deltaMode),(e.ctrlKey||!e.shiftKey||t)&&(i*=-1),e.ctrlKey&&e.deltaMode===e.DOM_DELTA_PIXEL&&(i*=10),1+(i>0?Math.sqrt(i):-Math.sqrt(-i))*Xa}(e),n=3*Math.abs(e.deltaX)>2*Math.abs(e.deltaY),a=this.allowWheelToZoom2&&!Va(this,er)&&(Va(this,Qa)||1===o||!e.shiftKey&&n);if((!a||this.pannable)&&(a||this.zoomable)){if(a?(clearTimeout(Va(this,tr)),qa(this,tr,setTimeout((()=>{qa(this,Qa,!1)}),$a)),qa(this,Qa,!0)):(clearTimeout(Va(this,ir)),qa(this,ir,setTimeout((()=>{qa(this,er,!1)}),$a)),qa(this,er,!0)),e.preventDefault(),a){const i=-Ja(e.deltaX,e.deltaMode),s=-Ja(e.deltaY,e.deltaMode);if(0===i&&0===s)return;return{is:"pan",translation:new cs(i,s),isFirstEvent:t}}return{is:"zoom",scale:o,isFirstEvent:t}}}resetGesture(){clearTimeout(Va(this,tr)),clearTimeout(Va(this,ir)),qa(this,Qa,!1),qa(this,er,!1)}destroy(){clearTimeout(Va(this,tr)),clearTimeout(Va(this,ir))}}function or(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function nr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ar(e,t){var i=function(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}(e,t,"get");return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}const rr=Ze.performanceMarkers.interactions,lr=Math.log2(1.03)/(1e3/60),hr=Math.log2(.97)/(1e3/60),cr=Math.log2(1.06)/(1e3/60),dr=Math.log2(.94)/(1e3/60),ur=Math.log2(1.0075),pr=Math.log2(.9925);var mr=new WeakMap;const gr=class{constructor(e){nr(this,"_cancelledWheelGestureTimeoutId",void 0),nr(this,"_animating",!1),nr(this,"_animationEndingTimeoutId",void 0),or(this,mr,{writable:!0,value:new sr}),nr(this,"_lastScaleCenter",void 0),nr(this,"_accumulatedZoomLevelDelta",void 0),nr(this,"_accumulatedDesiredZoomLevelDelta",void 0),nr(this,"_timeAtLastFrame",void 0),this.map=e,this.map.node.element.addEventListener("wheel",this),this._previousZoomLevelDelta=[],this.pannable=!1,this.zoomable=!1}destroy(){S(this.map),this.map.node.element.removeEventListener("wheel",this),clearTimeout(this._wheelEndTimeoutId),ar(this,mr).destroy(),this.map=null,this._animationEndingTimeoutId&&clearTimeout(this._animationEndingTimeoutId)}handleEvent(e){this._handleWheelZoom(e)}performScheduledUpdate(e=performance.now()){if(S(this._animating),!this.map)return;S(this._accumulatedDesiredZoomLevelDelta),S(this._accumulatedZoomLevelDelta),S(this._timeAtLastFrame),S(this._lastScaleCenter);const t=this.zoomsIn?Math.ceil(this._accumulatedDesiredZoomLevelDelta):Math.floor(this._accumulatedDesiredZoomLevelDelta),i=e-this._timeAtLastFrame,s=this._getEstimatedSpeedPerMS()*i;this._accumulatedZoomLevelDelta=this._accumulatedZoomLevelDelta+s,this._timeAtLastFrame=e;if(!(this.zoomsIn&&this._accumulatedZoomLevelDelta<t||!this.zoomsIn&&this._accumulatedZoomLevelDelta>t)){const e=this.map.zoomLevel,t=Math.round(this.map.zoomLevel);return this.map.scaleCameraAroundMapPoint(Math.pow(2,t-e),this._lastScaleCenter),this._animating=!1,this._previousEstimatedSpeedPerMS=void 0,void(this._animationEndingTimeoutId=setTimeout((()=>{S(this.map),this._animationEndingTimeoutId=void 0,this.map.cameraDidStopZooming()}),$a))}this.map.scaleCameraAroundMapPoint(Math.pow(2,s),this._lastScaleCenter),Mt.scheduleOnNextFrame(this)}resetWheelEventGesture(){ar(this,mr).resetGesture()}_handleWheelZoom(e){S(this.map);const t=this.map;ar(this,mr).pannable=this.pannable,ar(this,mr).zoomable=this.zoomable,ar(this,mr).allowWheelToZoom=t.allowWheelToZoom,ar(this,mr).allowWheelToZoom2=t.allowWheelToZoom2;const i=ar(this,mr).classifyWheelEvent(e);if(!i)return;if("pan"===i.is){if(i.isFirstEvent){t.currentGestureType="wheel";if(!t.cameraWillStartPanning())return;this._wheelPanning=!0}else if(!this._wheelPanning)return;return t.setCameraAnimated(t.camera.translate(i.translation)),this._wheelEndTimeoutId&&(clearTimeout(this._wheelEndTimeoutId),this._wheelEndTimeoutId=null),void(this._wheelEndTimeoutId=setTimeout((()=>{this._wheelEndTimeoutId=null,this._wheelPanning=!1,t.cameraWillStopPanning(),t.cameraDidStopPanning()}),$a))}const s=i.scale;if(1===s||s>1&&t.camera.zoom===t.currentMaxZoomLevel||s<1&&t.camera.zoom===t.currentMinZoomLevel)return;const o=new cs(e.pageX,e.pageY);this._lastScaleCenter=t.usesInteractionCenter?t.interactionCenter:this._mapPointFromCentroid(o),S(this._lastScaleCenter),t.snapsToIntegralZoomLevels?this._integralZoomToScale(s,this._lastScaleCenter,e.timeStamp,i.isFirstEvent):this._wheelZoomToScale(s,i.isFirstEvent),rr&&performance.measure("mapkit-map-zoom-interaction",{start:e.timeStamp,detail:"changed"})}_mapPointFromCentroid(e){S(this.map);const t=this.map;let i=t.node.convertPointFromPage(e);i=t.camera.transformGestureCenter(i);const s=t.visibleMapRect,o=t.camera.viewportSize;return new Ci(s.minX()+i.x/o.width*s.size.width,s.minY()+i.y/o.height*s.size.height)}_integralZoomToScale(e,t,i,s){S(this.map),this._lastUpdateTime=i;const o=Math.log2(e);if(this.zoomsIn=o>0,this._lastScaleCenter=t,this._previousZoomLevelDelta.push({delta:o,timestamp:i}),this._animating)return S(this._accumulatedDesiredZoomLevelDelta),void(this._accumulatedDesiredZoomLevelDelta=this._accumulatedDesiredZoomLevelDelta+o);if(this._cleanupPreviousZoomLevelDelta(),pr<=o&&o<=ur&&this._previousZoomLevelDelta.length<=1)return;const n=this.map;if(!(this._animating||this._animationEndingTimeoutId)){if(this._cancelledWheelGestureTimeoutId)return clearTimeout(this._cancelledWheelGestureTimeoutId),void(this._cancelledWheelGestureTimeoutId=setTimeout((()=>{this._cancelledWheelGestureTimeoutId=void 0}),$a));n.currentGestureType="wheel";if(!n.cameraWillStartZooming(Qs.Scroll))return clearTimeout(this._cancelledWheelGestureTimeoutId),void(this._cancelledWheelGestureTimeoutId=setTimeout((()=>{this._cancelledWheelGestureTimeoutId=void 0}),$a))}this._animating=!0,this._accumulatedZoomLevelDelta=0,this._accumulatedDesiredZoomLevelDelta=o,this._timeAtLastFrame=i,this._animationEndingTimeoutId&&(clearTimeout(this._animationEndingTimeoutId),this._animationEndingTimeoutId=void 0),Mt.scheduleOnNextFrame(this)}_cleanupPreviousZoomLevelDelta(){const e=performance.now()-100,t=this.zoomsIn?1:-1;for(let i=0;i<this._previousZoomLevelDelta.length;i++)(this._previousZoomLevelDelta[i].timestamp<e||this._previousZoomLevelDelta[i].delta*t<0)&&this._previousZoomLevelDelta.splice(i,1)}_getEstimatedSpeedPerMS(){if(this._cleanupPreviousZoomLevelDelta(),this._previousZoomLevelDelta.length<=1)return this._previousEstimatedSpeedPerMS?this._previousEstimatedSpeedPerMS:this.zoomsIn?cr:dr;let e=this._previousZoomLevelDelta.reduce(((e,t)=>e+t.delta),0)/100;return hr<e&&e<lr&&(e=this.zoomsIn?lr:hr),this._previousEstimatedSpeedPerMS=e,e}_wheelZoomToScale(e,t){S(this.map);const i=this.map;if(k(i.snapsToIntegralZoomLevels),t){i.currentGestureType="wheel";if(!i.cameraWillStartZooming(Qs.Scroll))return;this._wheelZooming=!0}else if(!this._wheelZooming)return;S(this._lastScaleCenter),i.scaleCameraAroundMapPoint(e,this._lastScaleCenter),this._wheelEndTimeoutId&&(clearTimeout(this._wheelEndTimeoutId),this._wheelEndTimeoutId=null),this._wheelEndTimeoutId=setTimeout((()=>{this._wheelEndTimeoutId=null,this._wheelZooming=!1,i.cameraDidStopZooming()}),$a)}};function _r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const fr=1-Math.pow(2,-52),yr=Math.PI/3,vr=Math.tan(yr/2);class br{constructor(e){_r(this,"minZoomLevel",br.DEFAULT_MIN_ZOOM_LEVEL),_r(this,"maxZoomLevel",br.DEFAULT_MAX_ZOOM_LEVEL),_r(this,"usesInteractionCenter",!1),_r(this,"currentGestureType",!1),_r(this,"cameraAnimation",null),_r(this,"_isRotationEnabled",!1),_r(this,"isRotationLocked",!0),_r(this,"_snapsToIntegralZoomLevels",!1),_r(this,"restrictIncomingRotation",!1),this.node=e,this._configuration=null,this._debug=!1,this._language=null,this.allowWheelToZoom=!1,this.allowWheelToZoom2=!0,this._pointOfInterestFilter=null,this._showsDefaultTiles=!0,this._tileOverlays=[],this._filteredPois=new Set,this._={},this._[Qn]=!1,this.camera=new oa,this._element=document.createElement("div"),this.currentMinZoomLevel=this.minZoomLevel,this.currentMaxZoomLevel=this.maxZoomLevel}get element(){return this._element}deactivate(){this.pannable=!1,this.zoomable=!1,this.node.delegate=null}destroy(e){!e&&this.cameraAnimation&&this.cameraAnimation.cancel(),this._tileOverlays.forEach((e=>{e.removeEventListener(Ba.RELOAD_EVENT,this)})),this._initialInteractionController&&(this._initialInteractionController.destroy(),this._initialInteractionController=null),this._panController&&(this._panController.destroy(),this._panController=null),this._wheelEventHandler&&(this._wheelEventHandler.destroy(),delete this._wheelEventHandler),this._zoomController&&(this._zoomController.destroy(),this._zoomController=null),this._rotationController&&(this._rotationController.destroy(),this._rotationController=null),this.node.delegate=null}get isRotationEnabled(){return this._isRotationEnabled}set isRotationEnabled(e){this._isRotationEnabled=e}get snapsToIntegralZoomLevels(){return this._snapsToIntegralZoomLevels}set snapsToIntegralZoomLevels(e){this._snapsToIntegralZoomLevels=e}get configuration(){return this._configuration}set configuration(e){this._configuration!==e&&this.updateConfiguration(e)}get tint(){return this._tint}get tileTint(){return this._tileTint}get emphasis(){return this._emphasis}setTintAndEmphasis(e,t,i){e===this._tint&&t===this._tileTint&&i===this._emphasis||(this._tint=e,this._tileTint=t,this._emphasis=i,this.updateTintAndEmphasis(e,t,i))}get language(){return this._language}set language(e){this._language!==e&&(this._language=e,this.refresh())}get pointOfInterestFilter(){return this._pointOfInterestFilter}set pointOfInterestFilter(e){this._pointOfInterestFilter!==e&&(this._pointOfInterestFilter=e,this.updatePointOfInterestFilter())}get size(){return this.camera.viewportSize.copy()}set size(e){this.adjustForSize(e.copy()),e.width>0&&e.height>0&&this._updateZoom(!1)}adjustForSize(e){if(this._visibleMapRect&&this._visibleMapRect.size.width>0&&this._visibleMapRect.size.height>0&&e.width>0&&e.height>0){const t=this._visibleMapRect;delete this._visibleMapRect,this.setCameraAnimated(this.camera.withNewMapRect(t,this.snapsToIntegralZoomLevels,e))}else{let t=null;this._pendingCameraDistance&&(t=this._pendingCameraDistance);const i=this.camera;this.setCameraAnimated(new oa(i.center,i.zoom,e,i.rotation)),null!==t&&this.setCameraDistanceAnimated(t,!1)}}get cameraIsPanning(){return!!this._panning}get pannable(){return!!this._panController}set pannable(e){if(!e&&this._panController?(this._panController.destroy(),delete this._panController):e&&!this._panController&&(this._initialInteractionController||(this._initialInteractionController=new ra(this)),this._panController=new _a(this)),!e&&!this.zoomable&&this._wheelEventHandler)return this._wheelEventHandler.destroy(),void delete this._wheelEventHandler;this._wheelEventHandler||(this._wheelEventHandler=new gr(this)),this._wheelEventHandler.zoomable=this.zoomable,this._wheelEventHandler.pannable=e}get cameraIsZooming(){return!!this._zooming||!!this._suspendedZoom}get zoomable(){return!!this._zoomController}set zoomable(e){if(!e&&this._zoomController?(this._zoomController.destroy(),delete this._zoomController):e&&!this._zoomController&&(this._initialInteractionController||(this._initialInteractionController=new ra(this)),this._zoomController=new ua(this)),!e&&!this.pannable&&this._wheelEventHandler)return this._wheelEventHandler.destroy(),void delete this._wheelEventHandler;this._wheelEventHandler||(this._wheelEventHandler=new gr(this)),this._wheelEventHandler.zoomable=e,this._wheelEventHandler.pannable=this.pannable}get cameraIsRotating(){return!!this._rotating}get visibleMapRect(){return this._visibleMapRect||this.camera.toMapRect()}set visibleMapRect(e){this.setVisibleMapRectAnimated(e)}setVisibleMapRectAnimated(e,t){if(this.camera.viewportSize.equals(ls.Zero))this._visibleMapRect=e.copy();else{const i=this.camera.withNewMapRect(e,this.snapsToIntegralZoomLevels);i.rotation=0,this.setCameraAnimated(i,!!t)}}setCenterAnimated(e,t){const i=e.toMapPoint();if(this._visibleMapRect)this._visibleMapRect=new Si(i.x-this._visibleMapRect.size.width/2,i.y-this._visibleMapRect.size.height/2,this._visibleMapRect.size.width,this._visibleMapRect.size.height);else{const e=this.camera.copy();e.center=i,this.setCameraAnimated(e,t)}}setCameraBoundaryAnimated(e,t){e?(this._cameraBeforeBoundaryChange=this.camera,this._cameraBoundaryRect=new Si(e.origin.x,e.origin.y,c(e.size.width,0,1),Math.max(e.size.height,0)),this.setCameraAnimated(this.camera.copy(),t),delete this._cameraBeforeBoundaryChange):delete this._cameraBoundaryRect}constrainCamera(e){this._cameraBoundaryRect&&(e.center=this._constrainCenterWithinBounds(e.center)),this._updateMinAndMaxZoomLevelsAtY(e.center.y),e.zoom=c(e.zoom,this.currentMinZoomLevel,this.currentMaxZoomLevel)}constrainCameraRotation(e){const t=this.isRotationLocked;if(this.isRotationLocked=e.zoom<7,0!==e.rotation&&this.isRotationLocked){const i=this.restrictIncomingRotation?Bo.restrictRotation(e.rotation):0,s=i!==e.rotation;return e.rotation=i,!t&&s}return!1}get transformCenter(){const e=this.node.delegate;return e&&"function"==typeof e.mapTransformCenter?e.mapTransformCenter(this.node):this.camera.center}get interactionCenter(){const e=this.node.delegate;return e&&"function"==typeof e.mapInteractionCenter?e.mapInteractionCenter(this.node):this.camera.center}get zoomLevel(){return this.camera.zoom}set zoomLevel(e){this.setZoomLevelAnimated(e)}setZoomLevelAnimated(e,t){if(delete this._cameraDistance,this._suspendedZoom)return this._suspendedZoom.animated=this._suspendedZoom.animated||this._suspendedZoom.level!==e,void(this._suspendedZoom.level=e);if(this.cameraAnimation&&!t)return void(this.cameraAnimation.additiveZoom=e);const i=this.zoomLevel,s=c(e,this.currentMinZoomLevel,this.currentMaxZoomLevel);if(i===s)return;const o=this.interactionCenter,n=this.camera;o.equals(n.center)?this.setCameraAnimated(new oa(n.center,s,n.viewportSize,n.rotation),t):this.scaleCameraAroundMapPoint(Math.pow(2,s-i),this.interactionCenter,t)}setCameraDistanceAnimated(e,t){if(0===this.camera.viewportSize.width)return void(this._pendingCameraDistance=e);let i=this.zoomLevelForCameraDistanceAtY(e,this.camera.center.y);this.snapsToIntegralZoomLevels&&(i=Bo.getIntegralZoom(i)),this.setZoomLevelAnimated(i,t),this._cameraDistance=e}getCurrentCameraDistance(){return this.visibleMapRect.size.width/2/Li.mapUnitsPerMeterAtLatitude(this.camera.center.toCoordinate().latitude)/vr}get cameraZoomRange(){return this._cameraZoomRange?this._cameraZoomRange.copy():new Mi}setCameraZoomRangeAnimated(e,t){e?(this._cameraZoomRange=e.copy(),delete this._cameraZoomLevelLimit):delete this._cameraZoomRange,this._updateZoom(t)}setCameraZoomLevelLimitAnimated(e,t){e?(this._cameraZoomLevelLimit={minZoomLevel:e.minZoomLevel,maxZoomLevel:e.maxZoomLevel},delete this._cameraZoomRange):delete this._cameraZoomLevelLimit,this._updateZoom(t)}zoomLevelForCameraDistanceAtY(e,t){return this._zoomLevelForCameraDistanceAtLatitude(e,Li.convertYToLatitude(t))}adjustMapItemPoint(e){if(this.cameraIsZooming||this._pendingCameraDrawingReadiness)return e;if(!this._pointAdjustmentReference){const e=this.camera.zoom,t=this.visibleMapRect.origin,i=new Fa(this.camera),s=i.zoom,o=i.mapRect.origin,n=Math.pow(2,e-s),a=Li.pointsPerAxis(s)*n;this._pointAdjustmentReference=new cs((o.x-t.x)*a,(o.y-t.y)*a)}return e.x=Bo.roundToDevicePixel(this._pointAdjustmentReference.x)+Bo.roundToDevicePixel(e.x-this._pointAdjustmentReference.x),e.y=Bo.roundToDevicePixel(this._pointAdjustmentReference.y)+Bo.roundToDevicePixel(e.y-this._pointAdjustmentReference.y),e}scaleCameraAroundMapPoint(e,t,i){const s=Li.pointsPerAxis(this.currentMinZoomLevel),o=this.camera.viewportSize,n=this.visibleMapRect,a=n.size,r=1/e,l=s>0?o.width/(a.width*s):r,h=s>0?o.height/(a.height*s):r,c=Li.pointsPerAxis(this.currentMaxZoomLevel),d=o.width/(a.width*c),u=o.height/(a.height*c),p=Math.max(Math.min(r,l,h),d,u),m=t.x+(t.x<1?1:-1);m>=n.origin.x&&m<=n.maxX()&&(t=new Ci(m,t.y));const g=this.camera.withNewMapRect(n.scale(p,t),!1);this.setCameraAnimated(g,i)}setCameraAnimated(e,t,i,s){if(0===e.viewportSize.width||0===e.viewportSize.height)return this._pendingCameraDrawingReadiness=!0,void(this.camera=e);delete this._pendingCameraDistance;const o=this.camera;e.viewportSize.equals(o.viewportSize)||(this._updateMinAndMaxZoomLevels(e.viewportSize),!t&&this.cameraAnimation&&this.cameraAnimation.updateViewportSize(e.viewportSize)),s||this.constrainCamera(e);const n=this.constrainCameraRotation(e),a=e.toMapRect().size,r=a.width/2,h=a.height/2;if(e.center.x=l(e.center.x-r,1)+r,e.center.y=c(e.center.y,h,fr-h),this._pendingCameraDrawingReadiness||!e.equals(o))if(delete this._pendingCameraDrawingReadiness,this._cameraWillChange(!!t),!t&&!n||this.cameraAnimation)delete this._pointAdjustmentReference,this.camera=e,this.cameraZoomWasSet(),this._cameraDidChange();else{let s;t?s=this._cameraBeforeBoundaryChange||o:(s=e.copy(),s.rotation=o.rotation),this._cameraChangesMayHaveStarted(),this.cameraAnimation=new aa(this,s,e,i),this._cameraBeforeBoundaryChange&&(this.cameraAnimation.unconstrained=!0),this.cameraAnimation.rotating&&(this._rotating=!0),this.cameraAnimation.zooming&&this.cameraZoomWasSet(e)}}cameraWillStartZooming(e,t,i){const s=this.node.delegate,o=()=>!!s&&"function"==typeof s.mapCanStartZooming&&!s.mapCanStartZooming(this.node);return this.cameraAnimation?!(this._zoomController.active||this.cameraAnimation.zooming||o())&&(this._suspendedZoom={animated:!!t,offCenter:!!i,level:this.zoomLevel,completed:!1},!0):o()?(this._zoomController.interrupt(),!1):(this._cameraWillStartZooming(s,e,t,i),!0)}_cameraWillStartZooming(e,t,i,s){e&&"function"==typeof e.mapWillStartZooming&&e.mapWillStartZooming(this.node,t,i,s),this._cameraChangesMayHaveStarted(),this._zooming=!0,this.beforeCameraZoomChange(!0),this._cameraWillChange(!!i)}cameraDidStopZooming(){if(this.snapsToIntegralZoomLevels&&(this.camera.zoom=Math.round(this.camera.zoom)),this._suspendedZoom)return void(this._suspendedZoom.complete=!0);delete this._zooming,this.beforeCameraZoomChange(!1),this._cameraDidChange(),this._cameraChangesMayHaveEnded();const e=this.node.delegate;e&&"function"==typeof e.mapDidStopZooming&&e.mapDidStopZooming(this.node)}cameraWillStartRotating(){const e=this.node.delegate;!!e&&"function"==typeof e.mapCanStartRotating&&!e.mapCanStartRotating(this.node)||(this._cameraChangesMayHaveStarted(),this._rotating=!0,this._cameraWillChange())}cameraDidStopRotating(){if(!this._rotating)return;delete this._rotating,this._cameraDidChange(),this._cameraChangesMayHaveEnded();const e=this.node.delegate;e&&"function"==typeof e.mapDidStopRotating&&e.mapDidStopRotating(this.node)}setPoiFiltered(e,t){t?(this._filteredPois.has(e)&&console.warn("[MapKit] Multiple annotations linked to a single place have been added to the map, display instability may occur."),this._filteredPois.add(e)):this._filteredPois.delete(e),this.updatePointOfInterestFilter()}migrateStateTo(e){e.configuration=this.node.configuration,e.setTintAndEmphasis(this.node.tint,this.node.tileTint,this.node.emphasis),e.language=this.node.language,e.pannable=this.node.pannable,e.allowWheelToZoom=this.node.allowWheelToZoom,e.allowWheelToZoom2=this.node.allowWheelToZoom2,e.pointOfInterestFilter=this.node._impl.pointOfInterestFilter,e.showsDefaultTiles=this.node.showsDefaultTiles,e.tileOverlays=this.node.tileOverlays,e.size=this.node.size,e.usesInteractionCenter=this.node.usesInteractionCenter;const t=this.node.visibleMapRect;t.size.width>0&&t.size.height>0&&(e.visibleMapRect=t),e.zoomable=this.node.zoomable,e.isRotationEnabled=this.isRotationEnabled,e.rotation=this.rotation,e[Qn]=this[Qn],this._cameraZoomRange&&e.setCameraZoomRangeAnimated(this._cameraZoomRange,!1),this._cameraZoomLevelLimit&&e.setCameraZoomLevelLimitAnimated(this._cameraZoomLevelLimit,!1),this._cameraDistance>=0&&e.setCameraDistanceAnimated(this._cameraDistance,!1),this._cameraBoundaryRect&&e.setCameraBoundaryAnimated(this._cameraBoundaryRect,!1),e._impl._filteredPois=this._filteredPois,e._impl.updatePointOfInterestFilter(),e._impl.debug=this.debug,e._impl.isRotationLocked=this.isRotationLocked,this.cameraAnimation&&(this.cameraAnimation.map=e._impl,e._impl.cameraAnimation=this.cameraAnimation,this.cameraChangesHaveStarted&&(e._impl.cameraChangesHaveStarted=!0))}createLabelRegion(){}updatedLabelRegion(){}unregisterLabelRegion(){}get debug(){return this._debug}set debug(e){this._debug!==!!e&&(this._debug=!!e,this.refresh())}updateConfiguration(e){this._configuration=e,this._updateMinAndMaxZoomLevels(this.camera.viewportSize),this.setCameraAnimated(this.camera),this.refresh()}updatePointOfInterestFilter(){this.refresh()}refresh(){}beforeCameraZoomChange(){}cameraZoomWasSet(){}prepareLayer(e){}cleanupLayer(e){}addLayer(e){}insertBefore(e,t){}insertAfter(e,t){}removeLayer(e){}get showsDefaultTiles(){return this._showsDefaultTiles}set showsDefaultTiles(e){this._showsDefaultTiles!==e&&(this._showsDefaultTiles=e,this._tileOverlaysDidChange())}get tileOverlays(){return this._tileOverlays}set tileOverlays(e){if(0===this._tileOverlays.length&&0===e.length)return;g(e,"[MapKit] Map.tileOverlays should be an array, got `"+e+"` instead."),e.forEach((e=>{m(e,Za,"[MapKit] Map.tileOverlays can only contain TileOverlays, but got `"+e+"` instead.")})),this._tileOverlays.forEach((e=>{e.removeEventListener(Ba.RELOAD_EVENT,this)})),this._tileOverlays=e,this._tileOverlays.forEach((e=>{e.addEventListener(Ba.RELOAD_EVENT,this)})),this._tileOverlaysDidChange()}addTileOverlay(e){return m(e,Za,"[MapKit] Map.addTileOverlay expected a TileOverlay, but got `"+e+"` instead."),this.addTileOverlays([e]),e}addTileOverlays(e){return g(e,"[MapKit] Map.addTileOverlays expected an array, but got `"+e+"` instead."),e.forEach((function(e){if(m(e,Za,"[MapKit] Map.addTileOverlays expected only TileOverlays, but got `"+e+"` instead."),"number"==typeof e.minimumZ&&e.minimumZ<this.currentMinZoomLevel){const t=Math.ceil(100*this.currentMinZoomLevel)/100;console.warn("[MapKit] This TileOverlay has its minimumZ set to "+e.minimumZ+", but this map can only zoom to a minimum value of "+t+". As a result, some zoom levels supported by the TileOverlay cannot be viewed on this map.")}}),this),this.tileOverlays=this.tileOverlays.concat(e),e}removeTileOverlay(e){return m(e,Za,"[MapKit] Map.removeTileOverlay expected a TileOverlay, but got `"+e+"` instead."),this.tileOverlays=this.tileOverlays.filter((t=>t!==e)),e}removeTileOverlays(e){return g(e,"[MapKit] Map.removeTileOverlays expected an array, but got `"+e+"` instead."),e.forEach((function(e){m(e,Za,"[MapKit] Map.removeTileOverlays expected only TileOverlays, but got `"+e+"` instead."),this.removeTileOverlay(e)}),this),e}handleEvent(){}cameraWillStartPanning(){const e=this.node.delegate;return this.cameraAnimation||(()=>!!e&&"function"==typeof e.mapCanStartPanning&&!e.mapCanStartPanning(this.node))()?(this._panController.interrupt(),!1):(e&&"function"==typeof e.mapWillStartPanning&&e.mapWillStartPanning(this.node),this.refresh(),this._cameraChangesMayHaveStarted(),this._panning=!0,this._cameraWillChange(),!0)}cameraWillStopPanning(){const e=this.node.delegate;e&&"function"==typeof e.mapWillStopPanning&&e.mapWillStopPanning(this.node)}cameraDidStopPanning(){delete this._panning,this._cameraDidChange(),this._cameraChangesMayHaveEnded();const e=this.node.delegate;e&&"function"==typeof e.mapDidStopPanning&&e.mapDidStopPanning(this.node)}cameraAnimationDidProgress(e,t){this.setCameraAnimated(e,!1,null,t)}cameraAnimationDidEnd(){const e=this.cameraAnimation;this.cameraAnimation=null;let t=!1;if(e.zooming&&!e.zoomIsAdditive&&(this.cameraDidStopZooming(),t=!0),e.rotating&&(this.cameraDidStopRotating(),t=!0),t||this._cameraDidChange(),this._cameraChangesMayHaveEnded(),this._suspendedZoom){const e=this._suspendedZoom;delete this._suspendedZoom,this._cameraWillStartZooming(this.node.delegate,"",e.animated),e.complete&&(this.setZoomLevelAnimated(e.level,e.animated),e.animated||this.cameraDidStopZooming())}this._nextCameraZoomRange&&(this.setCameraZoomRangeAnimated(this._nextCameraZoomRange,!1),delete this._nextCameraZoomRange)}interactionDidStart(){this._panController&&this._panController.stopDecelerating(),this._zoomController&&this._zoomController.stopDecelerating(),this._rotationController&&this._rotationController.stopDecelerating()}beganRecognizingRotation(){this._zoomController&&(this._zoomController._singleTapWithTwoFingersRecognizer.enabled=!1),this.isRotationLocked&&(this.restrictedCamera=this.camera.copy(),this.restrictIncomingRotation=!0)}finishedRecognizingRotation(){this._zoomController&&(this._zoomController._singleTapWithTwoFingersRecognizer.enabled=!0),this.resetRestrictedCamera()}compassRotationWillStart(){this.isRotationLocked&&(this.restrictedCamera=this.camera.copy(),this.restrictIncomingRotation=!1)}compassRotationDidEnd(){this.resetRestrictedCamera()}resetRestrictedCamera(){this.restrictedCamera&&(this.restrictedCamera.rotation=0,this.setCameraAnimated(this.restrictedCamera,!0),delete this.restrictedCamera,this.restrictIncomingRotation=!1)}tileGridDidFinishRendering(){const e=this.node.delegate;e&&"function"==typeof e.mapDidFinishRendering&&e.mapDidFinishRendering(this.node)}tileAccessForbidden(){const e=this.node.delegate;e&&"function"==typeof e.tileAccessForbidden&&e.tileAccessForbidden(this.node)}updateMinAndMaxZoomLevelsWhenConfigurationChanges(){this.minZoomLevel=br.DEFAULT_MIN_ZOOM_LEVEL,this.maxZoomLevel=br.DEFAULT_MAX_ZOOM_LEVEL,this._configuration.tileSources.forEach((function(e){this.minZoomLevel=Math.max(this.minZoomLevel,e.minZoomLevel),this.maxZoomLevel=Math.min(this.maxZoomLevel,e.maxZoomLevel)}),this),this.minAndMaxZoomLevelsWereUpdated(),this.currentMinZoomLevel=this.minZoomLevel,this.currentMaxZoomLevel=this.maxZoomLevel}minAndMaxZoomLevelsWereUpdated(){}_updateMinAndMaxZoomLevels(e){if(e.width<=0||e.height<=0)return!1;this._configuration&&this.updateMinAndMaxZoomLevelsWhenConfigurationChanges(),this.minZoomLevel=Math.max(this.minZoomLevel,this.minZoomLevelForViewportSize(e,Li.tileSize)),this.snapsToIntegralZoomLevels&&(this.minZoomLevel=Math.ceil(this.minZoomLevel)),this.currentMinZoomLevel=Math.max(this.currentMinZoomLevel,this.minZoomLevel),this.adjustForSize(this.size)}_cameraChangesMayHaveStarted(e){if(!(this.cameraChangesHaveStarted||this._panning||this._zooming||this._rotating||this.cameraAnimation)){this.cameraChangesHaveStarted=!0;const t=this.node.delegate;t&&"function"==typeof t.mapCameraChangesWillStart&&t.mapCameraChangesWillStart(this.node,e)}}_cameraWillChange(e){this._cameraChangesMayHaveStarted(e),this._cameraWillChangeAnimated=!!e;const t=this.node.delegate;t&&"function"==typeof t.mapCameraWillChange&&t.mapCameraWillChange(this.node,!!e)}_cameraDidChange(){const e=this.node.delegate;e&&"function"==typeof e.mapCameraDidChange&&e.mapCameraDidChange(this.node,!!this._cameraWillChangeAnimated),delete this._cameraWillChangeAnimated,this._cameraChangesMayHaveEnded()}_cameraChangesMayHaveEnded(e){if(this.cameraChangesHaveStarted&&!this._panning&&!this._zooming&&!this._rotating&&!this.cameraAnimation){delete this.cameraChangesHaveStarted;const e=this.node.delegate;return e&&"function"==typeof e.mapCameraChangesDidEnd&&e.mapCameraChangesDidEnd(this.node),!0}}isMapPointWithinBounds(e){if(!this._cameraBoundaryRect)return!0;const t=this._constrainCenterWithinBounds(e);return e.x===t.x&&e.y===t.y}_constrainCenterWithinBounds(e){if(0===this.camera.viewportSize.width||0===this.camera.viewportSize.height)return e;const t=this.camera.center,i=this.transformCenter,s=t.x-i.x,o=t.y-i.y,n=l(this._cameraBoundaryRect.origin.x+s,1),a=n+this._cameraBoundaryRect.size.width;let r=l(e.x,1);if(r<n&&(r+=1),r>a){let e=r-n;e>.5&&(e=1-e);let t=r-a;t>.5&&(t=1-t),r=e<t?n:a}const h=c(e.y,this._cameraBoundaryRect.minY()+o,this._cameraBoundaryRect.maxY()+o);return r!==e.x||h!==e.y?new Ci(r,h):e}_updateMinAndMaxZoomLevelsAtY(e){let t=this.minZoomLevel,i=this.maxZoomLevel;if(this._cameraZoomRange){const s=Li.convertYToLatitude(e);t=c(this._zoomLevelForCameraDistanceAtLatitude(this._cameraZoomRange.maxCameraDistance,s),t,i),i=c(this._zoomLevelForCameraDistanceAtLatitude(this._cameraZoomRange.minCameraDistance,s),t,i),this.snapsToIntegralZoomLevels&&(t=Math.ceil(t),i=Math.floor(i))}else this._cameraZoomLevelLimit&&(t=c(this._cameraZoomLevelLimit.minZoomLevel,t,i),i=c(this._cameraZoomLevelLimit.maxZoomLevel,t,i));this.currentMinZoomLevel=t,this.currentMaxZoomLevel=i}_updateZoom(e){this._updateMinAndMaxZoomLevelsAtY(this.camera.center.y);const t=c(this.camera.zoom,this.currentMinZoomLevel,this.currentMaxZoomLevel);if(t!==this.camera.zoom)e&&(this._nextCameraZoomRange=this._cameraZoomRange,delete this._cameraZoomRange),this.setZoomLevelAnimated(t,e);else{const e=this.node.delegate;e&&"function"==typeof e.mapMinAndMaxZoomLevelsDidChange&&e.mapMinAndMaxZoomLevelsDidChange(this.node)}}_zoomLevelForCameraDistanceAtLatitude(e,t){return Li.zoomLevelForCameraDistanceAtLatitudeAndViewportWidth(e,t,this.camera.viewportSize.width)}get[Qn](){return this._[Qn]}set[Qn](e){this._[Qn]=e}[ea](e){throw new Error}}_r(br,"DEFAULT_MIN_ZOOM_LEVEL",-1/0),_r(br,"DEFAULT_MAX_ZOOM_LEVEL",1/0);const wr=br,Cr="rgba(0, 0, 0, 0.5)",kr="white",Sr="rgba(255, 255, 255, 0.75)",Mr="black";const Lr=class extends Qo{draw(e){const t=this._node.size.width,i="standard"===this._node.tile.settings.configuration.name;e.fillStyle=i?Cr:Sr,e.fillRect(0,0,t,1),e.fillRect(0,1,1,t-1);const s=["x","y","z"].map((e=>e+" = "+this._node.tile[e]));e.font="12px -apple-system-font",e.beginPath(),e.moveTo(1,1);let o=1,n=1;s.forEach(((t,i)=>{const s=e.measureText(t).width;o=1+s+16,e.lineTo(o,n),n+=20,0===i&&(n+=8),e.lineTo(o,n)})),e.lineTo(1,n),e.closePath(),e.fill(),e.fillStyle=i?kr:Mr,e.textBaseline="hanging",s.forEach(((i,s)=>{e.fillText(i,9,9+20*s,t)}))}};const xr=class extends Ns{constructor(e){super(),this._tile=e,this._renderer=new Lr(this)}get tile(){return this._tile}stringInfo(){return"DebugNode<x:"+this.tile.x+",y:"+this.tile.y+",z:"+this.tile.z+">"}};const Ar=class extends hn{constructor(e){super(),this._tileSource=e._public,this._tileSource&&"function"==typeof this._tileSource.addEventListener&&this._tileSource.addEventListener(Ba.OPACITY_EVENT,this)}handleEvent(){this._tileSource&&(this.opacity=this._tileSource.opacity)}wasRemoved(){setTimeout((()=>{this.parent&&this.parent.scene||this._tileSource&&"function"==typeof this._tileSource.removeEventListener&&this._tileSource.removeEventListener(Ba.OPACITY_EVENT,this)}),0)}};function Er(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Tr=ue,Ir=new ys,Or=new ls(Li.tileSize,Li.tileSize);function Rr(e){const t=new Ar(e.tileSource);return t.size=Or,e.loaderState===Tr.Succeeded&&(t.setImage(e.image,e.url),t.opacity=e.preferredOpacity),t}const Pr=class extends an{constructor(e){super(),Er(this,"stale",!1),Er(this,"fullyRendered",!1),Er(this,"_pendingTileCount",0),Er(this,"_tileData",null),this._scale=1,this._nodesByTileKey={},this._fadingNodes=[],this._debug=!!e}get locked(){return this.wantsLayerBacking}set locked(e){e!==this.wantsLayerBacking&&(e&&this._fadingNodes.length>0?this.wantsLayerBacking=!0:!e&&this._wantsLayerBacking?this.wantsLayerBacking=!1:this.frozen=e)}get tileData(){return this._tileData}setTileDataAnimated(e,t){this._fadingNodes=[],delete this._failedTileAndImage;const i=e.tiles,s=e.range.min,o=Math.pow(2,s.z);this._tileData&&this._tileData.tiles.forEach((function(e){if(e.removeEventListener(Ea.Events.LoadSuccess,this),e.removeEventListener(Ea.Events.LoadFail,this),-1===i.indexOf(e)){const t=e.key,i=this._nodesByTileKey[t];i&&(i.remove(),delete this._nodesByTileKey[t])}}),this),this._tileData=e,this.fullyRendered=!1,this._pendingTileCount=i.length;const n=this.childCount,a=e.range.min.x,r=e.range.max.x-a===o,h=o*Li.tileSize;i.forEach((function(e){const i=new cs(l(e.x-s.x,o)*Li.tileSize,(e.y-s.y)*Li.tileSize),c=this._ensureNodeForTile(e);c.position=i,c.opacity=0,r&&e.x===a&&(c.repeatOffset=h),this.addChild(c),e.loaded?((n>0||!t)&&(c.opacity=1),this._tileDidLoad(e)):(t||(c.opacity=1),e.addEventListener(Ea.Events.LoadSuccess,this),e.addEventListener(Ea.Events.LoadFail,this))}),this)}get pendingTileCount(){return this._pendingTileCount}set scale(e){e!==this._scale&&(this._scale=e,this.transform=1===e?Ir:(new ys).scale(e))}get debug(){return this._debug}stringInfo(){return"TileGridNode"+(this.tileData?"<range:("+this.tileData.range.toString()+")>":"")}get cssBackgroundProperty(){if(!this.fullyRendered)return"";const e=this.position;return Array.prototype.concat.apply([],this._tileData.tiles.map((function(t){const i=this._nodesByTileKey[t.key];return t.tileImages.reduce(((t,s,o)=>"url("+s.url+") "+(e.x+i.position.x)+"px "+(e.y+i.position.y)+"px / "+Li.tileSize+"px no-repeat"+(0===o?"":", ")+t),"")}),this)).join(", ")}handleEvent(e){const t=e.target;switch(e.type){case Ea.Events.LoadSuccess:t.removeEventListener(Ea.Events.LoadSuccess,this),this._tileDidLoad(t);break;case Ea.Events.LoadFail:this._tileLoadFail(t,e.tileImage)}}performScheduledUpdate(){this._updateFadingNodes(),0===this._pendingTileCount&&0===this._fadingNodes.length&&this._allTilesDidDraw()}_tileDidLoad(e){this._pendingTileCount--,0===this._pendingTileCount&&this._failedTileAndImage&&(this._failedTileAndImage.tile._requestTileImageLoadStatus(this._failedTileAndImage.tileImage,(e=>this._handleTileImageLoadStatus(e))),delete this._failedTileAndImage);const t=this._nodesByTileKey[e.key];if(0===t.childCount){const i=e.tileImages;if(t.children=i.map(Rr),this.debug){const i=new xr(e);i.size=Or,t.addChild(i)}}t.opacity<1?(this._fadingNodes.push(t),Mt.scheduleASAP(this)):0===this._pendingTileCount&&this._allTilesDidDraw()}_tileLoadFail(e,t){this._failedTileAndImage={tile:e,tileImage:t}}_handleTileImageLoadStatus(e){403===e.target.status&&this.parent&&this.parent.tileAccessForbidden(this)}_updateFadingNodes(){const e=Date.now();this._fadingNodes=this._fadingNodes.filter((t=>(t._startTime?t.opacity=Math.min(1,(e-t._startTime)/150):0===t.opacity&&(t._startTime=e),1!==t.opacity||(delete t._startTime,!1)))),this._fadingNodes.length>0?Mt.scheduleOnNextFrame(this):this._wantsLayerBacking&&(this.wantsLayerBacking=!1,this.frozen=!0)}_allTilesDidDraw(){this.fullyRendered=!0,this.parent&&this.parent.tileGridDidFinishRendering(this)}_ensureNodeForTile(e){const t=e.key;let i=this._nodesByTileKey[t];return i?delete i.repeatOffset:i=this._nodesByTileKey[t]=new an,i}};const Dr=class extends an{constructor(e){var t,i,s;super(),s=!1,(i="fullyRendered")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,this._map=e}scheduleRefresh(){this.children.forEach((e=>{e.stale=!0})),this.invalidate()}destroy(){this._releaseChildren(!0)}invalidate(){this.fullyRendered=!1,Mt.scheduleASAP(this)}stringInfo(){return"TileGridsGroupNode"}get cssBackgroundProperty(){return this.fullyRendered?this.lastChild.cssBackgroundProperty:""}handleEvent(e){this.scheduleRefresh()}performScheduledUpdate(){if(!this._canDraw())return;const e=this._map,t=e.camera,i=this.lastChild,s=!!i&&i.debug!==this._map.debug,o=!!i&&i.tileData.settings.showsDefaultTiles!==this._map.showsDefaultTiles;if(!this._tileDataAtZoomCompletion){let n;if(Math.round(t.zoom)!==t.zoom&&e.tileSettings.showsLabels){if(!i)return;n=i.tileData}else n=new Fa(t,e.tileSettings);if(i){if((i.stale||!i.locked)&&(!n.equals(i.tileData)||s||o)){const e=i.tileData;e.tiles.forEach((e=>{n.tiles.indexOf(e)<0&&e.unschedule()}));const t=n.settings.configuration===e.settings.configuration,o=n.sameSettings(e)&&n.resolution===e.resolution&&!s;if(t?!o:n.sharesTileSourcesWithTileData(e))i.locked=!0,this._addNewTileGridAnimated(n,!0);else if(!i.locked){const e=t&&this._children.length>1;delete i.stale,i.setTileDataAnimated(n,e);const s=this._children[this._children.length-2];s&&!n.sharesTileSourcesWithTileData(s.tileData)&&(this._releaseChildren(!1),this._children=[i])}}}else this._addNewTileGridAnimated(n,!1)}const n=t.zoom,a=e.visibleMapRect,r=a.origin,l=a.size,h=this.children,c=h.length;for(let e=0;e<c;++e){const t=h[e],i=t.tileData,s=i.zoom,o=i.mapRect.origin,a=Math.pow(2,n-s),d=Math.pow(2,s)*(Li.tileSize*a);let u=o.x-r.x;if(u>l.width)u--;else{const e=i.mapRect.size.width;e>0&&u+e<0&&u++}t.scale=a,t.position=new cs(Bo.roundToDevicePixel(u*d),Bo.roundToDevicePixel((o.y-r.y)*d)),e<c-1&&i.cancel()}this.fullyRendered=c>0&&this.children[c-1].fullyRendered}cameraWillStartZooming(e){if(!this._canDraw())return;const t=this._map;e&&(this._tileDataAtZoomCompletion=new Fa(e,t.tileSettings),this._tileDataAtZoomCompletion.load()),this.children.forEach((e=>{e.locked=!0}))}cameraDidStopZooming(){if(this._canDraw())if(this._tileDataAtZoomCompletion)this._addNewTileGridAnimated(this._tileDataAtZoomCompletion,!0,!0),delete this._tileDataAtZoomCompletion;else{const e=this._map,t=this.lastChild;if(t&&e.camera.zoom===t.tileData.zoom)t.locked=!1;else{const t=new Fa(e.camera,e.tileSettings);this._addNewTileGridAnimated(t,!0,!0)}}}tileGridDidFinishRendering(e){const t=this.children,i=t.length,s=t[i-1];if(s.fullyRendered&&!s.locked){for(let e=0;e<i-1;++e)t[e].tileData.releaseTiles();i>1&&(this.children=[s]),this.fullyRendered=!0,this._map.tileGridDidFinishRendering()}}tileAccessForbidden(e){this._map.tileAccessForbidden()}_canDraw(){const e=this._map;return e&&!!e.configuration&&!!e.language}_addNewTileGridAnimated(e,t,i){const s=new Pr(this._map.debug),o=this.lastChild;o&&!e.sharesTileSourcesWithTileData(o.tileData)?(this._releaseChildren(!0),this.children=[s]):this.addChild(s),s.setTileDataAnimated(e,t),i&&Mt.scheduleASAP(this)}_releaseChildren(e){for(let t=this.childCount-(e?1:2);t>=0;--t){const e=this.children[t].tileData;e.cancel(),e.releaseTiles()}}};const zr=class extends wr{constructor(e){super(e),this._backgroundGrid=this.node.addChild(new Jn),this._tileGridsGroup=this.node.addChild(new Dr(this)),this._labels=!0,this.rotation=0,this._backgroundGrid.initialRendering=!0,this._tileGridsGroup.opacity=0,setTimeout((()=>{this._backgroundGrid.initialRendering=!1,this._tileGridsGroup.opacity=1}),0)}stringInfo(){return"MapNode<camera:"+this.camera.toString()+">"}get tileSettings(){return{configuration:this._configuration,tint:this._tileTint,emphasis:this._emphasis,language:this._language,showsPOI:this._showsPOI(),showsLabels:this._labels,showsDefaultTiles:this._showsDefaultTiles,showsTileInfo:this._debug,tileOverlays:this._tileOverlays}}get fullyRendered(){return this._tileGridsGroup.fullyRendered}get cssBackgroundProperty(){return this._tileGridsGroup.cssBackgroundProperty}get labels(){return this._labels}set labels(e){this._labels=!!e,this.refresh()}destroy(e){super.destroy(e),this._tileGridsGroup.destroy()}updateTintAndEmphasis(e,t,i){this._backgroundGrid.updateThemeFromTint(e),this.refresh()}refresh(){this._tileGridsGroup.scheduleRefresh()}cameraZoomWasSet(e){e?this._tileGridsGroup.cameraWillStartZooming(e):this._tileGridsGroup.invalidate()}tileGridDidFinishRendering(){this._tileOverlays.forEach((e=>{e._impl.reloadComplete()})),super.tileGridDidFinishRendering()}handleEvent(){this._tileGridsGroup.scheduleRefresh()}beforeCameraZoomChange(e){e?this._tileGridsGroup.cameraWillStartZooming():this._tileGridsGroup.cameraDidStopZooming()}devicePixelRatioDidChange(){return this._tileGridsGroup.scheduleRefresh(),!0}minZoomLevelForViewportSize(e,t){const i=Math.max(e.width,e.height);return h(i/t)}minAndMaxZoomLevelsWereUpdated(){this.tileOverlays.forEach((function(e){"number"!=typeof e.minimumZ||isNaN(e.minimumZ)||(this.minZoomLevel=Math.min(this.minZoomLevel,e.minimumZ)),"number"!=typeof e.maximumZ||isNaN(e.maximumZ)||(this.maxZoomLevel=Math.max(this.maxZoomLevel,e.maximumZ))}),this)}_tileOverlaysDidChange(){this._updateMinAndMaxZoomLevels(this.camera.viewportSize),this._tileGridsGroup.scheduleRefresh()}_showsPOI(){return(null==this._pointOfInterestFilter||null==this._pointOfInterestFilter._includes&&0===this._pointOfInterestFilter._excludes.length)&&this.labels}needsReplacing(e){return e}};const Nr=class extends ia{constructor(){super(),Object.defineProperty(this,"_impl",{value:new zr(this)})}get cssBackgroundProperty(){return this._impl.cssBackgroundProperty}get labels(){return this._impl.labels}set labels(e){this._impl.labels=e}get pointOfInterestFilter(){return null===this._impl._pointOfInterestFilter?null:null===this._impl._pointOfInterestFilter._includes&&0===this._impl._pointOfInterestFilter._excludes.length?this._impl._pointOfInterestFilter:$e.filterExcludingAllCategories}set pointOfInterestFilter(e){this._impl.pointOfInterestFilter=e}get rotation(){return 0}set rotation(e){this._impl.rotation=e}rotateCameraAroundMapPoint(e,t){this._impl.rotation+=t}};function Fr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Ur=Object.freeze({Uninitialized:0,Initializing:1,Ready:2,Deactivated:3,DestroyPending:4,Destroyed:5});let Gr=0;function Wr(){throw new Error("[MapKit] The specified reference layer has not been added to the map.")}const Br=Ze.performanceMarkers.rendering,Zr=Ze.performanceMarkers["frame-updates"];class Kr{constructor(e){Fr(this,Qn,void 0),Fr(this,ea,void 0),Fr(this,"frozen",!1),delete this[Qn],delete this[ea],this.node=e,this._id=Gr++,this._state=Ur.Uninitialized,this._unregisteredLabelRegions=[],this._unregisteredLayers=[],this._baseLoadedOnce=!1,this._fullyLoadedOnce=!1,this._fullyRenderedOnce=!1,this.availability=void 0}init(e,t,i,s,o,n,a){this._state=Ur.Initializing,this.SyrupRenderer=t,this.Camera=i,this.Camera.hasRotationLock=!0,this._initialDisplayOptions=o,this._initialPoiFilter=n,this.initRenderer(t,e,s).then((()=>this.syrupInitHandler(a))).catch((e=>this.syrupInitErrorHandler(a,e)))}initRenderer(e,t,i){const s=this._syrupRenderer=new e(i);return s.on("invalid-access-key",(()=>{t.accessKeyHasExpired()}),jr),s.on("zoom-support-did-change",(()=>this.node.didReconfigure()),Hr),s.init(t)}syrupInitErrorHandler(e,t){if(this._state===Ur.DestroyPending)return this._state=Ur.Uninitialized,void this.destroy();this._state=Ur.Uninitialized,e(t||new Error)}syrupInitHandler(e){if(this._state===Ur.DestroyPending)return this._state=Ur.Deactivated,void this.destroy();this._state=Ur.Ready,S(this._syrupRenderer);const t=this._syrupRenderer.DrawPasses;t&&(this._drawPasses=[t.BaseMap,t.Roads,t.Borders,t.Buildings,t.Icons,t.Labels]);const i=this._syrupRenderer;i.setDeterministicCollisions(!0),i.setLanguage(this.node.language),i.setDeterministicCollisions(!1),i.setPixelRatio(Bo.devicePixelRatio),this._canvas=i.element(),S(this.node.configuration),S(this._initialDisplayOptions),this.updateConfiguration(this.node.configuration,this._initialDisplayOptions),this._initialDisplayOptions=null,this._initialPoiFilter&&(this.updatePointOfInterestFilter(this._initialPoiFilter),this._initialPoiFilter=null),this.performScheduledDraw(),S(this.node[Qn]),this[Qn]&&this[Qn](this.node[Qn]),S(this._unregisteredLabelRegions),this._unregisteredLabelRegions.forEach((e=>{i.registerLabelRegion(e)})),delete this._unregisteredLabelRegions,S(this._unregisteredLayers);const s=this._unregisteredLayers;delete this._unregisteredLayers,s.forEach((e=>{this.prepareLayer(e),S(e._impl.syrupLayer),e._impl.syrupToken=i.addLayer(e._impl.syrupLayer)})),e()}deactivate(){this._state!==Ur.Initializing?this._state!==Ur.DestroyPending&&(this._state=Ur.Deactivated):this._state=Ur.DestroyPending}destroy(){this._state!==Ur.Initializing?this._state!==Ur.DestroyPending&&this._state!==Ur.Destroyed&&(this._state=Ur.Destroyed,this._syrupRenderer&&(this._syrupRenderer.off("invalid-access-key",null,jr),this._syrupRenderer.off("zoom-support-did-change",null,Hr),"function"==typeof this._syrupRenderer.destroy&&this._syrupRenderer.destroy(),this._syrupRenderer=null)):this._state=Ur.DestroyPending}get snapsToIntegralZoomLevels(){return!!this._syrupRenderer&&!this._syrupRenderer.supportsNonIntegralZoomLevels()}getMapFeatureRegions(){return this._syrupRenderer&&this._syrupRenderer.getMapFeatureRegions?this._syrupRenderer.getMapFeatureRegions():[]}performScheduledDraw(e){if(this._state!==Ur.Ready&&this._state!==Ur.Deactivated)return;const t=[this.node.size.width,this.node.size.height];if(0===t[0]||0===t[1])return;this.node.delegate&&this.node.delegate.mapCustomCanvasWillRender&&this.node.delegate.mapCustomCanvasWillRender(this.node),S(this.Camera);const i=new(0,this.Camera)(t[0]/t[1]),s=this.node.zoomLevel,o=[this.node.camera.center.x,1-this.node.camera.center.y,0];i.setTarget(o),i.setZoomLevel(s),i.setRotation(this.node.camera.rotation*qr*-1),S(this._syrupRenderer);const n=Zr?performance.now():void 0;let a;this._syrupRenderer.update(i,t,void 0,void 0,e),S(this.SyrupRenderer);const r=this.SyrupRenderer.StatusType;if(Zr&&(a=this._syrupRenderer.status(),performance.measure("mapkit-syrup-update-frame",{start:n,detail:{syrupStatus:a,timestamp:e,baseLoaded:a>=r.BASE_LOADED,fullyLoaded:a>=r.FULLY_LOADED}})),this._state!==Ur.Destroyed){for(const e of Kr.PostUpdateHandlers)e.call(this);Br&&!this._fullyRenderedOnce&&this._syrupRenderer.status&&(a||(a=this._syrupRenderer.status()),!this._baseLoadedOnce&&a>=r.BASE_LOADED&&(this._baseLoadedOnce=!0,performance.measure("mapkit-map-land-cover-rendered","mapkit-map-start")),!this._fullyLoadedOnce&&a>=r.FULLY_LOADED&&(this._fullyLoadedOnce=!0,performance.measure("mapkit-map-base-map-loaded","mapkit-map-start")),!this._fullyRenderedOnce&&a>=r.FULLY_RENDERED&&(this._fullyRenderedOnce=!0,performance.measure("mapkit-map-base-map-rendered","mapkit-map-start"))),this._syrupRenderer.mapFullyRendered()?this.node._impl.tileGridDidFinishRendering():this.node.needsDisplay=!0}}forceRerender(){this._state===Ur.Ready&&(S(this._syrupRenderer),this._syrupRenderer.forceRerender())}devicePixelRatioDidChange(){this._syrupRenderer?.setPixelRatio(Bo.devicePixelRatio)}get element(){return this.canvas}get canvas(){return this._canvas}get fullyRendered(){return this._syrupRenderer&&this._syrupRenderer.mapFullyRendered()}set language(e){this._syrupRenderer&&this._syrupRenderer.setLanguage(e)}set fontSizeRatio(e){this._syrupRenderer&&this._syrupRenderer.setFontSize(e)}updateNetworkConfiguration(e){this._syrupRenderer&&this._syrupRenderer.updateNetworkConfiguration(e)}updateConfiguration(e,t){this._syrupRenderer&&(t.mode=e.name,this._syrupRenderer.setDisplayOptions(t),e.countryCode&&this._syrupRenderer.setLocationInfo(e.countryCode,e.countryCode))}updatePointOfInterestFilter(e){this._syrupRenderer?this._syrupRenderer.setPOIFilter(e):this._initialPoiFilter=e}createLabelRegion(){if(!this._syrupRenderer)return;const e=this._syrupRenderer.createLabelRegion();return this._unregisteredLabelRegions?this._unregisteredLabelRegions.push(e):this._syrupRenderer.registerLabelRegion(e),e}unregisterLabelRegion(e){this._unregisteredLabelRegions?this._unregisteredLabelRegions.splice(this._unregisteredLabelRegions.indexOf(e),1):this._syrupRenderer&&this._syrupRenderer.unregisterLabelRegion(e)}prepareLayer(e){if(!this._unregisteredLayers){if(S(this._syrupRenderer),!e._impl.syrupLayer||e._impl.rendererId!==this._id){S(this._syrupRenderer.createWebGLLayer);const t={},i=e._impl.blendMode;if(void 0!==i){if(!d(i,Hs))throw new Error("Invalid blendMode: "+i);t.blendMode=i}const s=e._impl.backdropFilter;if(void 0!==s){if(!d(s,qs))throw new Error("Invalid backdropFilter: "+s);t.backdropFilter=s}e._impl.rendererId=this._id,e._impl.syrupLayer=this._syrupRenderer.createWebGLLayer(e._impl,t)}S(this._drawPasses),S(e._impl.passIndex),e._impl.syrupLayer.setDrawPass(this._drawPasses[e._impl.passIndex]+e._impl.passOffset)}}cleanupLayer(e){e._impl.syrupLayer=void 0}addLayer(e){const t=this._unregisteredLayers;if(t){const i=t.indexOf(e);i>=0&&t.splice(i,1),t.push(e)}else{S(this._syrupRenderer);const t=this._syrupRenderer,i=e._impl;S(i.syrupLayer);const s=e=>{i.syrupToken=t.addLayer(e)};i.syrupToken?i.syrupToken.then(s):s(i.syrupLayer)}}insertBefore(e,t){const i=this._unregisteredLayers;if(i){const s=i.indexOf(t);if(s<0)return void Wr();const o=i.indexOf(e);o!==s&&(o>=0&&i.splice(o,1),i.splice(s,0,e))}else{S(this._syrupRenderer);const i=this._syrupRenderer,s=t._impl.syrupToken;if(!s)return void Wr();s.then((t=>{const s=e._impl;S(s.syrupLayer);const o=e=>{s.syrupToken=i.insertBefore(e,t)};s.syrupToken?s.syrupToken.then(o):o(s.syrupLayer)}))}}insertAfter(e,t){const i=this._unregisteredLayers;if(i){const s=i.indexOf(t);if(s<0)return void Wr();const o=i.indexOf(e);o!==s&&(o>=0&&i.splice(o,1),i.splice(s+1,0,e))}else{S(this._syrupRenderer);const i=this._syrupRenderer,s=t._impl.syrupToken;if(!s)return void Wr();s.then((t=>{const s=e._impl;S(s.syrupLayer);const o=e=>{s.syrupToken=i.insertAfter(e,t)};s.syrupToken?s.syrupToken.then(o):o(s.syrupLayer)}))}}removeLayer(e){if(this._unregisteredLayers){const t=this._unregisteredLayers.indexOf(e);if(t<0)return void Wr();this._unregisteredLayers.splice(t,1)}else{S(this._syrupRenderer);const t=this._syrupRenderer,i=e._impl.syrupToken;if(!i)return void Wr();e._impl.syrupToken=void 0,i.then((e=>{t.removeLayer(e)}))}}getMemoryStatistics(){const e=this._syrupRenderer;return e&&e.getMemoryStatistics?e.getMemoryStatistics():{}}}const jr="mapkit-re-bootstrap-notification",Hr="mapkit-zoom-support-notification";Kr.PostUpdateHandlers=[];const qr=Math.PI/180;const Vr=Kr,Yr={fontFamily:"-apple-system-font, sans-serif",margin:"2em auto",width:"20em",borderRadius:"0.5em",color:"#f8f9f0",backgroundColor:"rgba(0, 0, 0, 0.7)",padding:"1em",textAlign:"center",position:"relative"},Xr={listStyleType:"none",margin:0,paddingLeft:0},$r={width:"1em",height:"1em",position:"absolute",top:"0.5em",left:"0.5em"};function Jr(e,t){for(const i in t)e.style[i]=t[i];return e}const Qr=class{constructor(e,t){this._element=Jr(document.createElement("div"),Yr);const i=Jr(this._element.appendChild(document.createElement("ul")),Xr);this._items=[function(e){const t=e.center.toCoordinate();return"Center: "+t.latitude.toFixed(6)+", "+t.longitude.toFixed(6)},function(e){return"Zoom: "+e.zoom.toFixed(6)+", rotation: "+e.rotation.toFixed(6)},function(e){const t=Math.floor(e.zoom),i=Math.pow(2,t);return"Center tile: x="+Math.floor(l(e.center.x,1)*i)+", y="+Math.floor(e.center.y*i)+", z="+t},function(e){return"Viewport: "+e.viewportSize.width+"×"+e.viewportSize.height}].map((e=>{const t=i.appendChild(document.createElement("li"));return function(i){t.textContent=e(i)}}));const s=Bo.svgElement("svg",{viewBox:"-16 -16 32 32"},Bo.svgElement("circle",{r:16,fill:"#ccc"}),Bo.svgElement("g",{"stroke-width":4,stroke:"#222"},Bo.svgElement("line",{x1:-8,y1:-8,x2:8,y2:8}),Bo.svgElement("line",{x1:8,y1:-8,x2:-8,y2:8})));this._element.appendChild(Jr(s,$r)),s.addEventListener("click",e),this.update(t),this.update=xt(this.update,50,this)}attachTo(e){e.appendChild(this._element)}detach(){this._element.remove()}update(e){this._items.forEach((t=>{t(e)}))}};const el=Ze.performanceMarkers.interactions,tl=180/Math.PI,il=3*tl,sl=1e-4*tl*1e3,ol=.995;const nl=class extends la{constructor(e){var t,i,s;super(e),s=!1,(i="decelerating")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,this._recognizer=this.addRecognizer(new Dn)}stopDecelerating(){this.decelerating&&this._decelerationEnded()}destroy(){super.destroy(),this.stopDecelerating(),delete this._recognizer}handleEvent(e){const t=e.target;t===this._recognizer&&(t.state===Ro.Began&&(this.map.beganRecognizingRotation(),this.map.currentGestureType="rotate",this.map.cameraWillStartRotating()),t.state===Ro.Ended&&(delete this._restricted,this.map.finishedRecognizingRotation(),this._startDeceleratingWithVelocity(t)),this._handleRotationChange(e.target),el&&performance.measure("mapkit-map-rotate-interaction",{start:t.lastEventTimeStamp,detail:t.state}))}_handleRotationChange(e){this._lastRotationCenter=this.centerForGesture(e);const t=this.map.cameraIsRotating&&e.state===Ro.Changed,i=2===e.numberOfTouches&&Math.abs(e.rotation)<=150/e._distance();t&&!i&&(this.map.rotateCameraAroundMapPoint(this._lastRotationCenter,e.rotation),e.rotation=0)}_centerWithRecognizer(e){const t=this.map,i=e.locationInElement();let s=this.map.node.convertPointFromPage(i);s=t.camera.transformGestureCenter(s);const o=t.visibleMapRect,n=t.camera.viewportSize;return new Li.MapPoint(o.minX()+s.x/n.width*o.size.width,o.minY()+s.y/n.height*o.size.height)}performScheduledUpdate(e){const t=el?performance.now():void 0;if(!this.decelerating)return;if(null==e)return void this._decelerationEnded();const i=e-this._timeAtPreviousFrame;if(i>300)return void this._decelerationEnded();let s=this._velocity/1e3;const o=Math.pow(ol,i),n=ol*s*(o-1)/-.0050000000000000044;if(s*=o,this.map.cameraAnimation?this.map.cameraAnimation.adjustRotation(this._lastRotationCenter,n):this.map.rotateCameraAroundMapPoint(this._lastRotationCenter,n),this._velocity*=o,Math.abs(this._velocity)<=sl)this._decelerationEnded();else{if(this._velocity*=o,Math.abs(this._velocity)<=sl)return this._decelerationEnded(),void(el&&performance.measure("mapkit-map-rotate-deceleration",{start:t}));this._timeAtPreviousFrame=e,this._schedule(),el&&performance.measure("mapkit-map-rotate-deceleration",{start:t})}}_startDeceleratingWithVelocity(e){const t=e.velocity;if(Math.abs(t)>1440||isNaN(t))this.map.cameraDidStopRotating();else{if(Math.abs(t)<il)return this.decelerating=!1,void this.map.cameraDidStopRotating();this._velocity=t,this.decelerating=!0,this._timeAtPreviousFrame=e.lastEventTimeStamp,this._schedule()}}_schedule(){Mt.scheduleOnNextFrame(this)}_decelerationEnded(){this.decelerating=!1,this.map.cameraDidStopRotating()}};const al=class extends wr{constructor(e){var t,i,s;super(e),s=!1,(i="forcedSnapsToIntegralZoomLevels")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,this._renderer=e._renderer,this._requiresFallback=!1,this._fallback=()=>{this._requiresFallback=!0}}init(e,t,i,s,o){if(this._requiresFallback)return void e.syrupRequestedFallback(Us.FEATURE_ERROR);this._fallback=()=>e.syrupRequestedFallback(Us.FEATURE_ERROR);const n={tint:this.tileTint,emphasis:this.emphasis};this._renderer.init(this.networkConfigurationFor(e),t,i,s,n,this._getRendererPoiFilter(),(e=>{this._updateMinAndMaxZoomLevels(this.camera.viewportSize),o(e,this._renderer)}))}get isRotationEnabled(){return this._isRotationEnabled}set isRotationEnabled(e){!e&&this._rotationController?(this._rotationController.destroy(),delete this._rotationController):e&&!this._rotationController&&(this._initialInteractionController||(this._initialInteractionController=new ra(this)),this._rotationController=new nl(this),this.camera._initialRotation=0),this._isRotationEnabled=e}get rotation(){return this.camera.rotation}set rotation(e){if(this._cameraWillChange(),this.camera.rotation=e,this._updateDisplay(),this._cameraDidChange(),this.cameraAnimation&&this.cameraAnimation.rotating)return;const t=this.node.delegate;t&&"function"==typeof t.mapRotationDidChange&&t.mapRotationDidChange(this.node)}set fontSizeRatio(e){this._renderer.fontSizeRatio=e,this._updateDisplay()}updateNetworkConfiguration(e){this._renderer.updateNetworkConfiguration(this.networkConfigurationFor(e))}forceRerender(){this._renderer.forceRerender()}prepareLayer(e){this._renderer.prepareLayer(e)}cleanupLayer(e){this._renderer.cleanupLayer(e)}addLayer(e){this._renderer.addLayer(e)}insertBefore(e,t){this._renderer.insertBefore(e,t)}insertAfter(e,t){this._renderer.insertAfter(e,t)}removeLayer(e){this._renderer.removeLayer(e)}getMemoryStatistics(){return this._renderer.getMemoryStatistics()}adjustForSize(e){super.adjustForSize(e),this.forceRerender()}adjustMapItemPoint(e){return this.cameraIsZooming||this.cameraIsPanning||this.cameraIsRotating||(e.x=Bo.roundToDevicePixel(e.x),e.y=Bo.roundToDevicePixel(e.y)),e}networkConfigurationFor(e){if(!e)return{};let t,i=!1;return e.customMadabaUrl||(t=e.getProxyPrefix(),i=e.urlWithCredentials(t)),{madabaDomains:e.madabaDomains.slice(0),rasterTiles:e.rasterTilesForSyrup,proxyPrefixes:t?[t]:null,withCredentials:i,tileGroup:e.tileGroup,accessKey:e.accessKey,accessKeyHasExpired:()=>e.accessKeyHasExpired()}}rotateCameraAroundMapPoint(e,t){if(this.isRotationLocked){if(!this.restrictedCamera)return;if(this.restrictIncomingRotation){const e=l(this.camera.rotation+t,360),i=Bo.restrictRotation(e);i!==e&&(t=i-this.camera.rotation)}}if(0===t)return;this._cameraWillChange(),this.camera.rotateAroundCenter(e,t),this.constrainCamera(this.camera),this._updateDisplay(),this._cameraDidChange();const i=this.node.delegate;i&&"function"==typeof i.mapRotationDidChange&&i.mapRotationDidChange(this.node)}deactivate(){super.deactivate(),this.isRotationEnabled=!1,this._renderer.deactivate()}getMapFeatureRegions(){return this._renderer.getMapFeatureRegions()}destroy(e){super.destroy(e),this.customCanvas&&this.customCanvas.parentNode&&this.customCanvas.parentNode.removeChild(this.customCanvas),this._renderer&&(this._renderer.destroy(),this._renderer=null)}stringInfo(){return"SyrupNode<camera:"+this.camera.toString()+">"}get backgroundGridTheme(){return this._backgroundGridTheme}set backgroundGridTheme(e){this._backgroundGridTheme=e}get fullyRendered(){return this._renderer.fullyRendered}get customCanvas(){return this._renderer&&this._renderer.canvas}get camera(){return this._camera}set camera(e){this._camera=e,this.node.needsDisplay=!0}get language(){return this._language}set language(e){this._language!==e&&(this._language=e,this._renderer&&(this._renderer.language=e,this.node.needsDisplay=!0))}updateConfiguration(e){const t=this._configuration&&(e.name!==this._configuration.name||e.provider!==this._configuration.provider||e.countryCode!==this._configuration.countryCode);super.updateConfiguration(e),t&&this._renderer&&(this._renderer.updateConfiguration(e,{}),this.node.needsDisplay=!0)}updateTintAndEmphasis(e,t,i){this._renderer.node.pendingConfigurationUpdates?(this._renderer.node.pendingConfigurationUpdates.tint=e,this._renderer.node.pendingConfigurationUpdates.tileTint=t,this._renderer.node.pendingConfigurationUpdates.emphasis=i):this._renderer&&this._configuration&&(this._renderer.updateConfiguration(this._configuration,{tint:t,emphasis:i}),this.node.needsDisplay=!0)}updatePointOfInterestFilter(){this._renderer&&(this._renderer.updatePointOfInterestFilter(this._getRendererPoiFilter()),this.node.needsDisplay=!0)}makePendingConfigurationUpdates(){const e=this._renderer.node.pendingConfigurationUpdates;e&&(delete this._renderer.node.pendingConfigurationUpdates,e.tint&&e.emphasis&&this.updateTintAndEmphasis(e.tint,e.tileTint,e.emphasis),e.poiFilter&&this.updatePointOfInterestFilter())}devicePixelRatioDidChange(){return!this._renderer}get snapsToIntegralZoomLevels(){return this.forcedSnapsToIntegralZoomLevels||this._renderer&&this._renderer.snapsToIntegralZoomLevels}set snapsToIntegralZoomLevels(e){k()}get debug(){return this._debug}set debug(e){this._debug!==!!e&&(this._debug=!!e,this._debug?this._showDebugPanel():this._hideDebugPanel())}minZoomLevelForViewportSize(e,t){return this._renderer&&this._renderer.Camera?this._renderer.Camera.getMinZoomLevel([e.width,e.height],t):this.minZoomLevel}needsReplacing(e){return!e}createLabelRegion(){return this._renderer.createLabelRegion()}updatedLabelRegion(){this.forceRerender(),this.node.needsDisplay=!0}unregisterLabelRegion(e){this._renderer.unregisterLabelRegion(e),this.node.needsDisplay=!0}_tileOverlaysDidChange(){this._fallback()}_showDebugPanel(){this._debugPanel=new Qr((()=>{this.debug=!1}),this.camera),this._debugPanel.attachTo(this._element)}_hideDebugPanel(){this._debugPanel.detach(),delete this._debugPanel}_updateDisplay(){this.forceRerender(),this.node.needsDisplay=!0}_getRendererPoiFilter(){const e=null!==this.pointOfInterestFilter,t=0!==this._filteredPois.size,i={};return e&&(i.categoryInclude=this.pointOfInterestFilter._includes,i.categoryExclude=this.pointOfInterestFilter._excludes),t&&(i.muidExclude=Array.from(this._filteredPois)),e||t?i:null}_cameraDidChange(){super._cameraDidChange(),this._debugPanel&&this._debugPanel.update(this.camera)}get[Qn](){return this._[Qn]}set[Qn](e){this._[Qn]=e,this._renderer[Qn]?.(e)}[ea](e){return this._renderer[ea]?.(e)}};const rl=class extends ia{constructor(){super(),this._renderer=new Vr(this),Object.defineProperty(this,"_impl",{value:new al(this)})}get isRotationEnabled(){return this._impl.isRotationEnabled}set isRotationEnabled(e){this._impl.isRotationEnabled=e}get customCanvas(){return this._impl.customCanvas}set needsDisplay(e){e&&Mt.scheduleDraw(this._renderer)}get forcedSnapsToIntegralZoomLevels(){return this._impl.forcedSnapsToIntegralZoomLevels}set forcedSnapsToIntegralZoomLevels(e){this._impl.forcedSnapsToIntegralZoomLevels=e}init(e,t,i,s,o){this._impl.init(e,t,i,s,o)}updateNetworkConfiguration(e){this._impl.updateNetworkConfiguration(e)}forceRerender(){this._impl.forceRerender()}forceDraw(){this._impl.forceRerender(),this._impl._renderer.performScheduledDraw()}requireRender(){this._impl.forceRerender(),Mt.scheduleDraw(this._renderer)}rotateCameraAroundMapPoint(e,t){this._impl.rotateCameraAroundMapPoint(e,t)}makePendingConfigurationUpdates(){this._impl.makePendingConfigurationUpdates()}didReconfigure(){this.dispatchEvent(new F.Event("reconfigured"))}getMapFeatureRegions(){return this._impl.getMapFeatureRegions()}getMemoryStatistics(){return this._impl.getMemoryStatistics()}},ll=Object.freeze({name:"functions",fn:function(){return!!(Array.prototype.fill&&Uint8Array.from&&"undefined"!=typeof Set&&Set.prototype.forEach&&window.btoa)}}),hl=Object.freeze({name:"webGL",fn:function(e,t){if(t)return{capable:!0};const i=e?[e]:["webgl2","webgl"];for(let e=0;e<i.length;e++){const t=document.createElement("canvas");t.width=t.height=0;const o=t.getContext(i[e],{antialias:!1,stencil:!0,failIfMajorPerformanceCaveat:!0});if(null!=o)return{contextType:i[e],capable:(s=o,s.getParameter(s.MAX_TEXTURE_SIZE)>=4096&&s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>=8&&s.getParameter(s.MAX_VARYING_VECTORS)>=8&&s.getParameter(s.STENCIL_BITS)>=8),gpuInfo:cl(o)}}var s;return!1}});function cl(e){return{VERSION:e.getParameter(e.VERSION),MAX_RENDERBUFFER_SIZE:e.getParameter(e.MAX_RENDERBUFFER_SIZE)}}const dl=hl;let ul;const pl=()=>{if(k((Ze.state,Ze.States.UNINITIALIZED)),window.Syrup||window.Spile&&window.Spile.Syrup)return Promise.resolve();if(!ul){const e=Ze.performanceMarkers.loading;e&&performance.mark("mapkit-syrup-load-start");const t=()=>new Promise(((e,t)=>{const i=It.createSyrupUrl(),s=document.head.appendChild(document.createElement("script"));s.addEventListener("error",(e=>t(e)),{once:!0}),s.addEventListener("load",(()=>e()),{once:!0}),Ze.nonce&&It.isSyrupUrlTrusted(i)&&(s.nonce=Ze.nonce),s.crossOrigin=fa.getCorsAttribute(Ze.urlWithCredentials(i)),s.src=i})).then((()=>{const t=window.Syrup||window.Spile?.Syrup;t&&(e&&performance.measure("mapkit-syrup-load","mapkit-syrup-load-start"),Ze.componentVersions.set("s",t.Version))}),(e=>{console.error(e)}));ul=Ze._syrupUrl?t():Ze.loginPromise.then(t)}return ul},ml=me,gl=$,_l={sg_grid:{"global-configuration":"sg_ready",upgrade:"syrup_insert"},sg_insert:{"global-configuration":"sg_ready",upgrade:"syrup_insert",recreate:"sg_insert"},syrup_insert:{"global-configuration":"syrup_need_load",fallback:"sg_insert",recreate:"syrup_insert"},syrup_need_load:{"syrup-load":"syrup_init",fallback:"sg_insert",recreate:"syrup_insert"},syrup_init:{"global-configuration":"syrup_network_stalled",fallback:"sg_insert",recreate:"syrup_insert","syrup-complete":"syrup_ready"},syrup_network_stalled:{"global-configuration":"syrup_network_stalled",fallback:"sg_insert",recreate:"syrup_insert","syrup-complete":"syrup_ready"},sg_ready:{"global-configuration":"sg_ready",upgrade:"syrup_insert",recreate:"sg_insert","map-configuration":"sg_ready"},syrup_ready:{"global-configuration":"syrup_ready",upgrade:"syrup_insert",fallback:"sg_insert",recreate:"syrup_insert","map-configuration":"syrup_ready","print-match":"syrup_printing"},syrup_printing:{"print-unmatch":"syrup_ready"}},fl=Object.keys(js).map((e=>js[e]));class yl{constructor(e,t){this._state=null,this._map=e,this._previousNode=null,this.node=null,this._initialOptions=t,this._cachedWebGLCheck=null,this._layers=[],this.loadPriority=Vs.LandCover,void 0!==t.loadPriority&&(d(t.loadPriority,Vs)?this.loadPriority=t.loadPriority:console.warn("[MapKit] Unknown value for `loadPriority`. Choose from mapkit.Map.LoadPriorities.")),this.initialContextType=t.contextType,this._previousCanRunCSR=!1;this._updateState("sg_grid")}get usingSSR(){return"sg_insert"===this._state||"sg_ready"===this._state}get csrCapable(){return"HYBRID"===Ze.forcedRenderingMode||"CLIENT"===Ze.forcedRenderingMode||this._webglCheckResult.shouldTryCSR}get shouldDynamicallyLoadSyrup(){return this._webglCheckResult.shouldTryCSR}get _webglCheckResult(){return null===this._cachedWebGLCheck&&(this._cachedWebGLCheck=function(e,t){const i={};return i.shouldTryCSR=[ll,dl].every((s=>{const o=s.fn(e,t);return i[s.name]=o,"object"==typeof o?o.capable:o})),i}(this.initialContextType,Ze._disableWebGLCheck)),this._cachedWebGLCheck}get renderingMode(){let e="CLIENT";return this.usingSSR?e="SERVER":this._switchedToLoCSR&&(e="HYBRID"),e}configurationDidBecomeAvailable(e){const t=this._previousCanRunCSR,i=Ze.canRunCSR;this._previousCanRunCSR=i,!t||i||this.usingSSR?!t&&i?this.handleUpgrade():e||this.handleGlobalConfigurationChange():(k(),this.handleFallback(Us.CONFIG_CHANGE))}forceSyrup(){this._transition("upgrade")}_findLayerIndex(e){let t;const i=this._layers;if("string"==typeof e)for(t=i.length;t--&&i[t].name!==e;);else t=i.indexOf(e);if(t<0)throw new Error("[MapKit] Layer not found");return t}_addLayer(e,t,i){const s=this._layers;let o;const n=fl.indexOf(t);if(n<0)o=this._findLayerIndex(t),e._impl.passIndex=s[o]._impl.passIndex,o+=i;else{for(o=0;o<s.length&&s[o].passIndex<n+i;)o++;e._impl.passIndex=n,e._impl.passOffset=i-1}this.node._impl.prepareLayer(e),o===s.length?this.node._impl.addLayer(e):0===o?this.node._impl.insertBefore(e,s[0]):this.node._impl.insertAfter(e,s[o-1]),s.splice(o,0,e)}_addedLayer(e){this.usingSSR?e._impl.contextFailed():this.node.requireRender()}addLayerAbove(e,t){void 0===t?(e._impl.passIndex=fl.length-1,e._impl.passOffset=0,this.node._impl.prepareLayer(e),this.node._impl.addLayer(e),this._layers.push(e)):this._addLayer(e,t,1),this._addedLayer(e)}addLayerBelow(e,t){if(void 0===t)throw new Error("[MapKit] Relative layer not specified");this._addLayer(e,t,0),this._addedLayer(e)}removeLayer(e){const t=this._findLayerIndex(e);this._layers.splice(t,1),this.node._impl.removeLayer(e),this.node.requireRender()}requireRender(){this.node.requireRender()}updateSize(e){this.node.size=e,this._previousNode&&(this._previousNode.size=e)}destroy(){this._layers.forEach((e=>this.node._impl.removeLayer(e))),this.node.removeEventListener("reconfigured",this),this.node.destroy(),this.node.delegate=null,this.node=null,this._previousNode&&(this._previousNode.destroy(),this._previousNode=null)}handleEvent(e){"reconfigured"===e.type&&(this._switchedToLoCSR=this.node.snapsToIntegralZoomLevels,this._map.didReconfigureMapNode(this.node))}handleGlobalConfigurationChange(){this._transition("global-configuration")}handleSyrupLoad(){this._transition("syrup-load")}handleFallback(e,t){const i=Ze.didFallback&&Ze.fallbackType||e;i&&this._logFallback(i,t),this._fallbackInfo={reason:e,message:t},this._transition("fallback")}handleUpgrade(){this._fallbackInfo=void 0,this._transition("upgrade")}handleRecreate(){this._transition("recreate")}handleMapConfigurationChange(){this._transition("map-configuration"),this._previousNode&&this._previousNode.configuration&&(this._previousNode.language=Ze.language,this._previousNode.configuration=Ze.types[this._map.mapType])}handleSyrupComplete(){this._transition("syrup-complete")}handlePrintMatch(){this._transition("print-match")}handlePrintUnmatch(){this._transition("print-unmatch")}handleMapRendered(){this.node instanceof rl&&(this.node.forcedSnapsToIntegralZoomLevels=!1,this._removePreviousMapNode(!0))}setPointOfInterestFilter(e){this._previousNode&&(this._previousNode.pointOfInterestFilter=e)}setTintAndEmphasis(e,t,i){this._previousNode&&this._previousNode.setTintAndEmphasis(e,t,i)}mapCameraDidChange(){this._previousNode&&this._previousNode.setCameraAnimated(this.node.camera.copy())}_transition(e){const t=_l[this._state][e];t&&this._updateState(t)}_updateState(e){this._state=e;const t=this["_enter_"+e];"function"==typeof t&&t.call(this)}_loadSyrupIfNeeded(e){pl().then((()=>{e.call(this,!!window.Syrup||!!window.Spile&&!!window.Spile.Syrup)}))}_insertSceneGraphNode(){this.usingSSR&&(this.node.isRotationEnabled=!1);const e=new Nr;this._insertNewMapNode(e),this._map.didFinishMapNodeInitialization(e)}_enter_sg_grid(){this._insertSceneGraphNode(),Ze.ready&&!Ze.canRunCSR&&this._updateState("sg_ready")}_enter_sg_insert(){this._insertSceneGraphNode(),Ze.ready&&this._updateState("sg_ready")}_enter_syrup_insert(){const e=new rl;e.pendingConfigurationUpdates={},this._insertNewMapNode(e),Ze.state===Ze.States.READY&&this._updateState("syrup_need_load")}_insertNewMapNode(e){const t=this._initialOptions||{};this._initialOptions||this.node._impl._cameraWillChange(this.node,!1);const i=this.node;if(i)this._removePreviousMapNode(),i.migrateStateTo(e),i.removeEventListener("reconfigured",this),i.deactivate(),this._layers.forEach((e=>{i._impl.cleanupLayer(e),i._impl.removeLayer(e)})),this._previousNode=i,this._map.didSetPreviousMapNode(i);else{e.allowWheelToZoom=void 0!==t._allowWheelToZoom&&!!t._allowWheelToZoom,e.allowWheelToZoom2=void 0===t._allowWheelToZoom2||!!t._allowWheelToZoom2,e.pannable=void 0===t.isScrollEnabled||!!t.isScrollEnabled,e.zoomable=void 0===t.isZoomEnabled||!!t.isZoomEnabled,void 0!==t.pointOfInterestFilter?(void 0!==t.showsPointsOfInterest&&console.warn("[MapKit] `showsPointsOfInterest` is ignored because `pointOfInterestFilter` is set."),null!==t.pointOfInterestFilter&&m(t.pointOfInterestFilter,$e,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),e.pointOfInterestFilter=t.pointOfInterestFilter):void 0!==t.showsPointsOfInterest&&(t.showsPointsOfInterest?e.pointOfInterestFilter=null:e.pointOfInterestFilter=$e.filterExcludingAllCategories),e.showsDefaultTiles=void 0===t._showsDefaultTiles||!!t._showsDefaultTiles;for(const i of yl.InitialOptionsHandlers)i.call(this,e,t)}this.node=e,this.node.addEventListener("reconfigured",this),this._map.didInsertNewMapNode(e),this._layers.forEach((t=>{e._impl.prepareLayer(t),e._impl.addLayer(t)})),this._initialOptions?delete this._initialOptions:this.node._impl._cameraDidChange(this.node,!1)}_removePreviousMapNode(e){if(this._previousNode)if(e){if(this._previousNode.animators&&this._previousNode.animators.length)return;const e=this._previousNode;new vl({node:this._previousNode,duration:150,from:1,to:0,customCanvas:this._previousNode.customCanvas,done:()=>{e===this._previousNode&&this._removePreviousMapNode(!1)}}).begin()}else this._previousNode.destroy(!0),this._previousNode.remove(),this._previousNode=null}_enter_syrup_need_load(){if(k((Ze.state,Ze.States.READY)),k(this.node),k(this.node.pendingConfigurationUpdates),this.shouldDynamicallyLoadSyrup){if(this.loadPriority&&this._previousNode&&this._previousNode instanceof Nr&&!this._previousNode.configuration)if(0!==this.node.rotation)0;else{const e=this.loadPriority===Vs.PointsOfInterest;this._previousNode.snapsToIntegralZoomLevels=e,this._previousNode.labels=e,e&&(this.node.forcedSnapsToIntegralZoomLevels=!0,this.node.setZoomLevelAnimated(Bo.getIntegralZoom(this.node.zoomLevel))),this._previousNode.language=Ze.language,this._previousNode.configuration=Ze.types[this._map.mapType],k(this._previousNode.delegate),this._previousNode.delegate={mapDidFinishRendering:e=>this._map.previousMapDidFinishRendering(e)},this._previousNode.setCameraBoundaryAnimated(null),this._previousNode.setCameraZoomRangeAnimated(null)}this._loadSyrupIfNeeded((e=>{e?this.handleSyrupLoad():(Ze.syrupRequestedFallback(),this.handleFallback(Us.NETWORK_ERROR))}))}else this.handleFallback(Us.BROWSER_SUPPORT_ERROR)}_enter_syrup_init(){if(!this.node)return;if(k(Ze.types[this._map.mapType]),k(this.node),k(this.node.pendingConfigurationUpdates),!Ze.madabaDomains||!Ze.madabaDomains.length)return this._csrWarning("Network error"),void this.handleFallback(Us.CONFIG_MISSING);const e="object"==typeof Syrup?Syrup.SyrupRenderer:Spile.getRendererWithoutAnyWarranty(),t="object"==typeof Syrup?Syrup.Camera:Spile.Syrup.Camera;this._switchedToLoCSR=!1,Ze.forcedRenderingMode&&(this._switchedToLoCSR="HYBRID"===Ze.forcedRenderingMode);const i=this.node;this._reConfigureMapNode();const s=Ze.performanceMarkers.rendering?performance.now():void 0;i.init(Ze,e,t,{startInLoCSR:this._switchedToLoCSR,contextType:this._webglCheckResult.webGL.contextType,performanceMarkers:Ze.performanceMarkers.rendering},(e=>{Ze.performanceMarkers.rendering&&performance.measure("mapkit-syrup-init",{start:s}),e?(this._csrWarning(e),this.handleFallback(e.type||Us.UNKNOWN_ERROR,e.message)):(this._reConfigureMapNode(),i.needsDisplay=!0,this._map.didFinishMapNodeInitialization(i),this.handleSyrupComplete())}))}_csrWarning(e){console.warn("[MapKit] CSR is unavailable. "+e)}_enter_syrup_network_stalled(){this.node.updateNetworkConfiguration(Ze)}_enter_sg_ready(){this._removePreviousMapNode(),this.node.snapsToIntegralZoomLevels=!0,this.node.isRotationEnabled=!1,"HYBRID"!==Ze.forcedRenderingMode&&"CLIENT"!==Ze.forcedRenderingMode||(this._map.mapNodeDidFail(this._fallbackInfo),console.warn("[MapKit] Not rendering raster tiles under forced client rendering."),this.node.showsDefaultTiles=!1),this._reConfigureMapNode(),this._map.mapNodeReady(!1),this._layers.forEach((e=>{e._impl.contextFailed()}))}_enter_syrup_ready(){k(Ze.types[this._map.mapType]),k(this.node),!this.node.fullyRendered&&this._previousNode&&this._previousNode.configuration?(this._previousNode.language=Ze.language,this._previousNode.configuration=Ze.types[this._map.mapType]):this._removePreviousMapNode(),this._reConfigureMapNode(),this.node.updateNetworkConfiguration(Ze),this.node.makePendingConfigurationUpdates(),this._map.mapNodeReady(!0)}_reConfigureMapNode(){this.node.language=Ze.language,this.node.configuration=Ze.types[this._map.mapType],this.node._impl.debug||(this.node._impl.debug=!!Ze.showsTileInfo),this._map.didReconfigureMapNode(this.node)}_enter_syrup_printing(){this.node.forceRerender(),this.node.needsDisplay=!0}_sendAnalytics(e){const t=Ze.applyProxyPrefix("https://gsp10.apple-mapkit.com/hvr/mw/v1/spile"),i={};e&&(i.ssrFallback=e);new ml(t,{getDataToSend:function(e){return e.setRequestHeader("Content-Type","text/plain"),e.responseType="text",JSON.stringify(i)}},{method:"POST",priority:gl.Low,withCredentials:Ze.urlWithCredentials(t)}).schedule()}_logFallback(e,t){const i=Qt.uaParserInfo.browserInfo,s=Qt.uaParserInfo.deviceInfo,o=this._usingCSRAPI();this._sendAnalytics({reason:e,message:t,usingCSRAPI:o,devicePlatform:s.platform,deviceOs:s.os,browserName:i.name,browserVersion:i.version})}_usingCSRAPI(){return!(this._map._showsCompass!==Xs.Visible&&(this._map._showsCompass!==Xs.Adaptive||this._map._usingDefaultShowsCompassValue)&&0===this._map.rotation&&!this._map._annotationsController.containsMarkerAnnotation())}}yl.InitialOptionsHandlers=[];class vl extends pn{constructor(e){super(e),this.customCanvas=e.customCanvas}update(e){this.customCanvas&&(this.customCanvas.style.opacity=this.valueAt(e)),super.update(e)}}const bl=yl,wl=(e,t,i)=>{const s=e.createShader(t);e.shaderSource(s,i),e.compileShader(s);if(e.getShaderParameter(s,e.COMPILE_STATUS))return s;e.deleteShader(s)};const Cl=function(e){this._impl={scene:e,failed:!1,prepare(e){if(this.failed)return;const t=wl(e,e.VERTEX_SHADER,"\nattribute vec2 a_position;\nvarying vec2 v_texcoord;\nvoid main() {\n gl_Position = vec4((a_position * 2.0 - 1.0) * vec2(1, -1), 0, 1);\n v_texcoord = a_position;\n}\n"),i=wl(e,e.FRAGMENT_SHADER,"precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nvoid main() {\n gl_FragColor = texture2D(u_texture, v_texcoord);\n}");this.program=((e,t,i)=>{const s=e.createProgram();if(e.attachShader(s,t),e.attachShader(s,i),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS))return s;e.deleteProgram(s)})(e,t,i)},release(e){this.failed||e.deleteProgram(this.program)},added(e){this.prepare(e)},removed(e){this.release(e)},render(e,t){if(this.failed)return;const i=this.program,s=e.getAttribLocation(i,"a_position"),o=e.getUniformLocation(i,"u_texture"),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);const a=e.canvas.width,r=e.canvas.height;e.viewport(0,0,a,r),e.useProgram(this.program),e.enableVertexAttribArray(s),e.bindBuffer(e.ARRAY_BUFFER,n);const l=e.createTexture();e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.scene.element),e.generateMipmap(e.TEXTURE_2D),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),e.uniform1i(o,0),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,6)},contextFailed(){this.failed=!0}}},kl={"logo-autonavi":{xMin:.132,xMax:.828},"logo-autonavi-rtl":{xMin:.127,xMax:.833},"logo-autonavi-satellite":{xMin:.132,xMax:.828},"logo-autonavi-satellite-rtl":{xMin:.186,xMax:.862},"logo-wordmark-ca-ES":{xMin:.042,xMax:.62},"logo-wordmark-ar-SA":{xMin:.371,xMax:.956},"logo-wordmark-el-GR":{xMin:.042,xMax:.666},"logo-wordmark-de-DE":{xMin:.042,xMax:.606},"logo-wordmark-cs-CZ":{xMin:.042,xMax:.541},"logo-wordmark-da-DK":{xMin:.042,xMax:.438},"logo-wordmark-en-US":{xMin:.042,xMax:.535},"logo-wordmark-en-GB":{xMin:.042,xMax:.535},"logo-wordmark-es-ES":{xMin:.042,xMax:.618},"logo-wordmark-es-MX":{xMin:.042,xMax:.618},"logo-wordmark-fr-FR":{xMin:.042,xMax:.53},"logo-wordmark-fi-FI":{xMin:.042,xMax:.57},"logo-wordmark-fr-CA":{xMin:.042,xMax:.53},"logo-wordmark-he-IL":{xMin:.49,xMax:.955},"logo-wordmark-id-ID":{xMin:.042,xMax:.457},"logo-wordmark-hi-IN":{xMin:.042,xMax:.52},"logo-wordmark-it-IT":{xMin:.042,xMax:.632},"logo-wordmark-hr-HR":{xMin:.042,xMax:.52},"logo-wordmark-hu-HU":{xMin:.042,xMax:.782},"logo-wordmark-ja-JP":{xMin:.042,xMax:.505},"logo-wordmark-ko-KR":{xMin:.042,xMax:.413},"logo-wordmark-nl-NL":{xMin:.042,xMax:.686},"logo-wordmark-ms-MY":{xMin:.042,xMax:.457},"logo-wordmark-pl-PL":{xMin:.042,xMax:.541},"logo-wordmark-nb-NO":{xMin:.042,xMax:.436},"logo-wordmark-ro-RO":{xMin:.042,xMax:.488},"logo-wordmark-pt-BR":{xMin:.042,xMax:.618},"logo-wordmark-satellite-ar-SA":{xMin:.328,xMax:.917},"logo-wordmark-satellite-cs-CZ":{xMin:.003,xMax:.507},"logo-wordmark-satellite-ca-ES":{xMin:.003,xMax:.584},"logo-wordmark-pt-PT":{xMin:.042,xMax:.618},"logo-wordmark-ru-RU":{xMin:.042,xMax:.595},"logo-wordmark-satellite-el-GR":{xMin:.003,xMax:.63},"logo-wordmark-satellite-da-DK":{xMin:.003,xMax:.402},"logo-wordmark-satellite-de-DE":{xMin:.003,xMax:.57},"logo-wordmark-satellite-en-GB":{xMin:.003,xMax:.499},"logo-wordmark-satellite-en-US":{xMin:.003,xMax:.499},"logo-wordmark-satellite-es-ES":{xMin:.003,xMax:.582},"logo-wordmark-satellite-es-MX":{xMin:.003,xMax:.582},"logo-wordmark-satellite-fr-FR":{xMin:.003,xMax:.494},"logo-wordmark-satellite-fi-FI":{xMin:.003,xMax:.534},"logo-wordmark-satellite-hi-IN":{xMin:.003,xMax:.483},"logo-wordmark-satellite-he-IL":{xMin:.448,xMax:.917},"logo-wordmark-satellite-id-ID":{xMin:.003,xMax:.421},"logo-wordmark-satellite-fr-CA":{xMin:.003,xMax:.494},"logo-wordmark-satellite-hr-HR":{xMin:.003,xMax:.481},"logo-wordmark-satellite-ja-JP":{xMin:.003,xMax:.469},"logo-wordmark-satellite-it-IT":{xMin:.003,xMax:.596},"logo-wordmark-satellite-nb-NO":{xMin:.003,xMax:.4},"logo-wordmark-satellite-nl-NL":{xMin:.003,xMax:.651},"logo-wordmark-satellite-hu-HU":{xMin:.003,xMax:.749},"logo-wordmark-satellite-pl-PL":{xMin:.003,xMax:.507},"logo-wordmark-satellite-pt-BR":{xMin:.003,xMax:.582},"logo-wordmark-satellite-ms-MY":{xMin:.003,xMax:.421},"logo-wordmark-satellite-ro-RO":{xMin:.003,xMax:.453},"logo-wordmark-satellite-ru-RU":{xMin:.003,xMax:.559},"logo-wordmark-satellite-pt-PT":{xMin:.003,xMax:.582},"logo-wordmark-satellite-ko-KR":{xMin:.003,xMax:.377},"logo-wordmark-satellite-th-TH":{xMin:.003,xMax:.499},"logo-wordmark-satellite-sl-SI":{xMin:.003,xMax:.812},"logo-wordmark-satellite-sk-SK":{xMin:.003,xMax:.507},"logo-wordmark-satellite-tr-TR":{xMin:.003,xMax:.529},"logo-wordmark-satellite-zh-CN":{xMin:.003,xMax:.374},"logo-wordmark-satellite-uk-UA":{xMin:.003,xMax:.541},"logo-wordmark-satellite-zh-HK":{xMin:.003,xMax:.374},"logo-wordmark-satellite-vi-VN":{xMin:.003,xMax:.586},"logo-wordmark-sv-SE":{xMin:.042,xMax:.577},"logo-wordmark-sl-SI":{xMin:.042,xMax:.852},"logo-wordmark-satellite-sv-SE":{xMin:.003,xMax:.541},"logo-wordmark-sk-SK":{xMin:.042,xMax:.541},"logo-wordmark-tr-TR":{xMin:.042,xMax:.564},"logo-wordmark-vi-VN":{xMin:.042,xMax:.621},"logo-wordmark-th-TH":{xMin:.042,xMax:.535},"logo-wordmark-zh-CN":{xMin:.042,xMax:.41},"logo-wordmark-uk-UA":{xMin:.042,xMax:.577},"logo-wordmark-satellite-zh-TW":{xMin:.003,xMax:.374},"logo-wordmark-zh-HK":{xMin:.042,xMax:.41},"logo-wordmark-zh-TW":{xMin:.042,xMax:.41}},Sl="satellite",Ml="autonavi";function Ll(e,t,i,s){const o=e._delegate,n=function(e,t,i){let s=["logo-wordmark"];i&&(s=["logo",Ml]);e&&s.push(Sl);i&&t&&s.push("rtl");i||s.push(es.localeId);return s.join("-")}(i,e.rtl,s),a="logos/"+n,r=s?[1,2,3]:[1],l=s||1===Bo.devicePixelRatio?".png":".svg",h=It.createImageUrl(Bo.imagePathForDevice(r,a,l)),c=kl[n];c&&o.logoUpdated(c),t.classList.toggle("mk-logo-autonavi",s),t.element.crossOrigin=fa.getCorsAttribute(Ze.urlWithCredentials(h)),t.setAttribute("src",h)}const xl=class extends _o{constructor(e){const t=Bo.htmlElement("img");super(Bo.htmlElement("div",{class:e.logoEnablesContainerQuery?"mk-cq-logo-control":"mk-logo-control"},t)),this._delegate=e,this._logoElement=t,this._logoElementNode=new _o(this._logoElement),this._logoElementNode.classList.add("mk-logo"),this.tint=void 0,es.addEventListener(es.Events.LocaleChanged,this),Ze.addEventListener(Ze.Events.Changed,this),this.rtl=es.activeLocale.rtl}updateWithMapNodeTint(e){k(d(e,Fs)),this.tint=e;const t=Bo.darkColorScheme(e),i=this._logoElementNode;if(Ze.state===Ze.States.UNINITIALIZED){const e=()=>{Ze.removeEventListener(Ze.Events.Initialized,e),Ll(this,i,t,Ze.isAutoNavi&&!this._delegate.alwaysShowAppleMapsLogo)};Ze.addEventListener(Ze.Events.Initialized,e)}else Ll(this,i,t,Ze.isAutoNavi&&!this._delegate.alwaysShowAppleMapsLogo);const s=Ze.tileProvider?Ze.tileProvider:Ze.TileProviders.Apple;i.setAttribute("alt",es.get("Logo."+s+".Tooltip"))}handleEvent(e){switch(e.type){case es.Events.LocaleChanged:this.rtl=e.locale.rtl,this._handleLocaleChange(e);break;case Ze.Events.Changed:if(!this.tint)return void k(this.parent);this.updateWithMapNodeTint(this.tint)}}destroy(){es.removeEventListener(es.Events.LocaleChanged,this),Ze.removeEventListener(Ze.Events.Changed,this)}_handleLocaleChange(e){this.tint?this.updateWithMapNodeTint(this.tint):k(this.parent)}};function Al(e,t){Tl(e,t),t.add(e)}function El(e,t,i){Tl(e,t),t.set(e,i)}function Tl(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Il(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}function Ol(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Pl(e,t,"get"))}function Rl(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Pl(e,t,"set"),i),i}function Pl(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}var Dl=new WeakMap,zl=new WeakMap,Nl=new WeakMap,Fl=new WeakMap,Ul=new WeakMap,Gl=new WeakSet,Wl=new WeakMap,Bl=new WeakSet;function Zl(e){this.mapType&&this.updateWithMapType(this.mapType)}function Kl([{contentRect:{width:e,height:t}}]){S(Ol(this,Dl)),Ol(this,Dl).sizeDidUpdate?.call(Ol(this,Dl),{width:e,height:t})}const jl=class extends _o{constructor(e={}){const{enableContainerQuery:t=!1,showsImageryLink:i=!1,showsReportLink:s=!1,detectSizeChange:o=!1}=e;var n,a,r;if(super(i||s?Bo.htmlElement("div",{class:t?"mk-legal mk-cq-legal":"mk-legal"}):Bo.htmlElement("a",{target:"_blank",tabindex:0,class:t?"mk-legal mk-cq-legal":"mk-legal"})),Al(this,Bl),Al(this,Gl),El(this,Dl,{writable:!0,value:void 0}),El(this,zl,{writable:!0,value:void 0}),El(this,Nl,{writable:!0,value:void 0}),El(this,Fl,{writable:!0,value:void 0}),r=void 0,(a="anchorNode")in(n=this)?Object.defineProperty(n,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[a]=r,El(this,Ul,{writable:!0,value:e=>Il(this,Gl,Zl).call(this,e)}),El(this,Wl,{writable:!0,value:void 0}),Rl(this,Dl,e),i||s){const e=Bo.htmlElement("a",{target:"_blank",tabindex:0,class:"mk-legal-link"});this.anchorNode=new _o(e),this.element.appendChild(e);const t=Bo.htmlElement("span",{class:"mk-legal-label"},es.get("Legal.Label"));this._labelNode=new _o(t),e.appendChild(this._labelNode.element)}else{this.anchorNode=this;const e=Bo.htmlElement("span",{class:"mk-legal-label"},es.get("Legal.Label"));this._labelNode=new _o(e),this.element.appendChild(this._labelNode.element)}if(i){const e=Bo.htmlElement("span",{class:"mk-legal-label"}," | ");this.element.appendChild(e);const t=Bo.htmlElement("a",{target:"_blank",tabindex:0,class:"mk-legal-link",href:"https://maps.apple.com/imagecollection/"});this.element.appendChild(t);const i=Bo.htmlElement("span",{class:"mk-legal-label mk-legal-imagery"},es.get("Legal.Label.Imagery"));Rl(this,zl,new _o(i)),t.appendChild(Ol(this,zl).element)}if(s){const e=Bo.htmlElement("span",{class:"mk-legal-label"}," | ");this.element.appendChild(e);const t=Bo.htmlElement("a",{target:"_blank",tabindex:0,class:"mk-legal-link"});Rl(this,Nl,new _o(t)),this.element.appendChild(t);const i=Bo.htmlElement("span",{class:"mk-legal-label mk-legal-report"},es.get("Legal.Label.Report"));Rl(this,Fl,new _o(i)),t.appendChild(Ol(this,Fl).element)}es.addEventListener(es.Events.LocaleChanged,Ol(this,Ul)),o&&(Rl(this,Wl,new ResizeObserver((e=>Il(this,Bl,Kl).call(this,e)))),Ol(this,Wl).observe(this.element))}updateWithMapType(e){if(this.mapType=e,this._labelNode.element.textContent=es.get("Legal.Label"),Ol(this,zl)&&(Ol(this,zl).element.textContent=es.get("Legal.Label.Imagery")),Ol(this,Fl)&&(Ol(this,Fl).element.textContent=es.get("Legal.Label.Report")),Ze.isAutoNavi)if(Ze.ready){const e=Ze.types[this.mapType]?.tileSources[0];S(),e.attribution&&e.attribution.url&&this.anchorNode.setAttribute("href",e.attribution.url)}else this.anchorNode.removeAttribute("href");else this.anchorNode.setAttribute("href",es.get("Legal.Apple.URL"))}updateReportLink(e){e?(Ol(this,Nl)?.setAttribute("href",e),Ol(this,Nl)?.removeAttribute("data-error")):(Ol(this,Nl)?.removeAttribute("href"),Ol(this,Nl)?.setAttribute("data-error",""))}destroy(){es.removeEventListener(es.Events.LocaleChanged,Ol(this,Ul)),Ol(this,Wl)?.disconnect(),Rl(this,Dl,void 0)}};function Hl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const ql={CONTROL:"mk-control",DISABLED:"mk-disabled",FOCUS:"mk-focus"};class Vl{constructor(e){this._control=e}destroy(){window.removeEventListener(Bo.startEventType,this._control._cancelFocusEventListener,!0),this._removeEventListeners(),delete this._control}handleEvent(e){switch(k(this._control.enabled&&this._control.parent||(e.type,es.Events.LocaleChanged)),e.type){case"click":this._click(e);break;case Bo.startEventType:this._touchesBegan(e);break;case Bo.moveEventType:this._control.touchesMoved(e);break;case Bo.endEventType:this._removeEventListeners(),this._control.touchesEnded(e);break;case Bo.cancelEventType:this._removeEventListeners(),this._control.touchesCanceled(e);break;case"keydown":this._keyDown(e);break;case"keyup":this._keyUp(e);break;case"focus":this._focus(e);break;case"blur":this._blur(e);break;case es.Events.LocaleChanged:this._control.localeChanged(e);break;default:k()}}_click(e){this._swallowEvent(e),this._control.clicked(e)}_touchesBegan(e){this._swallowEvent(e);("mousedown"===e.type||"pointerdown"===e.type&&"mouse"===e.pointerType)&&(0!==e.button||e.ctrlKey)||(window.addEventListener(Bo.moveEventType,this,!0),window.addEventListener(Bo.endEventType,this,!0),Bo.cancelEventType&&window.addEventListener(Bo.cancelEventType,this,!0),this._control.touchesBegan(e))}_keyDown(e){switch(e.keyCode){case t:this._control.escapeKeyDown(e);break;case i:e.preventDefault(),this._control.spaceBarKeyDown(e);break;case a:e.preventDefault(),this._control.downArrowKeyDown(e);break;case o:e.preventDefault(),this._control.upArrowKeyDown(e);break;case n:e.preventDefault(),this._control.rightArrowKeyDown(e);break;case s:e.preventDefault(),this._control.leftArrowKeyDown(e)}}_keyUp(e){switch(e.keyCode){case t:this._control.escapeKeyUp(e);break;case a:e.preventDefault(),this._control.downArrowKeyUp(e);break;case o:e.preventDefault(),this._control.upArrowKeyUp(e);break;case n:e.preventDefault(),this._control.rightArrowKeyUp(e);break;case s:e.preventDefault(),this._control.leftArrowKeyUp(e);break;case i:e.preventDefault(),this._control.spaceBarKeyUp(e)}}_focus(e){if(this._control.hasFocus)return void 0;Bo.containingDocumentOrShadowRoot(this._control.element).activeElement===e.target&&(this._control.hasFocus=!0,this._control.classList.add(ql.FOCUS),window.addEventListener(Bo.startEventType,this._control._cancelFocusEventListener,!0),this._control.focused(e))}_blur(e){this._control.hasFocus&&(this._control.hasFocus=!1,window.removeEventListener(Bo.startEventType,this._control._cancelFocusEventListener,!0),this._control.classList.remove(ql.FOCUS),this._control.blurred(e))}_removeEventListeners(){window.removeEventListener(Bo.moveEventType,this,!0),window.removeEventListener(Bo.endEventType,this,!0),Bo.cancelEventType&&window.removeEventListener(Bo.cancelEventType,this,!0)}_swallowEvent(e){e.preventDefault(),e.stopPropagation()}}class Yl{constructor(e){this._control=e}destroy(){delete this._control}handleEvent(e){k(this._control.enabled),k(this._control.parent),this._control.blurFocusedElement(e)}}class Xl{constructor(e){this._control=e}destroy(){delete this._control}handleEvent(e){switch(k(this._control.enabled),k(this._control.parent),e.type){case"focus":this._control.pageHasFocus||(this._control.pageHasFocus=!0,this._control.pageDidFocus(e));break;case"blur":this._control.pageHasFocus=!1,this._control.pageDidBlur(e)}}}const $l=class extends _o{constructor(e){super(e),Hl(this,"addEventListener",P.prototype.addEventListener),Hl(this,"removeEventListener",P.prototype.removeEventListener),Hl(this,"dispatchEvent",P.prototype.dispatchEvent),this.classList.add(ql.CONTROL),void 0===this._enabled&&(this._enabled=!1),void 0===this.hasFocus&&(this.hasFocus=!1),void 0===this.pageHasFocus&&(this.pageHasFocus=!1)}get enabled(){return this._enabled}set enabled(e){const t=!!e;this._enabled!==t&&(t?this.enable():this.disable(),this._enabled=t,this.reset())}set canShowTooltips(e){e?this._updateLabels():this._clearLabels()}willMoveToParent(e){e?this.parent||(this._createListeners(),es.addEventListener(es.Events.LocaleChanged,this._eventListener),this.enabled&&(this._addFocusAndBlurListeners(),this._addKeyboardListeners(),this.addEventListeners())):(es.removeEventListener(es.Events.LocaleChanged,this._eventListener),this.removeEventListeners(),this._removeFocusAndBlurListeners(),this._removeKeyboardListeners(),this._destroyListeners())}enable(){this.classList.remove(ql.DISABLED),this._createListeners(),this.element.addEventListener(Bo.startEventType,this._eventListener),this.element.addEventListener("click",this._eventListener),this.parent&&(this._addFocusAndBlurListeners(),this._addKeyboardListeners(),this.addEventListeners())}disable(){this.classList.add(ql.DISABLED),this.element.removeEventListener(Bo.startEventType,this._eventListener),this.element.removeEventListener("click",this._eventListener),this.removeEventListeners(),this._removeFocusAndBlurListeners(),this._removeKeyboardListeners()}blurFocusedElement(e){k(this.hasFocus);const t=Bo.getShadowDOMTargetFromEvent(this.element,e);if(!this.element.contains(t)){const e=Bo.containingDocumentOrShadowRoot(this.element);e.activeElement&&this.element.contains(e.activeElement)&&e.activeElement.blur()}}reset(){}saveEndEventProps(e){if(e&&e.type===Bo.endEventType){const t=e.changedTouches?e.changedTouches[0]:e;this._endEventProps=[t.clientX,t.clientY,t.screenX,t.screenY]}}checkClickEventProps(e){if(!this._endEventProps)return!1;const t=[e.clientX,e.clientY,e.screenX,e.screenY];let i=!0;for(let e=0;e<t.length;e++)if(Math.abs(this._endEventProps[e]-t[e])>1){i=!1;break}return delete this._endEventProps,i}clicked(){}touchesBegan(e){}touchesMoved(e){}touchesEnded(e){}touchesCanceled(e){}spaceBarKeyDown(e){}spaceBarKeyUp(e){}escapeKeyDown(e){}escapeKeyUp(e){}downArrowKeyUp(e){}downArrowKeyDown(e){}upArrowKeyUp(e){}upArrowKeyDown(e){}rightArrowKeyUp(e){}leftArrowKeyUp(e){}rightArrowKeyDown(e){}leftArrowKeyDown(e){}focused(e){}blurred(e){}pageDidFocus(e){}pageDidBlur(e){}updateTintColor(e){}removeEventListeners(){}addEventListeners(){}localeChanged(){}_clearLabels(){Bo.updateLabel(this.element,"")}_createListeners(){this._eventListener||(this._eventListener=new Vl(this)),this._windowEventListener||(this._windowEventListener=new Xl(this)),this._cancelFocusEventListener||(this._cancelFocusEventListener=new Yl(this))}_destroyListeners(){this._eventListener&&(this.element.removeEventListener(Bo.startEventType,this._eventListener),this.element.removeEventListener("click",this._eventListener),this._eventListener.destroy(),delete this._eventListener),this._windowEventListener&&(this._windowEventListener.destroy(),delete this._windowEventListener),this._cancelFocusEventListener&&(this._cancelFocusEventListener.destroy(),delete this._cancelFocusEventListener)}_addFocusAndBlurListeners(){this.element.addEventListener("focus",this._eventListener,!0),this.element.addEventListener("blur",this._eventListener,!0),window.addEventListener("focus",this._windowEventListener),window.addEventListener("blur",this._windowEventListener),this.hasFocus=Bo.containingDocumentOrShadowRoot(this.element).activeElement===this.element}_removeFocusAndBlurListeners(){this.element.removeEventListener("focus",this._eventListener,!0),this.element.removeEventListener("blur",this._eventListener,!0),window.removeEventListener(Bo.startEventType,this._cancelFocusEventListener,!0),window.removeEventListener("focus",this._windowEventListener),window.removeEventListener("blur",this._windowEventListener)}_addKeyboardListeners(){this.element.addEventListener("keydown",this._eventListener),this.element.addEventListener("keyup",this._eventListener)}_removeKeyboardListeners(){this.element.removeEventListener("keydown",this._eventListener),this.element.removeEventListener("keyup",this._eventListener)}};const Jl={CONTROL:"mk-popover",ARROW:"mk-popover-arrow",SHOWN:"mk-shown"};const Ql=class extends _o{constructor(){super(Bo.htmlElement("div",{class:Jl.CONTROL,role:"dialog",tabindex:"-1"})),this.element.appendChild(Bo.createSVGIcon(Bo.svgElement("g",Bo.svgElement("rect",{y:12,x:0,height:2,width:30}),Bo.svgElement("path",{d:"M0 13v-.5c4.038 0 8.305-3.53 12.835-10.477.454-.71 1.005-1.137 1.564-1.326h.001a2.07 2.07 0 011.814.225c.273.175.505.407.68.68C21.525 8.829 25.881 12.5 30 12.5v.5"})),{class:Jl.ARROW,"aria-hidden":!0,width:30,height:14}))}open(){this.classList.add(Jl.SHOWN)}handleEvent(e){this.classList.contains(Jl.SHOWN)&&this.focus()}focus(){this.element.focus()}close(){this.classList.remove(Jl.SHOWN)}didMoveToParent(e){e?this.element.addEventListener("transitionend",this):this.element.removeEventListener("transitionend",this)}};const eh={CONTROL:"mk-map-type-button",LIGHT_ICON:"mk-light-icon",DARK_ICON:"mk-dark-icon"};function th(e,t){const i=["icons/map-type"];return i.push(e.toLowerCase()),t&&i.push("dark"),It.createImageUrl(Bo.imagePathForDevice([1,2],i.join("-"),".png"))}const ih=class extends _o{constructor(e,t,i){super(Bo.htmlElement("label",{class:eh.CONTROL})),this.delegate=i,this.mapType=e,this.enabled=!1,this._handleChangeEventListener=()=>this._handleChangeEvent();const s=i.mapTypes[e]===i.mapType,o=es.get("Mode."+e),n=Bo.htmlElement("input",{type:"radio",name:t,"aria-label":o,tabindex:"0"});n.checked=s,this.radioElement=n,this.element.appendChild(n);const a=function(e,t){const i=[];if(t[e]===t.Standard){const t=th(e,!1);i.push(Bo.htmlElement("img",{class:eh.LIGHT_ICON,"aria-hidden":!0,crossOrigin:fa.getCorsAttribute(Ze.urlWithCredentials(t)),src:t}));const s=th(e,!0);i.push(Bo.htmlElement("img",{class:eh.DARK_ICON,"aria-hidden":!0,crossOrigin:fa.getCorsAttribute(Ze.urlWithCredentials(s)),src:s}))}else{const t=th(e,!1);i.push(Bo.htmlElement("img",{"aria-hidden":!0,crossOrigin:fa.getCorsAttribute(Ze.urlWithCredentials(t)),src:t}))}return i}(e,i.mapTypes);a.forEach((e=>this.element.appendChild(e)))}focus(){this.radioElement.focus()}setSelected(){this.element.firstChild.checked=!0}updateLabels(){const e=es.get("Mode."+this.mapType);this.radioElement.setAttribute("aria-label",e)}activate(){this.radioElement.addEventListener("change",this._handleChangeEventListener),this._handleChangeEvent()}deactivate(){this.radioElement.removeEventListener("change",this._handleChangeEventListener)}_handleChangeEvent(){this.radioElement.checked&&this._handleSelected(this.radioElement.checked)}_handleSelected(){this.delegate.mapType=this.delegate.mapTypes[this.mapType]}},sh=["Standard","Hybrid","Satellite"];const oh={POPOVER:"mk-map-type-popover",MAP_TYPE_LABEL:"mk-map-type-label"},nh=class extends Ql{constructor(e){super(),this.classList.add(oh.POPOVER),this.setAttribute("aria-label",es.get("MapType.Tooltip")),this.delegate=e,this.buttons={},this.labels={};const t=`mk-map-type-button-${Math.random().toString(32).substring(2)}`;sh.forEach((i=>{const s=new _o,o=new ih(i,t,e);s.addChild(o);const n=new _o(Bo.htmlElement("div",{"aria-hidden":"true",class:oh.MAP_TYPE_LABEL}));n.element.textContent=es.get("Mode."+i),s.addChild(n),this.addChild(s),this.buttons[i]=o,this.labels[i]=n,e.mapTypes[i]===e.mapType&&(this.selectedButton=o)}))}focus(){this.selectedButton.focus()}updateSelected(){const e=sh.find((e=>this.delegate.mapTypes[e]===this.delegate.mapType));this.selectedButton=this.buttons[e],this.selectedButton.setSelected()}updateLabels(){this.setAttribute("aria-label",es.get("MapType.Tooltip")),sh.forEach((e=>{this.labels[e].element.textContent=es.get("Mode."+e),this.buttons[e].updateLabels()}))}didMoveToParent(e){super.didMoveToParent(e),e?sh.forEach((e=>this.buttons[e].activate())):sh.forEach((e=>this.buttons[e].deactivate()))}},ah="data-l10n-key";class rh{constructor(e){this._control=e}get mapTypes(){return this._control.mapTypes}get mapType(){return this._control.mapType}set mapType(e){this._control.mapType=e}}const lh="mk-map-type-control",hh="mk-pressed";class ch extends $l{constructor(e,t,i){super(Bo.htmlElement("div",{role:"button",tabindex:"0"})),this.classList.add(lh),this._delegate=new rh(this),this._focusDelegate=i;const s=function(){const e=Bo.svgElement("path"),t=Bo.createSVGIcon(e,{});return t.setAttribute("viewBox","0 0 45 24"),[t,e]}();this.element.appendChild(s[0]),this._iconElement=s[1],this._mapType=t,this._mapTypes=e,this._updateIcon(),this._updateLabels(),this.enabled=!0,this._isOpen=!1}get mapType(){return this._mapType}set mapType(e){e!==this._mapType&&(this._mapType=e,this._updateIcon(),this.popover.updateSelected(),this.dispatchEvent(new F.Event(ch.EVENTS.MAP_TYPE_CHANGE)))}get mapTypes(){return this._mapTypes}localeChanged(e){this._updateLabels(),this.popover.updateLabels()}touchesBegan(e){this._pressed()}touchesEnded(e){this.reset()}clicked(e){this._toggle()}touchesCanceled(e){this.reset()}spaceBarKeyDown(e){this._pressed()}spaceBarKeyUp(e){this.reset(),k(this.popover.classList.contains("mk-shown")),this._open(!0)}updateTintColor(e){this.tintColor=e,this._iconElement.style.fill=e}reset(){this.classList.remove(hh),this._focusDelegate.controlWasReleased(this)}handleEvent(e){switch(k(this._isOpen),e.type){case Bo.startEventType:{const t=Bo.getShadowDOMTargetFromEvent(this.element,e);this.popover.element.contains(t)||this.element.contains(t)||this._close();break}case"keydown":if((e=>e.keyCode===t)(e)){this._close();const e=Bo.containingDocumentOrShadowRoot(this.element).activeElement;e&&this.popover.element.contains(e)&&this.element.focus()}break;case"blur":this.popover.element.contains(e.relatedTarget)||this._close()}}didMoveToParent(e){e?(k(this.popover),this.popover=new nh(this._delegate),this.parent.insertAfter(this.popover,this)):(window.removeEventListener(Bo.startEventType,this,!0),window.removeEventListener("keydown",this,!0),this.popover.element.removeEventListener("blur",this,!0),this.popover.remove(),this.popover=null)}focused(e){this._focusDelegate.controlDidGetFocus(this)}blurred(e){this._focusDelegate.controlDidLoseFocus(this)}_updateLabels(){Bo.updateLabel(this,es.get("MapType.Tooltip"))}_toggle(){this._isOpen?this._close():this._open()}_pressed(){this.classList.add(hh),this._focusDelegate.controlWasPressed(this)}_open(){this._isOpen||(this._isOpen=!0,this.popover.open(),window.addEventListener(Bo.startEventType,this,!0),window.addEventListener("keydown",this,!0),this.popover.element.addEventListener("blur",this,!0))}_close(){this._isOpen&&(this._isOpen=!1,this.popover.close(),window.removeEventListener(Bo.startEventType,this,!0),window.removeEventListener("keydown",this,!0),this.popover.element.removeEventListener("blur",this,!0))}_handleLocaleChange(){this.children.forEach((e=>{const t=e.element.getAttribute(ah);e.element.textContent=es.get(t)}))}_updateIcon(){this._iconElement.setAttribute("d",dh[this._mapType])}}ch.EVENTS={MAP_TYPE_CHANGE:"map-type-change"};const dh={standard:"M24.597 18.663V8.233L21.53 6.369a1.83 1.83 0 00-.413-.178v10.569l3.136 1.764c.06.03.116.058.171.083a.815.815 0 00.172.057zm-7.548-.178c.17 0 .356-.057.559-.171l2.615-1.416V6.285c-.06.026-.125.055-.197.089-.072.034-.14.07-.203.108l-2.958 1.695c-.199.11-.346.246-.44.41a1.118 1.118 0 00-.144.574v8.544c0 .25.07.442.207.577.137.136.324.203.561.203zm8.436.153a.641.641 0 00.204-.09l3.269-1.853c.203-.114.352-.251.447-.412.095-.161.143-.354.143-.578V7.18c0-.254-.07-.447-.21-.58-.14-.134-.332-.2-.577-.2-.17 0-.358.057-.565.17l-2.71 1.505v10.563z",hybrid:"M22.918 13.579c.13 0 .262-.023.393-.067.131-.044.275-.111.432-.2l4.951-2.875c.267-.157.456-.303.568-.438a.741.741 0 00.168-.49.724.724 0 00-.168-.475c-.112-.136-.301-.282-.568-.438L23.743 5.72a2.539 2.539 0 00-.432-.2 1.22 1.22 0 00-.79 0c-.129.045-.274.111-.435.2l-4.951 2.876c-.267.156-.456.302-.568.438a.724.724 0 00-.168.476c0 .19.056.353.168.489.112.135.301.28.568.438l4.951 2.875c.161.089.306.156.435.2.13.044.261.067.397.067zm0 3.135a.81.81 0 00.343-.076c.11-.05.237-.116.38-.197l5.409-3.192a.775.775 0 00.292-.28.656.656 0 00.095-.33.601.601 0 00-.12-.374.81.81 0 00-.267-.235l-5.847 3.377c-.055.034-.105.06-.152.08a.352.352 0 01-.133.028.366.366 0 01-.14-.029 1.063 1.063 0 01-.152-.08L16.78 12.03a.81.81 0 00-.267.235.601.601 0 00-.12.374c0 .11.032.22.098.33.065.11.164.203.295.28l5.402 3.192c.144.08.27.146.38.197.11.051.227.076.35.076zm0 2.94a.81.81 0 00.343-.077c.11-.05.237-.118.38-.203l5.409-3.186a.825.825 0 00.288-.277.644.644 0 00.099-.34.582.582 0 00-.12-.361.887.887 0 00-.267-.241l-5.847 3.383a2.55 2.55 0 01-.152.076.322.322 0 01-.133.032.335.335 0 01-.14-.032 2.55 2.55 0 01-.152-.076L16.78 14.97a.887.887 0 00-.267.241.582.582 0 00-.12.362c0 .118.032.231.098.34.065.107.164.2.295.275l5.402 3.187c.144.085.27.152.38.203.11.05.227.076.35.076z",satellite:"M22.915 18.923c.888 0 1.725-.169 2.51-.507a6.62 6.62 0 002.079-1.41 6.62 6.62 0 001.41-2.079 6.271 6.271 0 00.507-2.51c0-.889-.17-1.726-.508-2.51a6.583 6.583 0 00-1.41-2.076 6.682 6.682 0 00-2.081-1.41 6.26 6.26 0 00-2.514-.51c-.888 0-1.725.17-2.51.51a6.654 6.654 0 00-3.482 3.485 6.271 6.271 0 00-.508 2.511c0 .889.17 1.725.508 2.51a6.62 6.62 0 001.41 2.08c.6.6 1.293 1.07 2.078 1.409a6.271 6.271 0 002.51.507zm0-.92c-.762 0-1.48-.147-2.155-.441a5.732 5.732 0 01-1.781-1.21 5.687 5.687 0 01-1.206-1.78 5.37 5.37 0 01-.438-2.155c0-.762.146-1.479.438-2.152.209-.48.473-.92.794-1.32l.188-.222-.068.254a4.38 4.38 0 00-.127 1.04c0 .695.23 1.23.689 1.607.459.376 1.114.564 1.964.564.115 0 .196.04.245.121.048.08.041.171-.022.273a2.875 2.875 0 00-.311.584c-.055.157-.083.32-.083.489 0 .283.069.525.206.723.138.2.304.361.499.486a3.2 3.2 0 00.57.295l-.247.997c-.076.296-.039.53.111.704.15.174.348.26.594.26.245 0 .478-.114.698-.342l1.543-1.67c.258-.275.443-.524.555-.749.112-.224.168-.448.168-.672a1.11 1.11 0 00-.11-.426 3.165 3.165 0 00-.664-.958 1.378 1.378 0 00-.594-.337 3.345 3.345 0 00-.784-.076h-.342l-.35-.685.965-.362c.271.178.487.313.648.406.16.093.317.14.47.14.194 0 .347-.06.457-.178a.582.582 0 00.155-.435.742.742 0 00-.225-.485l-.99-1.048c-.064-.063-.096-.124-.096-.18 0-.058.028-.118.083-.182a4.83 4.83 0 00.431-.552c.144-.211.216-.442.216-.692a.813.813 0 00-.084-.357l-.045-.078.183.073c.675.292 1.27.695 1.784 1.21a5.709 5.709 0 011.21 1.78c.291.673.437 1.39.437 2.152a5.37 5.37 0 01-.438 2.155 5.687 5.687 0 01-1.206 1.78 5.732 5.732 0 01-1.78 1.21 5.336 5.336 0 01-2.155.44z"};const uh=ch;function ph(e,t){if(!t)return this._targetOpacity=e,void(this.opacity=e);e!==this._targetOpacity&&(e!==this.opacity?(this._targetOpacity=e,this._startTime=null,this._startOpacity=this._opacity,Mt.scheduleOnNextFrame(this)):this._targetOpacity=e)}function mh(e){null==this._startTime&&(this._startTime=e??null);const t=this.constructor.prototype.performScheduledUpdate;if("function"==typeof t&&t.call(this,e),null===this._targetOpacity)return;if(null==e&&(this.opacity=this._targetOpacity),this._targetOpacity===this.opacity)return this._startTime=null,this._startOpacity=null,void(this._targetOpacity=null);S(this._startOpacity),S(),S(this._startTime);const i=e-this._startTime,s=this._targetOpacity-this._startOpacity,o=Math.abs(s*this._totalDurationMs),n=Math.min(i/o,1),a=Bo.easeInOut(n)*s+this._startOpacity;this.opacity=c(a,0,1),Mt.scheduleOnNextFrame(this)}const gh=function(e,t){const i=e;return i._targetOpacity=null,i._startOpacity=null,i._startTime=null,i._totalDurationMs=t||300,i.setOpacityAnimated=ph,i.performScheduledUpdate=mh,i},_h=Object.freeze({GlobalFadeDuration:700,InnerTransitionDuration:200,MinimumNumberOfSegments:2,MaximumNumberOfSegments:5,MagicNumbers:[1.25,2.5,5],FirstMagicExponent:-3,LastMagicExponent:7,MaximumNumberOfDisplayedSegments:3,SegmentThickness:3,LegendHorizontalMargin:6,LegendMarginBottom:8,LegendSpacing:1,OutlineWidth:1,LightSegmentColorRegular:"rgba(255, 255, 255, 0.7)",DarkSegmentColorRegular:"rgba(0, 0, 0, 0.73)",OutlineColorRegular:"rgba(255, 255, 255, 0.5)",LightSegmentColorSatellite:"rgba(255, 255, 255, 0.8)",DarkSegmentColorSatellite:"rgba(178, 178, 178, 0.8)",OutlineColorSatellite:"rgba(0, 0, 0, 1)",SegmentInnerStrokeColor:"rgba(0, 0, 0, 0.2)",SegmentInnerStrokeWidth:.5,LegendFontSize:9,LegendFontFamily:"'-apple-system-font', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'",LegendColorRegular:"rgba(72, 69, 65, 1)",LegendOuterStrokeColorRegular:"rgba(255, 255, 255, 0.5)",LegendColorSatellite:"rgba(255, 255, 255, 1)",LegendOuterStrokeColorSatellite:"rgba(0, 0, 0, 1)",LegendOuterStrokeWidth:1,MetersThreshold:500,FeetThreshold:.25,MilesToMeters:1609.344,MetersToMiles:1/1609.344,MilesToFeet:5280});const fh=class extends Qo{measureTextOverflow(e,t){const i=this._node;if(!i.legend)return 0;const s=_h.LegendFontSize*this.node.fontSizeRatio;let o;e.font=`${s}px ${_h.LegendFontFamily}`,o=t?i.legend.labels[0]:i.legend.labels[i.numberOfSegments];const n=e.measureText(o).width/2;let a;return a=t?0:e.measureText(" "+i.legend.unit).width,n+a}draw(e){const t=this._node;if(!t.legend)return;const i=_h.LegendFontSize*this.node.fontSizeRatio;e.font=`${i}px ${_h.LegendFontFamily}`,e.textAlign="center",e.textBaseline="bottom",e.lineWidth=_h.LegendOuterStrokeWidth,S(t.fillColor),S(t.strokeColor),e.fillStyle=t.fillColor,e.strokeStyle=t.strokeColor;const s=t.size.height-_h.LegendMarginBottom-_h.LegendSpacing;let o=t.segmentStart;for(let i=0;i<=t.numberOfSegments;i++){const n=t.legend.labels[i];e.strokeText(n,o,s),e.fillText(n,o,s),this.node.leftAligned?i===t.numberOfSegments?o+=e.measureText(n).width/2:o+=t.segmentWidth:i===t.numberOfSegments?o-=e.measureText(n).width/2:o-=t.segmentWidth}const n=" "+t.legend.unit;e.textAlign=this.node.leftAligned?"left":"right",e.strokeText(n,o,s),e.fillText(n,o,s)}};function yh(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const vh=class extends Ns{constructor(...e){super(...e),yh(this,"fontSizeRatio",1),yh(this,"_legend",null),yh(this,"_segmentWidth",0),yh(this,"_segmentStart",0),yh(this,"_numberOfSegments",0),yh(this,"_fillColor",null),yh(this,"_strokeColor",null),yh(this,"_renderer",new fh(this)),yh(this,"_leftAligned",void 0)}get leftAligned(){return this._leftAligned}set leftAligned(e){this._leftAligned=e,this.needsDisplay=!0}get legend(){return this._legend}set legend(e){this._legend=e,this.needsDisplay=!0}get segmentStart(){return this._segmentStart}set segmentStart(e){this._segmentStart=e,this.needsDisplay=!0}get segmentWidth(){return this._segmentWidth}set segmentWidth(e){this._segmentWidth=e,this.needsDisplay=!0}get numberOfSegments(){return this._numberOfSegments}set numberOfSegments(e){this._numberOfSegments=e,this.needsDisplay=!0}get fillColor(){return this._fillColor}set fillColor(e){this._fillColor=e,this.needsDisplay=!0}get strokeColor(){return this._strokeColor}set strokeColor(e){this._strokeColor=e,this.needsDisplay=!0}stringInfo(){const e="~"+this.fillColor+"/"+this.strokeColor+"~ ",t=this.leftAligned?"":", rtl";if(!this._legend)return"LegendNode "+e;return"LegendNode<labels:["+this._legend.labels.slice(0,this.numberOfSegments+1).join(", ")+"], unit:"+this._legend.unit+t+")> "+e}measureTextOverflow(e,t=!1){return this._renderer.measureTextOverflow(e,t)}};const bh=class extends Qo{draw(e){const t=this._node,i=t.fillColor,s=t.strokeColor,o=t.lineWidth;i&&(e.fillStyle=i,e.fillRect(0,0,t.size.width,t.size.height));s&&o&&(o>=1||Bo.devicePixelRatio>1)&&(e.lineWidth=o,e.strokeStyle=s,t.innerStroke?e.strokeRect(o/2,o/2,t.size.width-o,t.size.height-o):e.strokeRect(-o/2,-o/2,t.size.width+o,t.size.height+o))}};function wh(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Ch=class extends Ns{constructor(...e){super(...e),wh(this,"_fillColor",null),wh(this,"_strokeColor",null),wh(this,"_lineWidth",null),wh(this,"_innerStroke",!1),wh(this,"_renderer",new bh(this))}get fillColor(){return this._fillColor}set fillColor(e){this._fillColor=e,this.needsDisplay=!0}get strokeColor(){return this._strokeColor}set strokeColor(e){this._strokeColor=e,this.needsDisplay=!0}get innerStroke(){return this._innerStroke}set innerStroke(e){this._innerStroke=e,this.needsDisplay=!0}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this.needsDisplay=!0}};function kh(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Sh=class extends Ch{constructor(){super(),kh(this,"setOpacityAnimated",(()=>{})),kh(this,"performScheduledUpdate",(()=>{})),gh(this,_h.InnerTransitionDuration),this.lineWidth=_h.OutlineWidth}stringInfo(){return"OutlineNode "+("~"+this.strokeColor+"~ ")}};function Mh(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Lh=class extends Ch{constructor(){super(),Mh(this,"setOpacityAnimated",(()=>{})),Mh(this,"performScheduledUpdate",(()=>{})),gh(this,_h.InnerTransitionDuration),this.lineWidth=_h.SegmentInnerStrokeWidth,this.innerStroke=!0}stringInfo(){return"SegmentNode "+("~"+this.fillColor+"~ ")}};var xh;function Ah(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Eh extends an{constructor(){super(),Ah(this,"_needsLayout",!1),Ah(this,"_distance",0),Ah(this,"_mapWidth",0),Ah(this,"_theme",Eh.Themes.light),Ah(this,"_leftAligned",!1),Ah(this,"_l10n",null),Ah(this,"_legendNode",this.addChild(new vh)),Ah(this,"_segmentWidth",0),Ah(this,"_oldNumberOfSegments",0),Ah(this,"_legend",{labels:[],unit:""}),Ah(this,"_outlineNodes",void 0),Ah(this,"_activeOutlineNode",void 0),Ah(this,"_segmentNodes",void 0),Ah(this,"_useMetric",!1),Ah(this,"setOpacityAnimated",(()=>{})),this._outlineNodes=[0,1].map((()=>this.addChild(new Sh))),this._activeOutlineNode=this._outlineNodes[0],this._outlineNodes[1].opacity=0,this._segmentNodes=[0,1,2].map((()=>this.addChild(new Lh))),this._updateColors(),gh(this,_h.GlobalFadeDuration)}get layerBounds(){return new us(0,0,this.size.width,Math.max(this.size.height,48))}get fontSizeRatio(){return this._legendNode.fontSizeRatio}set fontSizeRatio(e){this._legendNode.fontSizeRatio=e,this._computeSegments()}get distance(){return this._distance}set distance(e){Math.abs(e-this._distance)/this._distance<.01||(this._distance=e,this._computeSegments())}get mapWidth(){return this._mapWidth}set mapWidth(e){e!==this._mapWidth&&(this._mapWidth=e,this._computeSegments())}get theme(){return this._theme}set theme(e){this._theme=e,this._updateColors()}get l10n(){return this._l10n}set l10n(e){this._l10n&&this._l10n.removeEventListener(this._l10n.Events.LocaleChanged,this),this._l10n=e,e&&e.addEventListener(e.Events.LocaleChanged,this)}get useMetric(){return this._useMetric}set useMetric(e){this._useMetric!==e&&(this._useMetric=e,this._computeSegments())}get leftAligned(){return this._leftAligned}set leftAligned(e){this._leftAligned=e,this.needsLayout=!0}stringInfo(){return"ScaleNode<distance:"+Math.round(100*this.distance)/100+"m>"}get needsLayout(){return this._needsLayout}set needsLayout(e){this._needsLayout!==e&&(this._needsLayout=e,e&&Mt.scheduleASAP(this))}performScheduledUpdate(){this.needsLayout&&this.parent&&(this.layoutSubNodes(),this.needsLayout=!1)}layoutSubNodes(){const e=this._computeSegmentsRects();for(let t=0;t<_h.MaximumNumberOfDisplayedSegments;t++){const i=e[t],s=this._segmentNodes[t];i?(s.position=i.origin,s.size=i.size,s.setOpacityAnimated(1,!0)):s.setOpacityAnimated(0,!0)}const t=us.unionOfRects(e).round();if(e.length!==this._oldNumberOfSegments){this._activeOutlineNode.setOpacityAnimated(0,!0);const e=0===this._outlineNodes.indexOf(this._activeOutlineNode)?1:0;this._activeOutlineNode=this._outlineNodes[e],this._activeOutlineNode.setOpacityAnimated(1,!0)}this._activeOutlineNode.position=t.origin,this._activeOutlineNode.size=t.size;const i=e[0];this._legendNode.segmentStart=this.leftAligned?i.origin.x:i.origin.x+i.size.width,this._legendNode.leftAligned=this.leftAligned,this._legendNode.segmentWidth=i.size.width,this._legendNode.size=this.size.copy(),this._oldNumberOfSegments=e.length}handleEvent(){this._computeSegments()}_updateColors(){const e=this.theme===Eh.Themes.dark;this._legendNode.fillColor=e?_h.LegendColorSatellite:_h.LegendColorRegular,this._legendNode.strokeColor=e?_h.LegendOuterStrokeColorSatellite:_h.LegendOuterStrokeColorRegular;const t=e?[_h.LightSegmentColorSatellite,_h.DarkSegmentColorSatellite]:[_h.DarkSegmentColorRegular,_h.LightSegmentColorRegular];this._segmentNodes.forEach(((i,s)=>{i.fillColor=t[s%2],i.strokeColor=e?null:_h.SegmentInnerStrokeColor}),this);const i=e?_h.OutlineColorSatellite:_h.OutlineColorRegular;this._outlineNodes.forEach((e=>{e.strokeColor=i}))}_computeSegments(){if(0===this.size.width||0===this.mapWidth||!this._l10n)return;const e=this.size.width,t=this.mapWidth;let i=this.distance*e/t;const s=!this._useMetric;let o=!1,n=1,a=0;function r(e,t){return a=e*Math.pow(10,t),n=i/a,n>=_h.MinimumNumberOfSegments&&n<_h.MaximumNumberOfSegments}s&&(i*=_h.MetersToMiles,i<_h.FeetThreshold&&(o=!0,i*=_h.MilesToFeet));let l=!1;for(let e=_h.FirstMagicExponent;!l&&e<_h.LastMagicExponent;e++)l=_h.MagicNumbers.some((t=>r(t,e)));this._segmentWidth=n?e/n:0;const h=a;s&&(o&&(a/=_h.MilesToFeet),a*=_h.MilesToMeters),this._computeLegend(a,h,o)}_computeLegend(e,t,i){let s=0;const o=this._l10n;S(),this._useMetric?e>_h.MetersThreshold?(this._legend.unit=o.get("Scale.Kilometer.Short"),s=e/1e3):(this._legend.unit=o.get("Scale.Meter.Short"),s=e):(this._legend.unit=i?o.get("Scale.Feet.Short"):o.get("Scale.Mile.Short"),s=t);const n=[];let a;"object"==typeof Intl&&Intl&&Intl.NumberFormat&&(a=new Intl.NumberFormat(o.activeLocale.localeId));for(let e=0;e<_h.MaximumNumberOfSegments;e++){const t=e*s,i=a?a.format(t):t.toString();n.push(i)}this._legend.labels=n,this._legendNode.legend=this._legend,this.needsLayout=!0}_computeSegmentsRects(){S(this.scene);const e=this.scene.contextForMeasurement;let t=0,i=this.leftAligned?_h.LegendHorizontalMargin+this._legendNode.measureTextOverflow(e,!0):this.size.width-_h.LegendHorizontalMargin-this._legendNode.measureTextOverflow(e,!0);const s=this.size.height-_h.LegendMarginBottom+_h.LegendSpacing,o=this._segmentWidth,n=[];for(let a=0;a<_h.MaximumNumberOfDisplayedSegments;a++){const a=new us(this.leftAligned?i:i-o,s,o,_h.SegmentThickness).round();n.push(a),i=this.leftAligned?a.origin.x+a.size.width:a.origin.x,this._legendNode.numberOfSegments=n.length,t=this._legendNode.measureTextOverflow(e);const r=o+t+_h.LegendHorizontalMargin;if(this.leftAligned&&i+r>this.size.width)break;if(!this.leftAligned&&i-r<0)break}return 0===this._oldNumberOfSegments&&(this._oldNumberOfSegments=n.length),n}}xh=Eh,Ah(Eh,"Themes",{light:"Light",dark:"Dark"}),Ah(Eh,"ScaleNode",xh);const Th=Eh.Themes,Ih=Eh,Oh=new ls(170,20),Rh="mk-scale";const Ph=class extends _o{constructor(e){const t=new nn;super(t.element),this.scene=t,this._map=e;const i=Oh.copy();i.height=this._getHeight(),this.scene.size=i,this.node=this.scene.addChild(new Ih),this.node.size=i,this.node.position=new cs(0,0),this.node.opacity=0,this.node.l10n=es,this.node.fontSizeRatio=e.fontSizeRatio,this.node.useMetric=e.useMetric,es.addEventListener(es.Events.LocaleChanged,this),this.classList.add(Rh),this.element.setAttribute("aria-hidden","true"),this.size=Oh}get shouldDisplayScale(){return this._map._showsScale===Xs.Visible||this._map._showsScale===Xs.Adaptive&&this._map.cameraIsZooming}updateTheme(e){this.node.theme=Th[e]}update(){const e=this._map;if(!this.node||!this.shouldDisplayScale)return;const t=e.renderingMapRect.origin.toCoordinate().latitude,i=e.renderingMapRect.size.width/Li.mapUnitsPerMeterAtLatitude(t);if(i/e._visibleFrame.size.width*Bo.devicePixelRatio>=7500)return void this.hideIfNeeded(!0);const s=this._getHeight();if(s!==this.node.size.height){const e=Oh.copy();e.height=s,this.scene.size=e,this.node.size=e}this.node.fontSizeRatio=e.fontSizeRatio,this.node.distance=i,this.node.useMetric=this._map.useMetric,this.node.setOpacityAnimated(1,!1)}hideIfNeeded(e){!this.node||this.shouldDisplayScale&&!e||this.node.setOpacityAnimated(0,!0)}handleEvent(e){k((e.type,es.Events.LocaleChanged)),this.node.useMetric=this._map.useMetric}mapWasDestroyed(){this.node.l10n=null,this.node.remove(),this.scene.destroy(),es.removeEventListener(es.Events.LocaleChanged,this)}_getHeight(){const e=_h.LegendFontSize*this._map.fontSizeRatio;return Oh.height-_h.LegendFontSize+e}},Dh="mk-zoom-controls",zh="mk-divider",Nh="mk-zoom-in",Fh="mk-zoom-out",Uh="mk-pressed",Gh="mk-pill-pressed",Wh="mk-disabled";class Bh extends $l{constructor(){const e=Bo.htmlElement("div");super(e),this.classList.add(Dh),this._zoomInEnabled=!0,this._zoomOutEnabled=!0,this._zoomInButton=Bo.htmlElement("div",{role:"button",tabindex:"0"}),this._zoomInButtonNode=new Lo.Node(this._zoomInButton),this._zoomInButtonNode.classList.add(Nh),this._zoomInButton.appendChild(function(){const e=Bo.svgElement("path",{d:"M11.813 17.404c.4 0 .724-.33.724-.705v-3.974h3.872a.726.726 0 00.717-.723.73.73 0 00-.717-.724h-3.872V7.305a.72.72 0 00-.724-.705.724.724 0 00-.724.705v3.973H7.217a.739.739 0 00-.717.724c0 .4.343.723.717.723h3.872V16.7c0 .375.33.705.724.705z"}),t=Bo.createSVGIcon(e,{width:"100%",height:"100%"});return t.setAttribute("viewBox","0 0 24 24"),t}()),e.appendChild(this._zoomInButton),e.appendChild(Bo.htmlElement("div",{class:zh})),this._zoomOutButton=Bo.htmlElement("div",{role:"button",tabindex:"0"}),this._zoomOutButtonNode=new Lo.Node(this._zoomOutButton),this._zoomOutButtonNode.classList.add(Fh),this._zoomOutButton.appendChild(function(){const e=Bo.svgElement("path",{d:"M16.325 12.75c.364 0 .675-.336.675-.75 0-.408-.31-.75-.675-.75h-8.65c-.352 0-.675.342-.675.75 0 .414.323.75.675.75h8.65z"}),t=Bo.createSVGIcon(e,{width:"100%",height:"100%"});return t.setAttribute("viewBox","0 0 24 24"),t}()),e.appendChild(this._zoomOutButton),this._updateLabels()}get zoomInEnabled(){return this._zoomInEnabled}set zoomInEnabled(e){this._enabled&&e===this._zoomInEnabled||(this._zoomInEnabled=this._enabled&&e,Zh(this._zoomInButtonNode,this._zoomInEnabled))}get zoomOutEnabled(){return this._zoomOutEnabled}set zoomOutEnabled(e){this._enabled&&e===this._zoomOutEnabled||(this._zoomOutEnabled=this._enabled&&e,Zh(this._zoomOutButtonNode,this._zoomOutEnabled))}localeChanged(e){this._updateLabels()}touchesBegan(e){this._pressed(e)}touchesEnded(e){this.saveEndEventProps(e),this.reset(e)}clicked(e){this.checkClickEventProps(e)||(this._pressed(e),this.reset(e))}touchesCanceled(e){this.reset(e)}focused(e){this.updateTintColor(this.tintColor),e.target.style.fill=Bo.focusColor}blurred(e){this.updateTintColor(this.tintColor)}spaceBarKeyDown(e){this._pressed(e)}spaceBarKeyUp(e){this.reset(e)}updateTintColor(e){this.tintColor=e,this._zoomInButton.firstChild.style.fill=e,this._zoomOutButton.firstChild.style.fill=e}reset(e){let t;if(this._zoomInButtonNode.classList.contains(Uh)?t=this._zoomInButtonNode:this._zoomOutButtonNode.classList.contains(Uh)&&(t=this._zoomOutButtonNode),t){t.classList.remove(Uh),this.classList.remove(Gh);const e=new F.Event(Bh.EVENTS.ZOOM_END);this.dispatchEvent(e)}window.removeEventListener(Bo.endEventType,this),Bo.supportsPointerEvents?window.removeEventListener("pointercancel",this):Bo.supportsTouches&&window.removeEventListener("touchcancel",this)}_clearLabels(e){Bo.updateLabel(this._zoomInButtonNode,""),Bo.updateLabel(this._zoomOutButtonNode,"")}_updateLabels(e){Bo.updateLabel(this._zoomInButtonNode,es.get("Zoom.In.Tooltip")),Bo.updateLabel(this._zoomOutButtonNode,es.get("Zoom.Out.Tooltip"))}_pressed(e){const t=this._findButtonNodeFromButtonDOMElement(Bo.parentNodeForSvgTarget(e.target));if(!t||t.classList.contains(Wh))return;if(this.hasFocus){const e=Bo.containingDocumentOrShadowRoot(this.element).activeElement;e!==t.element&&e.blur()}t.classList.add(Uh),this.classList.add(Gh);const i=new F.Event(Bh.EVENTS.ZOOM_START);i.zoomIn=t===this._zoomInButtonNode,this.dispatchEvent(i)}_findButtonNodeFromButtonDOMElement(e){return e===this._zoomOutButton?this._zoomOutButtonNode:e===this._zoomInButton?this._zoomInButtonNode:null}}function Zh(e,t){t?(e.classList.remove(Wh),e.removeAttribute("aria-disabled"),e.setAttribute("tabindex",0)):(e.classList.add(Wh),e.setAttribute("aria-disabled","true"),e.setAttribute("tabindex",-1))}Bh.EVENTS={ZOOM_START:"zoom-start",ZOOM_END:"zoom-end"};const Kh=Bh;const jh={POP_OVER:"mk-user-location-error-popover",ERROR:"mk-error-message",ERROR_TEXT:"mk-error-text",ERROR_SUPPORT:"mk-error-support"},Hh=class extends Ql{constructor(){super(),this.classList.add(jh.POP_OVER),this._errorMessageElement=this._createErrorMessageElement(),this._errorMessageNode=new _o(this._errorMessageElement),this.update(),this.addChild(this._errorMessageNode)}get errorMessageElement(){return this._errorMessageElement}update(){this._errorMessageElement.getElementsByClassName(jh.ERROR_TEXT)[0].textContent=es.get("Location.Error.Message")+" ",this._supportLink.textContent=es.get("Location.Error.Support.Label"),Bo.supportsTouches?this._supportLink.href="https://support.apple.com/HT203033":this._supportLink.href="https://support.apple.com/guide/mac-help/allow-apps-to-detect-the-location-of-your-mac-mh35873/mac"}_createErrorMessageElement(){const e=Bo.htmlElement("div",{class:jh.ERROR});return this._supportLink=Bo.htmlElement("a",{class:jh.ERROR_SUPPORT,target:"_blank"}),e.appendChild(Bo.htmlElement("span",{class:jh.ERROR_TEXT})),e.appendChild(this._supportLink),e}},qh={CONTROL:"mk-user-location-control",WRAPPER:"mk-user-location-control-wrapper",PRESSED:"mk-pressed",TRACKING:"mk-tracking",WAITING:"mk-waiting",DISABLED:"mk-disabled",WAITING_ICON:"mk-icon-waiting",ARROW_ICON:"mk-icon-arrow",SCALED_OUT:"mk-scaled-out"};class Vh extends $l{constructor(e,t,i){super(Bo.htmlElement("div",{class:qh.CONTROL,role:"button",tabindex:"0"})),this._state=Vh.States.Default,this._tintColor="",this._wrapper=Bo.htmlElement("div",{class:qh.WRAPPER}),this.element.appendChild(this._wrapper),this._arrowIconNode=new Lo.Node(Bo.createSVGIcon(Bo.svgElement("path"),{class:qh.ARROW_ICON,viewBox:Xh})),this._waitingIconNode=new Lo.Node(function(){const e=[];for(let t=0;t<Qh;++t)e.push(Bo.svgElement("rect",{x:sc,y:oc,width:ec,height:tc,rx:ic,transform:"rotate("+45*t+")"}));const t=["g",{transform:"scale("+Jh+", "+-Jh+")"}].concat(e);return Bo.createSVGIcon(Bo.svgElement.apply(null,t),{class:[qh.WAITING_ICON,qh.SCALED_OUT].join(" "),viewBox:$h})}()),this._wrapper.appendChild(this._arrowIconNode.element),this._wrapper.appendChild(this._waitingIconNode.element),this._errorPopover=new Hh,this._updateLabels(),this._updateArrowIcon(),this._waitingIconBlades=this._waitingIconNode.element.querySelectorAll("rect"),this._map=e,this._rtl=t,this._focusDelegate=i}get state(){return this._state}set state(e){this._state!==e&&(this._state=e,this.classList.toggle(qh.TRACKING,this.isTrackingState()),this.classList.toggle(qh.WAITING,this.isWaitingState()),this.classList.toggle(qh.DISABLED,this.isDisabledState()),this.updateTintColor(this._tintColor),this.isWaitingState()?this._animateArrowIconOut():this._animateWaitingIconOut())}isDefaultState(){return this.state===Vh.States.Default}toDefaultState(){this.state=Vh.States.Default,this._updateArrowIcon(),this._closeErrorPopover()}isTrackingState(){return this.state===Vh.States.Tracking}toTrackingState(){this.state=Vh.States.Tracking,this._updateArrowIcon(),this._closeErrorPopover()}isWaitingState(){return this.state===Vh.States.Waiting}toWaitingState(){this.state=Vh.States.Waiting}isDisabledState(){return this.state===Vh.States.Disabled}toDisabledState(){this._map.tracksUserLocation&&this._map.userLocationAnnotation||(this.state=Vh.States.Disabled,this._updateArrowIcon(),this._openErrorPopover())}handleEvent(e){switch(e.type){case Bo.startEventType:{const t=Bo.getShadowDOMTargetFromEvent(this.element,e);this._errorPopover.errorMessageElement.contains(t)||(this._closeErrorPopover(),window.removeEventListener(Bo.startEventType,this,!0));break}case"keydown":27===e.keyCode&&this._closeErrorPopover();break;case"blur":this._errorPopover.element.contains(e.relatedTarget)||this._closeErrorPopover()}}touchesBegan(e){this._pressed(e)}touchesEnded(){this.reset()}clicked(){this.dispatchEvent(new F.Event(Vh.EVENTS.PRESSED))}touchesCanceled(e){this.reset()}spaceBarKeyDown(e){this._pressed(e)}spaceBarKeyUp(e){this.reset(e),this.dispatchEvent(new F.Event(Vh.EVENTS.PRESSED))}updateTintColor(e){this._tintColor=e,this._arrowIconNode.element.querySelector("g").style.fill=this.isTrackingState()?"":e,this._waitingIconNode.element.querySelector("g").style.fill=e,this.element.style.backgroundColor=this.isTrackingState()?e:""}reset(){this.classList.contains(qh.PRESSED)&&(this.classList.remove(qh.PRESSED),this._focusDelegate.controlWasReleased(this),this.isDefaultState()||this.isDisabledState()?this.toWaitingState():this.toDefaultState()),window.removeEventListener(Bo.endEventType,this),Bo.supportsPointerEvents?window.removeEventListener("pointercancel",this):Bo.supportsTouches&&window.removeEventListener("touchcancel",this)}localeChanged(e){this._updateLabels(),this._rtl=e.locale.rtl,this._errorPopover.update()}mapWasDestroyed(){delete this._map}focused(e){this._focusDelegate.controlDidGetFocus(this)}blurred(e){this._focusDelegate.controlDidLoseFocus(this)}didMoveToParent(e){e?this.parent.insertAfter(this._errorPopover,this):(this._closeErrorPopover(),this._errorPopover.remove())}_updateLabels(){Bo.updateLabel(this.element,es.get("Track.User.Location.Tooltip"))}_pressed(e){this.classList.add(qh.PRESSED),this._focusDelegate.controlWasPressed(this)}_animateArrowIconOut(){this._arrowIconNode.classList.add(qh.SCALED_OUT),this._waitingIconNode.classList.remove(qh.SCALED_OUT)}_animateWaitingIconOut(){this._waitingIconNode.classList.add(qh.SCALED_OUT),this._arrowIconNode.classList.remove(qh.SCALED_OUT)}_openErrorPopover(){this._errorPopover.open(),window.addEventListener(Bo.startEventType,this,!0),window.addEventListener("keydown",this,!0),this._errorPopover.element.addEventListener("blur",this,!0)}_closeErrorPopover(){this._errorPopover.close(),window.removeEventListener(Bo.startEventType,this,!0),window.removeEventListener("keydown",this,!0),this._errorPopover.element.removeEventListener("blur",this,!0)}_updateArrowIcon(){this._arrowIconNode.element.querySelector("path").setAttribute("d",Yh[this.state])}}Vh.States={Default:"default",Waiting:"waiting",Tracking:"tracking",Disabled:"disabled"},Vh.EVENTS={PRESSED:"pressed"};const Yh={default:"M24.675 17.91L29.48 7.512c.514-1.11-.349-1.847-1.409-1.358l-10.448 4.818c-.971.444-.768 1.802.342 1.809l4.723.019c.095 0 .127.038.127.133l.013 4.691c0 1.092 1.365 1.34 1.847.286zm-.711-1.448l.025-4.272c0-.387-.184-.577-.584-.577l-4.272.025c-.05 0-.07-.057-.012-.089l8.95-4.094c.076-.032.12.013.082.089l-4.1 8.925c-.025.063-.089.05-.089-.007z",disabled:"M27.112 12.641l2.368-5.129c.514-1.11-.349-1.847-1.409-1.358l-5.097 2.348.882.883 4.215-1.93c.076-.032.12.013.082.089l-1.93 4.208.89.89zm2.4 4.196a.51.51 0 000-.717l-9.934-9.934a.517.517 0 00-.724 0 .522.522 0 000 .717l9.947 9.934c.197.197.52.197.71 0zm-4.837 1.073l1.301-2.812-.882-.883-1.041 2.254c-.025.063-.089.05-.089-.007l.02-3.351-1.493-1.492-3.358.02c-.05 0-.07-.058-.012-.09l2.266-1.034-.876-.876-2.888 1.333c-.971.444-.768 1.802.342 1.809l4.723.019c.095 0 .127.038.127.133l.013 4.691c0 1.092 1.365 1.34 1.847.286z",tracking:"M24.675 17.91L29.48 7.512c.514-1.11-.349-1.847-1.409-1.358l-10.448 4.818c-.971.444-.768 1.802.342 1.809l4.723.019c.095 0 .127.038.127.133l.013 4.691c0 1.092 1.365 1.34 1.847.286z"},Xh="0 0 45 24",$h="-22.5 -12 45 24",Jh=2/3,Qh=8,ec=2.5,tc=6,ic=1.25,sc=-ec/2,oc=5;const nc=Vh,ac="mk-rotation-control",rc="mk-pressed",lc="mk-heading",hc="mk-rotation-wrapper",cc="mk-rotation-slider";function dc(e,t,i,s){let o;const n=t-s,a=e-i;return o=e>i?t<s?90+uc(Math.atan(n/a)):180-uc(Math.atan(a/n)):t<s?360-uc(Math.atan(a/n)):0!==a?270+uc(Math.atan(n/a)):180,o}function uc(e){return 180*e/Math.PI}function pc(e){const t=It.createImageUrl("icons/compass-sheet.svg");e.crossOrigin=fa.getCorsAttribute(Ze.urlWithCredentials(t)),e.src=t}const mc=class extends $l{constructor(e){const t=Bo.htmlElement("div");super(t),this.element=t,this._isDragging=!1,this._isDraggingPrevented=!1,this.classList.add(ac);const i=Bo.htmlElement("input",{class:cc,type:"range",min:0,max:360,value:0,"aria-label":es.get("Compass.Degrees.Plural",{n:0})});i.addEventListener("change",this),this._slider=i,this._sliderNode=new Lo.Node(i),this.element.appendChild(i),this._compassNode=new Lo.Node(Bo.htmlElement("div",{class:hc},Bo.htmlElement("img",{role:"presentation"}))),this.element.appendChild(this._compassNode.element);const s=Bo.htmlElement("div");if(this._heading=s,this._headingNode=new Lo.Node(s),this._headingNode.classList.add(lc),this.element.appendChild(s),Ze.state===Ze.States.UNINITIALIZED){const e=()=>{Ze.removeEventListener(Ze.Events.Initialized,e),pc(this._compassNode.element.firstChild)};Ze.addEventListener(Ze.Events.Initialized,e)}else pc(this._compassNode.element.firstChild);this._map=e,this._rotation=0,this._activeKeyRightAt=null,this._activeKeyLeftAt=null,this._updateLabels()}enable(){super.enable(),this._setupGestureRecognizers(),this._sliderNode.removeAttribute("aria-disabled"),this._sliderNode.setAttribute("tabindex",0)}disable(){super.disable(),this._sliderNode.setAttribute("aria-disabled","true"),this._sliderNode.setAttribute("tabindex",-1)}set rotation(e){e===this._rotation||360===this._rotation&&0===e||(this._rotation=e,this._updateHeading(),this._updateSlider(),this._rotateTo(e))}localeChanged(e){this._updateLabels()}mapWasDestroyed(){delete this._map}updateTintColor(e){this.tintColor!==e&&(this.tintColor=e,this._heading.style.color=e)}updateImage(e,t){this._dprValue===e&&this._darkColorScheme===t||(this._dprValue=e,this._darkColorScheme=t,Ze.state!==Ze.States.UNINITIALIZED&&pc(this._compassNode.element))}touchesEnded(e){this.saveEndEventProps(e)}clicked(e){this.checkClickEventProps(e)||this.reset(e)}reset(e){const t=e&&(e.target===this._tapRecognizer||"click"===e.type||e.keyCode===o||e.keyCode===i);this._map&&this._center&&!t&&this._isDragging&&(this._map.mapDidStopRotating(),this._map.compassRotationDidEnd()),this.classList.remove(rc),t&&this._map.setRotationAnimated(0,!0),this._isDragging=!1,this._isDraggingPrevented=!1,delete this._angleOffset}spaceBarKeyDown(e){this.reset(e)}upArrowKeyUp(e){this.reset(e)}rightArrowKeyDown(e){this._beginKeyboardRotate(e)}rightArrowKeyUp(e){this._endKeyboardRotate(e)}leftArrowKeyDown(e){this._beginKeyboardRotate(e)}leftArrowKeyUp(e){this._endKeyboardRotate(e)}performScheduledUpdate(){if(!this._activeKeyRightAt&&!this._activeKeyLeftAt)return!1;this._keyboardRotate(),Mt.scheduleOnNextFrame(this)}handleEvent(e){switch(e.target){case this._tapRecognizer:e.target.state===Ro.Recognized&&this.reset(e);break;case this._panRecognizer:e.target.state===Ro.Possible?this._beginDrag(e):e.target.state===Ro.Changed?this._drag(e):e.target.state!==Ro.Recognized&&e.target.state!==Ro.Failed||this.reset(e);break;case this._slider:this._handleSliderChange(e)}}fadeIn(){this.element.style.opacity=1}fadeOut(){this.element.style.opacity=0}_updateHeading(){const e=360-this._rotation,t=Math.round(e/360*4)%4;k(),this._heading.textContent=es.get("Compass."+["NorthIndicator","EastIndicator","SouthIndicator","WestIndicator"][t])}_updateLabels(){this._updateHeading(),Bo.updateLabel(this.element,es.get("Compass.Tooltip"))}_rotateTo(e){this._compassNode.transform="rotate("+e+"deg)"}_setupGestureRecognizers(){const e=new An;e.numberOfTapsRequired=1,e.addEventListener("statechange",this),e.target=this.element,this._tapRecognizer=e;const t=new Rn;t.addEventListener("statechange",this),t.target=this.element,this._panRecognizer=t}removeEventListeners(){this._tapRecognizer.removeEventListener("statechange",this),this._tapRecognizer.enabled=!1,this._tapRecognizer.target=null,this._panRecognizer.removeEventListener("statechange",this),this._panRecognizer.enabled=!1,this._panRecognizer.target=null,this._slider.removeEventListener("change",this)}_beginDrag(e){this.classList.add(rc);const t=this.element.getBoundingClientRect();this._center={x:t.right-t.width/2,y:t.bottom-t.height/2};const i=dc(e.target.locationInClient().x,e.target.locationInClient().y,this._center.x,this._center.y);this._angleOffset=i-this._map.rotation}_drag(e){if(!this._center||isNaN(this._angleOffset))return;if(this._isDraggingPrevented)return;if(!this._isDragging){if(!this._map.mapCanStartRotating())return void(this._isDraggingPrevented=!0);this._isDragging=!0}this._map.compassRotationWillStart(!0);let t=dc(e.target.locationInClient().x,e.target.locationInClient().y,this._center.x,this._center.y)-this._angleOffset;t=this._map.compassRotate(t,!0),this._rotateTo(t)}_beginKeyboardRotate(e){const t=this._activeKeyRightAt&&e.keyCode===n,i=this._activeKeyLeftAt&&e.keyCode===s;if(t||i)return;const o=Date.now();e.keyCode===n?this._activeKeyRightAt=o:this._activeKeyLeftAt=o,this._map.mapCanStartRotating()&&(this._timeAtLastFrame=o,Mt.scheduleASAP(this),this._map.compassRotationWillStart(!1))}_keyboardRotate(){const e=Math.max(this._activeKeyRightAt||0,this._activeKeyLeftAt||0);if(!e||!this._timeAtLastFrame)return;const t=Date.now();let i=this._rotation;const s=t-this._timeAtLastFrame;i+=(4*(e===this._activeKeyLeftAt)?-1:1)*(60*s)/1e3,this._map.compassRotate(i,!1),this._timeAtLastFrame=Date.now()}_endKeyboardRotate(e){e.keyCode===n?this._activeKeyRightAt=null:this._activeKeyLeftAt=null,this._activeKeyRightAt||this._activeKeyLeftAt||(this._timeAtLastFrame=null),this._map.mapDidStopRotating(),this._map.compassRotationDidEnd()}_handleSliderChange(e){const t=parseInt(e.target.value);if(t===this._rotation)return;let i=t;0===t?i=360:360===t&&(i=0),this.rotation=i,this._map.setRotationAnimated(i,!1,!0)}_updateSlider(){const e=Math.round(this._rotation);this._slider.value=e;const t=es.get(1===e?"Compass.Degrees.Single":"Compass.Degrees.Plural",{n:e});this._sliderNode.setAttribute("aria-label",t)}},gc=["ca-ES","en-GB","en-US","es-ES","es-MX","hi-IN","id-ID","ja-JP","ko-KR","ms-MY","nb-NO","pt-BR","pt-PT","ro-RO","zh-CN","zh-HK","zh-TW"],_c=Xs,fc="mk-rtl",yc="mk-autonavi",vc="mk-controls-container-controls-normal",bc="mk-controls-container-controls-larger",wc="mk-text-zoom",Cc=["mk-top-right-controls-container-children-none","mk-top-right-controls-container-children-one","mk-top-right-controls-container-children-two"],kc="mk-with-zoom-control",Sc="mk-pill-focus",Mc="mk-pill-pressed",Lc=new cs(7,11);class xc extends _o{constructor(e){super(Bo.htmlElement("div",{class:"mk-controls-container"})),this._rtl=!1,this._map=e,this._topRightControlsNode=new _o(Bo.htmlElement("div",{class:this._getTopRightControlsClass()})),this._bottomRightControlsNode=new _o(Bo.htmlElement("div",{class:"mk-bottom-right-controls-container"})),this._bottomLeftControlsNode=new _o(Bo.htmlElement("div",{class:"mk-bottom-left-controls-container"})),this._setPendingControls(),this._shadowRootNode=Bo.addShadowRootChild(this,Ze.shadowDOMMode,'@media (inverted-colors){:host(.mk-controls) img,:host(.mk-controls-container) img{filter:initial}}:host(.mk-controls-container) *{box-sizing:content-box}:host(.mk-controls-container) ::selection{background:0 0}.mk-error-message{font-family:-apple-system-font,"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:calc(100% * 13 / var(--font-size-default));width:200px;padding:10px;pointer-events:auto}.mk-error-support{white-space:nowrap}:host(.mk-controls) :focus,:host(.mk-controls-container) :focus{outline:0}:host(.mk-controls){container-name:controls-container;container-type:size;--logo-xmin:0;--logo-xmax:1;display:flex;flex-direction:row;justify-content:flex-end}.mk-logo-control .mk-logo{vertical-align:bottom;width:auto}:host(.mk-controls-container) .mk-bottom-left-controls-container{--logo-width:101px;--logo-margin:4px;--logo-height:24px;--logo-xmin:1;--logo-xmax:0;font:16px sans-serif;--font-size-default:16}.mk-cq-logo-control .mk-logo{display:block;--logo-width:101px;--logo-height:24px;--logo-margin:4px;width:calc(var(--logo-width) + var(--logo-margin) * 2);height:var(--logo-height);margin:0 calc(var(--logo-margin) * -1);transition:width .3s ease-in-out,height .3s ease-in-out}@container controls-container (min-width:1240px){.mk-cq-logo-control .mk-logo{--logo-width:126.25px;--logo-height:30px;--logo-margin:5px}}:host(.mk-controls-container.mk-text-zoom) .mk-bottom-left-controls-container{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-controls-container.mk-text-zoom) .mk-bottom-left-controls-container{font:-apple-system-body;--font-size-default:17}}:host(.mk-controls-container) .mk-bottom-left-controls-container.mk-controls-container-controls-larger{--logo-width:126.25px;--logo-height:30px;--logo-margin:5px}:host(.mk-controls-container) .mk-bottom-left-controls-container.mk-autonavi{--logo-width:68px;--logo-height:45px;--logo-margin:0}:host(.mk-controls-container) .mk-bottom-left-controls-container.mk-autonavi.mk-controls-container-controls-larger{--logo-width:85px;--logo-height:56.25px}:host(.mk-controls-container) div.mk-logo-control img.mk-logo{width:calc(var(--logo-width) + var(--logo-margin) * 2);height:var(--logo-height);margin:0 calc(var(--logo-margin) * -1);transition:width .3s ease-in-out,height .3s ease-in-out}.mk-legal{height:calc(1em * 16 / var(--font-size-default));padding:0 6px;margin:2px 4px;border-radius:5px;pointer-events:auto;z-index:1;text-align:center;vertical-align:middle;line-height:calc(100% * 12 / var(--font-size-default));cursor:pointer;white-space:nowrap}.mk-legal .mk-legal-label{display:inline-block;font-size:calc(100% * 9 / var(--font-size-default));font-family:-apple-system-font,"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:500;white-space:nowrap}.mk-legal .mk-legal-link{display:inline-block;padding:2px 4px;margin:-2px -4px;border-radius:5px}.mk-legal a>.mk-legal-label{text-decoration:underline}.mk-legal .mk-legal-label:has(+ .mk-legal-link:last-child),.mk-legal .mk-legal-link:last-child{transition-property:opacity,display;transition-duration:.5s;transition-behavior:allow-discrete}.mk-legal .mk-legal-label:has(+ .mk-legal-link:last-child[data-error]),.mk-legal .mk-legal-link:last-child[data-error]{display:none;opacity:0}.mk-legal .mk-legal-label:has(+ .mk-legal-link:last-child:not([data-error])),.mk-legal .mk-legal-link:last-child:not([data-error]){display:inline-block;opacity:1}.mk-cq-legal{--logo-width:101px;--logo-height:24px;--logo-margin:4px}@container controls-container (min-width:1240px){.mk-cq-legal{--logo-width:126.25px;--logo-height:30px;--logo-margin:4px}}@container controls-container (max-width:201px){.mk-cq-legal{transition:none}}:host(.mk-controls-container) .mk-bottom-right-controls-container{font:16px sans-serif;--font-size-default:16}:host(.mk-controls-container.mk-text-zoom) .mk-bottom-right-controls-container{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-controls-container.mk-text-zoom) .mk-bottom-right-controls-container{font:-apple-system-body;--font-size-default:17}}.mk-zoom-controls{width:48px;height:24px;border-radius:25%/50%;pointer-events:auto;transition:width .3s ease-in-out,height .3s ease-in-out}.mk-controls-container-controls-larger .mk-zoom-controls{width:60px;height:30px}.mk-zoom-controls .mk-zoom-in .mk-icon,.mk-zoom-controls .mk-zoom-out .mk-icon{pointer-events:none;display:block;opacity:.55}.mk-zoom-controls .mk-zoom-in.mk-pressed .mk-icon,.mk-zoom-controls .mk-zoom-in:focus .mk-icon,.mk-zoom-controls .mk-zoom-out.mk-pressed .mk-icon,.mk-zoom-controls .mk-zoom-out:focus .mk-icon{opacity:.85}@media not all and (hover:none){.mk-zoom-controls .mk-zoom-in:hover .mk-icon,.mk-zoom-controls .mk-zoom-out:hover .mk-icon{opacity:.85}}.mk-zoom-controls .mk-zoom-in.mk-disabled .mk-icon,.mk-zoom-controls .mk-zoom-out.mk-disabled .mk-icon{opacity:.2}.mk-zoom-controls .mk-zoom-in,.mk-zoom-controls .mk-zoom-out{position:absolute;z-index:2;width:50%;height:100%;cursor:pointer}.mk-zoom-controls .mk-divider{position:absolute;left:calc(50% - 1px);width:2px;height:100%;box-sizing:border-box;z-index:100}:host(.mk-controls-container) .mk-top-left-controls-container{font:16px sans-serif;--font-size-default:16}:host(.mk-controls-container.mk-text-zoom) .mk-top-left-controls-container{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-controls-container.mk-text-zoom) .mk-top-left-controls-container{font:-apple-system-body;--font-size-default:17}}.mk-top-right-controls-container{position:relative;width:0;height:24px;transition:width .3s ease-in-out,height .3s ease-in-out}:host(.mk-controls-container) .mk-top-right-controls-container{font:16px sans-serif;--font-size-default:16}:host(.mk-controls-container.mk-text-zoom) .mk-top-right-controls-container{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-controls-container.mk-text-zoom) .mk-top-right-controls-container{font:-apple-system-body;--font-size-default:17}}.mk-controls-container-controls-larger.mk-top-right-controls-container{height:30px}.mk-top-right-controls-container-children-one{width:45px;border-radius:20%/37.5%}.mk-controls-container-controls-larger.mk-top-right-controls-container-children-one{width:56.25px}.mk-top-right-controls-container-children-two{width:90px;border-radius:10%/37.5%}.mk-controls-container-controls-larger.mk-top-right-controls-container-children-two{width:112.5px}:host(.mk-controls-container) .mk-map-type-control,:host(.mk-controls-container) .mk-user-location-control{display:inline-block;position:absolute;width:45px;height:24px;cursor:pointer;pointer-events:auto;transition:width .3s ease-in-out,height .3s ease-in-out}:host(.mk-controls-container) .mk-user-location-control{left:0}:host(.mk-controls-container.mk-rtl) .mk-user-location-control{left:auto;right:0}:host(.mk-controls-container) .mk-map-type-control{right:0}:host(.mk-controls-container.mk-rtl) .mk-map-type-control{left:0;right:auto}:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-map-type-control,:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-user-location-control{width:56.25px;height:30px}:host(.mk-controls-container) .mk-user-location-control .mk-icon{position:absolute;left:0;height:100%;width:100%;display:block;transition:transform .2s ease-in-out}:host(.mk-controls-container) .mk-user-location-control .mk-scaled-out{transform:scale(0)}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect{animation:.8s infinite mk-spinner}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(2){animation-delay:-.1s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(3){animation-delay:-.2s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(4){animation-delay:-.3s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(5){animation-delay:-.4s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(6){animation-delay:-.5s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(7){animation-delay:-.6s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(8){animation-delay:-.7s}@keyframes mk-spinner{0%{opacity:1}88%{opacity:.15}}:host(.mk-controls-container) .mk-map-type-control .mk-icon,:host(.mk-controls-container) .mk-user-location-control .mk-icon{pointer-events:none;display:block;opacity:.55}:host(.mk-controls-container) .mk-map-type-control.mk-pressed .mk-icon,:host(.mk-controls-container) .mk-map-type-control:focus .mk-icon,:host(.mk-controls-container) .mk-map-type-control:hover .mk-icon,:host(.mk-controls-container) .mk-user-location-control.mk-pressed .mk-icon,:host(.mk-controls-container) .mk-user-location-control:focus .mk-icon,:host(.mk-controls-container) .mk-user-location-control:hover .mk-icon{opacity:.85}@media (hover:none){:host(.mk-controls-container) .mk-map-type-control:hover:not(.mk-pressed,:focus) .mk-icon,:host(.mk-controls-container) .mk-user-location-control:hover:not(.mk-pressed,:focus) .mk-icon{opacity:.55}}:host(.mk-controls-container) .mk-popover{visibility:hidden;transform:scale(.5);opacity:0;border-radius:10px;transition:.2s opacity cubic-bezier(.25, .1, .25, 1),.2s visibility step-end,.2s transform step-end;will-change:transform,opacity,visibility;border-width:1px;border-style:solid;cursor:default}:host(.mk-controls-container) .mk-popover.mk-shown{visibility:visible;pointer-events:auto;transform:none;opacity:1;transition:.2s transform cubic-bezier(.25, .1, .25, 1.3),.2s opacity cubic-bezier(.25, .1, .25, 1.3)}:host(.mk-controls-container) .mk-popover-arrow path{stroke-width:1px}:host(.mk-controls-container) .mk-map-type-popover{width:241px;padding:20px 20px 0}:host(.mk-controls-container) .mk-map-type-popover>div{width:67px;display:inline-block}:host(.mk-controls-container) .mk-map-type-label{margin-top:10px;margin-bottom:17px;text-align:center;font-size:calc(100% * 13 / var(--font-size-default));line-height:calc(16 / 13 * 100%);font-family:-apple-system-font,HelveticaNeue-Medium,Helvetica,Arial,sans-serif}.mk-map-type-button{position:relative;display:block;cursor:pointer;width:65px;height:52px}.mk-map-type-button input{appearance:none;padding:0;margin:0}.mk-map-type-button img,.mk-map-type-button input,.mk-map-type-button::after{position:absolute;top:0;left:0;width:65px;height:52px;border-radius:8px}.mk-map-type-button::after{content:""}:host(.mk-controls-container) .mk-map-type-button img.mk-dark-icon,:host(.mk-controls-container.mk-color-scheme-dark) .mk-map-type-button img.mk-light-icon{display:none}:host(.mk-controls-container.mk-color-scheme-dark) .mk-map-type-button img.mk-dark-icon{display:block}.mk-badge{position:absolute;--font-size:13.5;font:calc(100% * var(--font-size) / var(--font-size-default)) -apple-system-font,HelveticaNeue-Medium,Helvetica,Arial,sans-serif;font-weight:500;pointer-events:auto;height:calc(1em / var(--font-size) * 36);appearance:none;border:none;border-radius:10px;padding:6px 10px;display:flex;align-items:center;gap:5px;max-width:calc(100% - 18px)}:host(.mk-controls) .mk-badge svg.mk-icon{pointer-events:none;display:inline-block;margin:auto;width:calc(1em / var(--font-size) * 15);height:calc(1em / var(--font-size) * 15);opacity:.55}.mk-badge .mk-badge-label{opacity:.55;pointer-events:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mk-badge:active .mk-badge-label,.mk-badge:focus-visible .mk-badge-label{opacity:.85}.mk-open-dialog{pointer-events:auto;--font-size:13.5;font-size:calc(100% * var(--font-size) / var(--font-size-default));width:calc(1em / var(--font-size) * 36);height:calc(1em / var(--font-size) * 36);appearance:none;border:none;border-radius:10px}:host(.mk-controls) .mk-open-dialog svg.mk-icon{pointer-events:none;display:block;margin:auto;width:calc(1em / var(--font-size) * 15);height:calc(1em / var(--font-size) * 15);opacity:.55}:host(.mk-controls.mk-rtl) .mk-open-dialog svg.mk-icon{transform:scale(-1,1)}.mk-transition-path{transition:.5s fill ease-in-out}.mk-transition-path.mk-path-hidden{fill:transparent}:host(.mk-controls) .mk-open-dialog:active svg.mk-icon,:host(.mk-controls) .mk-open-dialog:focus-visible svg.mk-icon{opacity:.85}.mk-close{--font-size:13.5;font:calc(100% * var(--font-size) / var(--font-size-default)) HelveticaNeue-Medium,Helvetica,Arial,sans-serif;font-weight:500;pointer-events:auto;height:calc(1em / var(--font-size) * 36);appearance:none;border:none;border-radius:10px;padding:6px 10px}.mk-close .mk-close-label{opacity:.55;pointer-events:none}.mk-close:active .mk-close-label,.mk-close:focus-visible .mk-close-label{opacity:.85}@media not all and (hover:none){:host(.mk-controls) .mk-badge:hover svg.mk-icon,:host(.mk-controls) .mk-open-dialog:hover svg.mk-icon{opacity:.85}.mk-badge:hover .mk-badge-label,.mk-close:hover .mk-close-label{opacity:.85}}.mk-style-helper{opacity:0;pointer-events:none}.mk-compass,.mk-rotation-control{pointer-events:auto;border-radius:50%;overflow:hidden;line-height:0;transition:opacity .1s cubic-bezier(.19, 1, .22, 1)}.mk-compass{--font-size:15.5;font-size:calc(100% * var(--font-size) / var(--font-size-default));width:calc(1em / var(--font-size) * 48);height:calc(1em / var(--font-size) * 48)}.mk-compass.mk-compass-small{transform:scale(.75)}.mk-rotation-control{width:48px;height:48px;cursor:grab}.mk-rotation-control.mk-pressed{cursor:grabbing}@supports ((backdrop-filter:blur(30px)) or (-webkit-backdrop-filter:blur(30px))){.mk-badge,.mk-close,.mk-compass,.mk-focus .mk-zoom-in,.mk-focus .mk-zoom-out,.mk-legal-link:focus-visible,.mk-legal:focus-visible,.mk-open-dialog,.mk-pill-focus .mk-map-type-control,.mk-pill-focus .mk-user-location-control,.mk-pill-pressed .mk-map-type-control,.mk-pill-pressed .mk-user-location-control,.mk-pill-pressed .mk-zoom-in,.mk-pill-pressed .mk-zoom-out,.mk-rotation-control,.mk-top-right-controls-container:not( .mk-pill-pressed,.mk-pill-focus,:empty ),.mk-zoom-controls:not(.mk-pill-pressed,.mk-focus){-webkit-backdrop-filter:blur(30px);backdrop-filter:blur(30px)}}.mk-compass>.mk-compass-wrapper,.mk-rotation-control>.mk-rotation-wrapper{width:100%;height:100%;position:absolute;will-change:transform;overflow:hidden;pointer-events:none}.mk-compass>.mk-compass-wrapper>svg{display:block;width:100%;height:100%}.mk-rotation-control>.mk-rotation-wrapper>img{position:absolute;left:0;top:0;width:200%;height:200%;pointer-events:none}.mk-rotation-control.mk-focus>.mk-rotation-wrapper>img,.mk-rotation-control.mk-pressed>.mk-rotation-wrapper>img,.mk-rotation-control:hover>.mk-rotation-wrapper>img{left:-100%}.mk-compass .mk-compass-part-dial{fill-opacity:0.12}.mk-compass .mk-compass-part-dial-ews{fill-opacity:0.64}.mk-compass:is(:hover,:active) .mk-compass-part-dial-ews{fill-opacity:1}@media (hover:none){.mk-rotation-control:hover:not(.mk-focus,.mk-pressed)>.mk-rotation-wrapper>img{left:0}}:host(.mk-dark-mode) .mk-rotation-control>.mk-rotation-wrapper>img{top:-100%}.mk-compass .mk-compass-heading,.mk-rotation-control .mk-heading{font:15.5px -apple-system-font,HelveticaNeue-Medium,Helvetica,Arial,sans-serif;font-weight:500;position:absolute;left:0;width:100%;overflow:hidden;text-overflow:clip;text-align:center;opacity:.55;pointer-events:none}.mk-compass .mk-compass-heading{top:0;line-height:48px}.mk-rotation-control .mk-heading{top:calc(50% - 1em / 15.5 * 10.5);line-height:19px}.mk-compass:active .mk-compass-heading,.mk-compass:hover .mk-compass-heading,.mk-rotation-control.mk-focus .mk-heading,.mk-rotation-control.mk-pressed .mk-heading,.mk-rotation-control:hover .mk-heading{opacity:.85}.mk-compass:has(:focus-visible) .mk-compass-heading{opacity:.85}@media (hover:none){.mk-rotation-control:not(.mk-focus,.mk-pressed):hover .mk-heading{opacity:.55}.mk-compass:not(:has(:focus-visible),:active):hover .mk-compass-heading{opacity:.55}}.mk-rotation-control .mk-rotation-slider{position:absolute;left:0;width:100%;height:15px;top:-30px}.mk-compass-slider{all:initial;opacity:0;position:absolute;display:block;width:100%;height:100%;top:0;left:0;border-radius:24px;margin:0;padding:0}.mk-compass.mk-compass-reset-only .mk-compass-slider{cursor:pointer}.mk-compass:not(.mk-compass-reset-only) .mk-compass-slider{cursor:grab}.mk-compass:not(.mk-compass-reset-only) .mk-compass-slider:active{cursor:grabbing}.mk-compass-slider::-webkit-slider-runnable-track,.mk-compass-slider::-webkit-slider-thumb{all:initial;appearance:none;display:block;width:100%;height:100%;top:0;left:0}.mk-compass-slider::-moz-range-progress,.mk-compass-slider::-moz-range-thumb,.mk-compass-slider::-moz-range-track{all:initial;appearance:none;display:block;width:100%;height:100%}:host(.mk-controls-container.mk-dragging-annotation) .mk-legal,:host(.mk-controls-container.mk-dragging-annotation) .mk-map-type-control,:host(.mk-controls-container.mk-dragging-annotation) .mk-rotation-control,:host(.mk-controls-container.mk-dragging-annotation) .mk-rotation-control input,:host(.mk-controls-container.mk-dragging-annotation) .mk-user-location-control,:host(.mk-controls-container.mk-dragging-annotation) .mk-zoom-in,:host(.mk-controls-container.mk-dragging-annotation) .mk-zoom-out{cursor:none}.mk-compass,.mk-rotation-control,.mk-top-right-controls-container:not(.mk-pill-pressed,.mk-pill-focus,:empty),.mk-zoom-controls{box-shadow:0 0 0 .5px rgb(0 0 0 / 5%)}.mk-compass,.mk-focus .mk-zoom-in,.mk-focus .mk-zoom-out,.mk-pill-focus .mk-map-type-control,.mk-pill-focus .mk-user-location-control,.mk-pill-pressed .mk-map-type-control,.mk-pill-pressed .mk-user-location-control,.mk-pill-pressed .mk-zoom-in,.mk-pill-pressed .mk-zoom-out,.mk-rotation-control,.mk-top-right-controls-container:not(.mk-pill-pressed,.mk-pill-focus,:empty),.mk-zoom-controls:not(.mk-pill-pressed,.mk-focus){background-color:rgb(255 255 255)}.mk-compass:active,.mk-map-type-control.mk-pressed,.mk-rotation-control.mk-pressed,.mk-user-location-control.mk-pressed,.mk-zoom-controls .mk-zoom-in.mk-pressed:not(.mk-disabled),.mk-zoom-controls .mk-zoom-out.mk-pressed:not(.mk-disabled){background-color:rgb(229 229 229)}.mk-legal-link:focus-visible,.mk-legal:focus-visible,.mk-map-type-control:focus,.mk-rotation-control.mk-focus,.mk-user-location-control:focus,.mk-zoom-controls.mk-focus .mk-zoom-in:focus,.mk-zoom-controls.mk-focus .mk-zoom-out:focus{background-color:rgb(204 229 255)}.mk-legal-link:focus-visible,.mk-legal:focus-visible,.mk-map-type-control:focus,.mk-pill-focus .mk-map-type-control,.mk-pill-focus .mk-user-location-control,.mk-rotation-control.mk-focus,.mk-user-location-control:focus,.mk-zoom-controls.mk-focus{box-shadow:0 0 0 2px rgb(0 124 255)}.mk-compass:has(:focus-visible){background-color:rgb(204 229 255);box-shadow:0 0 0 2px rgb(0 124 255)}.mk-map-type-control.mk-focus.mk-pressed,.mk-rotation-control.mk-focus.mk-pressed,.mk-user-location-control.mk-focus.mk-pressed,.mk-zoom-controls.mk-focus .mk-zoom-in.mk-pressed:focus,.mk-zoom-controls.mk-focus .mk-zoom-out.mk-pressed:focus{background-color:rgb(127 189 255)}.mk-compass:has(:focus-visible):active{background-color:rgb(127 189 255)}.mk-zoom-controls.mk-focus .mk-divider{border-left:2px solid rgb(0 124 255)}.mk-map-type-control .mk-icon,.mk-user-location-control .mk-icon,.mk-zoom-controls .mk-icon{fill:#000}:host(.mk-controls-container) .mk-popover{background-color:rgb(239 239 239);color:#000;border-color:transparent;box-shadow:0 5px 10px 0 rgb(0 0 0 / 30%)}:host(.mk-controls-container) .mk-popover-arrow{fill:rgb(239 239 239)}.mk-error-message{color:#333}.mk-error-message a{color:#007aff}.mk-error-message a:visited{color:#af52de}.mk-legal .mk-legal-label{color:rgb(0 0 0 / 70%);text-shadow:0 0 1px rgb(255 255 255 / 85%)}.mk-compass .mk-compass-heading,.mk-rotation-control .mk-heading{color:#000}.mk-popover .mk-map-type-button input{box-shadow:0 0 0 .5px rgb(0 0 0 / 14%)}.mk-popover .mk-map-type-button input:checked{box-shadow:0 0 0 2px rgb(0 124 255)}.mk-popover .mk-map-type-button input:focus-visible{box-shadow:0 0 0 4px rgb(0 124 255 / 40%)}.mk-popover .mk-map-type-button input:checked:focus-visible{box-shadow:0 0 0 2px rgb(0 124 255),0 0 0 4px rgb(0 124 255 / 40%)}.mk-map-type-button:active::after{background-color:rgb(0 0 0 / 25%)}.mk-compass :is(.mk-compass-part-dial,.mk-compass-part-dial-ews){fill:#000}.mk-compass .mk-compass-part-dial-n{fill:#ff3b30}@supports ((backdrop-filter:blur(30px)) or (-webkit-backdrop-filter:blur(30px))){.mk-compass,.mk-focus .mk-zoom-in,.mk-focus .mk-zoom-out,.mk-pill-focus .mk-map-type-control,.mk-pill-focus .mk-user-location-control,.mk-pill-pressed .mk-map-type-control,.mk-pill-pressed .mk-user-location-control,.mk-pill-pressed .mk-zoom-in,.mk-pill-pressed .mk-zoom-out,.mk-rotation-control,.mk-top-right-controls-container:not( .mk-pill-pressed,.mk-pill-focus,:empty ),.mk-zoom-controls:not(.mk-pill-pressed,.mk-focus){background-color:rgb(255 255 255 / 75%)}.mk-compass:active,.mk-map-type-control.mk-pressed,.mk-rotation-control.mk-pressed,.mk-user-location-control.mk-pressed,.mk-zoom-controls .mk-zoom-in.mk-pressed:not(.mk-disabled),.mk-zoom-controls .mk-zoom-out.mk-pressed:not(.mk-disabled){background-color:rgb(229 229 229 / 60%)}.mk-legal-link:focus-visible,.mk-legal:focus-visible,.mk-map-type-control.mk-focus,.mk-rotation-control.mk-focus,.mk-user-location-control.mk-focus,.mk-zoom-controls.mk-focus .mk-zoom-in:focus,.mk-zoom-controls.mk-focus .mk-zoom-out:focus{background-color:rgb(204 229 255 / 60%)}.mk-compass:has(:focus-visible){background-color:rgb(204 229 255 / 60%)}.mk-map-type-control.mk-focus.mk-pressed,.mk-rotation-control.mk-focus.mk-pressed,.mk-user-location-control.mk-focus.mk-pressed,.mk-zoom-controls.mk-focus .mk-zoom-in.mk-pressed:focus,.mk-zoom-controls.mk-focus .mk-zoom-out.mk-pressed:focus{background-color:rgb(127 189 255 / 60%)}.mk-compass:has(:focus-visible):active{background-color:rgb(127 189 255 / 60%)}}:host(.mk-dark-mode) .mk-compass,:host(.mk-dark-mode) .mk-rotation-control,:host(.mk-dark-mode) .mk-top-right-controls-container:not( .mk-pill-pressed,.mk-pill-focus,:empty ),:host(.mk-dark-mode) .mk-zoom-controls{box-shadow:0 0 0 .5px rgb(255 255 255 / 5%)}:host(.mk-dark-mode) .mk-badge,:host(.mk-dark-mode) .mk-close,:host(.mk-dark-mode) .mk-compass,:host(.mk-dark-mode) .mk-focus .mk-zoom-in,:host(.mk-dark-mode) .mk-focus .mk-zoom-out,:host(.mk-dark-mode) .mk-open-dialog,:host(.mk-dark-mode) .mk-pill-focus .mk-map-type-control,:host(.mk-dark-mode) .mk-pill-focus .mk-user-location-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-map-type-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-user-location-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-zoom-in,:host(.mk-dark-mode) .mk-pill-pressed .mk-zoom-out,:host(.mk-dark-mode) .mk-rotation-control,:host(.mk-dark-mode) .mk-top-right-controls-container:not( .mk-pill-pressed,.mk-pill-focus,:empty ),:host(.mk-dark-mode) .mk-zoom-controls:not(.mk-pill-pressed,.mk-focus){background-color:rgb(18 18 18)}:host(.mk-dark-mode) .mk-badge:active,:host(.mk-dark-mode) .mk-close:active,:host(.mk-dark-mode) .mk-map-type-control.mk-pressed,:host(.mk-dark-mode) .mk-open-dialog:active,:host(.mk-dark-mode) .mk-user-location-control.mk-pressed,:host(.mk-dark-mode) .mk-zoom-controls .mk-zoom-in.mk-pressed:not(.mk-disabled),:host(.mk-dark-mode) .mk-zoom-controls .mk-zoom-out.mk-pressed:not(.mk-disabled){background-color:rgb(42 42 42)}:host(.mk-dark-mode) .mk-badge:focus-visible,:host(.mk-dark-mode) .mk-close:focus-visible,:host(.mk-dark-mode) .mk-legal-link:focus-visible,:host(.mk-dark-mode) .mk-legal:focus-visible,:host(.mk-dark-mode) .mk-map-type-control.mk-focus,:host(.mk-dark-mode) .mk-open-dialog:focus-visible,:host(.mk-dark-mode) .mk-rotation-control.mk-focus,:host(.mk-dark-mode) .mk-user-location-control.mk-focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-in:focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-out:focus{background-color:rgb(12 49 89)}:host(.mk-dark-mode) .mk-badge:focus-visible,:host(.mk-dark-mode) .mk-close:focus-visible,:host(.mk-dark-mode) .mk-legal-link:focus-visible,:host(.mk-dark-mode) .mk-legal:focus-visible,:host(.mk-dark-mode) .mk-map-type-control:focus,:host(.mk-dark-mode) .mk-open-dialog:focus-visible,:host(.mk-dark-mode) .mk-pill-focus .mk-map-type-control,:host(.mk-dark-mode) .mk-pill-focus .mk-user-location-control,:host(.mk-dark-mode) .mk-rotation-control.mk-focus,:host(.mk-dark-mode) .mk-user-location-control:focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus{box-shadow:0 0 0 2px rgb(0 124 255)}:host(.mk-dark-mode) .mk-compass:has(:focus-visible){background-color:rgb(12 49 89);box-shadow:0 0 0 2px rgb(0 124 255)}:host(.mk-dark-mode) .mk-badge:focus-visible:active,:host(.mk-dark-mode) .mk-close:focus-visible:active,:host(.mk-dark-mode) .mk-map-type-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-open-dialog:focus-visible:active,:host(.mk-dark-mode) .mk-rotation-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-user-location-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-in.mk-pressed:focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-out.mk-pressed:focus{background-color:rgb(3 102 207)}:host(.mk-dark-mode) .mk-compass:has(:focus-visible):active{background-color:rgb(3 102 207)}:host(.mk-dark-mode) .mk-badge .mk-icon,:host(.mk-dark-mode) .mk-map-type-control .mk-icon,:host(.mk-dark-mode) .mk-open-dialog .mk-icon,:host(.mk-dark-mode) .mk-user-location-control .mk-icon,:host(.mk-dark-mode) .mk-zoom-controls .mk-icon{fill:#fff}:host(.mk-dark-mode) .mk-badge-label,:host(.mk-dark-mode) .mk-close-label{color:#fff}:host(.mk-controls-container.mk-dark-mode) .mk-popover{background-color:rgb(54 54 54);color:#fff;border-color:rgb(90 92 100)}:host(.mk-controls-container.mk-dark-mode) .mk-popover-arrow{fill:rgb(54 54 54)}:host(.mk-controls-container.mk-dark-mode) .mk-popover-arrow path{stroke:rgb(90 92 100)}:host(.mk-dark-mode) .mk-error-message{color:rgb(255 255 255 / 85%)}:host(.mk-dark-mode) .mk-error-message a{color:#0a84ff}:host(.mk-dark-mode) .mk-error-message a:visited{color:#bf5af2}:host(.mk-dark-mode) .mk-legal .mk-legal-label{color:rgb(255 255 255 / 90%);text-shadow:0 0 1px rgb(0 0 0 / 50%),0 0 6px rgb(0 0 0 / 50%)}:host(.mk-dark-mode) .mk-compass .mk-compass-heading,:host(.mk-dark-mode) .mk-rotation-control .mk-heading{color:#fff}:host(.mk-dark-mode) .mk-popover .mk-map-type-button input:not(:checked,:focus-visible){box-shadow:0 0 0 .5px rgb(255 255 255 / 30%)}:host(.mk-dark-mode) .mk-compass :is(.mk-compass-part-dial,.mk-compass-part-dial-ews){fill:#fff}:host(.mk-dark-mode) .mk-compass .mk-compass-part-dial-n{fill:#ff453a}@supports ((backdrop-filter:blur(30px)) or (-webkit-backdrop-filter:blur(30px))){:host(.mk-dark-mode) .mk-badge,:host(.mk-dark-mode) .mk-close,:host(.mk-dark-mode) .mk-compass,:host(.mk-dark-mode) .mk-focus .mk-zoom-in,:host(.mk-dark-mode) .mk-focus .mk-zoom-out,:host(.mk-dark-mode) .mk-open-dialog,:host(.mk-dark-mode) .mk-pill-focus .mk-map-type-control,:host(.mk-dark-mode) .mk-pill-focus .mk-user-location-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-map-type-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-user-location-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-zoom-in,:host(.mk-dark-mode) .mk-pill-pressed .mk-zoom-out,:host(.mk-dark-mode) .mk-rotation-control,:host(.mk-dark-mode) .mk-top-right-controls-container:not( .mk-pill-pressed,.mk-pill-focus,:empty ),:host(.mk-dark-mode) .mk-zoom-controls:not(.mk-pill-pressed,.mk-focus){background-color:rgb(18 18 18 / 60%)}:host(.mk-dark-mode) .mk-badge:active,:host(.mk-dark-mode) .mk-close:active,:host(.mk-dark-mode) .mk-compass:active,:host(.mk-dark-mode) .mk-map-type-control.mk-pressed,:host(.mk-dark-mode) .mk-open-dialog:active,:host(.mk-dark-mode) .mk-rotation-control.mk-pressed,:host(.mk-dark-mode) .mk-type-control.mk-pressed,:host(.mk-dark-mode) .mk-user-location-control.mk-pressed,:host(.mk-dark-mode) .mk-zoom-controls .mk-zoom-in.mk-pressed:not(.mk-disabled),:host(.mk-dark-mode) .mk-zoom-controls .mk-zoom-out.mk-pressed:not(.mk-disabled){background-color:rgb(42 42 42 / 60%)}:host(.mk-dark-mode) .mk-badge:focus-visible,:host(.mk-dark-mode) .mk-close:focus-visible,:host(.mk-dark-mode) .mk-legal-link:focus-visible,:host(.mk-dark-mode) .mk-legal:focus-visible,:host(.mk-dark-mode) .mk-map-type-control.mk-focus,:host(.mk-dark-mode) .mk-open-dialog:focus-visible,:host(.mk-dark-mode) .mk-rotation-control.mk-focus,:host(.mk-dark-mode) .mk-user-location-control.mk-focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-in:focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-out:focus{background-color:rgb(12 49 89 / 60%)}:host(.mk-dark-mode) .mk-compass:has(:focus-visible){background-color:rgb(12 49 89 / 60%)}:host(.mk-dark-mode) .mk-badge:focus-visible:active,:host(.mk-dark-mode) .mk-close:focus-visible:active,:host(.mk-dark-mode) .mk-map-type-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-open-dialog:focus-visible:active,:host(.mk-dark-mode) .mk-rotation-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-user-location-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-in.mk-pressed:focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-out.mk-pressed:focus{background-color:rgb(3 102 207 / 60%)}:host(.mk-dark-mode) .mk-compass:has(:focus-visible):active{background-color:rgb(3 102 207 / 60%)}}.mk-scale{position:absolute;top:0;left:0;vertical-align:top}:host(.mk-rtl) .mk-scale{direction:rtl}:host(.mk-controls-container) .mk-popover{position:absolute;top:38px;right:-1px}:host(.mk-controls-container) .mk-popover-arrow{position:absolute;top:-13px}.mk-top-right-controls-container{position:absolute;top:9px;right:9px;direction:ltr}:host(.mk-controls-container:not(.mk-rtl)) .mk-top-right-controls-container>.mk-control:first-child{border-top-left-radius:20% 37.5%;border-bottom-left-radius:20% 37.5%}:host(.mk-controls-container:not(.mk-rtl)) .mk-top-right-controls-container>.mk-control:nth-last-child(2){border-top-right-radius:20% 37.5%;border-bottom-right-radius:20% 37.5%}:host(.mk-controls-container) .mk-popover.mk-user-location-error-popover{transform-origin:calc(100% - 69px) -12.416px}:host(.mk-controls-container) .mk-popover.mk-map-type-popover,:host(.mk-controls-container) .mk-popover.mk-user-location-error-popover:last-child{transform-origin:calc(100% - 24px) -12.416px}:host(.mk-controls-container) .mk-popover.mk-user-location-error-popover>.mk-popover-arrow{right:52.5px}:host(.mk-controls-container) .mk-popover.mk-map-type-popover>.mk-popover-arrow,:host(.mk-controls-container) .mk-popover.mk-user-location-error-popover:last-child>.mk-popover-arrow{right:10px}:host(.mk-controls-container) .mk-map-type-popover>div:not(:last-child){margin-right:20px}:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-popover{top:44px}:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-popover.mk-user-location-error-popover>.mk-popover-arrow{right:65px}:host(.mk-rtl) .mk-top-right-controls-container{left:9px;right:auto;direction:rtl}:host(.mk-controls-container.mk-rtl) .mk-top-right-controls-container>.mk-control:first-child{border-top-right-radius:20% 37.5%;border-bottom-right-radius:20% 37.5%}:host(.mk-controls-container.mk-rtl) .mk-top-right-controls-container>.mk-control:nth-last-child(2){border-top-left-radius:20% 37.5%;border-bottom-left-radius:20% 37.5%}:host(.mk-controls-container.mk-rtl) .mk-popover{right:auto;left:-1px}:host(.mk-controls-container.mk-rtl) .mk-popover.mk-user-location-error-popover{transform-origin:69px -12.416px}:host(.mk-controls-container.mk-rtl) .mk-popover.mk-map-type-popover,:host(.mk-controls-container.mk-rtl) .mk-popover.mk-user-location-error-popover:last-child{transform-origin:24px -12.416px}:host(.mk-controls-container.mk-rtl) .mk-popover.mk-user-location-error-popover>.mk-popover-arrow{right:auto;left:52.5px}:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-popover.mk-map-type-popover>.mk-popover-arrow{right:12px}:host(.mk-controls-container.mk-rtl) .mk-popover.mk-map-type-popover>.mk-popover-arrow,:host(.mk-controls-container.mk-rtl) .mk-popover.mk-user-location-error-popover:last-child>.mk-popover-arrow{right:auto;left:10px}:host(.mk-controls-container.mk-rtl) .mk-controls-container-controls-larger .mk-popover.mk-user-location-error-popover>.mk-popover-arrow{right:auto;left:69.75px}:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-popover.mk-user-location-error-popover:last-child>.mk-popover-arrow{right:12px}:host(.mk-controls-container.mk-rtl) .mk-controls-container-controls-larger .mk-popover.mk-map-type-popover>.mk-popover-arrow,:host(.mk-controls-container.mk-rtl) .mk-controls-container-controls-larger .mk-popover.mk-user-location-error-popover:last-child>.mk-popover-arrow{right:auto;left:13.25px}:host(.mk-controls-container.mk-rtl) .mk-map-type-popover>div:not(:last-child){margin-left:20px;margin-right:0}.mk-bottom-left-controls-container,.mk-bottom-right-controls-container{position:absolute;bottom:9px}.mk-rotation-control,.mk-zoom-controls{position:absolute;bottom:0}.mk-compass{position:absolute;top:9px}.mk-close,.mk-open-dialog{margin-block-start:9px;margin-inline-end:9px}.mk-close~.mk-compass,.mk-open-dialog~.mk-compass{top:calc(9px + 9px + 1em / var(--font-size) * 36)}@container controls-container (max-width:100px) or (max-height:100px){:host(.mk-controls) .mk-close,:host(.mk-controls) .mk-compass{display:none}}@container controls-container (max-width:200px) or (max-height:100px){:host(.mk-controls.mk-long-legal) .mk-close,:host(.mk-controls.mk-long-legal) .mk-compass{display:none}}.mk-badge.mk-badge-top{top:9px}.mk-badge.mk-badge-bottom{bottom:9px}@container controls-container (max-width:200px) or (max-height:100px){.mk-badge>.mk-badge-label{display:none}}@container controls-container (max-width:400px){.mk-badge>.mk-badge.mk-badge-bottom{display:none}}:host(.mk-rtl)>.mk-badge.mk-badge-trailing,:host(:not(.mk-rtl))>.mk-badge.mk-badge-leading{left:9px}:host(.mk-rtl)>.mk-badge.mk-badge-leading,:host(:not(.mk-rtl))>.mk-badge.mk-badge-trailing{right:9px}.mk-legal,.mk-logo-control{position:absolute}.mk-cq-logo-control{position:absolute;--control-margin:9px;bottom:5px}@container controls-container (max-width:100px) or (max-height:100px){:host(.mk-controls) .mk-cq-logo-control{display:none}}@container controls-container (max-width:200px) or (max-height:100px){:host(.mk-controls.mk-long-legal) .mk-cq-logo-control{display:none}}.mk-logo-control,:host(.mk-controls-container) .mk-legal{bottom:-4px}.mk-cq-legal{bottom:5px;--control-margin:9px}@container controls-container (max-width:100px) or (max-height:100px){.mk-cq-legal{--control-margin:4px}}@container controls-container (max-width:200px) or (max-height:100px){:host(.mk-long-legal) .mk-cq-legal{--control-margin:4px}}.mk-bottom-right-controls-container{right:9px}.mk-bottom-left-controls-container{left:9px}:host(.mk-reduce-margin) .mk-bottom-right-controls-container{right:0}:host(.mk-reduce-margin) .mk-bottom-left-controls-container{left:4px}.mk-logo-control{left:0}:host(.mk-controls:not(.mk-rtl)) .mk-cq-logo-control{left:var(--control-margin)}:host(.mk-controls-container) div.mk-logo-control img.mk-logo.mk-logo-autonavi.mk-logo-autonavi{margin:0 0 -6px -9px}.mk-rotation-control,.mk-zoom-controls,:host(.mk-controls-container) .mk-legal{right:0;left:auto}:host(:not(.mk-rtl))>.mk-compass{right:9px}:host(:not(.mk-rtl))>.mk-compass.mk-compass-small{transform-origin:top right}:host(.mk-controls-container) .mk-legal{right:auto;left:0}:host(:not(.mk-rtl))>:not(.mk-cq-logo-control)+.mk-cq-legal{left:var(--control-margin)}:host(:not(.mk-rtl))>.mk-cq-logo-control+.mk-cq-legal{left:calc((var(--logo-width) + var(--logo-margin)) * var(--logo-xmax) + var(--control-margin))}@container controls-container (max-width:100px) or (max-height:100px){:host(:not(.mk-rtl))>.mk-cq-logo-control+.mk-cq-legal{left:var(--control-margin)}}@container controls-container (max-width:200px) or (max-height:100px){:host(.mk-long-legal:not(.mk-rtl))>.mk-cq-logo-control+.mk-cq-legal{left:var(--control-margin)}}.mk-zoom-controls .mk-zoom-in{border-top-right-radius:50%;border-bottom-right-radius:50%;right:0}.mk-zoom-controls .mk-zoom-out{border-top-left-radius:50%;border-bottom-left-radius:50%;left:0}.mk-rotation-control~.mk-zoom-controls{right:57px;left:auto}:host(.mk-controls-container) .mk-legal:nth-child(2){left:calc((var(--logo-width) + var(--logo-margin)) * var(--logo-xmax))}:host(.mk-rtl) .mk-bottom-right-controls-container{left:9px;right:auto}:host(.mk-rtl) .mk-bottom-left-controls-container{left:auto;right:9px}:host(.mk-rtl.mk-reduce-margin) .mk-bottom-right-controls-container{left:0;right:auto}:host(.mk-rtl.mk-reduce-margin) .mk-bottom-left-controls-container{left:auto;right:4px}:host(.mk-rtl) .mk-logo-control{left:auto;right:0}:host(.mk-controls.mk-rtl) .mk-cq-logo-control{right:var(--control-margin)}:host(.mk-rtl.mk-controls-container) div.mk-logo-control img.mk-logo.mk-logo-autonavi.mk-logo-autonavi{margin:0 -9px -6px 0}:host(.mk-rtl) .mk-zoom-controls .mk-zoom-in{border-top-right-radius:0;border-bottom-right-radius:0;border-top-left-radius:50%;border-bottom-left-radius:50%;right:auto;left:0}:host(.mk-rtl) .mk-zoom-controls .mk-zoom-out{border-top-right-radius:50%;border-bottom-right-radius:50%;border-top-left-radius:0;border-bottom-left-radius:0;right:0;left:auto}:host(.mk-controls-container.mk-rtl) .mk-legal,:host(.mk-rtl) .mk-rotation-control,:host(.mk-rtl) .mk-zoom-controls{left:0;right:auto}:host(.mk-rtl)>.mk-compass{left:9px}:host(.mk-rtl)>.mk-compass.mk-compass-small{transform-origin:top left}:host(.mk-rtl)>:not(.mk-cq-logo-control)+.mk-cq-legal{right:var(--control-margin)}:host(.mk-rtl)>.mk-cq-logo-control+.mk-cq-legal{right:calc((var(--logo-width) - var(--logo-margin)) * (1 - var(--logo-xmin)) + var(--control-margin))}@container controls-container (max-width:100px) or (max-height:100px){:host(.mk-rtl)>.mk-cq-logo-control+.mk-cq-legal{right:var(--control-margin)}}@container controls-container (max-width:200px) or (max-height:100px){:host(.mk-long-legal.mk-rtl)>.mk-cq-logo-control+.mk-cq-legal{right:var(--control-margin)}}:host(.mk-controls-container.mk-rtl) .mk-legal{left:auto;right:0}:host(.mk-rtl) .mk-rotation-control~.mk-zoom-controls{left:57px;right:auto}:host(.mk-controls-container) .mk-autonavi .mk-legal:nth-child(2){left:calc(var(--logo-width) * var(--logo-xmax) - 9px)}:host(.mk-controls-container.mk-rtl) .mk-legal:nth-child(2){right:calc((var(--logo-width) - var(--logo-margin)) * (1 - var(--logo-xmin)))}:host(.mk-controls-container.mk-rtl) .mk-autonavi .mk-legal:nth-child(2){left:auto;right:calc(var(--logo-width) * (1 - var(--logo-xmin)) - 9px)}',Ze.nonce),this._shadowRootNode.addChild(this._topRightControlsNode),this._shadowRootNode.addChild(this._bottomRightControlsNode),this._shadowRootNode.addChild(this._bottomLeftControlsNode),this._logo=new xl({logoUpdated:e=>this.logoUpdated(e)}),this._legalNode=new jl,Ze.addEventListener(Ze.Events.Changed,this),this._updateAutoNaviClass(),this.textZoom=e.textZoom,es.activeLocale&&(this._rtl=es.activeLocale.rtl,this.setAttribute("lang",es.localeId),this.classList.toggle(fc,this._rtl)),es.addEventListener(es.Events.LocaleChanged,this)}get textZoom(){return this.classList.contains(wc)}set textZoom(e){this.classList.toggle(wc,e)}get controlsPending(){return this._controlsPending}set canShowTooltips(e){this._userLocationControl&&(this._userLocationControl.canShowTooltips=e),this._zoomControl&&(this._zoomControl.canShowTooltips=e),this._mapTypeControl&&(this._mapTypeControl.canShowTooltips=e),this._rotationControl&&(this._rotationControl.canShowTooltips=e)}mapPaddingDidChange(e){const t=this.element.style;t.top=e.top+"px",t.left=e.left+"px",t.bottom=e.bottom+"px",t.right=e.right+"px",this.sizeDidChange()}sizeDidChange(){const e=this._shouldHideControls();this._toggleControl(this._map.showsZoomControl&&!e,this._zoomControl,this.updateZoomControl),this._toggleControl(this._map.showsMapTypeControl&&!e,this._mapTypeControl,this.updateMapTypeControl),this._toggleControl(this._map.showsUserLocationControl&&!e,this._userLocationControl,this.updateUserLocationControl),this.updateLogo(),this.updateLegalNode(),this.updateRotationControl(),this.updateScale(),this.zoomLevelDidChange();const t=this._getSizeClass();this._updateTopRightControlsContainer(!1),this._setSizeClass(this._bottomRightControlsNode,t),this._setSizeClass(this._bottomLeftControlsNode,t),this._setReduceMargin()}logoUpdated(e){const t=this._bottomLeftControlsNode.domNode;t.style.setProperty("--logo-xmin",e.xMin),t.style.setProperty("--logo-xmax",e.xMax)}zoomLevelDidChange(){this._zoomControl&&(this._zoomControl.zoomOutEnabled=this._map.canZoomOut,this._zoomControl.zoomInEnabled=this._map.canZoomIn)}update(){this._map&&(k(this._map.currentColorScheme),k(this._map.tint),this.classList.toggle("mk-color-scheme-dark",Bo.darkColorScheme(this._map.currentColorScheme)),this.classList.toggle("mk-dark-mode",Bo.darkColorScheme(this._map.tint)),this._shouldHideControls()?(this._removeZoomControl(),this._removeMapTypeControl(),this._removeUserLocationControl(),this._removeRotationControl(),this._removeScale()):(this.updateZoomControl(),this.updateMapTypeControl(),this.updateUserLocationControl(),this.updateRotationControl(),this.updateScale()),this.updateLogo(),this.updateLegalNode(),this._setReduceMargin())}scaleDidChange(){this._scale&&(this._scale.update(),this._scale.hideIfNeeded())}updateScale(){this._map.showsScale===_c.Hidden||this._shouldHideControls()?this._removeScale():(this._addScale(),this._scale.node.mapWidth=this._map._mapNode.size.width,this._scale.updateTheme(this._map.mapNodeTint),this._positionScale(),this._scale.update())}updateZoomControl(){this._map.showsZoomControl&&!this._shouldHideControls()?(this._addZoomControl(),this._zoomControl.enabled=this._map.isZoomEnabled,this.zoomLevelDidChange(),this._zoomControl.updateTintColor(this._map.tintColorForControls)):this._removeZoomControl()}updateMapTypeControl(){this._map.showsMapTypeControl&&!this._shouldHideControls()?(this._addMapTypeControl(),this._mapTypeControl.mapType=this._map.mapType,this._mapTypeControl.enabled=!0,this._mapTypeControl.updateTintColor(this._map.tintColorForControls)):this._removeMapTypeControl()}updateUserLocationControl(){if(this._map.showsUserLocationControl&&!this._shouldHideControls()){switch(S(xc.userLocation),this._addUserLocationControl(),this._userLocationControl.enabled=!0,this._userLocationControl.state){case nc.States.Default:xc.userLocation.isAvailable?this._map.tracksUserLocation&&xc.userLocation.location?this._userLocationControl.toTrackingState():(this._map.tracksUserLocation||this._map.showsUserLocation&&!this._map.userLocationAnnotation)&&this._userLocationControl.toWaitingState():this._userLocationControl.toDisabledState();break;case nc.States.Waiting:xc.userLocation.location&&this.userLocationDidChange(xc.userLocation),this._map.showsUserLocation||this._userLocationControl.toDefaultState();break;case nc.States.Tracking:this._map.tracksUserLocation||this._userLocationControl.toDefaultState()}this._userLocationControl.updateTintColor(this._map.tintColorForControls)}else this._removeUserLocationControl()}updateRotationControl(){this._shouldHideControls()||this._map.isCompassHidden?this._removeRotationControl():(this._addRotationControl(),this._rotationControl.rotation=this._map.rotation,this._rotationControl.updateImage(Bo.devicePixelRatio,Bo.darkColorScheme(this._map.mapNodeTint)),this._rotationControl.updateTintColor(this._map.tintColorForControls))}updateLegalNode(){this._addAndUpdateLegalNode()}updateLogo(){!this._shouldHideLogo()&&Ac()?this._addAndUpdateLogo():this._logo.remove(),this._legalNode.updateWithMapType(this._map.mapType)}devicePixelRatioDidChange(){this._rotationControl&&this._rotationControl.updateImage(Bo.devicePixelRatio,Bo.darkColorScheme(this._map.mapNodeTint)),this._scale&&this._scale.update(),this._logo.updateWithMapNodeTint(this._map.mapNodeTint)}fontSizeDidChange(){this._scale&&this._scale.update()}handleEvent(e){if(this._map)switch(e.type){case uh.EVENTS.MAP_TYPE_CHANGE:this._mapTypeControl&&(this._map.mapType=this._mapTypeControl.mapType);break;case nc.EVENTS.PRESSED:this._userLocationControl.state===nc.States.Waiting?this._map.tracksUserLocation=!0:this._userLocationControl.state!==nc.States.Tracking&&(this._map.tracksUserLocation=!1);break;case es.Events.LocaleChanged:this._handleLocaleChanged(e);break;case"update":this._unsetPendingControls(),this._map.addWaitingAnnotations();break;case Ze.Events.Changed:this._updateAutoNaviClass(),this.updateLogo(),this.updateLegalNode()}}mapWasDestroyed(){this._unsetPendingControls(),es.removeEventListener(es.Events.LocaleChanged,this),Ze.removeEventListener(Ze.Events.Changed,this),this._destroyZoomControl(),this._destroyMapTypeControl(),this._destroyUserLocationControl(),this._destroyRotationControl(!0),this._legalNode.destroy(),this._legalNode.remove(),delete this._legalNode,this._logo.destroy(),this._logo.remove(),delete this._logo,this._removeScale(),this.remove(),delete this._map}userLocationDidChange(e){this._userLocationControl&&(this._map.tracksUserLocation?this._userLocationControl.toTrackingState():this._userLocationControl.toDefaultState())}userLocationDidError(e){this._userLocationControl&&this._userLocationControl.toDisabledState(),this._map.userLocationAnnotation||3===e.errorCode||(this._map.showsUserLocation=!1)}_handleLocaleChanged(e){this.classList.toggle(fc,e.locale.rtl),this.setAttribute("lang",es.localeId),this._rtl!==e.locale.rtl?(this._rtl=e.locale.rtl,this._rtlChanged=!0,this.update(),this._rtlChanged=!1):this.updateLogo()}_addScale(){this._scale||(this._setPendingControls(),this._scale=new Ph(this._map),this._shadowRootNode.addChild(this._scale,0))}_positionScale(){const e=this._map.ensureVisibleFrame().size,t=!this._rtl;this._scale.node.leftAligned=t,this._scale.position=new cs(t?Lc.x:e.width-this._scale.size.width-Lc.x,Lc.y),this._scale.shouldDisplayScale||this._scale.node.setOpacityAnimated(0,!1)}_removeScale(){this._scale&&(this._setPendingControls(),this._scale.mapWasDestroyed(),this._scale.remove(),delete this._scale)}_addZoomControl(){!this._map.showsZoomControl||this._zoomControl||this._shouldHideControls()||(this._setPendingControls(),this._zoomControl=new Kh,this._zoomControl.enabled=this._map.isZoomEnabled,this._zoomControl.addEventListener(Kh.EVENTS.ZOOM_START,this._map),this._zoomControl.addEventListener(Kh.EVENTS.ZOOM_END,this._map),this._bottomRightControlsNode.insertBefore(this._zoomControl,this._legalNode),this._rotationControl&&this._rotationControl.classList.add(kc))}_removeZoomControl(){!this._shouldHideControls()&&this._map.showsZoomControl||!this._zoomControl||(this._setPendingControls(),this._zoomControl.enabled=!1,this._destroyZoomControl())}_destroyZoomControl(){this._zoomControl&&(this._zoomControl.removeEventListener(Kh.EVENTS.ZOOM_START,this._map),this._zoomControl.removeEventListener(Kh.EVENTS.ZOOM_END,this._map),this._zoomControl.remove(),this._rotationControl&&this._rotationControl.classList.remove(kc),delete this._zoomControl)}_addMapTypeControl(){!this._map.showsMapTypeControl||this._mapTypeControl||this._shouldHideControls()||(this._setPendingControls(),this._mapTypeControl=new uh(Bs,this._map.mapType,this),this._mapTypeControl.addEventListener(uh.EVENTS.MAP_TYPE_CHANGE,this),this._topRightControlsNode.addChild(this._mapTypeControl),this._updateTopRightControlsContainer(!0))}_removeMapTypeControl(){this._mapTypeControl&&(this._setPendingControls(),this._mapTypeControl.enabled=!1,this._destroyMapTypeControl(),this._updateTopRightControlsContainer(!0))}_destroyMapTypeControl(){this._mapTypeControl&&(this._mapTypeControl.removeEventListener(uh.EVENTS.MAP_TYPE_CHANGE,this),this._mapTypeControl.remove(),delete this._mapTypeControl)}_toggleControl(e,t,i){(t&&!e||!t&&e)&&i.call(this)}_shouldHideControls(){if(!Ze.ready)return!0;const e=this._map.ensureVisibleFrame().size;return e.width<eo.minimumSizeToShowControls.width||e.height<eo.minimumSizeToShowControls.height}_shouldHideLogo(){if(!Ze.ready)return!0;const e=-1===gc.indexOf(es.localeId)?eo.minimumSizeToShowLogo:eo.minimumSizeToShowLogoWithReducedMargin,t=this._map.ensureVisibleFrame().size;return t.width<e.width||t.height<e.height}_addRotationControl(){this._shouldHideControls()||this._rotationControl||(this._setPendingControls(),this._rotationControl=new mc(this._map),this._rotationControl.enabled=!0,this._bottomRightControlsNode.insertBefore(this._rotationControl,this._zoomControl||this._legalNode),this._zoomControl&&this._rotationControl.classList.add(kc))}_removeRotationControl(){this._rotationControl&&(this._setPendingControls(),this._destroyRotationControl())}_destroyRotationControl(e){if(this._rotationControl){if(e)this._rotationControl.mapWasDestroyed(),this._rotationControl.remove();else{const e=this._rotationControl,t=()=>{clearTimeout(i),e.element.removeEventListener("transitionend",t),e.mapWasDestroyed(),e.remove()};e.opacity=0;const i=setTimeout(t,300);e.element.addEventListener("transitionend",t)}delete this._rotationControl}}_addUserLocationControl(){!this._map.showsUserLocationControl||this._userLocationControl||this._shouldHideControls()||(this._setPendingControls(),this._userLocationControl=new nc(this._map,this._rtl,this),this._userLocationControl.addEventListener(nc.EVENTS.PRESSED,this),this._topRightControlsNode.insertBefore(this._userLocationControl,this._mapTypeControl),this._updateTopRightControlsContainer(!0))}controlDidGetFocus(e){this._toggleParentClass(e,Sc,!0)}controlDidLoseFocus(e){this._toggleParentClass(e,Sc,!1)}controlWasPressed(e){this._toggleParentClass(e,Mc,!0)}controlWasReleased(e){this._toggleParentClass(e,Mc,!1)}_setSizeClass(e,t){e.classList.toggle(vc,vc===t),e.classList.toggle(bc,bc===t)}_updateAutoNaviClass(){const e=this._bottomRightControlsNode,t=this._bottomLeftControlsNode;e.classList.toggle(yc,Ze.isAutoNavi),t.classList.toggle(yc,Ze.isAutoNavi)}_toggleParentClass(e,t,i){const s=e.parent;s===this._topRightControlsNode&&s.classList.toggle(t,i)}_removeUserLocationControl(){!this._shouldHideControls()&&this._map.showsUserLocationControl||!this._userLocationControl||(this._setPendingControls(),this._destroyUserLocationControl(),this._updateTopRightControlsContainer(!0))}_destroyUserLocationControl(){this._userLocationControl&&(this._userLocationControl.removeEventListener(nc.EVENTS.STATE_CHANGE,this._map),this._userLocationControl.mapWasDestroyed(),this._userLocationControl.remove(),delete this._userLocationControl)}_addAndUpdateLegalNode(){this._setPendingControls(),Ze.showLegalLink&&(this._bottomLeftControlsNode.addChild(this._legalNode),this._legalNode.updateWithMapType(this._map.mapType))}_addAndUpdateLogo(){this._logo.parent||(this._setPendingControls(),this._bottomLeftControlsNode.insertBefore(this._logo,this._legalNode)),this._logo.updateWithMapNodeTint(this._map.mapNodeTint)}_setPendingControls(){this._controlsPending=!0,Lo.addEventListener("update",this)}_unsetPendingControls(){this._controlsPending=!1,Lo.removeEventListener("update",this)}_setReduceMargin(){const e=this._map.ensureVisibleFrame().size.width,t=eo,i=t.minimumSizeToShowLogo.width,s=t.minimumSizeToShowControls.width;this.classList.toggle("mk-reduce-margin",e<i&&Ac()),this.classList.toggle("mk-reduced-vertical-margin",e<s)}_updateTopRightControlsContainer(e){const t=this._topRightControlsNode,i=t.element,s=i&&i.parentNode;if(s&&e){const e=Bo.htmlElement("div",{class:i.className});for(;i.children.length>0;)e.appendChild(i.children[0]);s.insertBefore(e,i),s.removeChild(i),t.element=e}t.element&&(t.element.className=this._getTopRightControlsClass(),t.classList.reset())}_getSizeClass(){const e=this._map.ensureVisibleFrame().size,t=eo.maximumSizeControlsNormal;return e.width>t.width&&e.height>t.height?bc:vc}_getTopRightControlsClass(){const e=(this._userLocationControl?1:0)+(this._mapTypeControl?1:0);return"mk-top-right-controls-container "+Cc[e]+" "+this._getSizeClass()}controlBounds(){const e=[];return[this._topRightControlsNode,this._bottomLeftControlsNode,this._bottomRightControlsNode].forEach((function(t){0!==t.children.length&&(t===this._bottomRightControlsNode?Array.prototype.push.apply(e,t.children):e.push(t))}),this),e.map((function(e){try{const t=e.element.getBoundingClientRect();if("none"===window.getComputedStyle(this._map.element).transform){const e=this._map.element.getBoundingClientRect();return new us(t.left-e.left,t.top-e.top,t.width,t.height)}return us.rectFromClientRect(t)}catch(e){return new us}}),this)}}function Ac(){return Ze.isAutoNavi||Ze.showMapsLogo}xc.ZoomControl=Kh,j.jsModules.userLocation?xc.userLocation=j.jsModules.userLocation:j.addEventListener("load",(function e(t){t.jsModules.userLocation&&(xc.userLocation=t.jsModules.userLocation,j.removeEventListener("load",e))}));const Ec=xc;function Tc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Ic{constructor(e){Tc(this,"element",void 0),Tc(this,"fontSizeDidChange",void 0),Tc(this,"observer",null),Tc(this,"defaultFontSize",void 0),Tc(this,"currentFontSize",void 0),Tc(this,"ratio",void 0);const{container:t,fontSizeDidChange:i}=e,s=document.createElement("div");this.element=s,t.appendChild(s),s.className="mk-font-size-detector",s.textContent="A",s.ariaHidden="true",this.fontSizeDidChange=i,CSS.supports("(font: -apple-system-body) and (-webkit-touch-callout: default)")?(this.defaultFontSize=this.currentFontSize=17,s.style.font="-apple-system-body"):(this.defaultFontSize=this.currentFontSize=16,s.style.fontSize="initial",s.style.fontFamily="sans-serif"),this.ratio=1,"undefined"!=typeof ResizeObserver&&(this.observer=new ResizeObserver((()=>this._sizeChanged())),this.observer.observe(s))}_sizeChanged(){S(this.element);const e=parseInt(window.getComputedStyle(this.element).fontSize);if(isNaN(e)||e===this.currentFontSize)return;const t=Math.min(e/this.defaultFontSize,2);this.currentFontSize=this.defaultFontSize*t,this.ratio=t,this.fontSizeDidChange(this)}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.element=null)}}let Oc=Math.random().toString(36);function Rc(e){if(e===Oc)return;Oc=e;const t="[MapKit] Authorization token is invalid.";if("string"!=typeof e)return void console.warn(t);const i=e.split(".");if(3!==i.length)return void console.warn(t);let s;try{i.pop(),s=i.map((e=>{return JSON.parse((t=e,window.atob(t)));var t}))}catch(e){return void console.warn(t)}"alg"in s[0]?"ES256"!==s[0].alg&&console.warn('[MapKit] Authorization token has incorrect "alg" value.'):console.warn('[MapKit] Authorization token has no "alg" value.'),"typ"in s[0]?"JWT"!==s[0].typ&&console.warn('[MapKit] Authorization token has incorrect "typ" value.'):console.warn('[MapKit] Authorization token has no "typ" value.'),"kid"in s[0]||console.warn('[MapKit] Authorization token has no "kid" value.');const o=Date.now(),n=1e3*parseInt(s[1].iat);if(!("iat"in s[1])||isNaN(n)?console.warn('[MapKit] Authorization token has no "iat" value.'):n>o+36e5&&console.warn('[MapKit] Authorization token may have an "iat" value that is in the future ('+new Date(n)+")."),"exp"in s[1]){const e=1e3*parseInt(s[1].exp);(e<o||isNaN(e))&&console.warn('[MapKit] Authorization token may be expired according to its "exp" value.')}"origin"in s[1]||console.warn("[MapKit] Authorization token without origin restriction is not recommended in production environments.")}for(Object.defineProperties(Be.prototype,{canRunCSR:{get:function(){const e="CLIENT"===this.forcedRenderingMode||"HYBRID"===this.forcedRenderingMode,t="SERVER"===this.forcedRenderingMode;return!(!this.ready||t||this._disableCsr&&!e||this._syrupRequestedFallback)}},madabaDomains:{get:function(){return this.customMadabaUrl||!this._madabaDomains&&this._madabaBaseUrl?(S(this._madabaBaseUrl),[this._madabaBaseUrl]):this._madabaDomains?this._madabaDomains:null}}}),Be.prototype.syrupRequestedFallback=function(e){this._syrupRequestedFallback=!0,this._syrupRequestedFallbackType=e,setTimeout((()=>{const e=new Fe(Be.ChangeStatus.Refreshed);this.dispatchEvent(e)}),0)},Be.prototype.getMadabaDomainFromStringHash=function(e){if(S(this.madabaDomains),1===this.madabaDomains.length)return this.madabaDomains[0];const t=function(e){k(e.length);let t=0,i=e.length;for(;i--;)t+=e.charCodeAt(i);return t}(e);return this.madabaDomains[t%this.madabaDomains.length]},Be.prototype._parseMapData=function(){const e=this._data;S(),this.customMadabaUrl||!e.madabaBaseUrl&&!e.madabaDomains||(this._madabaBaseUrl=e.madabaBaseUrl??null,this._madabaDomains=e.madabaDomains&&e.madabaDomains.length?e.madabaDomains.map((e=>e.match(/^(https?:)?\/\//)?e:-1!==e.indexOf(":")&&this.getProxyPrefix(e)?"http://"+e:Be.PROTOCOL+"//"+e)):null),this._disableCsr=!!e.disableCsr;const t={};e.attributions&&e.attributions.forEach((e=>{t[e.attributionId]=e,this.tileGroup=e.attributionId}));const i={};e.tileSources.forEach((e=>{const s=e.tileSource,o=this.getProxyPrefix();i[s]={name:s,path:e.path,domains:e.domains,withCredentials:this.urlWithCredentials(o),crossOrigin:!0,protocol:e.protocol||(o&&-1!==e.domains[0].indexOf(":")?"http:":"https:"),attribution:t[e.attributionId],minZoomLevel:e.minZoomLevel,maxZoomLevel:e.maxZoomLevel,supportedSizes:e.supportedSizes,supportedResolutions:e.supportedResolutions,showPrivacyLink:e.showPrivacyLink,showTermsOfUseLink:e.showTermsOfUseLink},i[s].attribution&&i[s].attribution.global&&(i[s].attribution.name=i[s].attribution.global[0].name,i[s].attribution.url=i[s].attribution.global[0].url)})),this.types={},this.rasterTilesForSyrup={},S(this.tileProvider),S(this.countryCode);for(const t in e.modes){const s=e.modes[t].layers;this.types[t]={name:t,provider:this.tileProvider,countryCode:this.countryCode,lowResolutionTileSource:s[0].lowResTileSource?i[s[0].lowResTileSource]:void 0,tileSources:s.map((e=>i[e.tileSource]))},this.rasterTilesForSyrup[t]={name:t,provider:this.tileProvider,countryCode:this.countryCode,tileSources:s.map((e=>i[e.tileSource]))}}},Ze._data&&(S(Ze._parseMapData),Ze._parseMapData()),Be.prototype._checkJwtToken=Rc;Ze._jwtTokensToCheck.length;){const e=Ze._jwtTokensToCheck.shift();S(Ze._checkJwtToken),S(),Ze._checkJwtToken(e)}function Pc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Dc=Xs,zc=Bo.supportsTouches,Nc=new Si(0,0,1,1),Fc="mk-panning",Uc="mk-dragging-cursor",Gc="mk-dragging-annotation",Wc="InitializedWithoutConfiguration",Bc="Initialized",Zc="ReadyWithoutConfiguration",Kc="Ready",jc="Rendered",Hc="Switched",qc="Destroyed",Vc={padding:"rw",isScrollEnabled:"rw",isZoomEnabled:"rw",center:"rw",region:"rw",rotation:"rw",isRotationEnabled:"rw",showsCompass:"rw",visibleMapRect:"rw",tintColor:"rw",annotations:"rw",selectedAnnotation:"rw",overlays:"rw",selectedOverlay:"rw",showsUserLocation:"rw",tracksUserLocation:"rw",mapType:"rw",contextType:"rw",colorScheme:"rw",_allowWheelToZoom:"rw",_allowWheelToZoom2:"rw",_showsDefaultTiles:"rw",_internalAppDelegate:"rw",loadPriority:"rw",showsPointsOfInterest:"rw",showsMapTypeControl:"rw",showsZoomControl:"rw",showsScale:"rw",showsUserLocationControl:"rw",pointOfInterestFilter:"rw",annotationForCluster:"rw",cameraDistance:"rw",cameraZoomRange:"rw",cameraZoomLimit:"rw",cameraBoundary:"rw",distances:"rw",tileOverlays:"rw",selectableMapFeatures:"rw",selectableMapFeatureSelectionAccessory:"rw",annotationForMapFeature:"rw",_unifiedCanvas:"rw",_textZoom:"rw",element:"ro",userLocationAnnotation:"ro"};function Yc(e,t){return new Error(1===t.length?`[MapKit] mapkit.Map.${e} is available after loading the following library: ${t.join(", ")}.`:`[MapKit] mapkit.Map.${e} is available after loading one of the following libraries: ${t.join(", ")}.`)}const Xc=Ze.performanceMarkers.loading,$c=Ze.performanceMarkers.rendering,Jc=Ze.performanceMarkers["frame-updates"];Jc&&Lo.setPerformanceMeasureName("mapkit-dom-update-frame");const Qc="mk-dark-mode",ed="zoom-start",td="zoom-end",id="select",sd="deselect",od="region-change-start",nd="region-change-end",ad="scroll-start",rd="scroll-end",ld="map-type-change",hd="rotation-start",cd="rotation-change",dd="rotation-end",ud="single-tap",pd="double-tap",md="long-press",gd="map-node-change",_d="map-node-ready",fd="complete",yd="error",vd="start-up-complete";class bd{constructor(e,t,i){Pc(this,"_showsUserLocation",!1),Pc(this,"_tracksUserLocation",!1),Pc(this,"_tintColor",""),Pc(this,"_annotationForCluster",null),Pc(this,"_emphasis",Ys.Standard),Pc(this,"currentColorScheme",null),Pc(this,"tint",null),Pc(this,"_forcedInteractionCenter",null),Pc(this,"shouldDispatchRotationChangeEvent",!1),Pc(this,"selectionMayChange",!0),Pc(this,"unifiedCanvas",!1),Pc(this,"_completedOnce",!1),Pc(this,"_mapStabilizationTimeout",null),Xc&&performance.mark("mapkit-map-start"),Ze.state!==Ze.States.UNINITIALIZED&&pl(),Ze.state===Ze.States.READY?this.state=Bc:this.state=Wc,e._impl=this;try{(t=this._checkParent(t))&&(this._bootstrapSize=new ls(t.offsetWidth,t.offsetHeight)),this.public=e,bd.maps.push(this.public),i=_(i),this._checkOptions(i),void 0!==i._internalAppDelegate&&(this.public._internalAppDelegate=i._internalAppDelegate),this._setDefaultState(i),this._setupScene(),this._setupRenderTree(),this._setupControllers(i);const s=void 0!==i.isRotationEnabled;this._setIsRotationEnabled(!s||i.isRotationEnabled,s),void 0!==i.selectableMapFeatures&&(this.selectableMapFeatures=i.selectableMapFeatures),void 0!==i.selectableMapFeatureSelectionAccessory&&(this.selectableMapFeatureSelectionAccessory=i.selectableMapFeatureSelectionAccessory),this._flushToDOM(t),this._handleOptions(i,t),this._setupListeners(),Mt.scheduleOnNextFrame(this)}catch(e){throw this.destroy(),e}finally{0,Xc&&performance.measure("mapkit-map-constructor","mapkit-map-start")}}get padding(){return this._padding.copy()}set padding(e){if(m(e,Mn,"[MapKit] The `padding` parameter passed to `Map.padding` is not a Padding."),this._padding.equals(e))return;this._padding=e.copy();const t=this.ensureRenderingFrame();if(!t.equals(us.Zero)){this.rotation=0;const e=this._mapRectAccountingForPadding(),i=e.midX(),s=e.midY();this._setRenderingFrameValue(t);const o=this._mapRectAccountingForPadding(),n=i-o.midX(),a=s-o.midY(),r=new Si(o.minX()+n,o.minY()+a,o.size.width,o.size.height);this.setVisibleMapRectAnimated(r,!1)}this.controlsLayer&&this.controlsLayer.mapPaddingDidChange(this._adjustedPadding)}get isScrollEnabled(){return this._mapNode.pannable}set isScrollEnabled(e){this._mapNode.pannable=!!e,this._mapUserInteractionController.updateGestureEnableState()}get isZoomEnabled(){return this._mapNode.zoomable}set isZoomEnabled(e){this._mapNode.zoomable=!!e,this.controlsLayer&&this.controlsLayer.updateZoomControl(),this._mapUserInteractionController.updateGestureEnableState()}get snapsToIntegralZoomLevels(){return this._mapNode.snapsToIntegralZoomLevels}set snapsToIntegralZoomLevels(e){this._mapNode.snapsToIntegralZoomLevels=!!e}get showsZoomControl(){return this._showsZoomControl}set showsZoomControl(e){(e=!!e)!==this._showsZoomControl&&(this._showsZoomControl=e,this.controlsLayer&&(this.controlsLayer.updateZoomControl(),this.controlsLayer.updateScale()))}get showsScale(){return this._showsScale}set showsScale(e){d(e,Dc)?e!==this._showsScale&&(this._showsScale=e,this.controlsLayer&&this.controlsLayer.updateScale()):console.warn("[MapKit] value passed to `Map.showsScale` setter must be part of the mapkit.FeatureVisibility enum.")}get mapType(){return this._mapType}set mapType(e){e!==this._mapType&&(Cd(e,bd.MapTypes,"mapType","Map.MapTypes"),this._setMapTypeAndEmphasis(e,this._emphasis))}getMapTypeWithEmphasis(){return this._mapType===bd.MapTypes.Standard&&this._emphasis===Ys.Muted?bd.MapTypes.MutedStandard:this._mapType}setMapTypeWithEmphasis(e){let t=Ys.Standard;e===bd.MapTypes.MutedStandard?(e=bd.MapTypes.Standard,t=Ys.Muted):Cd(e,bd.MapTypes,"mapType","Map.MapTypes"),t===this._emphasis&&e===this._mapType||this._setMapTypeAndEmphasis(e,t)}_setMapTypeAndEmphasis(e,t){this._mapType=e,this._emphasis=t,this._annotationsController&&this._annotationsController.mapTypeDidChange(),this._updateMapNodeTintAndEmphasis(this._mapNode),this._mapNodeController.handleMapConfigurationChange(),this.controlsLayer&&this.controlsLayer.update(),this.public.dispatchEvent(new je.Event(ld)),this._logWithMap(Qt.Events.MapTypeChange)}get distances(){return this._distances}set distances(e){e!==this._distances&&(Cd(e,bd.Distances,"distances","Map.Distances"),this._distances=e,this.controlsLayer&&this.controlsLayer.updateScale())}get colorScheme(){return this._colorScheme}set colorScheme(e){e!==this._colorScheme&&(Cd(e,bd.ColorSchemes,"colorScheme","Map.ColorSchemes"),this._colorScheme===Je.Adaptive&&(this._colorSchemeHandle.removeEventListener("change",this._boundDarkModeDidChange),et.removeHandle(this._colorSchemeHandle),this._colorSchemeHandle=null),this._colorScheme=e,e===Je.Adaptive&&(this._colorSchemeHandle=et.addHandle(),this._boundDarkModeDidChange=()=>this._updateMapNodeTintAndEmphasis(this._mapNode),this._colorSchemeHandle.addEventListener("change",this._boundDarkModeDidChange)),this._updateMapNodeTintAndEmphasis(this._mapNode))}get tileTint(){return this._mapNode.tileTint}get _allowWheelToZoom(){return this._mapNode.allowWheelToZoom}set _allowWheelToZoom(e){this._mapNode.allowWheelToZoom=e}get _allowWheelToZoom2(){return this._mapNode.allowWheelToZoom2}set _allowWheelToZoom2(e){this._mapNode.allowWheelToZoom2=e}get loadPriority(){return this._mapNodeController.loadPriority}set loadPriority(e){d(e,bd.LoadPriorities)?this._mapNodeController.loadPriority=e:console.warn("[MapKit] Unknown value for `loadPriority`. Choose from mapkit.Map.LoadPriorities.")}get _showsTileInfo(){return this._mapNode._impl.debug}set _showsTileInfo(e){this._mapNode._impl.debug=e}get _showsDefaultTiles(){return this._mapNode.showsDefaultTiles}set _showsDefaultTiles(e){this._mapNode.showsDefaultTiles=e}get tileOverlays(){return this._mapNode.tileOverlays}set tileOverlays(e){this._mapNode.tileOverlays=e,this.controlsLayer&&this.controlsLayer.updateZoomControl()}addTileOverlay(e){if(!this._overlaysController)throw Yc("addTileOverlay",["overlays"]);const t=this._mapNode.addTileOverlay(e);return this.controlsLayer&&this.controlsLayer.updateZoomControl(),t}addTileOverlays(e){if(!this._overlaysController)throw Yc("addTileOverlays",["overlays"]);const t=this._mapNode.addTileOverlays(e);return this.controlsLayer&&this.controlsLayer.updateZoomControl(),t}removeTileOverlay(e){if(!this._overlaysController)throw Yc("removeTileOverlay",["overlays"]);const t=this._mapNode.removeTileOverlay(e);return this.controlsLayer&&this.controlsLayer.updateZoomControl(),t}removeTileOverlays(e){if(!this._overlaysController)throw Yc("removeTileOverlays",["overlays"]);const t=this._mapNode.removeTileOverlays(e);return this.controlsLayer&&this.controlsLayer.updateZoomControl(),t}get showsMapTypeControl(){return this._showsMapTypeControl}set showsMapTypeControl(e){(e=!!e)!==this._showsMapTypeControl&&(this._showsMapTypeControl=e,this.controlsLayer&&this.controlsLayer.updateMapTypeControl())}get showsUserLocationControl(){return!!this._userLocationController&&this._showsUserLocationControl}set showsUserLocationControl(e){if((e=!!e)!==this._showsUserLocationControl){if(!this._userLocationController)throw Yc("showsUserLocationControl",["user-location"]);this._showsUserLocationControl=e,this.controlsLayer&&(this.controlsLayer.updateUserLocationControl(),this.controlsLayer.updateScale())}}get showsPointsOfInterest(){return null===this.pointOfInterestFilter||null===this.pointOfInterestFilter._includes&&0===this.pointOfInterestFilter._excludes.length}set showsPointsOfInterest(e){if(e){if(null===this.pointOfInterestFilter)return;this.pointOfInterestFilter=null}else{if(this.pointOfInterestFilter===$e.filterExcludingAllCategories)return;this.pointOfInterestFilter=$e.filterExcludingAllCategories}}get pointOfInterestFilter(){return this._mapNode.pointOfInterestFilter}set pointOfInterestFilter(e){null!==e&&m(e,$e,"[MapKit] Value passed to `Map.pointOfInterestFilter` setter must be an instance of mapkit.PointOfInterestFilter."),this._mapNode.pointOfInterestFilter=e,this._mapNodeController.setPointOfInterestFilter(e)}setPoiFiltered(e,t){this._mapNode.setPoiFiltered(e,t)}get element(){return this.rootNode&&this.rootNode.element}set element(e){console.warn("[MapKit] The `element` property is read-only.")}get renderingMapRect(){return this._mapNode.visibleMapRect}get visibleMapRect(){return this._visibleMapRect||(this._visibleMapRect=this._mapRectAccountingForPadding()),this._visibleMapRect}set visibleMapRect(e){this.setVisibleMapRectAnimated(e,!1)}setVisibleMapRectAnimated(e,t,i){u(e,"[MapKit] Missing `visibleMapRect` parameter in call to `Map.setVisibleMapRectAnimated()`."),m(e,Si,"[MapKit] The `visibleMapRect` parameter passed to `Map.setVisibleMapRectAnimated()` is not a MapRect.");const s=this.ensureRenderingFrame();if(0===s.size.width||0===s.size.height)this._visibleMapRect=e;else{delete this._visibleMapRect;const t=this._visibleFrame;let i=e;const o=this._adjustedPadding;if(!o.equals(Mn.Zero)){const n=s.size.width/t.size.width,a=s.size.height/t.size.height;i=new Si(e.minX()-o.left*n*e.size.width,e.minY()-o.top*a*e.size.height,e.size.width*n,e.size.height*a)}const n=new Ci(e.midX(),e.midY());let a=Li.zoomLevelForMapRectInViewport(i,s.size,Li.tileSize);a=c(this._mapNode.snapsToIntegralZoomLevels?Bo.getIntegralZoom(a):a,this.minZoomLevel,this.maxZoomLevel);const r=Math.pow(2,Math.ceil(a))*(Li.tileSize*Math.pow(2,a-Math.ceil(a))),l=new ki(t.size.width/r,t.size.height/r);e=new Si(n.x-l.width/2,n.y-l.height/2,l.width,l.height)}return t=null==t||!!t,this._setVisibleMapRect(e,t,i),delete this._delayedShowItems,this.public}get region(){return this.visibleMapRect.toCoordinateRegion()}set region(e){this.setRegionAnimated(e,!1)}setRegionAnimated(e,t,i){return u(e,"[MapKit] Tried to set `Map.region` property to a non-existent value."),m(e,yi,"[MapKit] Region passed to `Map.region` setter is not a CoordinateRegion."),this.region.equals(e)||this.setVisibleMapRectAnimated(e.toMapRect(),t,i),this.public}get isRotationAvailable(){return"HYBRID"===Ze.forcedRenderingMode||"CLIENT"===Ze.forcedRenderingMode?!Ze.didFallback&&this.csrCapable:Ze.ready||Ze.didFallback?Ze.canRunCSR&&this.csrCapable:this.csrCapable}set isRotationAvailable(e){console.warn("[MapKit] Map.isRotationAvailable is a read-only property")}get isRotationEnabled(){return this._mapNode.isRotationEnabled}set isRotationEnabled(e){this._setIsRotationEnabled(e,!0)}get isRotationLocked(){return this._mapNode.isRotationLocked}get rotation(){return this._mapNode.rotation}set rotation(e){this.setRotationAnimated(e,!1),this.controlsLayer&&this.controlsLayer.updateRotationControl()}get heading(){const e=this._mapNode.rotation;return 0===e?0:360-e}get showsCompass(){return this.usingCSR?this._showsCompass:Dc.Hidden}set showsCompass(e){d(e,Dc)?(this.isRotationEnabled||e!==Dc.Visible&&e!==Dc.Adaptive||console.warn("[MapKit] The compass cannot be shown when `Map.isRotationEnabled` is false."),this._usingDefaultShowsCompassValue=!1,e!==this._showsCompass&&(this._showsCompass=e,this.controlsLayer&&this.controlsLayer.updateRotationControl())):console.warn("[MapKit] value passed to `Map.showsCompass` setter must be part of the MapKit.FeatureVisibility enum.")}get usingCSR(){return!this._mapNodeController.usingSSR}compassRotate(e,t){if(t){if(this.isRotationLocked){const t=l(e,360),i=Bo.restrictRotation(t);e=t<180?i+.025*(t-i):i-.025*(i-t)}Math.abs(e)<5&&(e=0)}else this.isRotationLocked&&(e=Bo.restrictRotation(l(e,360)));return this.setRotationAnimated(e,!1,!0),e}setRotationAnimated(e,t,i){if(!this.isRotationAvailable)return void console.warn("[MapKit] Rotation is not available.");if(u(e,"[MapKit] Tried to set `Map.rotation` property to a non-existent value."),"number"!=typeof e||!isFinite(e))return void console.warn("[MapKit] Argument for `Map.rotation` is not a finite number.");this.isRotationLocked&&0!==e&&console.warn("[MapKit] Rotation is not available on this zoom.");const s=this.forcedInteractionCenter?this.forcedInteractionCenter:this._centerMapPoint(),o=l(e,360)-this._mapNode.getRotation();if(!o)return;const n=(t||null==t||!i)&&this.mapCanStartRotating();if((t||null==t)&&n){const e=this.camera.copy();e.rotateAroundCenter(s,o),this._mapNode.setCameraAnimated(e,!0,s)}else(n||i)&&this._mapNode.rotateCameraAroundMapPoint(s,o),i||this.mapDidStopRotating();return this.public}get center(){return this._centerMapPoint().toCoordinate()}set center(e){this.setCenterAnimated(e,!1)}setCenterAnimated(e,t,i){u(e,"[MapKit] Tried to set `Map.center` property to a non-existent value."),m(e,bi,"[MapKit] Value passed to `Map.center` setter is not a Coordinate object.");const s=this.ensureRenderingFrame();if(0!==s.size.width&&0!==s.size.height){const t=this._offsetCenterWithPaddingAndRotation(e.toMapPoint(),-1);t&&(e=t.toCoordinate())}return this._mapNode.setCenterAnimated(e,null==t||!!t),delete this._visibleMapRect,i||(this.tracksUserLocation=!1),this.public}get cameraZoomLevelLimit(){return this._mapNode.cameraZoomLimit}set cameraZoomLevelLimit(e){this.setCameraZoomLevelLimitAnimated(e,!1)}setCameraZoomLevelLimitAnimated(e,t){return this._mapNode.setCameraZoomLevelLimitAnimated(e,null==t||!!t),this.public}get cameraZoomRange(){return this._mapNode.cameraZoomRange}set cameraZoomRange(e){this.setCameraZoomRangeAnimated(e,!1)}setCameraZoomRangeAnimated(e,t){return null!=e&&m(e,Mi,"[MapKit] Expected a `mapkit.CameraZoomRange` object for `Map.cameraZoomRange`, but got `"+e+"` instead."),this._mapNode.setCameraZoomRangeAnimated(e,null==t||!!t),this.public}get cameraDistance(){return this._mapNode.getCurrentCameraDistance()}set cameraDistance(e){this.setCameraDistanceAnimated(e,!1)}setCameraDistanceAnimated(e,t){if(!(e>=0))throw new Error("[MapKit] Expected a number for Map.cameraDistance, but got `"+e+"` instead");return this._mapNode.setCameraDistanceAnimated(e,null==t||!!t),this.public}get cameraBoundary(){const e=this._cameraBoundary;return e?{region:e.toCoordinateRegion?e.toCoordinateRegion():e.copy(),mapRect:e.toMapRect?e.toMapRect():e.copy()}:null}set cameraBoundary(e){this.setCameraBoundaryAnimated(e,!1)}setCameraBoundaryAnimated(e,t){let i=null;if(null==e)delete this._cameraBoundary;else if(e instanceof yi)i=e.toMapRect(),this._cameraBoundary=e.copy();else{if(!(e instanceof Si))throw new Error("[MapKit] `Map.cameraBoundaryRect` expected a CoordinateRegion or a MapRect, but got `"+e+"` instead.");i=e,this._cameraBoundary=i.copy()}const s=this._centerMapPoint();return this._mapNode.setCameraBoundaryAnimated(i,null==t||!!t),this.tracksUserLocation&&!this._mapNode.isMapPointWithinBounds(s)&&(this.tracksUserLocation=!1),this.public}get overlays(){return this._overlaysController?this._overlaysController.items:[]}set overlays(e){if(!this._overlaysController)throw Yc("overlays",["overlays"]);this._overlaysController.items=e}get selectedOverlay(){return this._overlaysController?this._overlaysController.selectedItem:null}set selectedOverlay(e){if(!this._overlaysController)throw Yc("selectedOverlay",["overlays"]);this._overlaysController.selectedItem=e}addOverlay(e){if(this._overlaysController)return this._overlaysController.addItem(e);throw Yc("addOverlay",["overlays"])}addOverlays(e){if(this._overlaysController)return this._overlaysController.addItems(e),e;throw Yc("addOverlays",["overlays"])}removeOverlay(e){if(this._overlaysController)return this._overlaysController.removeItem(e);throw Yc("removeOverlay",["overlays"])}removeOverlays(e){if(this._overlaysController)return this._overlaysController.removeItems(e);throw Yc("removeOverlays",["overlays"])}topOverlayAtPoint(e){if(!this._overlaysController)throw Yc("topOverlayAtPoint",["overlays"]);m(e,window.DOMPoint,"[MapKit] Map.topOverlayAtPoint expected a DOMPoint, but got `"+e+"` instead.");const t=this.rootNode.convertPointFromPage(e),i=this._overlaysController.pickableItemsCloseToPoint(this.overlays,t,0),s=this.selectedOverlay;return s&&i.indexOf(s)>0?s:i[0]}overlaysAtPoint(e){if(!this._overlaysController)throw Yc("overlaysAtPoint",["overlays"]);m(e,window.DOMPoint,"[MapKit] Map.overlaysAtPoint expected a DOMPoint, but got `"+e+"` instead.");const t=this.rootNode.convertPointFromPage(e);return this._overlaysController.pickableItemsCloseToPoint(this.overlays,t,0).reverse()}get annotations(){if(this._annotationsController)return this._annotationsController.items;throw Yc("annotations",["annotations"])}set annotations(e){if(!this._annotationsController)throw Yc("annotations",["annotations"]);this._annotationsController.items=e}get selectedAnnotation(){if(this._annotationsController)return this._annotationsController.selectedItem;throw Yc("selectedAnnotation",["annotations"])}set selectedAnnotation(e){if(!this._annotationsController)throw Yc("selectedAnnotation",["annotations"]);this._annotationsController.selectedItem=e}addAnnotation(e){if(this._annotationsController)return this._annotationsController.addItem(e);throw Yc("addAnnotation",["annotations"])}addAnnotations(e){if(this._annotationsController)return this._annotationsController.addItems(e);throw Yc("addAnnotations",["annotations"])}removeAnnotation(e){if(this._annotationsController)return this._annotationsController.removeItem(e);throw Yc("removeAnnotation",["annotations"])}removeAnnotations(e){if(this._annotationsController)return this._annotationsController.removeItems(e);throw Yc("removeAnnotations",["annotations"])}showItems(e,t){if(!bd.LayerItemsController||!bd.ItemCollection)throw Yc("showItems",["annotations","overlays","user-location"]);S(this._annotationsController??this._overlaysController);const i=new bd.ItemCollection(e).getFlattenedItemList();t=bd.LayerItemsController.checkShowItemsParameters(i,t);const s=[],o=[];return i.forEach((function(e){bd.OverlaysController&&e instanceof bd.OverlaysController.Overlay&&!e.map&&(e._impl._map=this.public,s.push(e)),bd.AnnotationsController&&e instanceof bd.AnnotationsController.Annotation&&this._annotationsController&&this._annotationsController.preAddedAnnotation(e)&&o.push(e)}),this),this.isRooted()&&bd.LayerItemsController.setRegionForItems(this,i,t)||(this._delayedShowItems=[i,t]),s.forEach((e=>{delete e._impl._map})),o.forEach((e=>this._annotationsController.resetAnnotation(e))),this._addItems(i),e}addItems(e){if(!bd.ItemCollection)throw Yc("addItems",["annotations","overlays","user-location"]);S(this._annotationsController??this._overlaysController);const t=new bd.ItemCollection(e).getFlattenedItemList();return this._addItems(t),e}removeItems(e){if(!bd.ItemCollection)throw Yc("removeItems",["annotations","overlays","user-location"]);S(this._annotationsController??this._overlaysController);const t=new bd.ItemCollection(e).getFlattenedItemList(),i=[],s=[];return t.forEach(((e,t)=>{const o=bd.OverlaysController&&e instanceof bd.OverlaysController.Overlay,n=bd.AnnotationsController&&e instanceof bd.AnnotationsController.Annotation;if(!o&&!n)throw new Error("[MapKit] Map.removeItems expected an Annotation, Overlay, ItemCollection, or Array of valid items at index "+t+", but got `"+e+"` instead.");o?i.push(e):s.push(e)}),this),this.removeOverlays(i),this.removeAnnotations(s),e}addLayerAbove(e,t){return this._mapNodeController.addLayerAbove(e,t)}addLayerBelow(e,t){return this._mapNodeController.addLayerBelow(e,t)}removeLayer(e){return this._mapNodeController.removeLayer(e)}requireRender(){return this._mapNodeController.requireRender()}getMemoryStatistics(){return this._mapNode.getMemoryStatistics()}annotationsInMapRect(e){if(this._annotationsController)return this._annotationsController.annotationsInMapRect(e);throw Yc("annotationsInMapRect",["annotations"])}updateSize(e){return console.warn("[MapKit] Map resizing is now automatic, the Map.updateSize() method has been deprecated and will be removed in a future version."),this.public}convertCoordinateToPointOnPage(e){m(e,bi,"[MapKit] Map.convertCoordinateToPointOnPage expected a Coordinate, but got `"+e+"` instead.");const t=e.toMapPoint();this.wrapMapPointToViewport(t);const i=this.camera.transformMapPoint(t),s=this.rootNode.convertPointToPage(i);return new window.DOMPoint(s.x,s.y)}wrapMapPointToViewport(e){e.x<this.camera.minX()&&e.x+1<this.camera.maxX()&&(e.x+=1),e.x>this.camera.maxX()&&e.x-1>this.camera.minX()&&(e.x-=1)}convertPointOnPageToCoordinate(e){m(e,window.DOMPoint,"[MapKit] Map.convertPointOnPageToCoordinate expected a DOMPoint, but got `"+e+"` instead.");const t=this.camera.transformGestureCenter(this.rootNode.convertPointFromPage(new cs(e.x,e.y))),i=this.renderingMapRect.origin;return new bi(Li.convertYToLatitude(i.y+t.y/this.worldSize),Li.convertXToLongitude(i.x+t.x/this.worldSize))}get showsUserLocation(){return!!this._userLocationController&&this._userLocationController.showsUserLocation}set showsUserLocation(e){if((e=!!e)!==this.showsUserLocation){if(!this._userLocationController)throw Yc("showsUserLocation",["user-location"]);this._userLocationController.showsUserLocation=e,e||(this._removeUserLocationDisplay(),this.tracksUserLocation=!1),this.showsUserLocationControl&&this.controlsLayer&&(this.controlsLayer.updateUserLocationControl(),this.controlsLayer.updateScale())}}get userLocationAnnotation(){return this._userLocationController?this._annotationsController.userLocationAnnotation:null}get tracksUserLocation(){return!!this._userLocationController&&this._userLocationController.tracksUserLocation}set tracksUserLocation(e){if((e=!!e)!==this.tracksUserLocation){if(!this._userLocationController)throw Yc("tracksUserLocation",["user-location"]);this._userLocationController.tracksUserLocation=e,this._mapNode.usesInteractionCenter=!(!e&&!this.forcedInteractionCenter),e?this.showsUserLocation=!0:this.userLocationAnnotation||(this.showsUserLocation=!1),this._firstCameraUpdateToTrackUserLocationPending=e,this._updateCameraToTrackUserLocation(this._userLocationController.userLocation),this._userLocationController.tracksUserLocation===e&&(this.controlsLayer&&this.controlsLayer.updateUserLocationControl(),this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapUserLocationTrackingDidChange&&this._userLocationTrackingDelegate.mapUserLocationTrackingDidChange(this.public))}}get forcedInteractionCenter(){return this._forcedInteractionCenter}set forcedInteractionCenter(e){this._forcedInteractionCenter=e,this._mapNode.usesInteractionCenter=!(!this.tracksUserLocation&&!e)}get tintColor(){return this._tintColor}set tintColor(e){if(e!==this._tintColor){if(null!=e){if(p(e,"string","[MapKit] Expected a string value for Map.tintColor, but got `"+e+"` instead"),""!==e&&!Bo.isValidCSSColor(e))return void console.warn("[MapKit] value passed to `Map.tintColor` is not a valid color value. Ignoring: "+e);this._tintColor=e}else this._tintColor="";this.controlsLayer&&this.controlsLayer.update()}}get tintColorForControls(){return Bo.darkColorScheme(this.mapNodeTint)?"":this._tintColor}get minZoomLevel(){return this._mapNode.minZoomLevel}get maxZoomLevel(){return this._mapNode.maxZoomLevel}get zoomLevel(){return this._mapNode.zoomLevel}get canZoomIn(){const e=this.snapsToIntegralZoomLevels?Math.floor(this.maxZoomLevel):this.maxZoomLevel-.01;return this.zoomLevel<e}get canZoomOut(){const e=this.snapsToIntegralZoomLevels?Math.ceil(this.minZoomLevel):this.minZoomLevel+.01;return this.zoomLevel>e}set zoomLevel(e){this._mapNode.zoomLevel=e}get worldSize(){return Li.pointsPerAxis(this._mapNode.zoomLevel)}get camera(){return this._mapNodeController.node.camera}get cameraIsPanning(){return this._mapNode.cameraIsPanning}get cameraIsZooming(){return this._mapNode.cameraIsZooming}get cameraIsRotating(){return this._mapNode.cameraIsRotating}get cameraIsAnimating(){return this._mapNode.cameraIsAnimating}get cameraIsMoving(){return this.cameraIsPanning||this.cameraIsZooming||this.cameraIsRotating||this.cameraIsAnimating}get _mapNode(){return this._mapNodeController.node}get csrCapable(){return this._mapNodeController.csrCapable}destroy(){if(this.state===qc)return void console.warn("[MapKit] Map was already destroyed.");this.state=qc,this._annotationsController&&this.removeAnnotations(this.annotations),this._overlaysController&&this.removeOverlays(this.overlays),this._stopStabilizationTimeout(),this._linearZoomController?.stop(),this.showsUserLocation&&this._removeUserLocationDisplay(),this.controlsLayer?.mapWasDestroyed(),this.controlsLayer=null,this._mapUserInteractionController?.mapWasDestroyed(),this._overlaysController?.mapWasDestroyed(),this._annotationsController?.mapWasDestroyed(),this._userLocationController?.mapWasDestroyed(),this._linearZoomController?.mapWasDestroyed(),this._linearZoomController=null,this._colorSchemeHandle&&(et.removeHandle(this._colorSchemeHandle),this._colorSchemeHandle=null),Ze.removeEventListener(Ze.Events.Initialized,this),Ze.removeEventListener(Ze.Events.Changed,this),es.removeEventListener(es.Events.LocaleChanged,this),this._dppxMediaQueryList?.removeListener(this._boundDevicePixelRatioDidChange),this._dppxMediaQueryList=null,this._boundDevicePixelRatioDidChange=null,this._iframe&&(this._iframe.removeEventListener("load",this),this._iframe.contentWindow&&this._iframe.contentWindow.removeEventListener("resize",this),this.element.removeChild(this._iframe),this._iframe=null),this._resizeObserver?.disconnect(),this._resizeObserver=null,this._mapNodeController?.destroy(),this._mapRoot?.remove(),this._mapRoot=null,this._scene?.destroy(),this._scene=null,this._removePrintListener(),this.textZoom&&(this.textZoom=!1),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.rootNode?.remove(),this.rootNode=null;const e=bd.maps.indexOf(this.public);e>=0&&bd.maps.splice(e,1)}adjustMapItemPoint(e){return this._mapNode.adjustMapItemPoint(e)}get annotationForCluster(){return this._annotationForCluster}set annotationForCluster(e){if(null==e)this._annotationForCluster=null;else{if("function"!=typeof e)throw new Error("[MapKit] annotationForCluster must be a function or null");this._annotationForCluster=e}}get selectableMapFeatures(){return this._selectableMapFeatures?Ze.ready&&(Ze.didFallback||!Ze.canRunCSR)||!this.csrCapable||"SERVER"===Ze.forcedRenderingMode?[]:this._selectableMapFeatures.slice():[]}set selectableMapFeatures(e){if(null==e)return delete this._selectableMapFeatures,void this._mapFeaturesLayerController.node.remove();if(!bd.MapFeatureType)throw Yc("selectableMapFeatures",["annotations"]);g(e,"[MapKit] Map.selectableMapFeatures expected an array of values, but got `"+e+"` instead."),e.forEach((e=>{Cd(e,bd.MapFeatureType,"MapFeatureType","mapkit.MapFeatureType")}));const t=[];if(Object.values(bd.MapFeatureType).forEach((i=>{-1!==e.indexOf(i)&&t.push(i)})),0===t.length)return delete this._selectableMapFeatures,void this._mapFeaturesLayerController.node.remove();(!Ze.ready||!Ze.didFallback&&Ze.canRunCSR)&&this.csrCapable&&"SERVER"!==Ze.forcedRenderingMode||console.warn("[MapKit] Selectable map features is not available."),this._selectableMapFeatures=t,this._updateMapFeatureRegionLayer()}get selectableMapFeatureSelectionAccessory(){return this._selectableMapFeatureSelectionAccessory?this._selectableMapFeatureSelectionAccessory:null}set selectableMapFeatureSelectionAccessory(e){if(!bd.PlaceSelectionAccessory)throw Yc("selectableMapFeatureSelectionAccessory",["annotations"]);null!==e&&m(e,bd.PlaceSelectionAccessory,"[MapKit] The `selectableMapFeatureSelectionAccessory` parameter passed to `Map.selectableMapFeatureSelectionAccessory` is not a PlaceSelectionAccessory."),this._selectableMapFeatureSelectionAccessory=e}get annotationForMapFeature(){return this._annotationForMapFeature}set annotationForMapFeature(e){if(null==e)delete this._annotationForMapFeature;else{if("function"!=typeof e)throw new Error("[MapKit] annotationForMapFeature must be a function or null");this._annotationForMapFeature=e}}handleEvent(e){const t=bd.ControlsLayer?bd.ControlsLayer.ZoomControl.EVENTS.ZOOM_START:void 0,i=bd.ControlsLayer?bd.ControlsLayer.ZoomControl.EVENTS.ZOOM_END:void 0;switch(e.type){case Ze.Events.Initialized:pl();break;case Ze.Events.Changed:this._configurationDidBecomeAvailable();break;case t:this.zoomControlStart(e.zoomIn);break;case i:this.zoomControlEnd();break;case es.Events.LocaleChanged:this._handleLocaleChange(e);break;case"load":this._iframeDidLoad();break;case"resize":this._sizeDidChange()}}elementShouldPreventDragstart(e){return!!this._annotationsController&&!this._annotationsController.isElementInCustomCallout(e)}elementWantsDefaultBrowserBehavior(e,t,i){if(t&&i&&("touchstart"===t.type||"pointerdown"===t.type&&"touch"===t.pointerType)){if(1===i&&!this.isScrollEnabled)return!0;if(2===i&&!this.isZoomEnabled&&!this.isRotationEnabled)return!0}return!!this._annotationsController&&this._annotationsController.isElementInAccessory(e)}getEventTargetFromSubShadowDOM(e){const t=e.touches?e.touches[0].target:e.target;return Bo.supportsShadowDOM&&this._annotationsController&&t===this._annotationsController.node.element&&this._annotationsController.getShadowDOMTargetFromEvent(e)||t}tileAccessForbidden(){Ze.accessKeyHasExpired()}previousMapDidFinishRendering(e){Xc&&performance.measure("mapkit-map-start-up-rendered","mapkit-map-start"),this.state!==qc&&(k(this._mapNode),this.public.dispatchEvent(new je.Event(vd)))}mapDidFinishRendering(e){this.state!==qc&&(k(this.state===Bc||this.state===Kc||this.state===Hc||this.state,this.state),this.state=jc,this._controlsLayer||setTimeout((()=>this._loadControlsLayer(!1))),this._mapNodeController.handleMapRendered(),this.addWaitingAnnotations(),this._startStabilizationTimeoutIfNeeded())}mapCanStartPanning(e){return this._panningWasPrevented?(delete this._panningWasPrevented,!1):!(this.tracksUserLocation&&this.cameraIsZooming||this._annotationsController&&this._annotationsController.dragging||this._isInitialInteractionTargetInUIElement()||!this.public.dispatchEvent(new je.Event(ad)))}mapWillStartPanning(e){this._stopStabilizationTimeout(),this.tracksUserLocation=!1,this.rootNode.classList.add(Fc),"drag"===e.currentGestureType&&this.rootNode.classList.add(Uc),this._annotationsController&&this._annotationsController.node.classList.add(Fc),Qt._trackPanEvent&&this._logWithMap(Qt.Events.Pan)}mapWillStopPanning(e){this.rootNode.classList.remove(Uc)}mapDidStopPanning(e){this._startStabilizationTimeoutIfNeeded(),this.rootNode.classList.remove(Fc),this._annotationsController&&this._annotationsController.node.classList.remove(Fc),this.public.dispatchEvent(new je.Event(rd))}mapCanStartZooming(e){return!(this._isInitialInteractionTargetInUIElement()||!this.public.dispatchEvent(new je.Event(ed)))}mapWillStartZooming(e,t,i,s){this._stopStabilizationTimeout(),s&&(this.tracksUserLocation=!1),this._logWithMap(Qt.Events.Zoom,{eventValue:t})}mapDidStopZooming(e){this._startStabilizationTimeoutIfNeeded(),this.public.dispatchEvent(new je.Event(td)),this.controlsLayer&&this.controlsLayer.scaleDidChange()}mapCameraWillChange(e,t){this.mapNodeCameraBeforeChange=e.camera}mapCameraDidChange(e,t){if(this.state===qc)return;const i=this.mapNodeCameraBeforeChange;delete this.mapNodeCameraBeforeChange,delete this._visibleMapRect,this._mapNodeController.mapCameraDidChange(),this._overlaysController&&this._overlaysController.mapCameraDidChange(),this._annotationsController&&this._annotationsController.updateVisibleAnnotations();const s=!i||i.rotation!==e.camera.rotation;s&&this._dispatchRotationChangeEvent(),this.controlsLayer&&(this.controlsLayer.scaleDidChange(),s&&this.controlsLayer.updateRotationControl())}mapCameraChangesWillStart(e,t){this._mapFeaturesLayerController&&this._mapFeaturesLayerController.node.remove(),this._zoomLevelWhenCameraChangeStarted=this.zoomLevel,this._annotationsController&&this._annotationsController.mapRegionChangeWillStart(),this.public.dispatchEvent(new je.Event(od))}mapCameraChangesDidEnd(e){this.state!==qc&&(this._zoomLevelWhenCameraChangeStarted!==this.zoomLevel&&this.controlsLayer&&this.controlsLayer.zoomLevelDidChange(),delete this._zoomLevelWhenCameraChangeStarted,this._annotationsController&&this._annotationsController.mapRegionChangeDidEnd(),this.public.dispatchEvent(new je.Event(nd)))}mapMinAndMaxZoomLevelsDidChange(e){this.controlsLayer&&this.controlsLayer.zoomLevelDidChange()}mapCanStartRotating(e){return this.public.dispatchEvent(new je.Event(hd))}mapRotationDidChange(e){this.controlsLayer&&this.controlsLayer.updateRotationControl(),this._dispatchRotationChangeEvent()}mapDidStopRotating(e){this.public.dispatchEvent(new je.Event(dd))}mapCustomCanvasWillRender(e){this.state!==qc&&this._canvas2dLayer&&this._scene.flush()}mapInteractionCenter(e){return this._forcedInteractionCenter?this._forcedInteractionCenter:this._centerMapPoint()}mapTransformCenter(e){return this._centerMapPoint()}userWillTap(e){const t=e.locationInElement();if(this._isInitialInteractionTargetInUIElement())return void(Bo.supportsTouches&&(this._delayedTapFunction=()=>this._elementWasTapped(this._mapUserInteractionController.initialEventTargetForCurrentInteraction)));const i=this.rootNode.convertPointFromPage(t),s=this._annotationsController?this._annotationsController.enabledItemCloseToPoint(i):void 0;if(s)return void(this._delayedTapFunction=()=>wd.call(this,s));let o=!1;if(this._overlaysController){const e=this._overlaysController.enabledItemCloseToPoint(i);if(e){if(e!==this._overlaysController.userLocationAccuracyRingOverlay)return void(this._delayedTapFunction=()=>{e.selected=!0});o=!0}}if(this._annotationsController&&this._selectableMapFeatures&&this._mapNode.getMapFeatureRegions){const e=this._mapNode.getMapFeatureRegions(),t=-1!==this._selectableMapFeatures.indexOf(bd.MapFeatureType.PointOfInterest),s=-1!==this._selectableMapFeatures.indexOf(bd.MapFeatureType.Territory),o=-1!==this._selectableMapFeatures.indexOf(bd.MapFeatureType.PhysicalFeature),n=e.filter((e=>-1!==["Poi","Territory","PhysicalFeature"].indexOf(e.category)&&(!(!t&&"Poi"===e.category)&&(!(!s&&"Territory"===e.category)&&!(!o&&"PhysicalFeature"===e.category))))),a=this._annotationsController.mapFeatureRegionCloseToPoint(i,n);if(a){const e=this._annotationsController.getMapFeatureAnnotationForRegion(a,this.selectableMapFeatureSelectionAccessory);return void(this._delayedTapFunction=()=>{this._annotationsController.mapFeatureDidSelect(e),this._logWithMap(Qt.Events.MapFeatureSelect,{eventValue:a.category})})}}if(o)return void(this._delayedTapFunction=()=>{const e=this.userLocationAnnotation;e&&wd.call(this,e)});const n=kd(ud,e);this._delayedTapFunction=()=>{this.public.dispatchEvent(n),n.defaultPrevented||(this._annotationsController&&(this._annotationsController.selectedItem=null),this._overlaysController&&(this._overlaysController.selectedItem=null))}}shouldDelaySingleTap(){return this.isZoomEnabled||this.public._listeners&&(this.public._listeners[ud]&&this.public._listeners[ud].length>0||this.public._listeners[pd]&&this.public._listeners[pd].length>0)}userDidTap(e){this._delayedTapFunction&&(this._delayedTapFunction(),delete this._delayedTapFunction)}userCanceledTap(e){delete this._delayedTapFunction}userDidDoubleTap(e){const t=e.modifierKeys.alt;(!this.isZoomEnabled||t&&this.zoomLevel===this._mapNode.minZoomLevel||!t&&this.zoomLevel===this._mapNode.maxZoomLevel)&&this.public.dispatchEvent(kd(pd,e))}userDidLongPress(e){if(this._isInitialInteractionTargetInUIElement())return!1;const t=e.locationInElement(),i=this._annotationsController?this._annotationsController.enabledItemCloseToPoint(this.rootNode.convertPointFromPage(t),!0):void 0;if(!i){const t=kd(md,e);return this.public.dispatchEvent(t),t.defaultPrevented&&(this._panningWasPrevented=!0),Bo.supportsTouches}return i._impl.isDraggable()&&!this.cameraIsMoving?(this._annotationsController.startDraggingAnnotation(i,t),!0):Bo.supportsTouches?(wd.call(this,i),!0):Bo.supportsTouches}userMayStartPanningAfterLongPress(){delete this._panningWasPrevented}userDidPanAfterLongPress(e){this._annotationsController&&this._annotationsController.annotationDraggingDidChange(e)}userDidStopPanningAfterLongPress(e){this._annotationsController&&this._annotationsController.annotationDraggingDidEnd(e)}linearZoomControllerDidZoom(e){this.cameraIsZooming&&(this.zoomLevel=e,(e<=this.minZoomLevel&&!this._linearZoomController.zoomsIn||e>=this.maxZoomLevel&&this._linearZoomController.zoomsIn)&&this._mapNode.cameraDidStopZooming())}linearZoomControllerDidStop(){this._mapNode.cameraDidStopZooming()}userLocationDidChange(e){S(this._userLocationController),this._updateUserLocationDisplay(e.target),this.controlsLayer&&this.controlsLayer.userLocationDidChange(e.target),this.tracksUserLocation&&this._updateCameraToTrackUserLocation(e.target),this.public.dispatchEvent(e)}userLocationDidError(e){S(this._userLocationController),this._updateUserLocationDisplay(e.target),this.controlsLayer&&this.controlsLayer.userLocationDidError(e.target),this.public.dispatchEvent(e)}get mapNodeTint(){const e=this._mapNodeController&&this._mapNodeController.node;return e?e.tint:Fs.Light}isRooted(){return this.element&&this.element.ownerDocument.body.contains(this.element)}stopDraggingAnnotation(){this._mapUserInteractionController._stopDraggingAnnotation()}translateVisibleMapRectAnimated(e,t){const i=this.visibleMapRect;this._setVisibleMapRect(new Si(i.minX()+e.x/this.worldSize,i.minY()+e.y/this.worldSize,i.size.width,i.size.height),!!t)}translateCameraAnimated(e,t){this._mapNode.setCameraAnimated(this.camera.translate(e),!!t)}setCameraAnimated(e,t){this._mapNode.setCameraAnimated(e,!!t)}shouldWaitForTilesAndControls(){return this.state!==jc||!this.controlsLayer||this.controlsLayer.controlsPending}ensureRenderingFrame(){return this._renderingFrame||new us}ensureVisibleFrame(){return this._visibleFrame||new us}annotationDraggingWillStart(){this.rootNode.classList.add(Gc),this._loadControlsLayer(!1),this.controlsLayer&&(this.controlsLayer.classList.add(Gc),this.controlsLayer.canShowTooltips=!1)}annotationDraggingDidEnd(){this.rootNode.classList.remove(Gc),this.controlsLayer&&(this.controlsLayer.classList.remove(Gc),this.controlsLayer.canShowTooltips=!0)}get useMetric(){switch(this.distances){case bd.Distances.Adaptive:return Qi;case bd.Distances.Metric:return!0;case bd.Distances.Imperial:return!1}}get isCompassHidden(){return this.showsCompass===Dc.Hidden||Bo.supportsTouches&&this.showsCompass===Dc.Adaptive&&0===this.rotation||!this.isRotationEnabled}get fontSizeRatio(){return this._textZoomDetector?this._textZoomDetector.ratio:1}get textZoom(){return!!this._textZoomDetector}set textZoom(e){e&&!this._textZoomDetector?this._textZoomDetector=new Ic({container:this.element,fontSizeDidChange:()=>{this._mapNode&&(this._mapNode.fontSizeRatio=this.fontSizeRatio),this.controlsLayer&&this.controlsLayer.fontSizeDidChange(),this._annotationsController&&this._annotationsController.fontSizeDidChange()}}):!e&&this._textZoomDetector&&(this._textZoomDetector.destroy(),this._textZoomDetector=void 0,this._mapNode&&(this._mapNode.fontSizeRatio=this.fontSizeRatio)),this.controlsLayer&&(this.controlsLayer.textZoom=!!e),this._annotationsController&&(this._annotationsController.textZoom=!!e)}compassRotationWillStart(e){return e&&this.rootNode.classList.add(Uc),this._mapNodeController.node.compassRotationWillStart()}compassRotationDidEnd(){this.rootNode.classList.remove(Uc),this._mapNodeController.node.compassRotationDidEnd()}panningDuringAnnotationDrag(){this._annotationsController&&this._annotationsController.mapPanningDuringAnnotationDrag()}padMapRect(e,t,i){p(t,"object","[MapKit] padding must be an object with any of `top`, `left`, `bottom`, `right`"),["top","left","bottom","right"].forEach((e=>{if(e in t){const i=t[e];if("number"!=typeof i||i<0)throw new Error("[MapKit] property `"+e+"` of padding must be a number >= 0; got `"+i+"`")}else t[e]=0}));const s=this.ensureRenderingFrame().size;let o=h(Math.min((s.width-(t.left+t.right))/(e.size.width*Li.tileSize),(s.height-(t.top+t.bottom))/(e.size.height*Li.tileSize)));const n=Math.max(Li.pointsPerAxis(o),1),a=bn(e,{top:t.top/n,left:t.left/n,bottom:t.bottom/n,right:t.right/n});if(void 0!==i&&i>=0){o=this._mapNode.zoomLevelForCameraDistanceAtY(i,a.midY());const e=n/Li.pointsPerAxis(o);return a.scale(e,new Ci(a.midX(),a.midY()))}return a}supportsLabelRegions(){return!this._mapNodeController.usingSSR}createLabelRegion(){return this._mapNode.createLabelRegion()}updatedLabelRegion(){this._mapNode.updatedLabelRegion()}unregisterLabelRegion(e){this._mapNode.unregisterLabelRegion(e)}annotationPlaceSelectionAccessoryDidReveal(e,t){this._logWithMap(Qt.Events.PlaceAccessoryReveal,{eventValue:e,eventTarget:"PLACECARD_TRAY",states:{PLACE_CARD:()=>t}})}annotationPlaceSelectionAccessoryOpenInMapsClicked(e,t){this._logWithMap(Qt.Events.PlaceAccessoryOpenAppleMaps,{eventTarget:"PLACECARD_TRAY",states:{PLACE_CARD:()=>t}})}_addItems(e){const t=[];return e.forEach((function(e,i){const s=bd.OverlaysController&&e instanceof bd.OverlaysController.Overlay,o=bd.AnnotationsController&&e instanceof bd.AnnotationsController.Annotation;if(!s&&!o)throw new Error("[MapKit] Map.addItems expected an Annotation, Overlay, ItemCollection, or Array of valid items at index "+i+", but got `"+e+"` instead.");e.map||(s?this.addOverlay(e):t.push(e))}),this),this._annotationsController?this.addAnnotations(t):k(t.length),e}_configurationDidBecomeAvailable(e){let t=e&&this.state===Bc;e||(this.state===Wc?(this.state=Bc,t=!0):this.state===Zc&&(this.state=Kc,t=!0)),this._mapNodeController.configurationDidBecomeAvailable(e),t&&this._logWithMap(Qt.Events.MapsLoad),this.controlsLayer&&this.controlsLayer.update(),this.public._internalAppDelegate&&"function"==typeof this.public._internalAppDelegate.networkConfigurationUpdated&&this.public._internalAppDelegate.networkConfigurationUpdated({madabaDomains:Ze.madabaDomains,tileGroup:Ze.tileGroup,accessKey:Ze.accessKey})}_setupScene(){this._scene=new nn,this._scene.sceneDidUpdate=(e,t)=>this._sceneDidUpdate(e,t),Jc&&(this._scene.performanceMeasureName="mapkit-scene-graph-update-frame");const e=this._scene.element;e.className="rt-root",es.activeLocale&&(e.lang=es.localeId,e.dir=es.activeLocale.rtl?"rtl":"ltr"),this._scene.element.setAttribute("aria-hidden","true")}_sceneDidUpdate(e,t){if(this.state===qc)return;const i=this._scene.hasPixels();if(t)return void(this._scene.element.hidden=!i||this._canvas2dLayer);this.unifiedCanvas&&this._mapNode&&this._mapNode.customCanvas&&!this._scene.isTainted()?(this._canvas2dLayer||(this._canvas2dLayer=new Cl(this._scene),this.addLayerAbove(this._canvas2dLayer,js.Labels)),this._mapNode.forceDraw()):this._canvas2dLayer&&(console.warn("[MapKit] Fallback to 2D rendering because canvas is tainted, or CSR became unavailable."),this.removeLayer(this._canvas2dLayer),this._canvas2dLayer=null),this._scene.element.hidden=!i||this._canvas2dLayer}_checkOptions(e){p(e,"object","[MapKit] The `options` object is invalid."),Object.keys(e).forEach((t=>{let i=Vc[t];if(void 0===i){const s=V(t);i=Vc[s],void 0!==i&&(e[s]=e[t])}"rw"===i||("ro"===i?console.warn("[MapKit] `"+t+"` is read-only and can't be set on a Map."):console.warn("[MapKit] `"+t+"` is not a valid property of Map."))}))}_checkParent(e){if(null==e)return;const t="string"==typeof e?document.getElementById(e):e;if(!t||!he(t))throw new Error("[MapKit] `parent` must either be a DOM element or its ID.");return t}_setDefaultState(e){this._showsScale=Dc.Hidden,this._visibleMapRect=Nc,this._padding=new Mn,this._adjustedPadding=new Mn,this._showsCompass=Dc.Adaptive,this._usingDefaultShowsCompassValue=!0,this._distances=bd.Distances.Adaptive,this._showsZoomControl=void 0!==e.showsZoomControl?!!e.showsZoomControl:!zc,this._showsMapTypeControl=void 0!==e.showsMapTypeControl?!!e.showsMapTypeControl:!zc,this._showsUserLocationControl=void 0!==e.showsUserLocationControl&&!!e.showsUserLocationControl,this._showsUserLocationControl&&!bd.UserLocationController&&console.warn("[MapKit] mapkit.Map.showsUserLocationControl is available after loading the following library: user-location.");const t=e.mapType||bd.MapTypes.Standard;Cd(t,bd.MapTypes,"mapType","Map.MapTypes"),t===bd.MapTypes.MutedStandard?(this._emphasis=Ys.Muted,this._mapType=bd.MapTypes.Standard):(this._emphasis=Ys.Standard,this._mapType=t);const i=e.colorScheme||bd.ColorSchemes.Light;Cd(i,bd.ColorSchemes,"colorScheme","Map.ColorSchemes"),this._colorScheme=i,i===Je.Adaptive&&(this._colorSchemeHandle=et.addHandle(),this._boundDarkModeDidChange=()=>this._updateMapNodeTintAndEmphasis(this._mapNode),this._colorSchemeHandle.addEventListener("change",this._boundDarkModeDidChange))}_setIsRotationEnabled(e,t){"boolean"==typeof e?(this.isRotationAvailable?this._mapNode.isRotationEnabled=e:t&&e&&console.warn("[MapKit] Rotation can't be enabled because it's not available."),this.controlsLayer&&this.controlsLayer.updateRotationControl(),this._mapUserInteractionController.updateGestureEnableState()):console.warn("[MapKit] Value passed to `Map.isRotationEnabled` is not a Boolean.")}_setupRenderTree(){const e=document.createElement("div");e.className="mk-map-view",e.appendChild(this._scene.element),this.rootNode=new Lo.Node(e)}_setupControllers(e){this._loadControlsLayer(!0),bd.OverlaysController&&this.addOverlaysController(),bd.MapFeaturesLayerController&&this.addMapFeaturesLayerController(),bd.AnnotationsController&&this.addAnnotationsController(),bd.UserLocationController&&this.addUserLocationController(),this._mapNodeController=new bl(this,e),this._linearZoomController=new xn(this._mapNode.snapsToIntegralZoomLevels,this),this._mapUserInteractionController=new Kn(this.rootNode.element,this)}addOverlaysController(){this.state===qc||this._overlaysController||(this._overlaysController=new bd.OverlaysController(this),this._scene.insertAfter(this._overlaysController.node,this._mapNodeController?this._mapNodeController.node:void 0))}addMapFeaturesLayerController(){this._mapFeaturesLayerController=new bd.MapFeaturesLayerController(this),this._startStabilizationTimeoutIfNeeded()}addAnnotationsController(){this.state===qc||this._annotationsController||(S(this._mapFeaturesLayerController),this._annotationsController=new bd.AnnotationsController(this),this._mapRoot?this._mapRoot.insertAfter(this._annotationsController.node,this._mapFeaturesLayerController.node):k(this.isInConstructor),this._scene.insertAfter(this._annotationsController.sceneGraphNode,this._overlaysController?this._overlaysController.node:this._mapNodeController?this._mapNodeController.node:void 0))}addUserLocationController(){this._userLocationController=new bd.UserLocationController(this),this._showsUserLocationControl&&this.controlsLayer&&(this.controlsLayer.updateUserLocationControl(),this.controlsLayer.updateScale())}getControlBounds(){return this.controlsLayer?this.controlsLayer.controlBounds():[]}_loadControlsLayer(e){var t;if(!this._loadControlsLayerHasFailed)return!e&&bd.ControlsLayer?(this._insertControlsLayer(),void this._updateInitialControlsLayerState()):(t=t=>{if(!t)return this._showsDefaultTiles=!1,Object.defineProperty(this,"_showsDefaultTiles",{get:function(){return!1},set:function(){throw new Error("[MapKit] Default tiles are not shown because map controls has failed to load.")},configurable:!0}),void(this._loadControlsLayerHasFailed=!0);bd.ControlsLayer=t,e?(Mt.scheduleInBackground((()=>this._insertControlsLayer()),Mt.Priority.Highest),Mt.scheduleInBackground((()=>this._updateInitialControlsLayerState()),Mt.Priority.Highest)):(this._insertControlsLayer(),this._updateInitialControlsLayerState())},void t(Ec))}_insertControlsLayer(){if(this.state!==qc&&!this.controlsLayer&&(k(this.isInConstructor),this.controlsLayer=new bd.ControlsLayer(this),S(this._mapRoot),this._mapRoot.insertAfter(this.controlsLayer,this._annotationsController?this._annotationsController.node:void 0),$c)){const e=()=>{Lo.removeEventListener("update",e),performance.measure("mapkit-map-controls-inserted","mapkit-map-start")};Lo.addEventListener("update",e)}}_updateInitialControlsLayerState(){this.state===qc||this._updateInitialControlsLayerStateCalled||(k(this.isInConstructor),this._updateInitialControlsLayerStateCalled=!0,k(this.controlsLayer),this.controlsLayer.update(),this.controlsLayer.mapPaddingDidChange(this._adjustedPadding))}_handleOptions(e,t){void 0!==e.contextType&&(this.contextType=e.contextType),void 0!==e.showsScale&&(this.showsScale=e.showsScale),void 0!==e.showsCompass&&(this.showsCompass=e.showsCompass),void 0!==e.padding&&(this.padding=e.padding),void 0!==e.cameraZoomRange&&(this.cameraZoomRange=e.cameraZoomRange),void 0!==e.cameraBoundary&&(this.cameraBoundary=e.cameraBoundary),void 0!==e.visibleMapRect?this.visibleMapRect=e.visibleMapRect:void 0!==e.region?this.region=e.region:(void 0!==e.center&&(this.center=e.center),void 0!==e.cameraDistance&&(this.cameraDistance=e.cameraDistance)),void 0!==e.rotation&&(this.rotation=e.rotation);const i=[],s=void 0===e.visibleMapRect&&void 0===e.region&&void 0===e.center&&t;if(void 0!==e.overlays&&(g(e.overlays,"[MapKit] Map constructor overlays option expected an array of overlays, but got `"+e.annotations+"` instead."),s?i.push.apply(i,e.overlays):this.overlays=e.overlays),void 0!==e.annotations&&(g(e.annotations,"[MapKit] Map constructor annotations option expected an array of annotations, but got `"+e.annotations+"` instead."),s?i.push.apply(i,e.annotations):this.annotations=e.annotations),i.length>0){const t={};void 0!==e.cameraDistance&&(t.cameraDistance=e.cameraDistance),this.showItems(i,t)}void 0!==e.selectedOverlay&&(this.selectedOverlay=e.selectedOverlay),void 0!==e.selectedAnnotation&&(this.selectedAnnotation=e.selectedAnnotation),void 0!==e.distances&&(this.distances=e.distances),void 0!==e.tintColor&&(this.tintColor=e.tintColor),void 0!==e.showsUserLocation&&(this.showsUserLocation=e.showsUserLocation),void 0!==e.tracksUserLocation&&(this.tracksUserLocation=e.tracksUserLocation),void 0!==e.tileOverlays&&(this.tileOverlays=e.tileOverlays),void 0!==e.annotationForCluster&&(this.annotationForCluster=e.annotationForCluster),void 0!==e.annotationForMapFeature&&(this.annotationForMapFeature=e.annotationForMapFeature),void 0!==e._unifiedCanvas&&(this.unifiedCanvas=!!e._unifiedCanvas),void 0!==e._textZoom?this.textZoom=!!e._textZoom:this.textZoom=!0}_flushToDOM(e){this._addMapToParent(e),Mt.flush(),this._ensureContainerIsPositioned()}_addMapToParent(e){null!=e&&(e.appendChild(this.element),this._bootstrapSize.width&&this._bootstrapSize.height&&this._updateRenderingFrameSize(this._bootstrapSize),delete this._bootstrapSize)}performScheduledUpdate(){if(this.state===qc)return;k(this.state===Wc||this.state===Bc||this.state===jc||this.state,this.state);const e=this._mapNode.camera.zoom;e%1!=0&&(this.state===Wc||this.state===Bc)&&("SERVER"===Ze.forcedRenderingMode||Ze.ready&&(Ze.didFallback||!Ze.canRunCSR)||!this.csrCapable||"HYBRID"===Ze.forcedRenderingMode||this._mapNodeController.loadPriority===Vs.PointsOfInterest)&&this._mapNode.setZoomLevelAnimated(Bo.getIntegralZoom(e)),this.state===Wc?this.state=Zc:this.state===Bc&&(this.state=Kc),this._loadResizeDetector()}_loadResizeDetector(){if(!this._iframe&&!this._resizeObserver){if(window.ResizeObserver)return this._resizeObserver=new window.ResizeObserver((e=>this._sizeDidChange())),this._resizeObserver.observe(this.rootNode.element),void this._resizeDetectorDidInstall();this._iframe=Bo.htmlElement("iframe",{tabindex:-1,"aria-hidden":!0}),this._iframe.addEventListener("load",this),this.element.insertBefore(this._iframe,this.element.firstChild)}}_updateUserLocationDisplay(e){S(this._overlaysController),S(this._annotationsController),S(this._userLocationController),this._annotationsController.updateUserLocationAnnotation(e),this._overlaysController.updateUserLocationAccuracyRingOverlay(e)}_removeUserLocationDisplay(){S(this._overlaysController),S(this._annotationsController),S(this._userLocationController),this._annotationsController.removeUserLocationAnnotation(),this._overlaysController.removeUserLocationAccuracyRingOverlay()}_updateCameraToTrackUserLocation(e){let t,i;if(S(this._userLocationController),this.tracksUserLocation&&this.showsUserLocation&&e.coordinate){if(this._mapNode.isMapPointWithinBounds(e.coordinate.toMapPoint()))if(this._firstCameraUpdateToTrackUserLocationPending&&this.zoomLevel<9.5){let s=14;if(e.location.accuracy>0){const t=5*e.location.accuracy*Li.mapUnitsPerMeterAtLatitude(e.location.latitude),i=new Si(0,0,t,t),o=this.ensureVisibleFrame().size;s=Math.max(this.zoomLevel,Li.zoomLevelForMapRectInViewport(i,o,Li.tileSize))}t=this._mapRectForCenterAndZoomLevel(e.coordinate.toMapPoint(),s),this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation&&(i=t.toCoordinateRegion(),this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation(this.public,i),t=i.toMapRect()),this._mapNode.setCameraAnimated(this.camera.withNewMapRect(t),!0,!0)}else this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation?(t=this._mapRectForCenterAndZoomLevel(e.coordinate.toMapPoint(),this.zoomLevel),i=t.toCoordinateRegion(),this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation(this.public,i),this._mapNode.setCameraAnimated(this.camera.withNewMapRect(t),!0,!0)):this.setCenterAnimated(e.coordinate,!0,!0);else this.setCenterAnimated(e.coordinate,!0,!0),this._userLocationController.tracksUserLocation=!1,this._mapNode.usesInteractionCenter=!1,this.controlsLayer&&this.controlsLayer.updateUserLocationControl();delete this._firstCameraUpdateToTrackUserLocationPending}}_updateRenderingFrameFromElement(){const e=this.rootNode.element,t=e.offsetWidth,i=e.offsetHeight;0!==t&&0!==i&&this._updateRenderingFrameSize(new ls(t,i))}_setRenderingFrameValue(e){this._renderingFrame=e,this._visibleFrame=e;const t=this._adjustedPadding.copy(),i=this._adjustedPaddingForMapSize(e.size);this._adjustedPadding=i,i.equals(Mn.Zero)||(this._visibleFrame=new us(e.origin.x+i.left,e.origin.y+i.top,e.size.width-i.left-i.right,e.size.height-i.top-i.bottom)),!i.equals(t)&&this.controlsLayer&&this.controlsLayer.mapPaddingDidChange(i)}_adjustedPaddingForMapSize(e){const t=new ls(Math.min(eo.minimumSizeToShowLogo.width,e.width),Math.min(eo.minimumSizeToShowLogo.height,e.height)),i=this._padding.copy();i.top<0&&(i.top=0),i.left<0&&(i.left=0),i.bottom<0&&(i.bottom=0),i.right<0&&(i.right=0);const s=i.left+i.right,o=i.top+i.bottom,n=s+t.width-e.width,a=o+t.height-e.height;if(n>0&&s>0){const e=(s-n)/s;i.left*=e,i.right*=e}if(a>0&&o>0){const e=(o-a)/o;i.top*=e,i.bottom*=e}return i}_iframeDidLoad(){try{this._iframe.contentWindow.addEventListener("resize",this)}catch(e){console.warn("[MapKit] Map resize detection is disabled when loaded in a sandboxed iframe.")}this._resizeDetectorDidInstall()}_resizeDetectorDidInstall(){const e=this._visibleMapRect&&this._visibleMapRect.copy(),t=this.rotation,i=this._padding&&!this._padding.equals(Mn.Zero);this._ensureContainerIsPositioned(),this._sizeDidChange(),e&&i&&(e.size.width>0||e.size.height>0?(this.setVisibleMapRectAnimated(e,!1),t&&this.setRotationAnimated(t,!1)):this.setCenterAnimated(new Ci(e.midX(),e.midY()).toCoordinate()))}_sizeDidChange(){this._printMediaQueryList&&this._printMediaQueryList.matches||this._updateRenderingFrameFromElement()}_updateRenderingFrameSize(e){const t=!this._renderingFrame;0===e.width||0===e.height||!t&&this._renderingFrame.size.equals(e)||(this._setRenderingFrameValue(new us(0,0,e.width,e.height)),this._scene.size=e,this._mapRoot.size=e,this._mapNodeController.updateSize(e),this._delayedShowItems&&(bd.LayerItemsController.setRegionForItems(this,this._delayedShowItems[0],this._delayedShowItems[1]),delete this._delayedShowItems),this.controlsLayer&&this.controlsLayer.sizeDidChange(),this._annotationsController&&this._annotationsController.mapSizeDidUpdate())}_mapRectForCenterAndZoomLevel(e,t){const i=this.ensureVisibleFrame().size,s=Li.pointsPerAxis(t),o=i.width/s,n=i.height/s;return new Si(e.x-o/2,e.y-n/2,o,n)}_isInitialInteractionTargetInUIElement(){const e=this._mapUserInteractionController.initialEventTargetForCurrentInteraction;return!!e&&(!(!this._annotationsController||!this._annotationsController.isElementInAccessory(e))||!(!this.controlsLayer||!this.controlsLayer.element.contains(e)))}zoomControlStart(e){e&&!this.canZoomIn||!e&&!this.canZoomOut||this._linearZoomController.start(this.zoomLevel,e)&&this._mapNode.cameraWillStartZooming(Qs.Button)}zoomControlEnd(){this._linearZoomController.stop()}_centerMapPoint(){if(0!==this.rotation){const e=this.renderingMapRect,t=new Ci(e.midX(),e.midY()),i=this._offsetCenterWithPaddingAndRotation(t,1);if(i)return i}const e=this.visibleMapRect;return new Ci(e.midX(),e.midY())}_offsetCenterWithPaddingAndRotation(e,t){const i=2*t*this.worldSize,s=(this._adjustedPadding.right-this._adjustedPadding.left)/i,o=(this._adjustedPadding.bottom-this._adjustedPadding.top)/i;if(0!==s||0!==o){const t=-this.rotation/180*Math.PI;return new Ci(e.x-s*Math.cos(t)+o*Math.sin(t),e.y-s*Math.sin(t)-o*Math.cos(t))}}_setVisibleMapRect(e,t,i){i||(this.tracksUserLocation=!1);let s=e;const o=this._adjustedPadding,n=this.ensureRenderingFrame(),a=this.ensureVisibleFrame();o.equals(Mn.Zero)||a.equals(us.Zero)||(s=new Si(e.minX()-o.left/a.size.width*e.size.width,e.minY()-o.top/a.size.height*e.size.height,e.size.width*(n.size.width/a.size.width),e.size.height*(n.size.height/a.size.height))),this._mapNode.setVisibleMapRectAnimated(s,t)}_ensureContainerIsPositioned(){const e=this.rootNode.element;"static"===e.ownerDocument.defaultView.getComputedStyle(e).position&&(e.style.position="relative")}didSetPreviousMapNode(e){this._annotationsController?.mapSupportForLabelRegionsRemoved()}didInsertNewMapNode(e){e.delegate=this,k(this.state===Wc||this.state===Bc||this.state===Zc||this.state===Kc||this.state===Hc||this.state,this.state),this.state===jc&&(this.state=Hc),this._updateMapRoot(e),this._updateMapNodeTintAndEmphasis(e),this._annotationsController?.mapSupportForLabelRegionsAdded(),this.controlsLayer?.updateRotationControl(),window.setTimeout((()=>this.public.dispatchEvent(new je.Event(gd))),0)}didReconfigureMapNode(e){e.snapsToIntegralZoomLevels&&e.zoomLevel%1!=0&&!e.cameraIsAnimating&&(e.zoomLevel=Bo.getIntegralZoom(e.zoomLevel)),this._linearZoomController&&(this._linearZoomController.snapsToIntegralZoomLevels=e.snapsToIntegralZoomLevels),e.fontSizeRatio=this.fontSizeRatio,this.controlsLayer&&this.controlsLayer.updateZoomControl()}didFinishMapNodeInitialization(e){e.customCanvas?(e.customCanvas.setAttribute("aria-hidden","true"),this.element.insertBefore(e.customCanvas,this.element.firstChild)):this._scene.addChild(e,0)}mapNodeDidFail(e){const t=new je.Event(yd);e&&(t.reason=e.reason,t.message=e.message),this.public.dispatchEvent(t)}mapNodeReady(e){window.setTimeout((()=>{const t=new je.Event(_d);t.usingCSR=e,this.public.dispatchEvent(t),this._logWithMap(Qt.Events.MapNodeReady)}),0),this._annotationsController?.mapSupportForLabelRegionsUpdated()}_updateMapRoot(e){this._mapRoot&&this._mapRoot.remove(),this._mapRoot=this.rootNode.insertBefore(new Lo.Node(e.element),this.rootNode.firstChild),e.element.className="mk-map-node-element",this._mapRoot.size=e.size=this._scene.size,this._annotationsController&&this._mapRoot.addChild(this._annotationsController.node),this.controlsLayer&&this._mapRoot.addChild(this.controlsLayer)}_updateMapNodeTintAndEmphasis(e){const t=this._colorScheme===Je.Adaptive?et.currentColorScheme:this._colorScheme;this.currentColorScheme=t;const i=this._mapType===bd.MapTypes.Standard?t:Fs.Dark;this.tint=i;let s=t;this._mapType!==bd.MapTypes.Hybrid&&this._mapType!==bd.MapTypes.Satellite||(s=Fs.Light),e.setTintAndEmphasis(i,s,this._emphasis),this._mapNodeController&&this._mapNodeController.setTintAndEmphasis(i,s,this._emphasis),this.controlsLayer&&this.controlsLayer.update(),this._annotationsController&&(this._annotationsController.mapNodeTintWasSet(i),this._annotationsController.node.classList.toggle(Qc,Bo.darkColorScheme(i))),this.rootNode.classList.toggle(Qc,Bo.darkColorScheme(i))}overlaySelectionDidChange(e){e.selected&&this._annotationsController&&(this._annotationsController.selectedItem=null);const t=new je.Event(e.selected?id:sd);t.overlay=e,this.selectionMayChange=!1,this.public.dispatchEvent(t),this.selectionMayChange=!0}annotationSelectionDidChange(e){e.selected&&this._overlaysController&&(this._overlaysController.selectedItem=null),this.selectionMayChange=!1,this.dispatchEventWithAnnotation(e.selected?id:sd,e),this.selectionMayChange=!0}dispatchEventWithAnnotation(e,t,i){const s=new je.Event(e);if(s.annotation=t,i)for(const e in i)s[e]=i[e];this.public.dispatchEvent(s)}addWaitingAnnotations(){this.shouldWaitForTilesAndControls()||(this._annotationsController?this._annotationsController.addWaitingAnnotations((()=>this._dispatchCompleteEvent())):this._dispatchCompleteEvent())}_dispatchCompleteEvent(){this._completedOnce||(this._completedOnce=!0,$c&&performance.measure("mapkit-map-annotations-rendered","mapkit-map-start")),this._mapNode.fullyRendered&&this.public.dispatchEvent(new je.Event(fd))}_dispatchRotationChangeEvent(){this.shouldDispatchRotationChangeEvent&&this.public.dispatchEvent(new je.Event(cd))}_handleLocaleChange(e){const t=this._scene.element;t.lang=es.localeId,t.dir=es.activeLocale.rtl?"rtl":"ltr",this._mapNodeController.handleMapConfigurationChange(),this._annotationsController&&(this._annotationsController.localeChanged(),this._userLocationController&&this._annotationsController.updateUserLocationAnnotation(this._userLocationController.userLocation,!0));const i=this.ensureRenderingFrame();0!==i.size.width&&0!==i.size.height&&this._setRenderingFrameValue(i)}_elementWasTapped(e){for(;null!==e;e=e.parentNode)if("a"===(t=e).localName||"button"===t.localName||"input"===t.localName&&"button"===t.type)return void e.click();var t}_devicePixelRatioDidChange(){this._scene.needsDisplay=!0,this.controlsLayer&&this.controlsLayer.devicePixelRatioDidChange(),this._annotationsController&&this._annotationsController.devicePixelRatioDidChange(),this._mapNode.devicePixelRatioDidChange()||this._mapNodeController.handleRecreate()}_mapRectAccountingForPadding(){const e=this.renderingMapRect;if(this._adjustedPadding.equals(Mn.Zero))return e.copy();const t=this.ensureVisibleFrame(),i=this.ensureRenderingFrame();return new Si(e.minX()+this._adjustedPadding.left/i.size.width*e.size.width,e.minY()+this._adjustedPadding.top/i.size.height*e.size.height,e.size.width*(t.size.width/i.size.width),e.size.height*(t.size.height/i.size.height))}_setupListeners(){Ze.state===Ze.States.READY&&this._configurationDidBecomeAvailable(!0),Ze.addEventListener(Ze.Events.Initialized,this),Ze.addEventListener(Ze.Events.Changed,this),es.activeLocale&&this._handleLocaleChange({locale:es.activeLocale}),es.addEventListener(es.Events.LocaleChanged,this),this._boundDevicePixelRatioDidChange=()=>this._devicePixelRatioDidChange(),this._dppxMediaQueryList=window.matchMedia("(-webkit-device-pixel-ratio: 1)"),this._dppxMediaQueryList.addListener(this._boundDevicePixelRatioDidChange),this._boundPrintMediaQueryChanged=()=>this._printMediaQueryChanged(),this._printMediaQueryList=window.matchMedia("print"),this._printMediaQueryList.addListener(this._boundPrintMediaQueryChanged)}_removePrintListener(){this._printMediaQueryList?.removeListener(this._boundPrintMediaQueryChanged),this._boundPrintMediaQueryChanged=null,this._printMediaQueryList=null}_printMediaQueryChanged(){const e=this._mapNode;this._printMediaQueryList.matches?(this.rootNode.element.style.background=this.rootNode.element.parentNode.dataset.mapPrintingBackground,e.fullyRendered?this._ensureMapCenterDuringPrint(!0):(e.opacity=0,this._annotationsController&&this._annotationsController.addWaitingAnnotations()),this._loadControlsLayer(!1),this._mapNodeController.handlePrintMatch(),Mt.flush()):(this._mapNodeController.handlePrintUnmatch(),e.opacity=1,this.rootNode.element.style.background="",this._ensureMapCenterDuringPrint(!1))}_ensureMapCenterDuringPrint(e){const t=[this._scene.element];this._mapNode.customCanvas&&t.push(this._mapNode.customCanvas),t.forEach((function(t){if(e){const e=this._scene.size;t.style.left="50%",t.style.marginLeft="-"+e.width/2+"px",t.style.top="50%",t.style.marginTop="-"+e.height/2+"px"}else t.style.left="",t.style.marginLeft="",t.style.top="",t.style.marginTop=""}),this)}_startStabilizationTimeoutIfNeeded(){this._mapNodeController&&this._mapNode&&this._mapNode.fullyRendered&&!this.cameraIsMoving&&(this._stopStabilizationTimeout(),this._mapStabilizationTimeout=window.setTimeout((()=>Mt.scheduleInBackground((()=>this._mapIsStabilized()))),500))}_stopStabilizationTimeout(){this._mapStabilizationTimeout&&(window.clearTimeout(this._mapStabilizationTimeout),this._mapStabilizationTimeout=null)}_mapIsStabilized(){this._updateMapFeatureRegionLayer(),this._updatePrintingBackground()}_updatePrintingBackground(){this._mapNode&&this._mapNode.cssBackgroundProperty&&this._mapNode.fullyRendered&&this.isRooted()&&(this.rootNode.element.parentNode.dataset.mapPrintingBackground=this._mapNode.cssBackgroundProperty)}_updateMapFeatureRegionLayer(){if(!(this._selectableMapFeatures&&this._mapNode&&this._mapNode.getMapFeatureRegions&&this._mapFeaturesLayerController))return;if(!this._mapNode.fullyRendered||!this.isRooted())return;const e=-1!==this._selectableMapFeatures.indexOf(bd.MapFeatureType.PointOfInterest),t=-1!==this._selectableMapFeatures.indexOf(bd.MapFeatureType.Territory),i=-1!==this._selectableMapFeatures.indexOf(bd.MapFeatureType.PhysicalFeature),s=this._mapNode.getMapFeatureRegions().filter((s=>e&&"Poi"===s.category||t&&"Territory"===s.category||i&&"PhysicalFeature"===s.category));this._mapFeaturesLayerController.update(s,this._mapNode.camera),this._mapRoot.addChild(this._mapFeaturesLayerController.node,0)}_logWithMap(e,t={}){if(this.state===qc)return;const i={map:this,eventTarget:t.eventTarget||Qt.EventTarget};for(const e in t)i[e]=t[e];Qt.log(e,i)}}function wd(e){e.selected=!0,this._logWithMap(Qt.Events.AnnotationClick)}function Cd(e,t,i,s){if(!d(e,t))throw new Error("[MapKit] Unknown value for `"+i+"`. Choose from "+s+".")}function kd(e,t){const i=new je.Event(e),s=t.locationInElement();return i.pointOnPage=new DOMPoint(s.x,s.y),i.domEvents=t.domEvents.slice(),i}Pc(bd,"maps",[]),Pc(bd,"MapTypes",Bs),Pc(bd,"Distances",Ks),Pc(bd,"ColorSchemes",Je),Pc(bd,"LoadPriorities",Vs),Pc(bd,"MapProperties",Vc);const Sd=["LayerItemsController","ItemCollection","OverlaysController","MapFeaturesLayerController","AnnotationsController","PlaceSelectionAccessory","UserLocationController","MapFeatureType"];function Md(){let e=!0;for(let t=0;t<Sd.length;t++){const i=Sd[t];!bd[i]&&j.jsModules[i]?bd[i]=j.jsModules[i]:e=!1}bd.OverlaysController&&bd.maps.forEach((e=>{e._impl.addOverlaysController()})),bd.MapFeaturesLayerController&&bd.maps.forEach((e=>{e._impl.addMapFeaturesLayerController()})),bd.AnnotationsController&&bd.maps.forEach((e=>{e._impl.addAnnotationsController()})),bd.UserLocationController&&bd.maps.forEach((e=>{e._impl.addUserLocationController()})),e&&j.removeEventListener("load",Md)}j.addEventListener("load",Md),Md();const Ld=bd;function xd(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Ad extends Ke{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new Ld(this,e,t)})}get padding(){return this._impl.padding}set padding(e){this._impl.padding=e}get isScrollEnabled(){return this._impl.isScrollEnabled}set isScrollEnabled(e){this._impl.isScrollEnabled=e}get isZoomEnabled(){return this._impl.isZoomEnabled}set isZoomEnabled(e){this._impl.isZoomEnabled=e}get showsZoomControl(){return this._impl.showsZoomControl}set showsZoomControl(e){this._impl.showsZoomControl=e}get showsScale(){return this._impl.showsScale}set showsScale(e){this._impl.showsScale=e}get mapType(){return this._impl.getMapTypeWithEmphasis()}set mapType(e){this._impl.setMapTypeWithEmphasis(e)}get colorScheme(){return this._impl.colorScheme}set colorScheme(e){this._impl.colorScheme=e}get distances(){return this._impl.distances}set distances(e){this._impl.distances=e}get _allowWheelToZoom(){return this._impl._allowWheelToZoom}set _allowWheelToZoom(e){this._impl._allowWheelToZoom=e}get _showsTileInfo(){return this._impl._showsTileInfo}set _showsTileInfo(e){this._impl._showsTileInfo=e}get _showsDefaultTiles(){return this._impl._showsDefaultTiles}set _showsDefaultTiles(e){this._impl._showsDefaultTiles=e}get loadPriority(){return this._impl.loadPriority}set loadPriority(e){this._impl.loadPriority=e}get tileOverlays(){return this._impl.tileOverlays}set tileOverlays(e){this._impl.tileOverlays=e}addTileOverlay(e){return this._impl.addTileOverlay(e)}addTileOverlays(e){return this._impl.addTileOverlays(e)}removeTileOverlay(e){return this._impl.removeTileOverlay(e)}removeTileOverlays(e){return this._impl.removeTileOverlays(e)}get showsMapTypeControl(){return this._impl.showsMapTypeControl}set showsMapTypeControl(e){this._impl.showsMapTypeControl=e}get showsUserLocationControl(){return this._impl.showsUserLocationControl}set showsUserLocationControl(e){this._impl.showsUserLocationControl=e}get showsPointsOfInterest(){return this._impl.showsPointsOfInterest}set showsPointsOfInterest(e){this._impl.showsPointsOfInterest=e}get pointOfInterestFilter(){return this._impl.pointOfInterestFilter}set pointOfInterestFilter(e){this._impl.pointOfInterestFilter=e}get element(){return this._impl.element}set element(e){this._impl.element=e}get visibleMapRect(){return this._impl.visibleMapRect}set visibleMapRect(e){this._impl.visibleMapRect=e}setVisibleMapRectAnimated(e,t){return this._impl.setVisibleMapRectAnimated(e,t)}get region(){return this._impl.region}set region(e){this._impl.region=e}setRegionAnimated(e,t){return this._impl.setRegionAnimated(e,t)}get isRotationAvailable(){return this._impl.isRotationAvailable}set isRotationAvailable(e){this._impl.isRotationAvailable=e}get isRotationEnabled(){return this._impl.isRotationEnabled}set isRotationEnabled(e){this._impl.isRotationEnabled=e}get rotation(){return this._impl.rotation}set rotation(e){this._impl.rotation=e}get showsCompass(){return this._impl.showsCompass}set showsCompass(e){this._impl.showsCompass=e}setRotationAnimated(e,t){return this._impl.setRotationAnimated(e,t)}get center(){return this._impl.center}set center(e){this._impl.center=e}setCenterAnimated(e,t){return this._impl.setCenterAnimated(e,t)}get cameraZoomRange(){return this._impl.cameraZoomRange}set cameraZoomRange(e){this._impl.cameraZoomRange=e}setCameraZoomRangeAnimated(e,t){return this._impl.setCameraZoomRangeAnimated(e,t)}get cameraDistance(){return this._impl.cameraDistance}set cameraDistance(e){this._impl.cameraDistance=e}setCameraDistanceAnimated(e,t){return this._impl.setCameraDistanceAnimated(e,t)}get cameraBoundary(){return this._impl.cameraBoundary}set cameraBoundary(e){this._impl.cameraBoundary=e}setCameraBoundaryAnimated(e,t){return this._impl.setCameraBoundaryAnimated(e,t)}get overlays(){return this._impl.overlays}set overlays(e){this._impl.overlays=e}get selectedOverlay(){return this._impl.selectedOverlay}set selectedOverlay(e){this._impl.selectedOverlay=e}addOverlay(e){return this._impl.addOverlay(e)}addOverlays(e){return this._impl.addOverlays(e)}removeOverlay(e){return this._impl.removeOverlay(e)}removeOverlays(e){return this._impl.removeOverlays(e)}topOverlayAtPoint(e){return this._impl.topOverlayAtPoint(e)}overlaysAtPoint(e){return this._impl.overlaysAtPoint(e)}get annotations(){return this._impl.annotations}set annotations(e){this._impl.annotations=e}get selectedAnnotation(){return this._impl.selectedAnnotation}set selectedAnnotation(e){this._impl.selectedAnnotation=e}addAnnotation(e){return this._impl.addAnnotation(e)}addAnnotations(e){return this._impl.addAnnotations(e)}removeAnnotation(e){return this._impl.removeAnnotation(e)}removeAnnotations(e){return this._impl.removeAnnotations(e)}showItems(e,t){return this._impl.showItems(e,t)}addItems(e){return this._impl.addItems(e)}removeItems(e){return this._impl.removeItems(e)}annotationsInMapRect(e){return this._impl.annotationsInMapRect(e)}updateSize(e){return this._impl.updateSize(e)}convertCoordinateToPointOnPage(e){return this._impl.convertCoordinateToPointOnPage(e)}convertPointOnPageToCoordinate(e){return this._impl.convertPointOnPageToCoordinate(e)}get showsUserLocation(){return this._impl.showsUserLocation}set showsUserLocation(e){this._impl.showsUserLocation=e}get userLocationAnnotation(){return this._impl.userLocationAnnotation}get tracksUserLocation(){return this._impl.tracksUserLocation}set tracksUserLocation(e){this._impl.tracksUserLocation=e}get tintColor(){return this._impl.tintColor}set tintColor(e){this._impl.tintColor=e}destroy(){this._impl.destroy()}get annotationForCluster(){return this._impl.annotationForCluster}set annotationForCluster(e){this._impl.annotationForCluster=e}get selectableMapFeatures(){return this._impl.selectableMapFeatures}set selectableMapFeatures(e){this._impl.selectableMapFeatures=e}get selectableMapFeatureSelectionAccessory(){return this._impl.selectableMapFeatureSelectionAccessory}set selectableMapFeatureSelectionAccessory(e){this._impl.selectableMapFeatureSelectionAccessory=e}get annotationForMapFeature(){return this._impl.annotationForMapFeature}set annotationForMapFeature(e){this._impl.annotationForMapFeature=e}}xd(Ad,"MapTypes",Ld.MapTypes),xd(Ad,"ColorSchemes",Ld.ColorSchemes),xd(Ad,"Distances",Ld.Distances),xd(Ad,"LoadPriorities",Ld.LoadPriorities);const Ed={MapInternal:Ld,css:".mk-map-view{width:100%;height:100%;overflow:hidden;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none;cursor:default}.mk-map-view.mk-dragging-annotation{cursor:none}.mk-map-view.mk-disable-all-gestures{touch-action:none}.mk-map-view.mk-disable-pinch-gestures{touch-action:pan-x pan-y}.mk-map-view.mk-disable-zoom-gestures{touch-action:manipulation}.mk-map-view.mk-disable-pan-gestures{touch-action:none;touch-action:pinch-zoom}div.mk-map-view.mk-map-view img,div.mk-map-view.mk-map-view svg{margin:0;padding:0}.mk-annotation-container,.mk-map-view{z-index:0}.mk-map-view>*{position:absolute;left:0;-webkit-user-select:none;user-select:none}.mk-map-view .rt-root{letter-spacing:initial}.mk-map-view .mk-font-size-detector{position:absolute;height:1em;visibility:hidden;left:-100%;-webkit-text-size-adjust:none}.mk-controls-container{position:absolute;overflow:hidden;top:0;bottom:0;left:0;right:0;z-index:3;pointer-events:none}.mk-map-view.mk-dragging-cursor{cursor:grabbing}.mk-map-view>iframe{width:100%;height:100%;pointer-events:none;opacity:0;border:0}",utils:Bo,mapkit:{FeatureVisibility:Xs,CoordinateRegion:yi,CoordinateSpan:vi,Coordinate:bi,BoundingRegion:wi,MapPoint:Ci,MapRect:Si,MapSize:ki,Padding:Mn,CameraZoomRange:Mi,Map:Ad,MapInternal:Ld,get maps(){return Ld.maps},PointOfInterestCategory:He,PointOfInterestFilter:$e.exposedConstructor,get filterIncludingAllCategories(){return $e.filterIncludingAllCategories},get filterExcludingAllCategories(){return $e.filterExcludingAllCategories},PlaceDetail:as,get placeDetails(){return ns}}};function Td(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Id=Li.MapRect,Od=Li.CoordinateSpan,Rd=Li.MapPoint,Pd=new Od(.001,.001),Dd=new Mn(12,12,12,12),zd="select",Nd="deselect";class Fd{constructor(e){Td(this,"_map",null),Td(this,"_selectedItem",null),Td(this,"_selectionDistance",10),Td(this,"_node",null),this._map=e,this._items=[]}static checkShowItemsParameters(e,t){return g(e,"[MapKit] Map.showItems expects an array of items as its first parameter."),t=_(t,"object"),Object.keys(t).forEach((e=>{switch(e){case"animate":break;case"padding":if(void 0===t.padding)break;m(t.padding,Mn,"[MapKit] Map.showItems expects a Padding object for `options.padding`.");break;case"minimumSpan":if(void 0===t.minimumSpan)break;m(t.minimumSpan,Od,"[MapKit] Map.showItems expects a CoordinateSpan for `options.minimumSpan`.");break;case"cameraDistance":if(void 0===t.cameraDistance)break;p(t.cameraDistance,"number","[MapKit] Map.showItems expects a number for `options.cameraDistance`.");break;default:console.warn("[MapKit] `"+e+"` is not a valid option of Map.showItems.")}})),t}static getRegionForItems(e,t,i){let s=i.padding||Dd;const o=i.minimumSpan||Pd;let n=0,a=0,r=0,l=0;const h=[];for(let i=0,s=t.length;i<s;++i){const s=t[i];if(s.map===e.public){const e=s._impl._boundingRect||s._impl.boundingRectAtScale&&s._impl.boundingRectAtScale(1);if(e){if(s._impl.style){const e=s._impl.style._impl.halfStrokeWidthAtResolution();n=Math.max(n,e),a=Math.max(a,e),r=Math.max(r,e),l=Math.max(l,e)}h.push(e)}else{s._impl.updateLayout(!0);const e=s._impl.delegate.paddingForAnnotation(s);n=Math.max(n,e.top),a=Math.max(a,e.right),r=Math.max(r,e.bottom),l=Math.max(l,e.left),h.push(new Id(s._impl.x,s._impl.y,0,0))}}}if(0===h.length)return null;s=new Mn(s.top+n,s.right+a,s.bottom+r,s.left+l);const c=function(e,t){const i=e.toCoordinateRegion();if(i.span.latitudeDelta>=t.latitudeDelta&&i.span.longitudeDelta>=t.longitudeDelta)return e;i.span.latitudeDelta=Math.max(i.span.latitudeDelta,t.latitudeDelta),i.span.longitudeDelta=Math.max(i.span.longitudeDelta,t.longitudeDelta);const s=i.span.latitudeDelta/2,o=i.span.longitudeDelta/2,n=new Rd(Li.convertLongitudeToX(i.center.longitude-o),Li.convertLatitudeToY(i.center.latitude+s)),a=new Rd(Li.convertLongitudeToX(i.center.longitude+o),Li.convertLatitudeToY(i.center.latitude-s));n.x>a.x&&n.x--;return new Id(n.x,n.y,Math.min(a.x-n.x,1),a.y-n.y)}(Cn(h.sort(((e,t)=>e.minX()-t.minX()))),o);return e.padMapRect(c,s,i.cameraDistance)}static setRegionForItems(e,t,i){if(e.ensureRenderingFrame().size.height<=0||e.ensureRenderingFrame().size.width<=0)return!1;if(0===t.length)return!0;const s=!!i.animate,o=Fd.getRegionForItems(e,t,i);return!o||(e.setVisibleMapRectAnimated(o,s),!0)}get node(){return this._node}get items(){return this._items.filter(this.isItemExposed,this)}set items(e){g(e,"[MapKit] Map."+this.itemName+"s expected an array of "+this.itemName+"s, but got `"+e+"` instead."),e.forEach((function(e,t){m(e,this.itemConstructor,"[MapKit] Map."+this.itemName+"s expected an "+this.itemName+" at index "+t+", but got `"+e+"` instead.")}),this),e=e.filter((function(e){return!e.map||e.map._impl===this._map||(console.warn("[MapKit] Map."+this.capitalizedItemName+"s: "+this.itemName+" is already in another map."),!1)}),this);const t=[].concat(this._items);e=[].concat(this._items.filter((e=>!this.isItemExposed(e))),e);let i=0,s=0,o=!1;for(;i<e.length;)t[s]!==e[i]?t[s]&&-1===e.indexOf(t[s])?(k(!t[s].map||(t[s].map._impl,this._map)),this.removedItem(t[s],!0),o=!0,s++):(e[i].map&&e[i].map._impl===this._map?(k(t.indexOf(e[i])),t.splice(t.indexOf(e[i]),1)):(this.addedItem(e[i],!0),o=!0),i++):(k(!e[i].map||(e[i].map._impl,this._map)),i++,s++);for(;s<t.length;)k(e.indexOf(t[s])),this.removedItem(t[s],!0),o=!0,s++;e=e.filter((e=>(k(!e.map||(e.map._impl,this._map)),e.map))),this._items=e,o&&this.manyItemsChanged(e,!0)}get selectedItem(){return this._selectedItem}set selectedItem(e){if(e!==this._selectedItem){if(null!=e&&(m(e,this.itemConstructor,"[MapKit] Map.selected"+this.capitalizedItemName+" expected an "+this.itemName+" or `null`, but got `"+e+"` instead."),e.map!==this._map.public))throw new Error("[MapKit] Map.selected"+this.capitalizedItemName+" cannot be set to an "+this.itemName+" that is not in the map.");if(this._selectedItem){const e=this._selectedItem;this._selectedItem=null,e.selected=!1,this._map.selectionMayChange=!1,e.dispatchEvent(new je.Event(Nd)),this._map.selectionMayChange=!0}e&&(this._selectedItem=e,e.selected=!0,this._map.selectionMayChange=!1,e.dispatchEvent(new je.Event(zd)),this._map.selectionMayChange=!0)}}addItem(e,t){return m(e,this.itemConstructor,"[MapKit] Map.add"+this.capitalizedItemName+" expected an "+this.itemName+", but got `"+e+"` instead."),(e=this.addItemToList(e,!1,t))&&this.manyItemsAdded([e],!1),e}addItems(e){g(e,"[MapKit] Map.add"+this.capitalizedItemName+"s expected an array of "+this.itemName+"s, but got `"+e+"` instead.");const t=e.filter((function(e,t){return m(e,this.itemConstructor,"[MapKit] Map.add"+this.capitalizedItemName+"s expected an "+this.itemName+" at index "+t+", but got `"+e+"` instead."),!!this.addItemToList(e,!0)}),this);return t.length>0&&this.manyItemsAdded(t,!0),t}shouldAddItem(e,t){return e.map?(e.map._impl!==this._map&&console.warn("[MapKit] Map."+this.capitalizedItemName+(t?"s":"")+": "+this.itemName+" is already in another map."),!1):!e._impl.isMapFeature||(console.warn("[MapKit] Map."+this.capitalizedItemName+(t?"s":"")+": "+this.itemName+" cannot be added to another map."),!1)}removeItem(e){return m(e,this.itemConstructor,"[MapKit] Map.remove"+this.capitalizedItemName+" expected an "+this.itemName+", but got `"+e+"` instead."),this.isItemExposed(e)?e.map!==this._map.public?console.warn("[MapKit] Map.remove"+this.capitalizedItemName+": cannot remove "+this.itemName+" as it is not attached to this map."):this.removeAnyItem(e):console.warn("[MapKit] Map.remove"+this.capitalizedItemName+": cannot remove "+this.itemName),e}removeAnyItem(e){const t=this._items.indexOf(e);return k(),t>=0&&(this._items.splice(t,1),this.removedItem(e),this.manyItemsRemoved([e],!1)),e}removeItems(e){return g(e,"[MapKit] Map.remove"+this.capitalizedItemName+"s expected an array of "+this.itemName+"s, but got `"+e+"` instead."),e.forEach((function(e,t){m(e,this.itemConstructor,"[MapKit] Map.remove"+this.capitalizedItemName+"s expected an "+this.itemName+" at index "+t+", but got `"+e+"` instead."),this.isItemExposed(e)?e.map!==this._map.public?console.warn("[MapKit] Map.remove"+this.capitalizedItemName+"s: cannot remove "+this.itemName+" at index "+t+" as it is not attached to this map."):e._impl._toBeRemoved=!0:console.warn("[MapKit] Map.remove"+this.capitalizedItemName+"s: cannot remove "+this.itemName+" at index "+t)}),this),this._items=this._items.filter((e=>!e._impl._toBeRemoved)),e.forEach((function(e){e._impl._toBeRemoved&&(delete e._impl._toBeRemoved,this.removedItem(e,!0))}),this),e.length>0&&this.manyItemsRemoved(e,!0),e}enabledItemCloseToPoint(e,t){return this._previousPointForPickingItem&&this._previousPointForPickingItem.equals(e)?(t||(this._closeItemIndex=(this._closeItemIndex+1)%this._closeItems.length),this._closeItems[this._closeItemIndex]):(this._previousPointForPickingItem=e,this._closeItems=this._itemsCloseToPoint(e).filter((e=>e.enabled)),this._closeItemIndex=!t&&this._closeItems.length>1&&this._closeItems[0].selected?1:0,this._closeItems[this._closeItemIndex])}get selectionMayChange(){return!this._map||this._map.selectionMayChange}addItemToList(e,t,i){if(this.shouldAddItem(e,t))return(void 0===i||i<0||i>this._items.length)&&(i=this._items.length),this._items.splice(i,0,e),this.addedItem(e,t),e}addedItem(e,t){"function"==typeof e._impl.setDelegate?e._impl.setDelegate(this):e._impl.delegate=this,e._impl.addedToMap&&e._impl.addedToMap()}manyItemsAdded(e,t){}removedItem(e){e.selected=!1,e._impl.delegate=null,e._impl.removedFromMap&&e._impl.removedFromMap()}manyItemsRemoved(e,t){}manyItemsChanged(e,t){}mapWasDestroyed(){this._map=null,this.removedReferenceToMap()}_deletePreviousPointForPickingItem(){delete this._previousPointForPickingItem,delete this._closeItems,delete this._closeItemIndex}_itemsCloseToPoint(e){const t=this._items.filter((e=>e._impl.canBePicked()));return 0===t.length?[]:this.pickableItemsCloseToPoint(t,e)}}const Ud=Fd;const Gd=class extends an{constructor(e){super(),this._controller=e}stringInfo(){return"OverlaysControllerNode"}};function Wd(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Bd=["visible","enabled","selected","data"];const Zd=class{constructor(e,t){Wd(this,"delegate",null),Wd(this,"_map",null),Wd(this,"_visible",!0),Wd(this,"_enabled",!0),Wd(this,"_selected",!1),Wd(this,"_data",{}),this._public=e,t=_(t),Bd.forEach((function(e){void 0!==t[e]&&(this[e]=t[e])}),this),Object.keys(t).forEach((e=>{Bd.indexOf(e)<0&&console.warn("[MapKit] Unknown option: "+e+". Use the data property to store custom data.")}))}get map(){return this._map}set map(e){console.warn("[MapKit] The `map` property of an overlay is read-only. Use map.addOverlay() instead.")}get data(){return this._data}set data(e){this._data=e}get visible(){return this._visible}set visible(e){const t=!!e;this._visible!==t&&(this._visible=t,this.updatedProperty("visible"))}get enabled(){return this._enabled}set enabled(e){this._enabled=!!e}get selected(){return this._selected}set selected(e){const t=!!e;if(t!==this._selected){if(this.delegate&&!this.delegate.selectionMayChange)return void console.warn("[MapKit] Selection may not change in select/deselect event handler.");this._selected=t,this.updatedProperty("selected")}}canBePicked(){return this.shown&&this._visible}setMap(e){e?this._map=e:this._map&&(this._map=null)}handleEvent(){}updatedProperty(e){this.delegate&&this.delegate.overlayPropertyDidChange(this._public,e)}visibleAfterClipping(e,t,i,s,o){this._node.shapes=[];const n=this.visibilityToleranceAtScale(i),a=this._boundingRect||this.boundingRectAtScale(i);if(!this.visible||a.maxY()+n<e.minY()||a.minY()-n>e.maxY())return!1;const r=a.minX()-n,l=a.maxX()+n,h=r<0?1:0,c=1+h;for(let n=h-1;n<=c;++n){const a=0===n?e:new Si(e.origin.x-n,e.origin.y,e.size.width,e.size.height);if(l>=a.minX()&&r<=a.maxX()){const e=this.clipOverlay(a,t,i,s,o);e.length>0&&(e.xOffset=n,this._node.shapes.push(e))}}return this._node.shapes.length>0}visibilityToleranceAtScale(){return 0}};class Kd extends Ke{constructor(e){super(),new.target===Kd&&Object.defineProperty(this,"_impl",{value:new Zd(this,e)})}get map(){return this._impl.map}set map(e){this._impl.map=e}get data(){return this._impl.data}set data(e){this._impl.data=e}get visible(){return this._impl.visible}set visible(e){this._impl.visible=e}get enabled(){return this._impl.enabled}set enabled(e){this._impl.enabled=e}get selected(){return this._impl.selected}set selected(e){this._impl.selected=e}}var jd,Hd,qd;qd={Select:"select",Deselect:"deselect"},(Hd="Events")in(jd=Kd)?Object.defineProperty(jd,Hd,{value:qd,enumerable:!0,configurable:!0,writable:!0}):jd[Hd]=qd;const Vd=Kd;const Yd=class{constructor(){this._overlays=[]}fadeOverlayTo(e,t){Object.prototype.hasOwnProperty.call(e,"fadeInOutOpacity")?e.fadeInOutOpacity.durationMs=350*Math.abs(e.fadeInOutOpacity.value-e.fadeInOutOpacity.end):(e.fadeInOutOpacity={durationMs:350},e.setFadeInOutOpacity(1-t),this._overlays.push(e)),e.fadeInOutOpacity.start=e.fadeInOutOpacity.value,e.fadeInOutOpacity.end=t,e.fadeInOutOpacity.startTime=Date.now(),Mt.scheduleASAP(this)}performScheduledUpdate(){const e=Date.now();this._overlays=this._overlays.filter((t=>(t.setFadeInOutOpacity(c(t.fadeInOutOpacity.start+(t.fadeInOutOpacity.end-t.fadeInOutOpacity.start)*((e-t.fadeInOutOpacity.startTime)/t.fadeInOutOpacity.durationMs),0,1)),t.fadeInOutOpacity.value!==t.fadeInOutOpacity.end||(delete t.fadeInOutOpacity,!1)))),this._overlays.length>0&&Mt.scheduleOnNextFrame(this)}};function Xd(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class $d extends Ud{constructor(e){super(e),Xd(this,"itemConstructor",Vd),Xd(this,"itemName","overlay"),Xd(this,"capitalizedItemName","Overlay"),this._node=new Gd(this),this._fadeAnimationController=new Yd}get map(){return this._map}get userLocationAccuracyRingOverlay(){return this._userLocationAccuracyRingOverlay}isItemExposed(e){return e!==this._userLocationAccuracyRingOverlay}removeUserLocationAccuracyRingOverlay(){this._userLocationAccuracyRingOverlay&&(this.removeAnyItem(this._userLocationAccuracyRingOverlay),delete this._userLocationAccuracyRingOverlay)}removedReferenceToMap(){this._items.forEach((e=>{e._impl.setMap(null)}))}mapCameraDidChange(){0!==this._items.length&&(Mt.scheduleASAP(this),this._deletePreviousPointForPickingItem())}overlayPropertyDidChange(e,t){switch(t){case"selected":e.selected?this.selectedItem=e:this.selectedItem=null,this._map.overlaySelectionDidChange(e),Mt.scheduleASAP(this);break;case"style":case"visible":case"geometry":Mt.scheduleASAP(this)}}fadeOverlayTo(e,t){this._fadeAnimationController.fadeOverlayTo(e,t)}updateUserLocationAccuracyRingOverlay(e){e.coordinate&&(this._userLocationAccuracyRingOverlay?this._userLocationAccuracyRingOverlay.updateForUserLocation(e):this._userLocationAccuracyRingOverlay=this.addItem(new $d.AccuracyRingOverlay(e)))}addedItem(e,t){super.addedItem(e,t),e._impl.setMap(this._map.public),e.selected&&(this.selectedItem=e),Mt.scheduleASAP(this)}removedItem(e){e._impl.setMap(null),super.removedItem(e),Mt.scheduleASAP(this)}pickableItemsCloseToPoint(e,t,i){const s=document.createElement("canvas"),o=s.getContext("2d",{willReadFrequently:!0});s.width=1,s.height=1;const n=this._map.camera,a=.5,r=t.x-a,l=t.y-a;o.translate(-r,-l);const h="number"==typeof i?i:this._selectionDistance/Bo.devicePixelRatio;let c=!1;return e.filter((e=>{if(!e._impl.shown)return!1;c&&(o.clearRect(r,l,s.width,s.height),c=!1),e._impl.node._renderer.render(o,n,h),c=!0;return!!o.getImageData(Math.floor(a),Math.floor(a),1,1).data[3]}),this).reverse()}performScheduledUpdate(){const e=this.map;if(!e)return void(this._node.children=[]);const t=e.camera.toRenderingMapRect(),i=e.worldSize,s=Math.ceil(h(i)),o=[],n=this._items;for(let a=0,r=n.length;a<r;++a){const r=n[a];if(r._impl.shown=r._impl.visibleAfterClipping(t,true,i,s,!0),r===this._userLocationAccuracyRingOverlay){const t=e.mapType,i=t===Bs.Satellite||t===Bs.Hybrid?"satellite":e.tint;this._userLocationAccuracyRingOverlay.updateIsShown(e.region,e.worldSize,i)}r._impl.shown&&!r.selected&&(o.push(r._impl.node),r._impl.node.needsDisplay=!0)}const a=this.selectedItem;a&&a._impl.shown&&(o.push(a._impl.node),a._impl.node.needsDisplay=!0),this._node.children=o}}Xd($d,"Overlay",Vd),j.jsModules.AccuracyRingOverlay?$d.AccuracyRingOverlay=j.jsModules.AccuracyRingOverlay:j.addEventListener("load",(function e(t){t.jsModules.AccuracyRingOverlay&&($d.AccuracyRingOverlay=t.jsModules.AccuracyRingOverlay,j.removeEventListener("load",e))}));const Jd=$d;function Qd(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const eu=class{constructor(e,t){Qd(this,"_items",void 0),Qd(this,"_data",void 0),this._items=this._toItemsList(e),this._data=t}get data(){return this._data}set data(e){this._data=e}get items(){return this._items}set items(e){this._items=this._toItemsList(e)}_toItemsList(e){return e instanceof Array?e:null===e?[]:[e]}getFlattenedItemList(){return this.items.reduce(((e,t)=>{const i=t&&"object"==typeof t&&"getFlattenedItemList"in t&&"function"==typeof t.getFlattenedItemList?t.getFlattenedItemList():t;return e.concat(i)}),[])}};const tu=class{constructor(e,t){!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"_impl",void 0),this._impl=new eu(e,t)}get data(){return this._impl.data}set data(e){this._impl.data=e}get items(){return this._impl.items}set items(e){this._impl.items=e}getFlattenedItemList(){return this._impl.getFlattenedItemList()}},iu=["butt","round","square"],su=["miter","round","bevel"],ou=["nonzero","evenodd"];let nu=0;class au extends P{constructor(e){if(super(),this._offsets=[[0],[1]],this._indices=[],this._lastUpdate=nu++,"object"==typeof e)for(const t in e)this.addColorStop(parseFloat(t),e[t])}get offsets(){return this._offsets}get indices(){return this._indices}get lastUpdate(){return this._lastUpdate}addColorStop(e,t){if("number"!=typeof e||!(e>=0&&e<=1))throw new Error("[MapKit] Expected a number between 0 and 1 for offset of LineGradient.addColorStop, but got `"+e+"` instead.");p(t,"string","[MapKit] Expected a string value for color in LineGradient.addColorStop, but got `"+t+"` instead."),this._addColorStop(this._offsets,e,t)}addColorStopAtIndex(e,t){if("number"!=typeof e||e<0||e%1!=0)throw new Error("[MapKit] Expected a integer greater than or equal to 0 for index of LineGradient.addColorStopAtIndex, but got `"+e+"` instead.");p(t,"string","[MapKit] Expected a string value for color in LineGradient.addColorStopAtIndex, but got `"+t+"` instead."),this._addColorStop(this._indices,e,t)}toString(){return"LineGradient"}_addColorStop(e,t,i){k(e===this._offsets||this._indices);const s=e.length;let o=0;for(o=0;o<s&&e[o][0]<t;)++o;o<s&&e[o][0]===t?e[o][1]=i:e.splice(o,0,[t,i]),this._lastUpdate=nu++,this.dispatchEvent(new D(au.UPDATE_EVENT))}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(au,"UPDATE_EVENT","update-color-stop");const ru=au;const lu=class{constructor(e){Object.defineProperty(this,"_impl",{value:new ru(e)})}addColorStop(e,t){this._impl.addColorStop(e,t)}addColorStopAtIndex(e,t){this._impl.addColorStopAtIndex(e,t)}toString(){return this._impl.toString()}};var hu;const cu="rgb(0, 122, 255)";class du extends P{constructor(e){super(),_(e);for(const t in e){const i=Object.getOwnPropertyDescriptor(du.prototype,t);i&&i.set?this[t]=e[t]:console.warn("[MapKit] Style has no property named `"+t+"`, ignoring.")}}get strokeColor(){return this._strokeColor}set strokeColor(e){null!=e&&p(e,"string","[MapKit] Expected a string value for Style.strokeColor, but got `"+e+"` instead."),this._strokeColor!==e&&(this._strokeColor=e,this._updated())}get strokeOpacity(){return this._strokeOpacity}set strokeOpacity(e){p(e,"number","[MapKit] Expected a number value for Style.strokeOpacity, but got `"+e+"` instead.");const t=c(e,0,1);this._strokeOpacity!==t&&(this._strokeOpacity=t,this._warnLineGradientComparability(),this._updated())}get strokeStart(){return this._strokeStart}set strokeStart(e){if("number"!=typeof e||!(e>=0&&e<=1))throw new Error("[MapKit] Expected a number between 0 and 1 for Style.strokeStart, but got `"+e+"` instead.");this._strokeStart!==e&&(this._strokeStart=e,this._updated())}get strokeEnd(){return this._strokeEnd}set strokeEnd(e){if("number"!=typeof e||!(e>=0&&e<=1))throw new Error("[MapKit] Expected a number between 0 and 1 for Style.strokeEnd, but got `"+e+"` instead.");this._strokeEnd!==e&&(this._strokeEnd=e,this._updated())}get lineWidth(){return this._lineWidth}set lineWidth(e){p(e,"number","[MapKit] Expected a number value for Style.lineWidth, but got `"+e+"` instead.");const t=Math.max(0,e);this._lineWidth!==t&&(this._lineWidth=t,this._updated())}get lineCap(){return this._lineCap}set lineCap(e){const t=iu,i="[MapKit] Expected one of "+t.map((e=>"`"+e+"`")).join(", ")+" for Style.lineCap, but got `"+e+"` instead.";if(p(e,"string",i),t.indexOf(e)<0)throw new TypeError(i);this._lineCap!==e&&(this._lineCap=e,this._warnLineGradientComparability(),this._updated())}get lineJoin(){return this._lineJoin}set lineJoin(e){const t=su,i="[MapKit] Expected one of "+t.map((e=>"`"+e+"`")).join(", ")+" for Style.lineJoin, but got `"+e+"` instead.";if(p(e,"string",i),t.indexOf(e)<0)throw new TypeError(i);this._lineJoin!==e&&(this._lineJoin=e,this._warnLineGradientComparability(),this._updated())}get lineDash(){return this._lineDash}set lineDash(e){g(e,"[MapKit] Expected an array of numbers for Style.lineDash, but got `"+e+"` instead."),e.forEach(((e,t)=>{p(e,"number","[MapKit] Expected an array of numbers for Style.lineDash, but got `"+e+"` at index "+t+" instead.")})),this._lineDash=e.slice(),this._warnLineGradientComparability(),this._updated()}get lineDashOffset(){return this._lineDashOffset}set lineDashOffset(e){p(e,"number","[MapKit] Expected a number value for Style.lineDashOffset, but got `"+e+"` instead."),this._lineDashOffset!==e&&(this._lineDashOffset=e,this._updated())}get lineGradient(){return this._lineGradient}set lineGradient(e){null!==e&&m(e,lu,"[MapKit] Expected a LineGradient object value (or null) for Style.lineGradient, but got `"+e+"` instead."),this._lineGradient!==e&&(this._lineGradient&&this._lineGradient._impl.removeEventListener(ru.UPDATE_EVENT,this),this._lineGradient=e,this._lineGradient&&this._lineGradient._impl.addEventListener(ru.UPDATE_EVENT,this),this._warnLineGradientComparability(),this._updated())}colorStopsForOverlay(e){if(k(e.style._impl),!this._lineGradient)return null;const t=this._lineGradient;return 0===t._impl.indices.length?t._impl.offsets:e.getColorStops(t._impl)}get fillColor(){return this._fillColor}set fillColor(e){null!=e&&p(e,"string","[MapKit] Expected a string value for Style.fillColor, but got `"+e+"` instead."),this._fillColor!==e&&(this._fillColor=e,this._updated())}get fillOpacity(){return this._fillOpacity}set fillOpacity(e){p(e,"number","[MapKit] Expected a number value for Style.fillOpacity, but got `"+e+"` instead.");const t=c(e,0,1);this._fillOpacity!==t&&(this._fillOpacity=t,this._updated())}get fillRule(){return this._fillRule}set fillRule(e){const t=ou,i="[MapKit] Expected one of "+t.map((e=>"`"+e+"`")).join(", ")+" for Style.fillRule, but got `"+e+"` instead.";if(p(e,"string",i),t.indexOf(e)<0)throw new TypeError(i);this._fillRule!==e&&(this._fillRule=e,this._updated())}shouldStroke(){return(this.strokeColor||this.lineGradient)&&this.strokeOpacity>0&&this.lineWidth>0}shouldFill(){return this.fillColor&&this.fillOpacity>0}halfStrokeWidthAtResolution(){return this.strokeColor&&this.strokeOpacity>0?this.lineWidth/2*Bo.devicePixelRatio:0}styleForHitTesting(e){const t=Object.create(this);return null!=this._fillColor&&(t._fillColor=cu,t._fillOpacity=1),t._strokeColor=cu,t._strokeOpacity=1,t._lineWidth=this.lineWidth+e,t._impl=t,t}toString(){return["strokeColor","strokeOpacity","strokeStart","strokeEnd","lineWidth","lineCap","lineJoin","lineDash","lineDashOffset","lineGradient","fillColor","fillOpacity","fillRule"].filter((function(e){return Object.prototype.hasOwnProperty.call(this,"_"+e)}),this).map((function(e){return e+":"+(Array.isArray(this[e])?JSON.stringify(this[e]):this.prop&&this[e].toString?this[e].toString():this[e])}),this).join(",")}handleEvent(e){e.type===ru.UPDATE_EVENT&&this._updated()}_warnLineGradientComparability(){if(!this.lineGradient)return;const e=[];1!==this.strokeOpacity&&e.push("strokeOpacity"),"round"!==this.lineCap&&e.push("lineCap"),"round"!==this.lineJoin&&e.push("lineJoin"),0!==this.lineDash.length&&e.push("lineDash"),0!==e.length&&(1===e.length?console.warn("[MapKit] lineGradient is incompatible with the following style property: "+e[0]+"."):console.warn("[MapKit] lineGradient is incompatible with the following style properties: "+e.join(", ")+"."))}_updated(){this.dispatchEvent(new D(du.UPDATE_EVENT))}}(hu=du).prototype._strokeColor=cu,hu.prototype._strokeOpacity=1,hu.prototype._strokeStart=0,hu.prototype._strokeEnd=1,hu.prototype._lineWidth=1,hu.prototype._lineCap="round",hu.prototype._lineJoin="round",hu.prototype._lineDash=[],hu.prototype._lineDashOffset=0,hu.prototype._lineGradient=null,hu.prototype._fillColor=cu,hu.prototype._fillOpacity=.1,hu.prototype._fillRule="nonzero",du.UPDATE_EVENT="update-style";const uu=du;const pu=class{constructor(e){Object.defineProperty(this,"_impl",{value:new uu(e)})}get strokeColor(){return this._impl.strokeColor}set strokeColor(e){this._impl.strokeColor=e}get strokeOpacity(){return this._impl.strokeOpacity}set strokeOpacity(e){this._impl.strokeOpacity=e}get strokeStart(){return this._impl.strokeStart}set strokeStart(e){this._impl.strokeStart=e}get strokeEnd(){return this._impl.strokeEnd}set strokeEnd(e){this._impl.strokeEnd=e}get lineWidth(){return this._impl.lineWidth}set lineWidth(e){this._impl.lineWidth=e}get lineCap(){return this._impl.lineCap}set lineCap(e){this._impl.lineCap=e}get lineJoin(){return this._impl.lineJoin}set lineJoin(e){this._impl.lineJoin=e}get lineDash(){return this._impl.lineDash}set lineDash(e){this._impl.lineDash=e}get lineDashOffset(){return this._impl.lineDashOffset}set lineDashOffset(e){this._impl.lineDashOffset=e}get lineGradient(){return this._impl.lineGradient}set lineGradient(e){this._impl.lineGradient=e}get fillColor(){return this._impl.fillColor}set fillColor(e){this._impl.fillColor=e}get fillOpacity(){return this._impl.fillOpacity}set fillOpacity(e){this._impl.fillOpacity=e}get fillRule(){return this._impl.fillRule}set fillRule(e){this._impl.fillRule=e}toString(){return this._impl.toString()}};class mu extends Zd{constructor(e,t={}){const i={};t&&Object.keys(t).forEach((e=>{"style"!==e&&(i[e]=t[e])})),super(e,i),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"_fillable",!0),t.style&&(this.style=t.style)}get style(){return this._style||(this._style=new pu,this._style._impl.addEventListener(uu.UPDATE_EVENT,this)),this._style}set style(e){if(this._style){if(this._style===e)return;this._style._impl.removeEventListener(uu.UPDATE_EVENT,this)}m(e,pu,"[MapKit] Expected a mapkit.Style value for Overlay.style, but got `"+e+"` instead."),this._style!==e&&(this._style=e,this._style&&this._style._impl.addEventListener(uu.UPDATE_EVENT,this),this.updatedProperty("style"))}visibilityToleranceAtScale(e){return this.style._impl.halfStrokeWidthAtResolution()/e}clipOverlay(e,t,i,s,o){if(this._simplifiedShapeLevel!==s){const e=Math.abs(this._simplifiedShapeLevel-s),t=!!this._hasPoints,i=this._simplifiedShape;this._simplifiedShape=this.simplifyShapeAtLevel(s),this._simplifiedShapeLevel=s,this._hasPoints=this._simplifiedShape.length>0,1===e&&t!==this._hasPoints&&(this.delegate.fadeOverlayTo(this,t?0:1),t&&(this.fadeInOutOpacity.previousShape=this.clip(i)))}const n=this.fadeInOutOpacity.previousShape||(t||!this.clippedShape?this.clip(this._simplifiedShape,e,this.style._impl.halfStrokeWidthAtResolution()/i):this.clippedShape);return o&&(this.clippedShape=n),n}setFadeInOutOpacity(e){this.fadeInOutOpacity.value=e,this.updatedProperty("style")}handleEvent(e){e.type===uu.UPDATE_EVENT&&this.updatedProperty("style")}fillPath(e,t){e.save(),e.fillStyle=t.fillColor,e.globalAlpha=t.fillOpacity*this.fadeInOutOpacity.value*this.node.opacity,e.fill(t.fillRule),e.restore()}strokePath(e,t,i,s){e.save(),e.strokeStyle=s||t.strokeColor,e.globalAlpha=t.strokeOpacity*this.fadeInOutOpacity.value*this.node.opacity;const o=i||Bo.devicePixelRatio;e.lineWidth=t.lineWidth*o,t.lineDash.length>0&&"function"==typeof e.setLineDash&&(e.setLineDash(t.lineDash.map((e=>e*o))),e.lineDashOffset=t.lineDashOffset*o),e.lineJoin=t.lineJoin,e.lineCap=t.lineCap,e.stroke(),e.restore()}updateGeometry(){const e=this.calculateBoundingRect();e&&(this._boundingRect=e,this.updatedProperty("geometry"))}}mu.prototype.fadeInOutOpacity={value:1};const gu=mu;class _u extends Vd{constructor(e){super(),new.target===_u&&Object.defineProperty(this,"_impl",{value:new gu(this,e)})}get style(){return this._impl.style}set style(e){this._impl.style=e}}const fu=_u;const yu=class extends Ns{constructor(e){super(),this.overlay=e}};function vu(e){return ku(Cu(e))}let bu;const wu={};function Cu(e){if(e in wu)return wu[e];const t=e.match(/#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})/i);if(t){const i=[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),1];return wu[e]=i,i}const i=e.match(/rgba\(([\d]+), ?([\d]+), ?([\d]+), ?([\d.]+)\)/i);if(i){const t=[parseInt(i[1]),parseInt(i[2]),parseInt(i[3]),Math.round(255*parseFloat(i[4]))];return wu[e]=t,t}if(!bu){const e=de().getContext("2d",{willReadFrequently:!0});S(),bu=e}bu.canvas.width=bu.canvas.height=1,bu.fillStyle=e,bu.fillRect(0,0,1,1);const s=bu.getImageData(0,0,1,1).data,o=[s[0],s[1],s[2],s[3]];return wu[e]=o,o}function ku(e){return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`}function Su(e,t,i){const s=1-i;return[Math.round(e[0]*s+t[0]*i),Math.round(e[1]*s+t[1]*i),Math.round(e[2]*s+t[2]*i),Math.round(e[3]*s+t[3]*i)]}const Mu=class extends Qo{draw(e){if(!this._node.overlay.map)return;const t=this._node.overlay.map._impl.camera;this.render(e,t)}render(e,t,i){let s=this._node.overlay.style;"number"==typeof i&&(s=s._impl.styleForHitTesting(i));const o=this._node.closed&&s._impl.shouldFill(),n=s._impl.shouldStroke();(o||n)&&this.drawShapes(e,s,o,n,t)}drawShapes(e,t,i,s,o){t._impl.lineGradient&&this._node.supportsLineGradient?s&&this.drawGradient(e,t,o):(e.beginPath(),this._node.shapes.forEach((function(t){t.forEach((function(i){let s=o.transformMapPoint(new cs(i[0].x+t.xOffset,i[0].y));e.moveTo(s.x,s.y);for(let n=1,a=i.length;n<a;n++)s=o.transformMapPoint(new cs(i[n].x+t.xOffset,i[n].y)),e.lineTo(s.x,s.y);this._node.closed&&e.closePath()}),this)}),this),i&&this._node.overlay.fillPath(e,t),s&&this._node.overlay.strokePath(e,t,1))}drawGradient(e,t,i){const s=t._impl.colorStopsForOverlay(this._node.overlay);let o=0;this._node.shapes.forEach((function(n){n.forEach((function(a){const r=[];let l;for(;a[0]._offset>s[o][0];)++o,l=s[o][0];for(let e=0,h=a.length;e<h;){const h=a[e]._offset,c=i.transformMapPoint(new cs(a[e].x+n.xOffset,a[e].y));l=s[o][0];const d=vu(s[o][1]||t.strokeColor);if(h===l)r.push([h,c,d]),++e,++o;else if(h<l){const i=s[o-1],n=i[0],a=ku(Su(Cu(i[1]||t.strokeColor),Cu(d),(h-n)/(l-n)));r.push([h,c,a]),++e}else{r[r.length-1].push([l,d]),++o}}this.strokePathForLineEvents(e,r,t)}),this)}),this)}strokePathForLineEvents(e,t,i){for(let s=0,o=t.length-1;s<o;++s){e.beginPath();const o=t[s],n=o[1],a=t[s+1][1];e.moveTo(n.x,n.y),e.lineTo(a.x,a.y);const r=e.createLinearGradient(n.x,n.y,a.x,a.y);if(r.addColorStop(0,o[2]),o.length>2){const e=o[0],n=t[s+1][0]-e;for(let t=3;t<o.length;++t)r.addColorStop(c((o[t][0]-e)/n,0,1),o[t][1]||i.strokeColor)}r.addColorStop(1,t[s+1][2]),this._node.overlay.strokePath(e,i,1,r)}}};const Lu=class extends yu{constructor(e,t,i=!0){super(e),this._closed=!!t,i&&(this._renderer=new Mu(this))}get closed(){return this._closed}},xu=2*Math.PI;function Au(e,t,i,s,o,n,a){e.beginPath();const r=t.transformMapPoint(new cs(i.x+s,i.y));n&&(n+=t.rotation),a&&(a-=t.rotation),e.arc(r.x,r.y,o,n||0,a||xu,!0)}const Eu=class extends Mu{drawShapes(e,t,i,s,o){const n=this._node.overlay;this._node.shapes.forEach((function(a){const r=a[0],l=n._mapRadius,h=l*o.worldSize;h<.5||this.drawClipped(e,t,i,s,o,r,l,a.xOffset)||(Au(e,o,r,a.xOffset,h),i&&n.fillPath(e,t),s&&n.strokePath(e,t,1))}),this)}drawClipped(e,t,i,s,o,n,a,r){const l=o.toRenderingMapRect();if(!s||a<l.size.width||a<l.size.height)return!1;const h=t._impl.halfStrokeWidthAtResolution()/o.worldSize,c=l.minX()-h-r,d=l.maxX()+h-r,u=l.minY()-h,p=l.maxY()+h,m=n.x,g=n.y;function _(e,t){const i=m-e,s=g-t;return i*i+s*s<=a*a}const f=[];let y;_(d,p)&&f.push(new Ci(d,p));const v=Math.acos((d-m)/a);if(!isNaN(v)){let e=g+a*Math.sin(v);e>=u&&e<=p&&(y=new Ci(d,e),y.angle=v,f.push(y)),e=g-a*Math.sin(v),e>=u&&e<=p&&(y=new Ci(d,e),y.angle=xu-v,f.push(y))}_(d,u)&&f.push(new Ci(d,u));const b=Math.asin((u-g)/a);if(!isNaN(b)){let e=m+a*Math.cos(b);e>=c&&e<=d&&(y=new Ci(e,u),y.angle=(b+xu)%xu,f.push(y)),e=m-a*Math.cos(b),e>=c&&e<=d&&(y=new Ci(e,u),y.angle=Math.PI-b,f.push(y))}_(c,u)&&f.push(new Ci(c,u));const w=Math.acos((c-m)/a);if(!isNaN(w)){let e=g-a*Math.sin(w);e>=u&&e<=p&&(y=new Ci(c,e),y.angle=xu-w,f.push(y)),e=g+a*Math.sin(w),e>=u&&e<=p&&(y=new Ci(c,e),y.angle=w,f.push(y))}_(c,p)&&f.push(new Ci(c,p));const C=Math.asin((p-g)/a);if(!isNaN(C)){let e=m-a*Math.cos(C);e>=c&&e<=d&&(y=new Ci(e,p),y.angle=Math.PI-C,f.push(y)),e=m+a*Math.cos(C),e>=c&&e<=d&&(y=new Ci(e,p),y.angle=(C+xu)%xu,f.push(y))}const k=f.length;let S=1;for(;k>2&&S<k&&(!isNaN(f[S-1].angle)||isNaN(f[S].angle)||isNaN(f[(S+1)%k].angle));)S+=1;if(S<k){let l=(S+1)%k;for(;k>2&&!isNaN(f[l].angle)&&!isNaN(f[(l+1)%k].angle);)l=(l+1)%k;const h=a*o.worldSize,c=Math.abs(f[S].angle-f[l].angle),d=h*c-2*h*Math.sin(c/2)>.001,u=o.transformMapPoint(new cs(f[S].x+r,f[S].y)),p=o.transformMapPoint(new cs(f[l].x+r,f[l].y));if(i){d?Au(e,o,n,r,h,f[S].angle,f[l].angle):(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y));for(let t=(l+1)%k;isNaN(f[t].angle);t=(t+1)%k){const i=o.transformMapPoint(new cs(f[t].x+r,f[t].y));e.lineTo(i.x,i.y)}this._node.overlay.fillPath(e,t)}s&&(d?Au(e,o,n,r,h,f[S].angle,f[l].angle):(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y)),this._node.overlay.strokePath(e,t))}else k>0&&i&&(e.fillStyle=t.fillColor,e.globalAlpha=t.fillOpacity,e.fillRect(0,0,l.size.width*o.worldSize,l.size.height*o.worldSize));return!0}};const Tu=class extends Lu{constructor(e){super(e,!0,!1),this._renderer=new Eu(this)}stringInfo(){const e=this.overlay;return"CircleOverlayNode<radius:"+e.radius+","+e.coordinate.toString().toLowerCase()+">"+(e.style.toString()?"["+e.style+"]":"")}},Iu=Li.Coordinate,Ou=Li.MapRect;const Ru=class extends gu{constructor(e,t,i,s){super(e,s),this._node=new Tu(this),this.coordinate=t,this.radius=i}get node(){return this._node}get coordinate(){return this._coordinate}set coordinate(e){m(e,Iu,"[MapKit] CircleOverlayInternal.coordinate expected a Coordinate value, but got `"+e+"` instead."),this._coordinate&&this._coordinate.latitude===e.latitude&&this._coordinate.longitude===e.longitude||(this._coordinate=e.copy(),this.updateGeometry())}get radius(){return this._radius}set radius(e){const t="[MapKit] CircleOverlayInternal.radius expected a non-negative number (radius in meters), but got `"+e+"` instead.";p(e,"number",t),e<0&&console.warn(t);const i=Math.max(0,e);this._radius!==i&&(this._radius=i,this.updateGeometry())}calculateBoundingRect(){if(!this._coordinate||isNaN(this._radius))return null;const e=this._center=this._coordinate.toMapPoint(),t=this._mapRadius=this._radius*Li.mapUnitsPerMeterAtLatitude(this._coordinate.latitude);return new Ou(e.x-t,e.y-t,2*t,2*t)}simplifyShapeAtLevel(){return this.clip()}clip(){return[this._coordinate.toMapPoint()]}};const Pu=class extends fu{constructor(e,t,i){super(),Object.defineProperty(this,"_impl",{value:new Ru(this,e,t,i)})}get coordinate(){return this._impl.coordinate}set coordinate(e){this._impl.coordinate=e}get radius(){return this._impl.radius}set radius(e){this._impl.radius=e}};const Du=class extends Lu{constructor(e){super(e,!1),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"supportsLineGradient",!0)}stringInfo(){const e=this.overlay;return"PolylineOverlayNode<points:"+(e.points.map((e=>e.toString())).join(",")+">")+(e.style.toString()?"["+e.style+"]":"")}},zu=function(e,t){const i=[];function s(e){const t=i.length;e._index=t,i.push(e),n(t)}function o(e,t){const s=i[e];return i[e]=i[t],i[t]=s,i[e]._index=e,i[t]._index=t,t}function n(e){for(;e>0;){const t=Math.floor((e-1)/2);if(i[t]._area<=i[e]._area)return;e=o(e,t)}}function a(e){for(;;){const t=2*e+1,s=2*e+2,n=i[e]._area,a=i[t]?i[t]._area:1/0,r=i[s]?i[s]._area:1/0;if(n<=a&&n<=r)return;e=o(e,a<=n&&a<=r?t:s)}}function r(){const e=i[0],t=i.pop();return i.length>0&&(i[0]=t,t._index=0,a(0)),e}function l(e){const t=e._prev,i=e,s=e._next;return Math.abs((t.x-s.x)*(i.y-t.y)-(t.x-i.x)*(s.y-t.y))/2}function h(e,t){const i=e._area;e._area=Math.max(l(e),t),e._area<i?n(e._index):a(e._index)}let c=e.length-1,d=!1,u=!1;t&&c>1&&(e[c].equals(e[0])||(e.push(e[0].copy()),d=!0,++c),u=!0,e.unshift(e[c-1].copy()),++c),e[0]._area=e[c]._area=1/0;for(let t=1;t<c;++t){const i=e[t];i._prev=e[t-1],i._next=e[t+1],i._area=l(i),s(i)}for(u&&e.shift(),d&&e.pop();i.length>0;){const e=r(),t=e._prev,i=e._next;t._prev&&(t._next=i,h(t,e._area)),i._next&&(i._prev=t,h(i,e._area)),delete e._index,delete e._next,delete e._prev}},Nu=function(e,t){const i=1/(t*t),s=e.filter((e=>e._area>i));if(2===s.length){const e=s[0].x-s[1].x,t=s[0].y-s[1].y;if(e*e+t*t<1*i)return[]}return s};const Fu=Li.Coordinate,Uu=Li.MapRect,Gu=1e3;function Wu(e,t,i){const s=e[i];let o=null;for(let t=i-1;!o;--t)void 0!==e[t]._offset&&(o=e[t]);let n=null;for(let t=i+1;!n;++t)void 0!==e[t]._offset&&(n=e[t]);const a=Math.sqrt(Math.pow(o.x-s.x,2)+Math.pow(o.y-s.y,2));e[i]._offset=Math.min(o._offset+a/t,n._offset)}function Bu(e,t,i,s,o){let n,a=o.minX()-o.size.width;if(e.x<a)return n=(a-e.x)/i,Zu(a,(1-n)*e.y+n*t.y,e,t,i,s);if(a=o.maxX()+o.size.width,e.x>a)return n=(a-e.x)/i,Zu(a,(1-n)*e.y+n*t.y,e,t,i,s);let r=o.minY()-o.size.height;return e.y<r?(n=(r-e.y)/s,Zu((1-n)*e.x+n*t.x,r,e,t,i,s)):(r=o.maxY()+o.size.height,e.y>r?(n=(r-e.y)/s,Zu((1-n)*e.x+n*t.x,r,e,t,i,s)):e)}function Zu(e,t,i,s,o,n){const a={x:e,y:t};if("number"==typeof i._offset&&"number"==typeof s._offset){const r=Math.sqrt(o*o+n*n),l=Math.sqrt(Math.pow(e-i.x,2)+Math.pow(t-i.y,2));a._offset=i._offset+(s._offset-i._offset)*(l/r)}return a}const Ku=class extends gu{constructor(e,t,i){super(e,i),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"_fillable",!1),this._node=new Du(this),this.points=t,this.updateGeometry()}get points(){return this._points.slice()}get node(){return this._node}set points(e){m(e,Array,"[MapKit] PolylineOverlay.points expected an array of Coordinates."),this._points=e.slice(),this._mapPoints=this._points.map(((e,t)=>(m(e,Fu,"[MapKit] PolylineOverlay.points expected a Coordinate at index: "+t),e.toUnwrappedMapPoint()))),this._pointsNeedRemapping=!0,delete this._distances,delete this._colorStops,this.updateGeometry()}calculateBoundingRect(){if(0===this._mapPoints.length)return new Uu(0,0,0,0);const e=this._mapPoints.reduce(((e,t)=>(t.x<e.xMin&&(e.xMin=t.x),t.x>e.xMax&&(e.xMax=t.x),t.y<e.yMin&&(e.yMin=t.y),t.y>e.yMax&&(e.yMax=t.y),e)),{xMin:1/0,xMax:-1/0,yMin:1,yMax:0}),t=e.xMax-e.xMin,i=l(e.xMin,1);if(this._pointsNeedRemapping){delete this._pointsNeedRemapping,t>1&&console.warn("[MapKit] Polyline overlay spans over 360º in longitude and may not render correctly.");const s=e.xMin-i;this._mapPoints.forEach((e=>{e.x-=s})),zu(this._mapPoints),delete this._simplifiedShapeLevel}return new Uu(i,e.yMin,t,e.yMax-e.yMin)}simplifyShapeAtLevel(e){delete this._distances;const t=this._simplifiedShapeLevel>e?this._simplifiedShape:this._mapPoints;return Nu(t,Math.pow(2,e))}clip(e,t,i){return e.length>0&&(e=this.clipShapeByStyleProperties(e)),!t||wn(t,this._boundingRect)?0===e.length?[]:[e]:function(e,t,i){const s=t.minX()-i,o=t.minY()-i,n=t.maxX()+i,a=t.maxY()+i,r=Gu*t.size.width,l=Gu*t.size.height,h=[];let c,d;for(let i=0,u=e.length;i<u-1;++i){const u=e[i];d=e[i+1];const p=d.x-u.x;let m,g;if(0!==p){const e=(s-u.x)/p,t=(n-u.x)/p;g=!(e<0&&t<0||e>1&&t>1)}else g=u.x>=s&&u.x<=n;if(g)if(m=d.y-u.y,0!==m){const e=(o-u.y)/m,t=(a-u.y)/m;g=!(e<0&&t<0||e>1&&t>1)}else g=u.y>=o&&u.y<=a;const _=Math.abs(p)>r||Math.abs(m)>l;g?(c||(c=[]),_?(c.push(Bu(u,d,p,m,t)),c.push(Bu(d,u,-p,-m,t)),h.push(c),c=null):c.push(u)):c&&(_?(c.push(Bu(u,d,p,m,t)),c.push(Bu(d,u,-p,-m,t))):c.push(u),h.push(c),c=null)}c&&(c.push(d),h.push(c));return h}(e,t,i)}clipShapeByStyleProperties(e){const t=this.style.strokeStart,i=this.style.strokeEnd,s=this.style.lineGradient;if(0!==t||1!==i||s){if(!this._distances||s&&!this._colorStops){this._length=0,this._distances=[];const t=e.length;for(let i=0;i<t-1;++i){const t=e[i],s=e[i+1],o=Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2));this._length+=o,this._distances.push(o)}if(s){if(s._impl.indices.length>0&&void 0!==this._mapPoints[0]._offset)for(let e=0,t=this._mapPoints.length;e<t;++e)delete this._mapPoints[e]._offset;for(let i=0,s=0;i<t-1;++i)e[i]._offset=s/this._length,s+=this._distances[i];t>0&&(e[t-1]._offset=1)}}0===t&&1===i||(e=function(e,t,i,s){if(i>=s)return[];let o=0,n=!1;const a=[];let r;for(let l=0,h=e.length;l<h-1;++l){let h=e[l];r=e[l+1];const c=t[l];if(o+=c,!n&&o>=i){n=!0;const e=(o-i)/c;h={x:e*h.x+(1-e)*r.x,y:e*h.y+(1-e)*r.y,_offset:e*h._offset+(1-e)*r._offset}}if(n&&(a.push(h),o>=s)){const e=(o-s)/c;r={x:e*h.x+(1-e)*r.x,y:e*h.y+(1-e)*r.y,_offset:e*h._offset+(1-e)*r._offset};break}}return a.push(r),a}(e,this._distances,t*this._length,i*this._length))}return e}getColorStops(e){if(k(this.style.lineGradient._impl),!this._colorStops||this._colorStops.lastUpdate!==e.lastUpdate){const t=e.offsets,i=e.indices;this._colorStops=t.slice(),this._colorStops.lastUpdate=e.lastUpdate;let s=0;const o=this._mapPoints.length;for(let e=0,t=i.length;s<this._colorStops.length&&e<t;++s,++e){const t=i[e],n=t[0];if(!(n<o))break;{void 0===this._mapPoints[n]._offset&&Wu(this._mapPoints,this._length,n);const e=this._mapPoints[n]._offset,i=t[1];for(;this._colorStops[s][0]<e;)++s;this._colorStops[s][0]===e?this._colorStops[s][1]=i:this._colorStops.splice(s,0,[e,i])}}}return this._colorStops}};const ju=class extends fu{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new Ku(this,e,t)})}get points(){return this._impl.points}set points(e){this._impl.points=e}};const Hu=class extends Lu{constructor(e){super(e,!0)}stringInfo(){const e=this.overlay;return"PolygonOverlayNode<points:"+(e.points.map((e=>e.map((e=>e.toString())).join(","))).join("|")+">")+(e.style.toString()?"["+e.style+"]":"")}},qu=Li.Coordinate,Vu=Li.MapRect;const Yu=class extends gu{constructor(e,t,i){super(e,i),this._node=new Hu(this),this.points=t,this.updateGeometry()}get points(){return this._points.map((e=>e.slice()))}get node(){return this._node}set points(e){g(e,"[MapKit] PolygonOverlay.points expected an array of Coordinates."),Array.isArray(e[0])||(e=[e]),this._points=e.map(((e,t)=>(g(e,"[MapKit] PolygonOverlay.points expected an array at index: "+t),e.slice()))),this._polygons=this._points.map(((e,t)=>e.map(((e,i)=>(m(e,qu,"[MapKit] PolygonOverlay.points expected a Coordinate at index: "+t+", "+i),e.toUnwrappedMapPoint()))))),this.updateGeometry()}calculateBoundingRect(){const e=function(e){const t=e.filter((e=>e.length>2)).map((e=>{const t=e.reduce(((e,t)=>(t.x<e.xMin&&(e.xMin=t.x),t.x>e.xMax&&(e.xMax=t.x),t.y<e.yMin&&(e.yMin=t.y),t.y>e.yMax&&(e.yMax=t.y),e)),{xMin:1/0,xMax:-1/0,yMin:1,yMax:0});return new Vu(t.xMin,t.yMin,t.xMax-t.xMin,t.yMax-t.yMin)})).sort(((e,t)=>e.minX()-t.minX()));return Cn(t)}(this._polygons);return delete this._simplifiedShapeLevel,e.size.width>1&&console.warn("[MapKit] Polygon overlay spans over 360º in longitude and may not render correctly."),this._polygons.forEach((t=>{0!==t.length&&(t.forEach((t=>{const i=l(t.x,1);t.x=i+(i<e.minX()?1:0)})),zu(t,!0))})),e}simplifyShapeAtLevel(e){const t=this._simplifiedShapeLevel>e?this._simplifiedShape:this._polygons,i=Math.pow(2,e);return t.reduce(((e,t)=>{const s=Nu(t,i);return s.length>0&&e.push(s),e}),[])}clip(e,t,i){return!t||wn(t,this._boundingRect)?e:function(e,t,i){const s=t.minX()-i,o=t.minY()-i,n=t.maxX()+i,a=t.maxY()+i,r=[];for(let t=0,i=e.length;t<i;++t){const i=e[t],l=[];for(let e=0,t=i.length;e<t;++e){const o=i[e],n=i[(e-1+t)%t];if(o.x>=s){if(n.x<s){const e=(s-o.x)/(n.x-o.x);l.push({x:s,y:(1-e)*o.y+e*n.y})}l.push(o)}else if(n.x>=s){const e=(s-o.x)/(n.x-o.x);l.push({x:s,y:(1-e)*o.y+e*n.y})}}const h=[];for(let e=0,t=l.length;e<t;++e){const i=l[e],s=l[(e-1+t)%t];if(i.y>=o){if(s.y<o){const e=(o-i.y)/(s.y-i.y);h.push({x:(1-e)*i.x+e*s.x,y:o})}h.push(i)}else if(s.y>=o){const e=(o-i.y)/(s.y-i.y);h.push({x:(1-e)*i.x+e*s.x,y:o})}}const c=[];for(let e=0,t=h.length;e<t;++e){const i=h[e],s=h[(e-1+t)%t];if(i.x<=n){if(s.x>n){const e=(n-i.x)/(s.x-i.x);c.push({x:n,y:(1-e)*i.y+e*s.y})}c.push(i)}else if(s.x<=n){const e=(n-i.x)/(s.x-i.x);c.push({x:n,y:(1-e)*i.y+e*s.y})}}const d=[];for(let e=0,t=c.length;e<t;++e){const i=c[e],s=c[(e-1+t)%t];if(i.y<=a){if(s.y>a){const e=(a-i.y)/(s.y-i.y);d.push({x:(1-e)*i.x+e*s.x,y:a})}d.push(i)}else if(s.y<=a){const e=(a-i.y)/(s.y-i.y);d.push({x:(1-e)*i.x+e*s.x,y:a})}}d.length>2&&r.push(d)}return r}(e,t,i)}};const Xu=class extends fu{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new Yu(this,e,t)})}get points(){return this._impl.points}set points(e){this._impl.points=e}},$u={OverlaysController:Jd,LayerItemsController:Ud,ItemCollection:tu,mapkit:{Style:pu,LineGradient:lu,CircleOverlay:Pu,PolylineOverlay:ju,PolygonOverlay:Xu,TileOverlay:Za}};const Ju=class{constructor(e){this._map=e,this.panning=!1}update(e,t){if(!this._map.isScrollEnabled)return;const i=e._impl.translatedPosition(),s=i.x,o=s+t.size.width,n=i.y,a=n+t.size.height,r=this._map.ensureVisibleFrame();this._direction=new cs,s<=r.minX()?this._direction.x=1:o>=r.maxX()&&(this._direction.x=-1),n<=r.minY()+5?this._direction.y=1:a>=r.maxY()-5&&(this._direction.y=-1);const l=0!==this._direction.x||0!==this._direction.y;!this.panning&&l?(this.panning=!0,this._startTime=Date.now(),this._initialSpeed=Math.floor(1/104.1*(r.size.width+r.size.height)/2),Mt.scheduleOnNextFrame(this)):this.panning&&!l&&this.stop()}stop(){this.panning&&(this.panning=!1,delete this._direction,delete this._startTime,delete this._initialSpeed)}performScheduledUpdate(){if(!this.panning)return;k(this._startTime),k(this._initialSpeed);let e=this._initialSpeed;const t=Date.now()-this._startTime;t>4e3?e*=3:t>1e3&&(e*=1.5),this._map.translateCameraAnimated(new cs(this._direction.x*e,this._direction.y*e),!1),this._map.panningDuringAnnotationDrag(),Mt.scheduleOnNextFrame(this)}mapWasDestroyed(){delete this._map}};var Qu;const ep="mk-hidden",tp="mk-invisible";class ip{constructor(e){!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"delegate",null),e&&(this._public=e),this._position=this._position?this._position:new cs,this._anchorPoint=this._anchorPoint?this._anchorPoint:new cs,this._anchorOffset=this._anchorOffset?this._anchorOffset:new window.DOMPoint}init(){}get node(){return this._node}get element(){return this._element}set element(e){console.warn("[MapKit] The `element` property is read-only.")}get anchorOffset(){return this._anchorOffset}set anchorOffset(e){m(e,window.DOMPoint,"[MapKit] Annotation.anchorOffset expected a DOMPoint, but got `"+e+"` instead."),this._anchorOffset=new window.DOMPoint(e.x,e.y),this.updatePosition()}get visible(){return this._visible}set visible(e){e=!!e,this._visible!==e&&(this._visible=e,this._updateVisibility())}get appearanceAnimation(){return this._appearanceAnimation}set appearanceAnimation(e){if(p(e,"string","[MapKit] Annotation.appearanceAnimation expected a string, but got `"+e+"` instead."),""===e)return void(this._appearanceAnimation=this._appearanceAnimationName="");const t=document.createElement("div");t.style.animation=e,this._appearanceAnimationName=t.style.animationName,this._appearanceAnimationName?this._appearanceAnimation=e:console.warn("[MapKit] Annotation.appearanceAnimation expects an animation style value with an animation name, but got `"+e+"` instead.")}nodePosition(){return this._nodePosition||this._node.position}calculateNodePosition(){return new cs(this._position.x-this._anchorPoint.x-this._anchorOffset.x,this._position.y-this._anchorPoint.y-this._anchorOffset.y)}updatePosition(){const e=this.calculateNodePosition();!this.renderedByDOMElement&&this.map&&this.map._impl.cameraIsMoving?this._nodePosition=e:(delete this._nodePosition,this._node.position=e),this.positionWasUpdated(e)}setShown(e){e=!!e,this._shown!==e&&(this._shown=e,this._node.element&&this._node.classList.toggle(ep,!e),this.shownPropertyWasUpdated(e))}shownPropertyWasUpdated(){}positionWasUpdated(e){}isShown(){return this._shown}position(){return this._position}setPosition(e){this._position=e,this.updatePosition()}updateVisibility(e){this._node.classList.toggle(tp,e)}setSize(e){this._node.size=e,this._anchorPoint=new cs(e.width/2,e.height),this.updatePosition()}_updateVisibility(){!this._visible&&this._animating||(this.updateVisibility(!this._visible),this.delegate&&this.delegate.annotationPropertyDidChange(this._public||this,"visible"))}}(Qu=ip).prototype._shown=!0,Qu.prototype._visible=!0,Qu.prototype._position=void 0,Qu.prototype._anchorPoint=void 0,Qu.prototype._anchorOffset=void 0,Qu.prototype._appearanceAnimation="",Qu.prototype.renderedByDOMElement=!0,Qu.prototype.isMapFeature=!1;const sp=ip;class op extends Ke{constructor(){super(),new.target===op&&Object.defineProperty(this,"_impl",{value:new sp(this)})}get element(){return this._impl.element}set element(e){this._impl.element=e}get anchorOffset(){return this._impl.anchorOffset}set anchorOffset(e){this._impl.anchorOffset=e}get animates(){return this._impl.animates}set animates(e){this._impl.animates=e}get visible(){return this._impl.visible}set visible(e){this._impl.visible=e}get appearanceAnimation(){return this._impl.appearanceAnimation}set appearanceAnimation(e){this._impl.appearanceAnimation=e}}const np=op;class ap{constructor(e){this.displayLines=e.displayLines,e.id&&(this.id=e.id,this.alternateIds=e.alternateIds||[]),e.muid&&(this.muid=e.muid),e.location&&(this.coordinate=new bi(e.location.lat,e.location.lng)),this._completionUrl=e.completionUrl,e.attribution&&(this._providerId=e.attribution.vendorId,this._providerItemId=e.attribution.externalItemId),this.name=e.name,this.telephone=e.telephone,this.urls=e.urls||[],this.country=e.country,this.administrativeArea=e.administrativeArea,this.administrativeAreaCode=e.administrativeAreaCode,this.locality=e.locality,this.postCode=e.postCode,this.subLocality=e.subLocality,this.thoroughfare=e.thoroughfare,this.subThoroughfare=e.subThoroughfare,this.fullThoroughfare=e.fullThoroughfare,this.areasOfInterest=e.areasOfInterest,this.dependentLocalities=e.dependentLocalities,this.timezone=e.timezone,this.timezoneSecondsFromGmt=e.timezoneSecondsFromGmt}}ap.isConstructable=!1;const rp=function(e){if(ap.isConstructable)return new ap(e);throw new TypeError("[MapKit] SearchAutocompleteResult may not be constructed.")};ap.prototype.constructor=rp,rp.prototype=ap.prototype;const lp=ap,hp=(e,t,i)=>{const s=[];for(let o=0;o<e.length;o+=1){let n=parseInt(e.charAt(o),t),a=0;for(;n||a<s.length;)n+=(s[a]||0)*t,s[a]=n%i,n=(n-s[a])/i,a+=1}return s.reduce(((e,t)=>t.toString(i).toUpperCase()+e),"")},cp=(e,t)=>t?`${e}${hp(t.toString(),10,16)}`:"",dp=e=>cp("G",e.protocolVersion)+cp("H",e.sourceId)+cp("I",e.muid),up=e=>{const t={};let i=0,s=0;for(let o=0;o<=e.length;o+=1){const n=e.charCodeAt(o),a=isNaN(n)||n>=71&&n<=90;if(i!==s||a||(s=o),i!==s&&a){t[e.substring(i,s)]=e.substring(s,o),i=o,s=o}}const o=t.I;return o?{sourceId:t.H?parseInt(t.H,16):0,protocolVersion:t.G?parseInt(t.G,16):0,muid:hp(o,16,10)}:null},pp=Object.freeze({Automatic:"automatic",Callout:"callout",FullCallout:"fullCallout",CompactCallout:"compactCallout",OpenInMaps:"openInMaps"});class mp{constructor({style:e}={}){this._impl={},this.style=e||pp.Automatic}get style(){return this._impl.style}set style(e){if(!d(e,pp))throw new Error("[MapKit] value passed to `PlaceSelectionAccessory.style` must be a value of `PlaceSelectionAccessory.Styles` enum.");this._impl.style=e}}function gp(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}mp.Styles=pp;const _p=Li.Coordinate,fp=Object.freeze({element:"ro",map:"ro",coordinate:"ro",id:"rw",place:"rw",title:"rw",subtitle:"rw",data:"rw",accessibilityLabel:"rw",anchorOffset:"rw",calloutOffset:"rw",size:"rw",callout:"rw",selectionAccessory:"rw",selectionAccessoryOffset:"rw",visible:"rw",enabled:"rw",selected:"rw",calloutEnabled:"rw",animates:"rw",appearanceAnimation:"rw",collisionMode:"rw",padding:"rw",draggable:"rw",displayPriority:"rw",clusteringIdentifier:"rw"}),yp={DragStart:"drag-start",Dragging:"dragging",DragEnd:"drag-end"},vp={Low:250,High:750,Required:1e3},bp={Rectangle:"rectangle",Circle:"circle",None:"none"};function wp(e){var t;class i extends e{constructor(e,t,i,s){super(e),gp(this,"_data",{}),gp(this,"delegate",null),gp(this,"dragOffset",cs.Zero)}init(e,t,s,o){this._calloutOffset=this._calloutOffset?this._calloutOffset:new window.DOMPoint(0,1),this._padding=this._padding?this._padding:new Mn,this._selectionAccessoryOffset=this._selectionAccessoryOffset?this._selectionAccessoryOffset:new window.DOMPoint(0,0),super.init(e),_(o);if((t instanceof Oi||t instanceof lp)&&((o=o?Object.create(o):{}).place=t,t=t.coordinate),this._setCoordinate(t),this._unsized=!0,this.occluded=!1,this._setNode(t,s,o),o){for(const[e,t]of Object.entries(this.ConstructorOptions))void 0!==o[e]&&("ro"!==t?i.OptionSetters[e]?i.OptionSetters[e].call(this,o[e]):this[e]=o[e]:console.warn("[MapKit] `"+e+"` is read-only and can't be set on the Annotation."));Object.keys(o).forEach((function(e){this.isAKnownOption(e)||console.warn("[MapKit] Unknown option for annotation: "+e+" (use the `data` property instead)")}),this)}es.addEventListener(es.Events.LocaleChanged,this),this.updateLocalizedText()}get map(){return this.delegate&&this.delegate.mapForAnnotation(this._public)}set map(e){console.warn("[MapKit] The `map` property is read-only.")}get coordinate(){return this._coordinate}set coordinate(e){this.memberAnnotations||this._setCoordinate(e)}get id(){return this._place&&this._place.id||this._id}set id(e){this._id=e}get place(){return this._place}set place(e){if(!(e instanceof Oi)&&!(e instanceof lp))throw new TypeError("[MapKit] Expected a Place for Annotation.place, but got `"+e+"` instead");this._place=e}get title(){return this._title}set title(e){null!=e?(p(e,"string","[MapKit] Expected a string value for Annotation.title, but got `"+e+"` instead"),this._title=e):delete this._title,this.updateLocalizedText(),this._updatedProperty("title")}get subtitle(){return this._subtitle}set subtitle(e){null!=e?(p(e,"string","[MapKit] Expected a string value for Annotation.subtitle, but got `"+e+"` instead"),this._subtitle=e):delete this._subtitle,this.updateLocalizedText(),this._updatedProperty("subtitle")}get accessibilityLabel(){return this._accessibilityLabel}set accessibilityLabel(e){null!=e?(p(e,"string","[MapKit] Expected a string value for Annotation.accessibilityLabel, but got `"+e+"` instead"),this._accessibilityLabel=e):delete this._accessibilityLabel,this.updateLocalizedText()}get data(){return this._data}set data(e){this._data=e}get enabled(){return this._enabled}set enabled(e){this._enabled=!!e}get calloutEnabled(){return this._calloutEnabled}set calloutEnabled(e){this._calloutEnabled=!!e}get selected(){return this._selected}set selected(e){const t=!!e;if(t!==this._selected){if(this.delegate&&!this.delegate.selectionMayChange)return void console.warn("[MapKit] Selection may not change in select/deselect event handler.");this._selected=t,this._updatedProperty("selected")}}get animates(){return this._animates}set animates(e){this._animates=!!e}get calloutOffset(){return this._calloutOffset}set calloutOffset(e){m(e,window.DOMPoint,"[MapKit] Annotation.calloutOffset expected a DOMPoint, but got `"+e+"` instead."),this._calloutOffset=new window.DOMPoint(e.x,e.y),this._updatedProperty("calloutOffset")}get callout(){return this._callout}set callout(e){null!==e&&p(e,"object","[MapKit] Annotation.callout expected an object, but got `"+e+"` instead."),this._callout=e}get selectionAccessory(){return this._selectionAccessory}set selectionAccessory(e){if(!this.place&&!this.muid)throw new Error("[MapKit] Selection Accessory can only be set on an annotation with an associated `place`.");null!==e&&m(e,mp,"[MapKit] The `selectionAccessory` parameter passed to `Annotation.selectionAccessory` is not a PlaceSelectionAccessory."),this._selectionAccessory=e}get selectionAccessoryOffset(){return this._selectionAccessoryOffset}set selectionAccessoryOffset(e){m(e,window.DOMPoint,"[MapKit] Annotation.selectionAccessoryOffset expected a DOMPoint, but got `"+e+"` instead."),this._selectionAccessoryOffset=new window.DOMPoint(e.x,e.y),this._updatedProperty("selectionAccessoryOffset")}get draggable(){return this._draggable}set draggable(e){this.memberAnnotations||this._setDraggable(e)}get draggingLift(){return this._draggingLift}set draggingLift(e){if(p(e,"number","[MapKit] Annotation.draggingLift expected a number, but got `"+e+"` instead."),e<0)throw new Error("[MapKit] Annotation.draggingLift must be zero or more.");this._draggingLift=e}get size(){if(this._updateSize(),!this._unsized)return this._node.size.copy()}set size(e){const t="[MapKit] Annotation size expects a size object with width and height properties";p(e,"object",t),p(e.width,"number",t),p(e.height,"number",t),this.setSize(new ls(e.width,e.height)),this._userSetSize=!0,this.updateSize()}get opacity(){return this.sceneGraphNode?this.sceneGraphNode.opacity:this.node.opacity}set opacity(e){this.sceneGraphNode?this.sceneGraphNode.opacity=e:this.node.opacity=e}get displayPriority(){return this._displayPriority}set displayPriority(e){this.memberAnnotations||this._setDisplayPriority(e)}isRequired(){return this.selected||this.displayPriority===vp.Required}get collisionMode(){return this._collisionMode}set collisionMode(e){if(!d(e,bp))throw new Error("[MapKit] Unknown value for `collisionMode`. Choose from Annotation.CollisionMode.");e!==this._collisionMode&&(this._collisionMode=e,this._updatedProperty("collisionMode"))}get clusteringIdentifier(){return this._clusteringIdentifier}set clusteringIdentifier(e){this.memberAnnotations||this._setClusteringIdentifier(e)}get padding(){return this._padding.copy()}set padding(e){m(e,Mn,"[MapKit] The `padding` parameter passed to `Annotation.padding` is not a Padding."),this._padding.equals(e)||(this._padding=e.copy(),this._updatedProperty("padding"))}get needsLayout(){return this._sceneGraphNode&&this._sceneGraphNode.needsLayout}get elementInAnnotationDOM(){return this._node.element.firstChild}getMuidList(){const e=[],t=this.id,i=t?up(t):null,s=i&&i.muid||this.place&&this.place.muid||this.muid;s&&e.push(s);const o=this.place&&this.place.alternateIds||[];for(const t of o){const i=t?up(t):null;i&&i.muid&&e.push(i.muid)}return e}centerOffsetForSelectionAccessory(){const e=this.size;return new cs(-e.width/2,-e.height/2)}removedFromMap(){this._removedFromMap=!0,es.removeEventListener(es.Events.LocaleChanged,this),this._occludedAnimation&&this._occludedAnimation.end(),this._clusteringAnimation&&this._clusteringAnimation.end()}addedToMap(){this._removedFromMap&&(this._removedFromMap=!1,es.addEventListener(es.Events.LocaleChanged,this),this.updateLocalizedText())}setDelegate(e){this.delegate=e}updateLayout(){}doesAnimate(){return this._animates&&!!this._appearanceAnimationName}willMoveToMap(){this._isMoving=this.doesAnimate(),this._updateSize()}didMoveToMap(){this._isMoving&&this._appearanceAnimationName&&this._visible&&(this.element.style.animation=this._appearanceAnimation,this.element.style.animationName&&(this._animating=!0,this.element.addEventListener("animationend",this))),delete this._isMoving}isStable(){return!(this.isWaiting||this._isMoving||this._isAnimating||this._isLifted)}canShowCallout(){return this._calloutEnabled&&this.isStable()}canShowSelectionAccessory(){return this.isStable()}selectionAccessoryWillAppear(){}selectionAccessoryWillDisappear(){}canBePicked(){return this._shown&&this._visible&&!this._isMoving&&!this._isAnimating&&!this._isLifted&&!this.occluded}draggingDidStart(){this._public.dispatchEvent(new je.Event(yp.DragStart))}isDraggable(){return this.draggable&&!this._isLifted}isLifted(){return this._isLifted}dispatchDraggingEvent(){const e=new je.Event(i.Events.Dragging);return e.coordinate=this._coordinateDuringDrag(),this._public.dispatchEvent(e),e}positionForCallout(){let e=this._calloutAnchorPoint;if(!e){const t=this._userSetSize?this._node.size:this.delegate.sizeForElement(this.elementInAnnotationDOM);e=new cs(-t.width/2,0)}const t=this.nodePosition();return new cs(t.x-e.x-this._calloutOffset.x,t.y-e.y-this._calloutOffset.y)}positionForSelectionAccessory(e,t){const i=this.centerOffsetForSelectionAccessory();i.x-=this._selectionAccessoryOffset.x,i.y-=this._selectionAccessoryOffset.y;const s=this.nodePosition(),o=this.size;let n;switch(e){case"top":n=new cs(i.x,t);break;case"left":n=new cs(t,i.y);break;case"right":n=new cs(-o.width-t,i.y);break;case"bottom":n=new cs(i.x,-o.height-t)}return new cs(s.x-n.x,s.y-n.y)}setDraggingTranslationForMapFrameSize(e,t){this._dragController.setTranslation(this.clampDraggingTranslationForMapFrameSize(e,t))}dropAfterDraggingAndRevertPosition(e){this._dragController.dropAnnotationAfterDraggingAndRevertPosition(e)}distanceToPoint(e){const t=this._node.position.x,i=t+this._node.size.width,s=t-e.x,o=i-e.x,n=s<=0&&o>=0?0:Math.min(Math.abs(s),Math.abs(o)),a=this._node.position.y,r=a+this._node.size.height,l=a-e.y,h=r-e.y,c=l<=0&&h>=0?0:Math.min(Math.abs(l),Math.abs(h));return n*n+c*c}lift(){this._isLifted=!0,this._dragController.lift(this._draggingLift),this._updatedProperty("")}translate(e,t){this.sceneGraphNode?this.sceneGraphNode.transform=(new ys).translate(e,t):this._node.transform=(new ao).translate(e,t)}translatedPosition(){const e=this._dragController.getTranslation();return new cs(this._position.x-this._anchorPoint.x-this._anchorOffset.x+e.x,this._position.y-this._anchorPoint.y-this._anchorOffset.y+e.y)}updatedPosition(){return this.coordinate?(this.x=Li.convertLongitudeToX(Li.wrapLongitude(this.coordinate.longitude)),this.y=Li.convertLatitudeToY(this.coordinate.latitude),!0):(this.setShown(!1),this.sceneGraphNode&&this.sceneGraphNode.remove(),!1)}get sceneGraphNode(){return this._sceneGraphNode}mayBeDrawn(){return!!this.sceneGraphNode&&this._shown&&this.visible&&!this.isWaiting}isDrawn(){return(!this.occluded||this._occludedAnimation)&&this.mayBeDrawn()}animateOcclusion(){const e=this.occluded?0:1;this._sceneGraphNode&&(this._occludedAnimation&&this._occludedAnimation.end(),this._occludedAnimation=new pn({node:this._sceneGraphNode,from:1-e,to:e,duration:200,done:()=>{delete this._occludedAnimation}}).begin());const t=this.occluded&&this.cluster&&this.cluster._impl&&!this.cluster._impl.occluded,i=!this.occluded&&this.previousCluster&&!this.previousCluster._impl.wasOccluded;(t||i)&&this._animateClustering()}positionWasUpdated(e){this._sceneGraphNode&&(this._sceneGraphNode.needsDisplay=!0)}handleEvent(e){switch(e.type){case es.Events.LocaleChanged:this.updateLocalizedText();break;case"animationend":if(e.animationName!==this._appearanceAnimationName)return;this.element.style.animation="",this.element.removeEventListener("animationend",this),this.finishedAnimating()}}updateLocalizedText(){this._node&&this._node.element&&this._node.element.setAttribute("aria-label",this.altText())}altText(){return this._accessibilityLabel||(this.title&&this.subtitle?es.get("Annotation.Generic.AccessibilityLabel",{title:this.title,subtitle:this.subtitle}):this.title||this.subtitle||"")}updateSize(){delete this._unsized,this._selected&&this.delegate&&this.delegate.selectedAnnotationDidMoveToMap(this._public)}clampDraggingTranslationForMapFrameSize(e,t){const i=this._anchorPoint.x+this._anchorOffset.x-this._position.x,s=t.width-this._node.size.width+i,o=this._anchorPoint.y+this._anchorOffset.y+this._dragController.liftAmount-this._position.y,n=t.height-this._node.size.height+o;return new cs(c(e.x,i,s),c(e.y,o,n))}droppedAfterLift(){delete this._isLifted,this._selected&&this.delegate&&this.delegate.selectedAnnotationDidMoveToMap(this._public),this._updatedProperty("")}draggingDidEnd(){this.coordinate=this._coordinateDuringDrag(),this.resetNodeTransform(),this._public.dispatchEvent(new je.Event(i.Events.DragEnd))}resetNodeTransform(){this.node.transform=new ao}finishedAnimating(){delete this._isAnimating,this._selected&&this.delegate&&this.delegate.selectedAnnotationDidMoveToMap(this._public),this._visible||this._updateVisibility(),this.delegate&&this.delegate.annotationFinishedAnimating(this._public)}isAKnownOption(e){return Object.keys(this.ConstructorOptions).includes(e)}_animateClustering(){if(this._sceneGraphNode){const e={annotation:this,node:this._sceneGraphNode,duration:200,done:()=>delete this._clusteringAnimation};this.cluster?(e.from=this.coordinate.toMapPoint(),e.to=this.cluster.coordinate.toMapPoint()):(e.from=this.previousCluster.coordinate.toMapPoint(),e.to=this.coordinate.toMapPoint());const t=e.to.x-e.from.x;t<-.5?e.to.x+=1:t>.5&&(e.from.x+=1),this._clusteringAnimation&&this._clusteringAnimation.end(),this._clusteringAnimation=new Cp(e).begin()}}_setCoordinate(e){m(e,_p,"[MapKit] Annotation.coordinate expected a Coordinate value."),delete this._translation,this._coordinate=e.copy(),this._updatedProperty("coordinate")}_setDraggable(e){const t=!!e;t!==this._draggable&&(this._draggable=t,this._updatedProperty("draggable"))}_setDisplayPriority(e){const t="[MapKit] Annotation displayPriority expects a number between 0 and "+vp.Required;p(e,"number",t);const i=c(e,0,vp.Required);if(i!==e)console.warn(t+", value was normalized");else if(i===this._displayPriority)return;this._displayPriority=i,this._updatedProperty("displayPriority")}_setClusteringIdentifier(e){null!==e&&p(e,"string","[MapKit] Annotation clusteringIdentifier expects a string"),this._clusteringIdentifier!==e&&(this._clusteringIdentifier=e,this._updatedProperty("clusteringIdentifier"))}_coordinateDuringDrag(){const e=this.sceneGraphNode?this._dragController.translation.x:0,t=this.sceneGraphNode?this._dragController.translation.y-this._dragController.liftAmount:0,i=this.node.convertPointToPage(new cs(e+this.dragOffset.x+this._anchorPoint.x+this.anchorOffset.x,t+this.dragOffset.y+this._anchorPoint.y+this.anchorOffset.y));return this.delegate._map.convertPointOnPageToCoordinate(new window.DOMPoint(i.x,i.y))}_updateSize(){if(!this._unsized||this._userSetSize||!this.delegate)return;const e=this.delegate.sizeForElement(this.elementInAnnotationDOM);e&&(delete this._unsized,this.setSize(e))}_updatedProperty(e){this.delegate&&this.delegate.annotationPropertyDidChange(this._public,e)}}return(t=i).prototype._calloutOffset=void 0,t.prototype._enabled=!0,t.prototype._selected=!1,t.prototype._calloutEnabled=!0,t.prototype._draggable=!1,t.prototype._title="",t.prototype._subtitle="",t.prototype._accessibilityLabel=null,t.prototype._displayPriority=vp.Required,t.prototype._collisionMode=bp.Rectangle,t.prototype._clusteringIdentifier=null,t.prototype._sceneGraphNode=null,t.prototype._padding=void 0,t.prototype._draggingLift=40,t.prototype.shouldHideLabels=!1,t.prototype._callout=null,t.prototype._selectionAccessory=null,t.prototype._selectionAccessoryOffset=void 0,t.prototype._animates=!1,t.prototype.ConstructorOptions=fp,gp(i,"Events",yp),gp(i,"DisplayPriority",vp),gp(i,"CollisionMode",bp),gp(i,"OptionSetters",Object.freeze({draggable:t.prototype._setIsDraggable,displayPriority:t.prototype._setDisplayPriority,clusteringIdentifier:t.prototype._setClusteringIdentifier})),i}class Cp extends un{constructor(e){super(e),this.annotation=e.annotation}update(e){const t=this.annotation;if(null==t.delegate)return;const i=t.delegate._map,s=i.camera.toRenderingMapRect(),o=Li.wrapX((1-e)*this.from.x+e*this.to.x,s.midX()),n=(1-e)*this.from.y+e*this.to.y,a=i.adjustMapItemPoint(i.camera.transformMapPoint(new cs(o,n)));this.node.transform=(new ys).translate(a.x-t._position.x,a.y-t._position.y)}stringInfo(){return super.stringInfo("translation*")}}wp.Events=yp,wp.DisplayPriority=vp,wp.CollisionMode=bp;const kp=wp;function Sp(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Mp=class{constructor(e){Sp(this,"liftDurationMs",200),Sp(this,"liftOpacity",.5),this._annotation=e}animateLift(){const e=Math.min((Date.now()-this._liftAnimationStartDate)/this.liftDurationMs,1);this._annotation.translate(this.translation.x,this.translation.y-this.liftAmount*e),this._annotation.opacity=1-(1-this.liftOpacity)*e,e<1?(Mt.scheduleOnNextFrame(this),this._liftAnimationProgress=e):(delete this._liftAnimationStartDate,delete this._liftAnimationProgress)}animateDropAfterLift(){const e=Math.max(this._dropAnimationStartP-Math.min((Date.now()-this._dropAfterLiftAnimationStartDate)/this.liftDurationMs,1),0);this._dropAnimationRevert&&this._annotation.translate(0,-this.liftAmount*e),this._annotation.opacity=1-(1-this.liftOpacity)*e,e>0?Mt.scheduleOnNextFrame(this):this._annotation.droppedAfterLift()}dropAnnotationAfterDraggingAndRevertPosition(e){this._liftAnimationStartDate?(this._dropAnimationStartP=this._liftAnimationProgress,delete this._liftAnimationStartDate,delete this._liftAnimationProgress):this._dropAnimationStartP=1,e?this._annotation.resetNodeTransform():this._annotation.draggingDidEnd(),this._dropAfterLiftAnimationStartDate=Date.now(),this._dropAnimationRevert=e,Mt.scheduleOnNextFrame(this)}lift(e){this.liftAmount=e,this.translation=new cs,e>0?(this._liftAnimationStartDate=Date.now(),this._liftAnimationProgress=0,Mt.scheduleOnNextFrame(this)):this._annotation.opacity=this.liftOpacity}getTranslation(){return new cs(this.translation.x,this.translation.y-this.liftAmount)}setTranslation(e){this.translation=e,this._liftAnimationStartDate||this._annotation.translate(this.translation.x+this._annotation.dragOffset.x,this.translation.y-this.liftAmount+this._annotation.dragOffset.y)}performScheduledUpdate(){this._liftAnimationStartDate?this.animateLift():this._dropAfterLiftAnimationStartDate&&this.animateDropAfterLift()}},Lp=kp(sp);Lp.prototype._animates=!0,Lp.prototype._setNode=function(e,t,i){p(t,"function");const s=fe(t,window,[e,i]);le(s,"[MapKit] Annotation element factory must return a DOM element, got `"+s+"` instead."),this._element=s;let o=s;if(Bo.supportsShadowDOM){const e="mk-slot-"+Math.random().toString(32).substr(2,8);s.slot=e,o=Bo.htmlElement("slot"),o.name=e}this._node=new Lo.Node(Bo.htmlElement("div",o)),this._node.wantsHardwareCompositing=this.renderedByDOMElement,this._dragController||(this._dragController=new Mp(this))},Lp.div=function(){return document.createElement("div")};const xp=Lp;function Ap(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Ep extends np{constructor(e,t,i){super(),new.target===Ep&&(Object.defineProperty(this,"_impl",{value:new xp(this,e,t,i)}),this._impl.init(this,e,t,i))}get map(){return this._impl.map}set map(e){this._impl.map=e}get coordinate(){return this._impl.coordinate}set coordinate(e){this._impl.coordinate=e}get id(){return this._impl.id}get title(){return this._impl.title}set title(e){this._impl.title=e}get subtitle(){return this._impl.subtitle}set subtitle(e){this._impl.subtitle=e}get accessibilityLabel(){return this._impl.accessibilityLabel}set accessibilityLabel(e){this._impl.accessibilityLabel=e}get data(){return this._impl.data}set data(e){this._impl.data=e}get enabled(){return this._impl.enabled}set enabled(e){this._impl.enabled=e}get calloutEnabled(){return this._impl.calloutEnabled}set calloutEnabled(e){this._impl.calloutEnabled=e}get selectionAccessory(){return this._impl.selectionAccessory}set selectionAccessory(e){this._impl.selectionAccessory=e}get selectionAccessoryOffset(){return this._impl.selectionAccessoryOffset}set selectionAccessoryOffset(e){this._impl.selectionAccessoryOffset=e}get selected(){return this._impl.selected}set selected(e){this._impl.selected=e}get animates(){return this._impl.animates}set animates(e){this._impl.animates=e}get calloutOffset(){return this._impl.calloutOffset}set calloutOffset(e){this._impl.calloutOffset=e}get callout(){return this._impl.callout}set callout(e){this._impl.callout=e}get draggable(){return this._impl.draggable}set draggable(e){this._impl.draggable=e}get size(){return this._impl.size}set size(e){this._impl.size=e}get displayPriority(){return this._impl.displayPriority}set displayPriority(e){this._impl.displayPriority=e}get collisionMode(){return this._impl.collisionMode}set collisionMode(e){this._impl.collisionMode=e}get clusteringIdentifier(){return this._impl.clusteringIdentifier}set clusteringIdentifier(e){this._impl.clusteringIdentifier=e}get padding(){return this._impl.padding}set padding(e){this._impl.padding=e}}Ap(Ep,"EVENTS",kp.EVENTS),Ap(Ep,"DisplayPriority",kp.DisplayPriority),Ap(Ep,"CollisionMode",kp.CollisionMode);const Tp=Ep;const Ip=class extends Qo{pathForSquareDot(e,t){const i=.6*t,s=.4*t;e.moveTo(t,0),e.lineTo(t+s,0),e.arc(t+s,i,i,Math.PI/2*3,0),e.lineTo(2*t,t+s),e.arc(t+s,t+s,i,0,Math.PI/2),e.lineTo(i,2*t),e.arc(i,t+s,i,Math.PI/2,Math.PI),e.lineTo(0,t-s),e.arc(i,i,i,Math.PI,Math.PI/2*3),e.lineTo(t,0)}};function Op(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function Rp(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}let Pp;const Dp=["size3","size4"];let zp=[],Np=" ",Fp="default-loading";var Up=new WeakSet,Gp=new WeakSet,Wp=new WeakSet,Bp=new WeakSet;function Zp(e,t){e.shadowOffsetY=t.shadowOffsetY*t.balloonRadius,e.shadowBlur=t.shadowBlur,e.shadowColor=t.shadowColor}function Kp(e,t,i,s){e.beginPath(),this.pathForBalloon(e,s.balloonRadius,s.style),e.fillStyle="selected"===t?i.selectedStrokeColor:i.strokeColor,e.fill()}function jp(e,t,i,s){e.save();const o="selected"===t?i.selectedFillColor:i.fillColor;e.beginPath();const n=s.balloonRadius-s.borderWidth;if(this.pathForMask(e,s.balloonRadius,n),i.fillWithGradient)if(i.gradientColors){const t=e.createLinearGradient(0,0,0,2*s.balloonRadius);t.addColorStop(0,i.gradientColors.start),t.addColorStop(1,i.gradientColors.end),e.fillStyle=t,e.fill()}else{e.fillStyle=o,e.fill(),e.globalCompositeOperation="overlay";const t=e.createLinearGradient(0,0,0,2*s.balloonRadius);t.addColorStop(0,"#a5a5a5"),t.addColorStop(1,"#4d4d4d"),e.fillStyle=t,e.fill()}else e.fillStyle=o,e.fill();e.restore()}function Hp(e,t,i,s){if(delete this.glyphFontSize,i.glyphText)this.glyphFontSize=qp(e,i,s),this.renderType="glyphText";else{const[o,n]=function(e,t,i,s,o,n){let a,r=!o,l=o?2*s.balloonRadius:s.glyphImageSize,h=Bo.roundToDevicePixel((t.size.width-l)/2),c=!1;a="default"===i||"lifted"===i?t.glyphImage:t.selectedGlyphImage||t.glyphImage;0;if(k(),!a&&t.enablesDefaultGlyphImage){if(Np)return k(),S(),Xp(),zp.indexOf(t)<0&&zp.push(t),qp(e,t.annotation,s,Np),[null,!1];S(),a=Pp[(e=>"selected"===e?"size4":"size3")(i)],l=2*s.balloonRadius,h=Bo.roundToDevicePixel((t.size.width-l)/2),r=!0,c=!0}try{if(!a)return[null,!1];let i;return i=r?function(e,t,i){Jp.get(e)||Jp.set(e,{});const s=Jp.get(e);S(),s[t]||(s[t]=[]);const o=i*Bo.devicePixelRatio;if(!s[t][o]){const i=de();i.width=o,i.height=o;const n=i.getContext("2d");S(),n.fillStyle=t,n.fillRect(0,0,o,o),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0,o,o),s[t][o]=i}return s[t][o]}(a,t.annotation.glyphColor,l):function(e,t,i,s){$p.get(e)||$p.set(e,{});const o=$p.get(e);S();const n=Bo.devicePixelRatio,a=t*n;if(!o[a]){const t=i*n/2,r=de();r.width=a,r.height=a;const l=r.getContext("2d");S(),l.beginPath(),s(l,a/2,t),l.clip(),l.drawImage(e,0,0,a,a),o[a]=r}return o[a]}(a,l,2*(s.balloonRadius-s.borderWidth),n),e.drawImage(i,h,h,l,l),c?[null,!1]:[a.src,null===a.crossOrigin]}catch(e){return t.glyphImageError(i),[null,!1]}}(e,this.node,t,s,i.isPlaceStyle,((e,t,i)=>this.pathForMask(e,t,i)));this.glyphImageSrc=o,this.isTainted=n,this.renderType=this.glyphImageSrc?"glyphImage":Fp}}function qp(e,t,i,s){null==s&&(s=t.glyphText),S(),e.save(),e.fillStyle=t.glyphColor;let o,n=i.glyphFontSize;do{e.font=n--+"px "+Js,o=e.measureText(s).width}while(o>i.glyphImageSize&&n>0);e.textBaseline="alphabetic";const a=i.balloonRadius+.35*n;let r;return"1"===s?(e.textAlign="left",r=i.balloonRadius-o/2-o/16,e.fillText(s,r,a,i.glyphImageSize)):(e.textAlign="center",e.fillText(s,i.balloonRadius,a,i.glyphImageSize)),e.restore(),n+1}function Vp(){const e=Math.min(Bo.imagePixelRatio,3),t=(e>1?"_"+e+"x":"")+".png",i={};let s=Dp.length;function o(){S(),--s,0===s&&(Pp=i,Np="",Fp="default",zp.forEach((e=>{e.freeze(),e.needsDisplay=!0})),zp=void 0)}Dp.forEach((e=>{!function(e){const s=It.createImageUrl("pins/marker"+(e?"-":"")+e+t),n=new wa($.Highest,{urlForImageLoader:s,loaderDidSucceed:function(){S(n.image),i[e]=n.image,o()},loaderDidFail:function(){console.warn("[MapKit] Error loading marker annotation image "+n.url+"; marker annotations may not display correctly."),Np="?",Fp="default-error",o()}});n.crossOrigin=fa.getCorsAttribute(Ze.urlWithCredentials(s)),n.schedule()}(e)}))}let Yp=!1;function Xp(){k(),Yp||(Yp=!0,Ze.state!==Ze.States.PENDING&&Ze.state!==Ze.States.READY?Ze.addEventListener(Ze.Events.Initialized,(function e(){Ze.removeEventListener(Ze.Events.Initialized,e),Vp()})):Vp())}const $p=new WeakMap;const Jp=new WeakMap;const Qp=class extends Ip{constructor(...e){super(...e),Op(this,Bp),Op(this,Wp),Op(this,Gp),Op(this,Up),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"isTainted",!1)}static loadMarkerResources(){Xp()}draw(e){this._sharedLayer&&(this._sharedLayer.renderer=this);const t=this._node;S(t.state);const i=t.state,s=t.annotation,o=t.params;if(s.balloonVisible){switch(!s.warnOnUnselectedGlyphImageAccess||"default"!==i&&"lifted"!==i||console.warn("[MapKit] Unselected glyph image style is not available for this annotation."),delete this.glyphImageSrc,this.isTainted=!1,delete this.renderType,e.save(),o.style){case"bubble":Rp(this,Gp,Kp).call(this,e,i,s,o),Rp(this,Wp,jp).call(this,e,i,s,o),Rp(this,Bp,Hp).call(this,e,i,s,o);break;case void 0:e.beginPath(),this.drawDotUnderCallout(e,s.selectedFillColor,o.radius);break;case"default":case"poi":case"balloon":e.save(),Rp(this,Up,Zp).call(this,e,o),Rp(this,Gp,Kp).call(this,e,i,s,o),e.restore(),Rp(this,Wp,jp).call(this,e,i,s,o),Rp(this,Bp,Hp).call(this,e,i,s,o)}e.restore()}}get isFallbackGlyphTextPending(){return!Pp}addPendingNode(e){k(),S(),S(e.enablesDefaultGlyphImage),zp.indexOf(e)<0&&zp.push(e),Xp()}get fallbackGlyphText(){return Np}get rendererForSharedLayer(){return this._sharedLayer?this._sharedLayer.renderer:this}drawDotUnderCallout(e,t,i){k()}pathForBalloon(e,t,i){k()}pathForMask(e,t,i){k()}};const em=class extends Qp{drawDotUnderCallout(e,t,i){e.strokeStyle=t,e.lineWidth=i,e.arc(i,i,i/2,0,2*Math.PI),e.stroke()}pathForBalloon(e,t,i){switch(i){case"balloon":e.save(),e.scale(t/256,t/256),e.moveTo(327.439,501.776),e.lineTo(327.525,501.776),e.bezierCurveTo(301.142,509.276,279.265,526.476,266.881,550.341),e.bezierCurveTo(263.709,556.456,261.65,562.811,255.956,562.811),e.bezierCurveTo(250.262,562.811,248.204,556.456,245.03,550.341),e.bezierCurveTo(232.648,526.471,210.771,509.272,184.388,501.776),e.lineTo(184.561,501.776),e.bezierCurveTo(77.943,470.858,0,372.507,0,255.944),e.bezierCurveTo(0,114.59,114.615,0,256,0),e.bezierCurveTo(397.385,0,512,114.59,512,255.944),e.bezierCurveTo(512,372.507,434.057,470.858,327.439,501.775),e.closePath(),e.restore();break;case"default":{const i=t/13.5*5,s=i/6,o=i/3,n=2*t,a=.448*t,r=.385*t;e.moveTo(n,t),e.bezierCurveTo(n,1.5*t,n-r,n-i/3,t+i/2+o,n),e.bezierCurveTo(t+i/3,n+i/3,t+s,n+i,t,n+i),e.bezierCurveTo(t-s,n+i,t-i/3,n+i/3,t-(i/2+o),n),e.bezierCurveTo(r,n-i/3,0,1.5*t,0,t),e.bezierCurveTo(0,a,a,0,t,0),e.bezierCurveTo(n-a,0,n,a,n,t),e.closePath();break}default:e.arc(t,t,t,0,2*Math.PI)}}pathForMask(e,t,i){e.arc(t,t,i,0,2*Math.PI)}};const tm=class extends Qp{drawDotUnderCallout(e,t,i){e.fillStyle=t,this.pathForSquareDot(e,i),e.fill()}pathForBalloon(e,t,i){e.save(),e.scale(t/256,t/256),e.moveTo(424.278,512.1),"balloon"!==i&&"default"!==i||(e.lineTo(363.104,512.1),e.bezierCurveTo(302.97,513.623,278.509,528.747,266.778,551.35),e.bezierCurveTo(263.607,557.462,261.548,563.819,255.857,563.819),e.bezierCurveTo(250.167,563.819,248.107,557.462,244.937,551.35),e.bezierCurveTo(233.205,528.747,208.743,513.623,148.61,512.1)),e.lineTo(87.723,512.1),e.bezierCurveTo(39.475,512.099,0,472.713,0,424.573),e.lineTo(0,87.525),e.bezierCurveTo(0,39.387,39.475,0,87.723,0),e.lineTo(424.278,0),e.bezierCurveTo(472.525,0,512,39.387,512,87.525),e.lineTo(512,424.573),e.bezierCurveTo(512,472.713,472.525,512.099,424.278,512.099),e.closePath(),e.restore()}pathForMask(e,t,i){e.save();const s=t-i;e.translate(s,s),e.scale(i/256,i/256),e.moveTo(424.278,512.1),e.lineTo(87.723,512.1),e.bezierCurveTo(39.475,512.099,0,472.713,0,424.573),e.lineTo(0,87.525),e.bezierCurveTo(0,39.387,39.475,0,87.723,0),e.lineTo(424.278,0),e.bezierCurveTo(472.525,0,512,39.387,512,87.525),e.lineTo(512,424.573),e.bezierCurveTo(512,472.713,472.525,512.099,424.278,512.099),e.closePath(),e.restore()}};function im(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const sm=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const om=class extends Ns{constructor(e,t){super(),im(this,"delegate",null),im(this,"_renderer",null),im(this,"injectedDefaultImage",void 0),im(this,"injectedDefaultImageScale",void 0),im(this,"glyphImage",void 0),im(this,"selectedGlyphImage",void 0),this.annotation=e,t&&(this._state=t)}get enablesDefaultGlyphImage(){return this.annotation.enablesDefaultGlyphImage}set enablesDefaultGlyphImage(e){this.annotation.enablesDefaultGlyphImage=e}setDelegate(e){this.delegate=e}isTainted(){return S(this._renderer),this._renderer.isTainted}stringInfo(){S(this._renderer);const e=this._renderer.rendererForSharedLayer,t=sm(this,"_state")?`<${this.state}>`:"",i=sm(e,"glyphFontSize")?` "${this.annotation.glyphText}"@${e.glyphFontSize}`:"",s=[];this._renderer instanceof tm&&s.push("⏹"),this.annotation.balloonVisible||s.push("👻"),this.annotation.isAppStyle&&s.push("⭕️"),this.annotation.isPlaceStyle&&s.push("📍");const o=s.length?` ${s.join(" ")}`:"",n=e.glyphImageSrc?" 🖼 "+e.glyphImageSrc:"";return""+("MarkerAnnotationBalloonNode"+t+("selected"===this.state?`<color: ${this.annotation.selectedFillColor}${this.annotation.selectedStrokeColor!==this.annotation.defaultStrokeColor?`/${this.annotation.selectedStrokeColor}`:""}>`:`<color: ${this.annotation.fillColor}${this.annotation.strokeColor!==this.annotation.defaultStrokeColor?`/${this.annotation.strokeColor}`:""}>`)+i+n+o)}get state(){return S(this.delegate),sm(this,"_state")?(S(this._state),this._state):this.delegate.state}get params(){return S(this.delegate),S(this.state),this.delegate.getParamsFromState(this.state)}get layerBounds(){const e=Math.ceil(this.size.width/2),t=Math.ceil(this.size.height/4);return new us(-e,-t,this.size.width+2*e,Math.ceil(1.5*this.size.height)+t)}glyphImageError(e){"selected"===e&&this.selectedGlyphImage?delete this.selectedGlyphImage:delete this.glyphImage,this.needsDisplay=!0}setBalloonStyle(){if(this.annotation.useSquareBalloon){if(this._renderer&&this._renderer.constructor===tm)return;this._renderer=new tm(this)}else{if(this._renderer&&this._renderer.constructor===em)return;this._renderer=new em(this)}}freeze(){if("default"!==this.state&&"lifted"!==this.state)return void(this.keyForFrozenLayer="");const e=this._renderer;S();const t=this.annotation;!t.glyph&&this.enablesDefaultGlyphImage&&e.isFallbackGlyphTextPending&&e.addPendingNode(this);const i=`${t.fillColor}${this.annotation.strokeColor!==this.annotation.defaultStrokeColor?`/${this.annotation.strokeColor}`:""}`;this.keyForFrozenLayer="balloon-"+[i,t.glyph?t.glyph:e.fallbackGlyphText,t.glyphColor,t.useSquareBalloon?"square":""].join("-"),this.annotation.fillWithGradient||(this.keyForFrozenLayer+="-flat"),this.annotation.balloonVisible||(this.keyForFrozenLayer+="-nonvisible"),this.annotation.isPlaceStyle&&(this.keyForFrozenLayer+="-place"),this.annotation.isAppStyle&&(this.keyForFrozenLayer+="-app")}};const nm=class extends Ip{draw(e){const t=this._node,i=t.annotation;if(!i.balloonVisible)return;const s=t.params;e.save(),e.beginPath(),e.translate(-s.dotBorderWidth/2,-s.dotBorderWidth/2),this.pathForDot(e,s.dotRadius*s.dotScale+s.dotBorderWidth/2),e.fillStyle=i.selectedStrokeColor,e.fill(),e.restore(),e.save(),e.beginPath(),e.translate(s.dotBorderWidth/2,s.dotBorderWidth/2),this.pathForDot(e,s.dotRadius*s.dotScale-s.dotBorderWidth/2),i.fillWithGradient?i.gradientColors?(e.fillStyle=i.gradientColors.end,e.fill()):(e.fillStyle=i.selectedFillColor,e.fill(),e.globalCompositeOperation="overlay",e.fillStyle="#4d4d4d",e.fill()):(e.fillStyle=i.selectedFillColor,e.fill()),e.restore()}pathForDot(e,t){k()}};const am=class extends nm{pathForDot(e,t){e.arc(t,t,t,0,2*Math.PI)}};const rm=class extends nm{pathForDot(e,t){this.pathForSquareDot(e,t)}};const lm=class extends Ns{constructor(e,t){super(),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"_renderer",void 0),this.annotation=e,this.params=t,e.useSquareBalloon?this._renderer=new rm(this):this._renderer=new am(this)}stringInfo(){const e=this._renderer instanceof rm?" ⏹":"";return"MarkerAnnotationDotNode<color: "+this.annotation.fillColor+">"+e}};function hm(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const cm=Object.freeze({title:{font:"600 11px "+Js,weight:600,fontWeight:600,fontFamily:Js,height:26,fontSize:11,lineHeight:12,yPadding:1,yMargin:5,shadowBlur:8,shadowOffsetY:.5,shadowColor:"rgba(0, 0, 0, .1)"},subtitle:{font:"500 10px "+Js,weight:500,fontWeight:500,fontFamily:Js,height:25,fontSize:10,lineHeight:11,yPadding:1,yMargin:5,shadowBlur:8,shadowOffsetY:.5,shadowColor:"rgba(0, 0, 0, .1)"}}),dm=(e,t,i)=>{const s=cm[e],o=s.fontFamily||Js,n=s.fontWeight||500,a=(s.fontSize||11)*t,r=`${n} ${a}px ${o}`;if(i){const e=(s.height||16)*t,o=(s.lineHeight||12)*t;i.weight=n,i.fontSize=a,i.height=e,i.lineHeight=o,i.font=r}return r},um=(e,t)=>{dm("title",e,t.title),dm("subtitle",e,t.subtitle)},pm=()=>{const e={haloColor:{light:"rgba(255, 255, 255, .8)",dark:"black"},haloSize:2,miterLimit:2,textAlign:"center",title:Object.assign({},cm.title,{color:{light:"#2b2b2b",dark:"#e7e6e4"}}),subtitle:Object.assign({},cm.subtitle,{color:{light:"#4c4c4c",dark:"#e7e6e4"}})};return um(1,e),e},mm=class extends Qo{constructor(e){super(e),hm(this,"_scale",1),hm(this,"_params",void 0),this._params=pm()}get params(){const e=(this.node?this.node.fontSizeRatio:0)||this._scale;return this.node&&this._scale!==e&&(this._scale=e,um(this._scale,this._params)),this._params}_setTextProperties(e){const t=this._node,i=this.params[t.kind];e.font=i.font,e.textAlign=this.params.textAlign,e.textBaseline="bottom",e.shadowBlur=this.params[t.kind].shadowBlur,e.shadowOffsetY=this.params[t.kind].shadowOffsetY,e.shadowColor=this.params[t.kind].shadowColor,e.miterLimit=this.params.miterLimit}draw(e){const t=this._node,i=this.params[t.kind];e.save(),this._setTextProperties(e);const s=t.colorScheme;e.fillStyle=i.color[s],e.strokeStyle=this.params.haloColor[s],e.lineWidth=this.params.haloSize;const o=t.size.width/2,n=i.height-i.yPadding-i.yMargin;e.strokeText(t.text,o,n),e.fillText(t.text,o,n),e.restore()}};const gm=class extends Ns{constructor(e,t,i,s,o,n){super(),this.text=e,this.kind=t,this._renderer=new mm(this),this.textAscent=s.actualBoundingBoxAscent||0,this.textDescent=s.actualBoundingBoxDescent||0;const a=this.textDescent>0?Math.ceil(this.textDescent):0;this.fontSizeRatio=n,this.size=new ls(i,this._renderer.params[this.kind].height+a),this.colorScheme=o?"dark":"light",this.keyForFrozenLayer=this.colorScheme+(1!==n?`-${n}`:"")+"-"+t+"#"+this.text}stringInfo(){return"MarkerAnnotationLabelNode<"+this.kind+'> "'+this.text+'"'}get yMargin(){return this._renderer.params[this.kind].yMargin}get fontSize(){return this._renderer.params[this.kind].fontSize}get lineHeight(){return this._renderer.params[this.kind].lineHeight}};function _m(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const fm=1e-12,ym={borderWidth:3,dotBorderWidth:2.5,labelWidthPadding:10,shadowColor:"rgba(0, 0, 0, .2)",shadowOffsetY:.5,transitionDuration:500,dotAnimationDuration:100,dotScale:1.5,anchorPointOffset:0},vm=Em(ym,{borderWidth:1.5,balloonRadius:13.5,shadowBlur:11.25,dotRadius:0,glyphFontSize:15,glyphImageSize:20,offset:0,style:"default",height:32}),bm=11.5,wm=Em(ym,{borderWidth:1.5,balloonRadius:bm,transitionDuration:250,shadowBlur:5,shadowOffsetY:0,dotRadius:0,glyphFontSize:15,glyphImageSize:16,offset:0,style:"poi",height:23,anchorPointOffset:-11.5}),Cm=[];for(let e=2;e<=6;e++){const t=12+.5*e;Cm[e]=Em(wm,{balloonRadius:t,height:2*t})}const km=Em(ym,{balloonRadius:30,shadowBlur:25,dotRadius:3,glyphFontSize:32,glyphImageSize:40,offset:8,style:"balloon",height:66}),Sm=Em(ym,{radius:4.5,style:void 0,shadowOffsetY:0,shadowBlur:0,shadowColor:"transparent"}),Mm=Em(ym,{balloonRadius:20,dotRadius:3,glyphFontSize:28,glyphImageSize:30,offset:0,style:"bubble",height:40});class Lm extends an{constructor(e){super(),_m(this,"_needsLayout",!1),_m(this,"_usingStaticStyle",!1),_m(this,"state",void 0),this.annotation=e,this._balloon=this.addChild(new om(e)),this._balloon.setDelegate(this)}get position(){return this.annotation?this.annotation.nodePosition():new cs}stringInfo(){return"MarkerAnnotationNode"+("default"!==this.state?"<"+this.state+">":"")}get enablesDefaultGlyphImage(){return this.annotation.enablesDefaultGlyphImage}set enablesDefaultGlyphImage(e){this.annotation.enablesDefaultGlyphImage=e}set needsLayout(e){e&&!this._needsLayout&&Mt.scheduleASAP(this),this._needsLayout=e}get needsLayout(){return this._needsLayout}getParamsFromState(e){const t=this.annotation.isAppStyle,i=t?Lm.POIIconParams:Lm.Params;return"default"===e&&this.annotation.n&&t?(k(this.annotation.n),k(this.annotation.n),Cm[Math.min(this.annotation.n,6)]):i[e]}balloonNodeSize(e){if(!this.annotation.balloonVisible)return new ls(0,0);e||(S(this.state),e=this.state);const t=this.getParamsFromState(e);if("callout"===e){const e=t;return new ls(2*e.radius,2*e.radius)}const i=t,s=2*i.balloonRadius;return new ls(s,i.height+i.offset)}updateAppearance(e){this._balloon.freeze(),e&&(this.needsDisplay=!0)}updateState(e){if(this._usingStaticStyle)return;const t=this.annotation;this.state!==e&&(!t.selected&&"selected"!==this.state&&"callout"!==this.state||!this.state||this._animateFromState||(this._animateFromState=this.state),this.state=e,this.updateSizeAndAppearance())}updateSizeAndAppearance(){this.annotation._node.size=this._size=this._balloon.size=this.balloonNodeSize(),this.updateAppearance(),this.needsLayout=!0}performScheduledUpdate(){this.updateLayout(!1)}updateLayout(e){this._needsLayout&&(this._layoutSubNodes(e),this._needsLayout=!1)}updateGlyphText(){this.updateAppearance(!0),this._balloon.needsDisplay=!0}updateGlyphImage(e){this.updateAppearance(),this._balloon.glyphImage=e,this._balloon.needsDisplay=!0}updateSelectedGlyphImage(e){this._balloon.selectedGlyphImage=e,this._balloon.needsDisplay=!0}glyphImageError(){this.updateAppearance(),this._balloon.glyphImageError(this.state)}animateAppearance(e){S(this.state);const t=this.getParamsFromState(this.state);if(this.children.forEach((e=>{this.annotation.isAppStyle||e===this._balloon||Tm(e,t)})),!this.annotation.isAppStyle||this.annotation.selected)Rm(this._balloon,t,fm,1,new cs(this._balloon.size.width/2,this._balloon.size.height),void 0,e);else{const i=new cs(this._balloon.size.width/2,this._balloon.size.height/2);Om(this._balloon,t,fm,1,i,e)}}fadeInLabels(){S(this.state);const e=this.children.filter((e=>e instanceof gm)),t=this.getParamsFromState(this.state);e.forEach((e=>{Tm(e,t)}))}preventAnimation(){this._animationPrevented=!0,this.needsLayout=!0}_layoutSubNodes(e){if(!this.annotation)return;S(this.state),this.updateAppearance();const t=this.children.slice();this.children=[this._balloon],this._dot&&this.addChild(this._dot);let i=this._balloon.size.width;const s=this.annotation,o=this.state,n=this.getParamsFromState(o),a=s.map&&!this._animationPrevented;delete this._animationPrevented;const r=s&&s.map&&s.map._impl.fontSizeRatio||1,l=(e,i)=>{t.forEach((t=>{t instanceof gm&&t.kind===e&&(this.addChild(t),function(e,t){Im.add(e),new yn.Opacity({node:e,duration:t.transitionDuration,from:1,to:0,done:function(){Im.delete(e),e.remove()}}).begin()}(t,n))})),delete this[i]};let h=0;const c=(e,t)=>{const o=dm(e,r),l=s[e],c=a&&!!this.parent&&l!==t&&(!l||!t),d=this.annotation.darkColorScheme;return function(e,t,i){e.font=i;const s=t.trim().split(/[\r\n]+/),o=[];for(const t of s){const i=t.split(/[\f\t\v\u0020\u2000-\u200b\u205f\u3000]+/);for(;i.length>0;){const t=[i.shift()];let s=t.join(" ").length;for(;i.length>0&&s<=16;)t.push(i.shift()),s=t.join(" ").length;if(s>16&&t.length>1){const e=t.pop();S(),i.unshift(e)}const n=t.join(" "),a=e.measureText(n),r=a.width+ym.labelWidthPadding;o.push([n,r,a])}}return o}(this.scene?this.scene.contextForMeasurement:Am(),l,o).forEach((([t,s,o])=>{const a=new gm(t,e,s,o,d,r);i=Math.max(i,s),h=a.lineHeight/2,this.addChild(a),c&&Tm(a,n)}),this),l},d="callout"!==o&&"lifted"!==o&&!("default"===o&&s.selected)&&s.labelsCanBeShown(),u=d&&s.titleCanBeShown();u?this._prevTitle=c("title",this._prevTitle):l("title","_prevTitle"),d&&s.subtitleCanBeShown(u)?this._prevSubtitle=c("subtitle",this._prevSubtitle):l("subtitle","_prevSubtitle");let p=this._balloon.size.height;if("callout"===o&&s.isAppStyle){0!==this.children.filter((e=>e instanceof gm)).length&&(p+=this.getParamsFromState("default").balloonRadius)}let m=p,g=0;this.children.forEach((e=>{let t=0;if(e instanceof gm){const i=Math.ceil(e.textAscent-e.fontSize);if(i>0&&(t+=i),g>0){t+=Math.ceil(g)}}e.position=new cs((i-e.size.width)/2,e instanceof gm?m-e.yMargin+t:0),e instanceof gm&&(m+=e.lineHeight+t,Im.has(e)||(p+=e.lineHeight+t,h=Math.round(e.lineHeight/2+(e.textDescent>0?e.textDescent:0))),g=e.textDescent)})),s._anchorPoint=new cs(i/2,this._balloon.size.height+n.anchorPointOffset),s._node.size=this.size=new ls(i,p+h),s.updatePosition();const _=s._position.x-s._anchorPoint.x-s._anchorOffset.x,f=this.position.x;if(this.children.forEach((e=>{e.position=new cs(Bo.roundToDevicePixel(_+e.position.x)-f,e.position.y)})),"selected"===o){const e=n;this._dot||(this._dot=this.addChild(new lm(this.annotation,e),1)),this._dot.size=new ls(2*e.dotRadius*e.dotScale,2*e.dotRadius*e.dotScale),this._dot.position=new cs(this._balloon.position.x+e.balloonRadius-e.dotRadius,this._balloon.size.height-2*e.dotRadius),this._dot.transform=(new ys).scale(1/e.dotScale)}else this._dot&&(this._dot.remove(),delete this._dot);if(a&&this._animateFromState){const e=this.getParamsFromState(this._animateFromState);if("callout"===o||"callout"===this._animateFromState){const t=Em(n);t.transitionDuration/=2;const i=this.addChild(new om(this.annotation,this._animateFromState));let s;i.setDelegate(this),i.glyphImage=this._balloon.glyphImage,i.selectedGlyphImage=this._balloon.selectedGlyphImage,i.setBalloonStyle(),i.size=this.balloonNodeSize(i.state),this._balloon.transform=(new ys).scale(fm),"callout"===o?(i.position=new cs((this.size.width-i.size.width)/2,this._balloon.size.height/2-i.size.height-e.anchorPointOffset+4.5),s=new cs(i.size.width/2,i.size.height+e.anchorPointOffset),Om(i,t,1,fm,s,(()=>{i.remove();const e=Em(n);e.transitionDuration/=2,Om(this._balloon,e,fm,1,new cs(this._balloon.size.width/2,this._balloon.size.height/2))}))):(i.position=new cs((this.size.width-i.size.width)/2,this._balloon.size.height+n.anchorPointOffset-i.size.height/2-4.5),s=new cs(i.size.width/2,i.size.height/2),this.annotation.isAppStyle?Om(i,t,1,fm,s,(()=>{i.remove();const e=new cs(this._balloon.size.width/2,this._balloon.size.height/2);Om(this._balloon,n,fm,1,e)})):Om(i,t,1,fm,s,(()=>{i.remove(),Rm(this._balloon,n,fm,1,new cs(this._balloon.size.width/2,this._balloon.size.height))})))}else{let t,i,a,r=0;if(s.isAppStyle){const s=n;if(t=e.balloonRadius/s.balloonRadius,r=km.height-km.balloonRadius+km.offset,"selected"===o){const e=n;i=new cs(e.balloonRadius,e.balloonRadius+r/(1-t)),a=new cs(this._balloon.size.width/2,this._balloon.size.height)}else i=new cs(s.balloonRadius,s.balloonRadius-r/(1-t))}else t=this.balloonNodeSize(this._animateFromState).height/this.balloonNodeSize().height,i=new cs(this._balloon.size.width/2,this._balloon.size.height);1!==t&&Rm(this._balloon,n,t,1,i,a);const l=this._dot;l&&Tm(l,{transitionDuration:n.dotAnimationDuration});let h=0;if(1!==t&&s.isAppStyle&&(h=(t<1?1:-1)*this.getParamsFromState("default").balloonRadius),0!==h){const e=new cs(0,0),t=new cs(0,h);this.children.forEach((i=>{i instanceof gm&&function(e,t,i,s){new yn.Translation({node:e,duration:t.transitionDuration,from:i,to:s,pop:!0}).begin()}(i,n,t,e)}))}}delete this._animateFromState}e||s.updatedLayout()}}let xm;Lm.Params={default:vm,lifted:vm,selected:km,bubble:Mm,callout:Sm},Lm.POIIconParams=Em(Lm.Params,{default:wm,lifted:wm}),Lm.FeatureVisibility=Xs;const Am=function(){xm||(xm=de());const e=xm.getContext("2d");return S(),e};function Em(e,t){const i=Object.create(e);for(const e in t)i[e]=t[e];return i}function Tm(e,t){new yn.Opacity({node:e,duration:t.transitionDuration}).begin()}const Im=new WeakSet;function Om(e,t,i,s,o,n){new yn.Scale({node:e,duration:t.transitionDuration,from:i,to:s,center:o,done:n}).begin()}function Rm(e,t,i,s,o,n,a){new yn.Float({node:e,duration:t.transitionDuration,from:i,to:s,center:o,floatCenter:n,done:a}).begin()}const Pm=Lm;const Dm=class{constructor(e,t){e.useSquareBalloon?this._renderer=new tm(this):this._renderer=new em(this),this.frozen=!0,this.annotation=e,this.state="selected",this.params=t;const i=2*t.balloonRadius;this.size=new ls(i,i),this.layerBounds=new us(0,0,this.size.width,this.size.height)}get enablesDefaultGlyphImage(){return this.annotation.enablesDefaultGlyphImage}draw(){!this.annotation.glyph&&this.enablesDefaultGlyphImage&&this._renderer.isFallbackGlyphTextPending&&this._renderer.addPendingNode(this);const e=this._renderer.layer;e.hidden=!1,e.style.width=e.style.height=this.size.width+"px",this._renderer.draw(e.getContext("2d"))}getLayer(){return this._renderer.layer}glyphImageError(e){"selected"===e&&this.selectedGlyphImage?delete this.selectedGlyphImage:delete this.glyphImage}updateGlyphImage(e){this.glyphImage=e}updateSelectedGlyphImage(e){this.selectedGlyphImage=e}freeze(){this.draw()}};const zm=function(e,t){let i;if("function"!=typeof e.getImageUrl)return i=function(e){if(!e||"object"!=typeof e)return;let t;const i=Object.keys(e).filter((t=>!!e[t])).map(parseFloat).filter((e=>!isNaN(e))).sort(),s=Bo.imagePixelRatio;for(let e=i.length-1;e>=0&&((!t||i[e]>=s)&&(t=i[e]),!(i[e]<=s));--e);return t}(e),i?void t({ratio:i,glyphImageUrl:e[i]}):void t();i=Bo.imagePixelRatio,fe(e.getImageUrl,e,[i,function(e){setTimeout((()=>t(e?{ratio:i,glyphImageUrl:e}:void 0)))}])};function Nm(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function Fm(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Um(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Wm(e,t,"set"),i),i}function Gm(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Wm(e,t,"get"))}function Wm(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}const Bm={light:"#ff5b40",dark:"#e6523b"},Zm={light:{start:"#fe6fa8",end:"#d70d2e"},dark:{start:"#ff9ea0",end:"#b03a4b"}},Km={light:"white",dark:"#e7e6e4"},jm={light:"white",dark:"rgba(34, 40, 52, 0.8)"},Hm={light:"white",dark:"black"},qm={Default:"default",Dot:"dot",Large:"large"};function Vm(e){var t,i=new WeakMap;class s extends e{constructor(t,s,o){super(t,s,e.div,o),Fm(this,"_labelOccluded",!1),Fm(this,"_labelRect",void 0),Fm(this,"_anchorPointWithLabel",void 0),Nm(this,i,{writable:!0,value:!0})}init(t,i,s){this._sceneGraphNode=new Pm(this),super.init(t,i,e.div,s),this.updateGlyph(),this._setBalloonStyle(),this._userSetSize=!0,this._calloutWithSelectedState||(this._calloutAnchorPoint=new window.DOMPoint(-Pm.Params.callout.radius,1));const o=this.selected?this.canShowCallout()?this.selectedStateForSceneGraphNode():"selected":"default";this._sceneGraphNode.updateState(o)}get size(){return this._sceneGraphNode.size.copy()}set size(e){console.warn("[MapKit] The `size` property of a marker annotation cannot be set.")}get color(){return null!==this._color?this._color:this.map?Bm[this.map._impl.currentColorScheme]:Bm.light}set color(e){null!==e&&p(e,"string","[MapKit] Expected a string value for MarkerAnnotation.color, but got `"+e+"` instead"),e!==this._color&&(this._color=e,this._sceneGraphNode.updateAppearance(!0),this._drawCalloutAccessory())}get selectedFillColor(){return this.color}get fillColor(){return this.color}get gradientColors(){return null!==this._color?null:this.map?Zm[this.map._impl.currentColorScheme]:Zm.light}get fillWithGradient(){return!0}get selectedStrokeColor(){return this.defaultStrokeColor}get strokeColor(){return this.defaultStrokeColor}get defaultStrokeColor(){return this.map?jm[this.map._impl.currentColorScheme]:jm.light}get glyphColor(){return null!==this._glyphColor?this._glyphColor:this.map?this.isPlaceStyle?Hm[this.map._impl.tint]:Km[this.map._impl.currentColorScheme]:Km.light}set glyphColor(e){null!==e&&p(e,"string","[MapKit] Expected a string value for MarkerAnnotation.glyphColor, but got `"+e+"` instead"),e!==this._glyphColor&&(this._glyphColor=e,this._sceneGraphNode.updateAppearance(!0),this._drawCalloutAccessory())}get glyphImage(){return this._glyphImage}set glyphImage(e){this._setGlyphImage("_glyphImage","updateGlyphImage",e)}get selectedGlyphImage(){return this._selectedGlyphImage}set selectedGlyphImage(e){this._setGlyphImage("_selectedGlyphImage","updateSelectedGlyphImage",e)}updateGlyphImages(){this._setGlyphImage("_glyphImage","updateGlyphImage",this._glyphImage),this._setGlyphImage("_selectedGlyphImage","updateSelectedGlyphImage",this._selectedGlyphImage)}get glyphText(){return this._glyphText}set glyphText(e){p(e,"string","[MapKit] Expected a string value for MarkerAnnotation.glyphText, but got `"+e+"` instead"),e!==this._glyphText&&(this._glyphText=e,this.updateLocalizedText(),this.updateGlyph(),this._sceneGraphNode.updateGlyphText(),this._drawCalloutAccessory())}get glyph(){return this._glyph}get titleVisibility(){return this._titleVisibility}set titleVisibility(e){if(!d(e,Pm.FeatureVisibility))throw new Error("[MapKit] Expected one of Hidden, Visible or Adaptive for MarkerAnnotation.titleVisibility");e!==this._titleVisibility&&(this._titleVisibility=e,this._sceneGraphNode.needsLayout=!0)}get subtitleVisibility(){return this._subtitleVisibility}set subtitleVisibility(e){if(!d(e,Pm.FeatureVisibility))throw new Error("[MapKit] Expected one of Hidden, Visible or Adaptive for MarkerAnnotation.subtitleVisibility");e!==this._subtitleVisibility&&(this._subtitleVisibility=e,this._sceneGraphNode.needsLayout=!0)}get labelOccluded(){return this._labelOccluded}set labelOccluded(e){this._labelOccluded!==e&&(this._sceneGraphNode.needsLayout=!0),this._labelOccluded=e}labelsCanBeShown(){return this.delegate&&this.delegate.supportsLabelRegions()}titleCanBeShown(){return this.title&&!this.labelOccluded&&this._titleVisibility!==Pm.FeatureVisibility.Hidden}subtitleCanBeShown(e){return this.subtitle&&!this.labelOccluded&&(this._subtitleVisibility===Pm.FeatureVisibility.Visible||this._subtitleVisibility===Pm.FeatureVisibility.Adaptive&&(this._public.memberAnnotations||this.selected&&e))}updateLayout(e,t){!t&&e||(this._sceneGraphNode.needsLayout=!0),(t||e)&&this._sceneGraphNode.updateLayout(e)}updatedLayout(){this._updatedProperty("")}calculateNodePosition(){return new cs(Bo.roundToDevicePixel(this._position.x-this._anchorPoint.x-this._anchorOffset.x),this._position.y-this._anchorPoint.y-this._anchorOffset.y)}animateOcclusion(){if(!this.isLoadingIconMetadata)return super.animateOcclusion()}get darkColorScheme(){return!!this.map&&Bo.darkColorScheme(this.map._impl.mapNodeTint)}get isAppStyle(){return!!(this._glyphImage&&this._glyphImage.isPOIIcon||this._selectedGlyphImage&&this._selectedGlyphImage.isPOIIcon)}get isPlaceStyle(){return this.isAppStyle}get balloonVisible(){return!0}iconRect(){k(!this.selected&&this.isAppStyle);const e=this.nodePosition(),t=this.sceneGraphNode._balloon.position,i=this.sceneGraphNode._balloon.size;return new us(e.x+t.x,e.y+t.y,i.width,i.width)}labelRect(){if(k(!this.selected&&this.isAppStyle),!this._labelRect){k(this.labelOccluded);const e=this.sceneGraphNode.children.filter((e=>e instanceof gm)).map((e=>new us(e.position.x,e.position.y,e.size.width,e.size.height)));this._labelRect=e.length?us.unionOfRects(e):new us(0,0,0,0),this._anchorPointWithLabel=this._anchorPoint.copy()}const e=new cs(Bo.roundToDevicePixel(this._position.x-this._anchorPointWithLabel.x-this._anchorOffset.x),this._position.y-this._anchorPointWithLabel.y-this._anchorOffset.y);return new us(e.x+this._labelRect.origin.x,e.y+this._labelRect.origin.y,this._labelRect.size.width,this._labelRect.size.height)}get warnOnUnselectedGlyphImageAccess(){return!1}get enablesDefaultGlyphImage(){return Gm(this,i)}set enablesDefaultGlyphImage(e){e!==Gm(this,i)&&(Um(this,i,e),e&&this._sceneGraphNode?.updateAppearance())}setDelegate(e){super.setDelegate(e),this.labelsCanBeShown()&&this._updatedProperty("title")}doesAnimate(){return this._animates}willMoveToMap(e){this._isMoving=e&&this.animates}didMoveToMap(){const e=this._isMoving;if(super.didMoveToMap(),this.isLoadingIconMetadata)return this._sceneGraphNode.opacity=0,void(this._isMoving=e);this.animateAppearance(e)}animateAppearance(e,t=!1){this.delegate&&e&&this.visible&&!this._appearanceAnimation&&this._shown?(this._isAnimating=!0,this._sceneGraphNode.animateAppearance((e=>{e.node.annotation.finishedAnimating()})),t&&this._sceneGraphNode.fadeInLabels()):this._sceneGraphNode.preventAnimation()}iconMetadataLoaded(){this.isLoadingIconMetadata&&(this.isLoadingIconMetadata=!1,this._sceneGraphNode.opacity=1,this.animateAppearance(this._isMoving,!0),delete this._isMoving)}lift(e){this._sceneGraphNode.updateState("lifted"),super.lift(e)}droppedAfterLift(){this._sceneGraphNode.updateState("default"),super.droppedAfterLift()}canShowCallout(){return(!!this.callout||this.delegate&&!this.delegate.supportsLabelRegions())&&super.canShowCallout()}centerOffsetForSelectionAccessory(){return new cs(-this._node.size.width/2,-Pm.Params.selected.balloonRadius)}selectedStateForSceneGraphNode(){return this.selectionAccessory||this._calloutWithSelectedState?"selected":"callout"}selectionAccessoryWillAppear(e){const t=e?this.selectedStateForSceneGraphNode():"selected";this.isStable()&&this._sceneGraphNode.updateState(t)}selectionAccessoryWillDisappear(){this.selected||(delete this._calloutAccessoryNode,this._sceneGraphNode.updateState("default"))}canvasForCalloutAccessory(){if(!this.callout||this.selectionAccessory||!(this.callout.calloutElementForAnnotation||this.callout.calloutContentForAnnotation||this.callout.calloutLeftAccessoryForAnnotation||this.callout.calloutRightAccessoryForAnnotation))return this._calloutAccessoryNode||(this._calloutAccessoryNode=new Dm(this,Pm.Params.bubble),this._calloutAccessoryNode.glyphImage=this._sceneGraphNode._balloon.glyphImage,this._calloutAccessoryNode.selectedGlyphImage=this._sceneGraphNode._balloon.selectedGlyphImage,this._calloutAccessoryNode.glyphText=this._glyphText,this._drawCalloutAccessory()),this._calloutAccessoryNode.getLayer();delete this._calloutAccessoryNode}get ignoreCalloutCornerRadiusForLeftAccessory(){return!0}altText(){return super.altText()||es.get("Annotation.Marker.AccessibilityLabel")}resetNodeTransform(){this.sceneGraphNode.transform=new ys}updateGlyph(){this._glyph=this.glyphText||(this._glyphImageElement?this._glyphImageElement.src:"")}get staticStyle(){return this._staticStyle}set staticStyle(e){let t;switch(e){case qm.Dot:t="callout";break;case qm.Large:t="selected";break;default:e=qm.Default,t="default"}this._staticStyle=e,this._sceneGraphNode.updateState(t),this._sceneGraphNode._usingStaticStyle=!0}loadGlyphImage(e,t,i,s){zm(s,(o=>{if(this[t]===s)return o?void function(e,t,i,s){const o=i+"Loader";e[o]&&e[o].unschedule();if(e[o]=new wa($.Highest,{urlForImageLoader:t,loaderDidSucceed:function(t){e[o]===t&&(delete e[o],e[i]=t.image,e.updateGlyph(),e._sceneGraphNode[s](t.image),e._calloutAccessoryNode&&(e._calloutAccessoryNode[s](t.image),e._drawCalloutAccessory()))},loaderDidFail:function(t){e[o]===t&&(delete e[o],delete e[i],e.updateGlyph(),e._sceneGraphNode[s](),e._calloutAccessoryNode&&(e._calloutAccessoryNode[s](),e._drawCalloutAccessory()))}}),e.isGlyphImageInternal){const i=!Ze.customMadabaUrl&&Ze.urlWithCredentials(t);e[o].crossOrigin=fa.getCorsAttribute(i)}e[o].schedule()}(this,o.glyphImageUrl,e,i):(delete this[e],this._sceneGraphNode.glyphImageError(),void(this._calloutAccessoryNode&&this._calloutAccessoryNode.glyphImageError()))}))}_setBalloonStyle(){this.useSquareBalloon=this._glyphImage&&this._glyphImage.useSquareBalloon||this._selectedGlyphImage&&this._selectedGlyphImage.useSquareBalloon,this._sceneGraphNode._balloon.setBalloonStyle()}_setGlyphImage(e,t,i){null!=i&&p(i,"object","[MapKit] Expected a hash value or an Image delegate for MarkerAnnotation."+e.replace(/^_/,"")+", but got `"+i+"` instead"),this[e]=i;const s=e+"Element";if(this._setBalloonStyle(),!i){delete this[s];const e=s+"Loader";return this[e]&&(this[e].unschedule(),delete this[e]),this._sceneGraphNode[t](null),void(this._calloutAccessoryNode&&(this._calloutAccessoryNode[t](null),this._drawCalloutAccessory()))}this.loadGlyphImage(s,e,t,i)}_updatedProperty(e){"title"!==e&&"subtitle"!==e||(this._labelRect=void 0,this._anchorPointWithLabel=void 0,this._sceneGraphNode&&(this._sceneGraphNode.needsLayout=!0)),super._updatedProperty(e)}_drawCalloutAccessory(){this._calloutAccessoryNode&&this._calloutAccessoryNode.draw()}}return t=s,Fm(s,"StaticStyles",qm),t.prototype._animates=!0,t.prototype._glyphImage=null,t.prototype._selectedGlyphImage=null,t.prototype._glyphText="",t.prototype._color=null,t.prototype._glyphColor=null,t.prototype._titleVisibility=Pm.FeatureVisibility.Adaptive,t.prototype._subtitleVisibility=Pm.FeatureVisibility.Adaptive,t.prototype.shouldHideLabels=!0,t.prototype.renderedByDOMElement=!1,t.prototype.isGlyphImageInternal=!1,t.prototype.ConstructorOptions=Object.freeze(Object.assign({},e.prototype.ConstructorOptions,{color:"rw",glyphColor:"rw",glyphImage:"rw",selectedGlyphImage:"rw",glyphText:"rw",titleVisibility:"rw",subtitleVisibility:"rw",_calloutWithSelectedState:"rw"})),Fm(s,"DefaultColor",Bm),s}Vm.StaticStyles=qm,Vm.DefaultColor=Bm,Vm.DefaultStrokeColor=jm,Vm.DefaultGlyphColor=Km;const Ym=Vm,Xm=Ym(xp);class $m extends Tp{constructor(e,t){super(),new.target===$m&&(Object.defineProperty(this,"_impl",{value:new Xm(this,e,t)}),this._impl.init(this,e,t))}get size(){return this._impl.size}set size(e){this._impl.size=e}get color(){return this._impl.color}set color(e){this._impl.color=e}get glyphColor(){return this._impl.glyphColor}set glyphColor(e){this._impl.glyphColor=e}get glyphImage(){return this._impl.glyphImage}set glyphImage(e){this._impl.glyphImage=e}get selectedGlyphImage(){return this._impl.selectedGlyphImage}set selectedGlyphImage(e){this._impl.selectedGlyphImage=e}get glyphText(){return this._impl.glyphText}set glyphText(e){this._impl.glyphText=e}get titleVisibility(){return this._impl.titleVisibility}set titleVisibility(e){this._impl.titleVisibility=e}get subtitleVisibility(){return this._impl.subtitleVisibility}set subtitleVisibility(e){this._impl.subtitleVisibility=e}}const Jm=$m,Qm=Object.freeze({Search:"mapsearch",Callout:"callout"}),eg=function(e,t){t=t||Fs.Light;const i=e===Bs.Hybrid||e===Bs.Satellite?Zs.Hybrid:Zs.Standard;i===Zs.Hybrid&&(t=Fs.Light);return{iconStyle:i,tint:t,emphasis:e===Bs.MutedStandard?Ys.Muted:Ys.Standard}};function tg(e=[void 0,void 0,void 0,void 0]){if(void 0!==e[0]&&void 0!==e[1]&&void 0!==e[2])return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${void 0===e[3]?1:e[3]/255})`}class ig{constructor(e){this.results={},this.completeCallback=e,this.pendingRequestsCount=0,this.loaderData=new Map}static fillGraphImageUrlPath(e,t=!1){let i=ig._CALLOUT_GLYPH_IMAGE_ENDPOINT_URL_PATH;return Ze.tileGroup?i=i.replace("{{tileGroup}}",Ze.tileGroup):k(),i=i.replace("{{attributes}}",t?e.styleAttributes:encodeURIComponent(e.styleAttributes)),i}static keyFromFetchOptions(e){const t=eg(e.mapType,e.colorScheme);return e.styleAttributes+e.iconContext+t.iconStyle+t.tint+t.emphasis}fetch(e){const t=new Map(e.map((e=>{const t=eg(e.mapType,e.colorScheme),i=Ze.tileGroup||e.tileGroup;S();return[e,ig.fillGraphImageUrlPath(e,!0).replace("&accessKey={{accessKey}}","").replace("{{scale}}","2").replace("{{size}}",e.iconContext===Qm.Search?"3":"4").replace("{{context}}",e.iconContext).replace("{{style}}",t.iconStyle).replace("{{tint}}",t.tint).replace("{{emphasis}}",t.emphasis).replace("{{tileGroup}}",i)]})));e.sort(((e,i)=>{const s=t.get(e),o=t.get(i);return S(),S(),s>o?1:s<o?-1:0}));const i=[];for(let t=0;t<e.length;t+=1)i.push(e.slice(t,t+1));k(Ze.accessKey&&Ze.tileGroup),k();const s=Ze.getMadabaDomainFromStringHash?.(e[0].styleAttributes);S();let o=s+ig.ATLAS_URL.replace("{{accessKey}}",encodeURIComponent(Ze.accessKey||""));Ze.customMadabaUrl||(o=Ze.applyProxyPrefix(o)),this.pendingRequestsCount=i.length;for(let e=0;e<i.length;e++){const s=i[e].map((e=>{const i=t.get(e);return S(),i})),n=o.replace("{{entries}}",encodeURIComponent(JSON.stringify({requests:s}))),a={withCredentials:Ze.urlWithCredentials(n)&&!Ze.customMadabaUrl,headers:{}};0;const r=new ge(n,this,a);this.loaderData.set(r,[s,i[e]]),r.schedule()}}loaderDidSucceed(e,t){this.pendingRequestsCount--;const i=this.loaderData.get(e);S();const[s,o]=i;this.loaderData.delete(e),S(t.responseText);const n=JSON.parse(t.responseText);s.forEach(((e,t)=>{const i=n.urls[e];if(!i)return void 0;const s=n["icon-metadata"][i],a=o[t].styleAttributes,r=ig.keyFromFetchOptions(o[t]),l=eg(o[t].mapType,o[t].colorScheme),h=!("labelIconSource"in s)||0!==s.labelIconSource,c=!("labelTextVisibility"in s)||"Never"!==s.labelTextVisibility;this.results[r]={context:o[t].iconContext,styleAttributes:a,iconStyle:l.iconStyle,tint:l.tint,emphasis:l.emphasis,badgeColor:tg(s.badgeColor),calloutColor:tg(s.calloutColor),gradientStartColor:tg(s.gradientStartColor),gradientEndColor:tg(s.gradientEndColor),calloutHaloColor:tg(s.calloutHaloColor),haloColor:tg(s.haloColor),calloutShape:s.calloutShape?s.calloutShape:"Circle",fillType:s.fillType,iconVisibility:h,labelVisibility:c}})),0===this.pendingRequestsCount&&this.completeCallback(this.results)}loaderDidFail(e,t){this.loaderData.delete(e),k(0,e.url),this.pendingRequestsCount--,0===this.pendingRequestsCount&&this.completeCallback(this.results)}}ig.ATLAS_URL="/md/v1/atlas?data=false&dimension=1&entries={{entries}}&format=json&metadata=true&origin=top&type=icon&urls=true&accessKey={{accessKey}}",ig._CALLOUT_GLYPH_IMAGE_ENDPOINT_URL_PATH="/md/v1/icon?subtype=poi&style={{style}}&context={{context}}&tint={{tint}}&emphasis={{emphasis}}&attributes={{attributes}}&v={{tileGroup}}&accessKey={{accessKey}}&scale={{scale}}&size={{size}}&glyph=true";class sg{constructor(){this._deferredFetchOptionsMap=null}static fillGraphImageUrlPath(e){return ig.fillGraphImageUrlPath(e)}static keyFromFetchOptions(e){return ig.keyFromFetchOptions(e)}fetchAll(e,t){if(!e.length)return void setTimeout((()=>t({})));new ig(t).fetch(e)}fetchDeferred(e,t){if(!this._deferredFetchOptionsMap)if(this._deferredFetchOptionsMap={},Ze.state!==Ze.States.READY){const e=()=>{Ze.removeEventListener(Ze.Events.Changed,e),setTimeout((()=>this._startDeferredFetch()),0)};Ze.addEventListener(Ze.Events.Changed,e)}else setTimeout((()=>this._startDeferredFetch()),0);const i=sg.keyFromFetchOptions(e);this._deferredFetchOptionsMap[i]||(this._deferredFetchOptionsMap[i]={fetchOptions:e,callbacks:[]});this._deferredFetchOptionsMap[i].callbacks.push(t)}_startDeferredFetch(){S(this._deferredFetchOptionsMap);const e=this._deferredFetchOptionsMap;this._deferredFetchOptionsMap=null,this.fetchAll(Object.values(e).map((e=>e.fetchOptions)),(t=>{Object.entries(e).forEach((([e,i])=>i.callbacks.forEach((i=>i.call(null,t[e])))))}))}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(sg,"madabaBaseUrl",void 0),sg.sharedMadabaIconMetadata=new sg;const og=sg;function ng(e,t,i,s,o){k(),k(),k(),k(),S(),this.annotation=e,this._url=t.replace("{{size}}",i.toString()).replace("{{context}}",s),this.useSquareBalloon=o}ng.prototype.getImageUrl=function(e,t){let i,s,o;if(S(Ze.accessKey),this.annotation.map){S(this.annotation.map._impl.tint),S(this.annotation.map.mapType);const e=eg(this.annotation.map.mapType,this.annotation.map._impl.tint);i=e.iconStyle,s=e.tint,o=e.emphasis}else if(this.annotation._impl.iconMetadata){const e=this.annotation._impl.iconMetadata;i=e.iconStyle,s=e.tint,o=e.emphasis}else k(),i=Zs.Standard,s=Fs.Light,o=Ys.Standard;e=Math.ceil(Math.min(Math.max(e,1),3)),t(this._url.replace("{{accessKey}}",encodeURIComponent(Ze.accessKey)).replace("{{scale}}",e).replace("{{style}}",i).replace("{{tint}}",s).replace("{{emphasis}}",o))};const ag=ng;function rg(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const lg=og.sharedMadabaIconMetadata,{Event:hg}=je,cg=Symbol(""),dg="load",ug="error";const pg=function(e){var t;class i extends e{constructor(e,t,i){super(e,t,i),rg(this,"styleAttributesHasIcon",!0),rg(this,"styleAttributes",""),rg(this,"iconContext",""),rg(this,"iconMetadata",void 0),rg(this,"muid",void 0)}init(e,t,s){if(this.enablesDefaultGlyphImage=!1,super.init(e,t,s),this._cachedIconMetadata={},this.constructor===i){if(!this.place)throw new Error("[MapKit] Expected a Place for PlaceAnnotation.");if(!this.place.coordinate)throw new Error("[MapKit] Expected a Place with coordinate.");this.coordinate.equals(this.place.coordinate)||(this.coordinate=this.place.coordinate),this.styleAttributes=this.place._styleAttributes,this.iconContext=Qm.Search,this.styleAttributes||(this.styleAttributesHasIcon=!1,this.enablesDefaultGlyphImage=!0),this.title||(this.title=this.place.name)}}get isAppStyle(){return!1}get isPlaceStyle(){return!(this.iconMetadata&&!this.iconMetadata.iconVisibility)}get balloonVisible(){return!(this.iconMetadata&&!this.iconMetadata.iconVisibility)}titleCanBeShown(){return!(this.iconMetadata&&!this.iconMetadata.labelVisibility)&&super.titleCanBeShown()}subtitleCanBeShown(){return!(this.iconMetadata&&!this.iconMetadata.labelVisibility)&&super.subtitleCanBeShown()}get _color(){return this.iconMetadata?this.iconMetadata&&!this.iconMetadata.iconVisibility?this.map?e.DefaultColor[this.map._impl.currentColorScheme]:e.DefaultColor.light:this.selected||this.staticStyle===i.StaticStyles.Large||this.staticStyle===i.StaticStyles.Dot?this.iconMetadata.calloutColor:this.iconMetadata.badgeColor:null}get selectedFillColor(){return this.iconMetadata&&this.iconMetadata.iconVisibility&&this.iconMetadata.calloutColor||super.selectedFillColor}get fillColor(){return this.iconMetadata&&this.iconMetadata.iconVisibility&&this.iconMetadata.badgeColor||super.fillColor}get gradientColors(){return this.iconMetadata&&this.iconMetadata.iconVisibility&&this.iconMetadata.gradientStartColor&&this.iconMetadata.gradientEndColor?{start:this.iconMetadata.gradientStartColor,end:this.iconMetadata.gradientEndColor}:null}get fillWithGradient(){return this.iconMetadata?"None"!==this.iconMetadata.fillType&&super.fillWithGradient:super.fillWithGradient}get selectedStrokeColor(){return this.iconMetadata?this.iconMetadata&&!this.iconMetadata.iconVisibility?this.defaultStrokeColor:this.iconMetadata.calloutHaloColor||this.defaultStrokeColor:this.defaultStrokeColor}get strokeColor(){return this.iconMetadata?this.iconMetadata&&!this.iconMetadata.iconVisibility?this.defaultStrokeColor:this.iconMetadata.haloColor||this.defaultStrokeColor:this.defaultStrokeColor}get defaultStrokeColor(){return this.map?Ym.DefaultStrokeColor[this.map._impl.tint]:Ym.DefaultStrokeColor.light}get warnOnUnselectedGlyphImageAccess(){return!(!this.iconMetadata||"callout"!==this.iconMetadata.context)}loadGlyphImage(e,t,i,s){(this.map||this.iconMetadata)&&super.loadGlyphImage(e,t,i,s)}updateLayout(e){this.updateGlyphImages(),this.updateIconMetadata(!0),super.updateLayout(e)}addedToMap(){super.addedToMap(),this.updateIconMetadata(!1),this.updateGlyphImages()}updateIconMetadata(e){if(!this.map)return;if(!this.styleAttributesHasIcon)return;const t=eg(this.map.mapType,this.map._impl.tint),i=this._cachedIconMetadata[t.iconStyle+t.tint+t.emphasis];return this.iconMetadata&&i===this.iconMetadata?void 0:i&&i!==cg?(this.iconMetadata=i,void this._sceneGraphNode.updateAppearance(e)):void this.fetchIconMetadata(this.map._impl.tint,this.map.mapType)}setIconMetadata(e,t){if(this._cachedIconMetadata[e.iconStyle+e.tint+e.emphasis]=e,!this.iconMetadata){if(this.iconMetadata=e,k(this.selectedGlyphImage),k(this.glyphImage),this.iconMetadata.iconVisibility){const i=t||og.fillGraphImageUrlPath(this);let s=Ze.getMadabaDomainFromStringHash(this.styleAttributes)+i;Ze.customMadabaUrl||(s=Ze.applyProxyPrefix(s));const o="Square"===e.calloutShape;this.selectedGlyphImage=new ag(this._public,s,4,e.context,o),e.context!==Qm.Callout&&(this.glyphImage=new ag(this._public,s,3,e.context,o))}else this._sceneGraphNode.updateSizeAndAppearance(),this.enablesDefaultGlyphImage=!0;setTimeout((()=>this._public.dispatchEvent(new hg(dg))))}this.updateIconMetadata(!!this.map)}fetchIconMetadata(e,t,i){k(this.styleAttributes),k(this.iconContext),this.iconMetadata||(this.isLoadingIconMetadata=!0);const s={colorScheme:e,styleAttributes:this.styleAttributes,iconContext:this.iconContext,mapType:t},o=eg(s.mapType,s.colorScheme),n=o.iconStyle+o.tint+o.emphasis;this._cachedIconMetadata[n]!==cg&&(this._cachedIconMetadata[n]=cg,lg.fetchDeferred(s,(e=>{k(this._cachedIconMetadata[n]),this._cachedIconMetadata[n]=void 0,e?this.setIconMetadata(e):(console.warn("[MapKit] Unable to fetch icon style for annotation."),this.iconMetadata=void 0,this.enablesDefaultGlyphImage=!0,this.glyphImage=this.selectedGlyphImage=null,setTimeout((()=>this._public.dispatchEvent(new hg(ug))))),this.iconMetadataLoaded(),"function"==typeof i&&i(this._public)})))}}return t=i,rg(i,"StaticStyles",e.StaticStyles),t.prototype.isGlyphImageInternal=!0,t.prototype.ConstructorOptions=Object.freeze(Object.assign({},e.prototype.ConstructorOptions,{color:"ro",glyphColor:"ro",glyphImage:"ro",selectedGlyphImage:"ro",draggable:"ro",appearanceAnimation:"ro",anchorOffset:"ro",padding:"ro",size:"ro",glyphText:"ro"})),i},mg=pg(Xm);class gg{constructor(e,t){this._selected=t,this._impl=t?e.selectedGlyphImage:e.glyphImage}getImageUrl(e,t){if(("number"!=typeof e||isNaN(e))&&(e=Bo.imagePixelRatio),"function"!=typeof t)throw new Error("[MapKit] Expects a callback to be provided.");HTMLCanvasElement.prototype.toBlob?this._impl.getImageUrl(e,(e=>{const i=new wa($.Highest,{urlForImageLoader:e,loaderDidSucceed:e=>{const i=this._selected?this._impl.annotation._impl.selectedFillColor:this._impl.annotation._impl.fillColor,s=e.image,o=document.createElement("canvas");o.width=s.naturalWidth,o.height=s.naturalHeight;const n=o.getContext("2d");i&&(n.fillStyle=i,n.fillRect(0,0,o.width,o.height)),n.drawImage(s,0,0),o.toBlob((e=>{fe(t,null,[URL.createObjectURL(e)])}))},loaderDidFail:function(e){setTimeout((()=>{fe(t,null)}))}}),s=!Ze.customMadabaUrl&&Ze.urlWithCredentials(e);i.crossOrigin=fa.getCorsAttribute(s),i.schedule()})):setTimeout((()=>{fe(t,null)}))}}const _g=function(){throw new Error("[MapKit] `MapFeatureAnnotationGlyphImage` may not be constructed directly.")};gg.prototype.constructor=_g,_g.prototype=gg.prototype;const fg=gg;class yg extends Jm{constructor(e,t){super(),new.target===yg&&(Object.defineProperty(this,"_impl",{value:new mg(this,e,t)}),this._impl.init(this,e,t))}get element(){return this._impl.element}get coordinate(){return this._impl.coordinate}get draggable(){return this._impl.draggable}get appearanceAnimation(){return this._impl.appearanceAnimation}get anchorOffset(){return this._impl.anchorOffset}get padding(){return this._impl.padding}get size(){return this._impl.size}get glyphText(){return this._impl.glyphText}get color(){return this._impl.color}get glyphColor(){return this._impl.glyphColor}get glyphImage(){return this._impl.glyphImage?(this._impl._glyphImagePublic||(this._impl._glyphImagePublic=new fg(this._impl,!1)),this._impl._glyphImagePublic):null}get selectedGlyphImage(){return this._impl.selectedGlyphImage?(this._impl._selectedGlyphImagePublic||(this._impl._selectedGlyphImagePublic=new fg(this._impl,!0)),this._impl._selectedGlyphImagePublic):null}}const vg=yg;const bg=class{constructor(){this._requests={},this._types={},this._counter=1}add(e,t){const i=this._counter;return this._counter+=1,this._requests[i]=e,this._types[i]=t,i}get(e){return this._requests[e]}typeForId(e){return this._types[e]}idsByType(e){return Object.keys(this._requests).filter((t=>this._types[parseInt(t)]===e)).map((e=>parseInt(e)))}remove(e){return!!this.get(e)&&(delete this._requests[e],delete this._types[e],!0)}};for(Be.prototype.appendServiceAuthOptions=function(e){return this.appendAuthOptions(e)},Be.prototype._checkJwtToken=Rc;Ze._jwtTokensToCheck.length;){const e=Ze._jwtTokensToCheck.shift();S(Ze._checkJwtToken),S(),Ze._checkJwtToken(e)}function wg(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Cg={enableHighAccuracy:!1,timeout:8e3,maximumAge:9e5};class kg{constructor(e,t={}){wg(this,"_getsUserLocation",!1),wg(this,"_language",null),wg(this,"_watchingConfiguration",!1),this._name=e,this._requestMap=new bg,Ze.state===Ze.States.ERROR&&(this._configFailed=!0),this.language=t.language??null,void 0!==t.getsUserLocation&&(this.getsUserLocation=!!t.getsUserLocation)}get getsUserLocation(){return this._getsUserLocation}set getsUserLocation(e){S(kg.userLocation),this._getsUserLocation=!!e}get language(){return this._language}set language(e){this._language=null==e?null:this._bestLanguage(e)}cancel(e){u(e,"[MapKit] Missing `id` in call to `"+this._name+".cancel()`."),p(e,"number","[MapKit] `id` passed to `"+this._name+".cancel()` is not a number.");const t=this._requestMap.typeForId(e);if(t)switch(t){case"query":case"geo":return this._requestMap.remove(e);case"xhr":{const t=this._requestMap.get(e);if(t)return t.unschedule(),this._requestMap.remove(e);break}default:throw new Error("Unknown type: "+t)}return!1}handleEvent(e){switch(e.type){case Ze.Events.Error:this._configFailed=!0;case Ze.Events.Changed:this._requestMap.idsByType("query").forEach((e=>{const t=this._requestMap.get(e);this._send(t.path,t.parameters,t.callback,t.transform,t.name),this._requestMap.remove(e)}))}0===this._requestMap.idsByType("query").length&&this._stopWatchingConfiguration()}_watchConfiguration(){this._watchingConfiguration||(this._watchingConfiguration=!0,Ze.addEventListener(Ze.Events.Changed,this),Ze.addEventListener(Ze.Events.Error,this))}_stopWatchingConfiguration(){this._watchingConfiguration&&(this._watchingConfiguration=!1,Ze.removeEventListener(Ze.Events.Changed,this),Ze.removeEventListener(Ze.Events.Error,this))}_logNetworkEvent(e,t){let i;switch(e){case"search":i=Qt.Events.Search;break;case"autocomplete":i=Qt.Events.SearchAC;break;case"placeLookup":i=Qt.Events.PlaceLookup;break;case"geocode":i=Qt.Events.ForwardGeocoder;break;case"reverseGeocode":i=Qt.Events.ReverseGeocoder;break;case"directions":i=Qt.Events.Directions;break;case"nearbyPoi":i=Qt.Events.PointsOfInterestSearch;break;default:return}Qt.log(i,t)}_send(t,i,s,o,n){const a=this._requestMap;if(!Ze.apiBaseUrl||Ze.state===Ze.States.PENDING)return this._configFailed?(setTimeout((()=>{fe(s,null,[new Error("MapKit failed to initialize.")])})),0):(this._watchConfiguration(),a.add({path:t,parameters:i,callback:s,transform:o,name:n},"query"));let r;r=0===t.search(/\/v?[0-9]+\//)?Ze.apiBaseUrl.replace(/\/v?[0-9]+\//,"")+t:Ze.apiBaseUrl+t,(i=i||{}).mkjsVersion=e.version;const l=new URLSearchParams;for(const[e,t]of Object.entries(i))t&&l.append(e,t);const h=l.toString();""!==h&&(r+=(t.indexOf("?")>-1?"&":"?")+h);const c={loaderDidSucceed:(e,t)=>{let r;if(this._logNetworkEvent(n,{responseCode:t.status}),a.remove(u),t.status<200||t.status>=300){try{S(t.responseText),r=JSON.parse(t.responseText)}catch(e){return void fe(s,null,[new Error("HTTP error: "+t.status)])}r&&r.error&&r.error.message?(/categor(y|ies)/i.test(r.error.message)&&console.warn("[MapKit] The version of MapKit may be deprecated."),fe(s,null,[new Error("HTTP error: "+t.status+". Message: "+r.error.message+".")])):fe(s,null,[new Error("HTTP error: "+t.status)])}else{try{S(t.responseText),r=JSON.parse(t.responseText)}catch(e){return void fe(s,null,[new Error("Failed to parse response: "+t.responseText)])}fe(s,null,[null,o(i,r)])}},loaderDidFail:(e,t)=>{this._logNetworkEvent(n,{responseCode:t.status}),a.remove(u);let i=Ze.ErrorStatus.Unknown;0===t.status?i=Ze.ErrorStatus.NetworkError:t.status===Ze.HTTP.UNAUTHORIZED?i=Ze.ErrorStatus.Unauthorized:t.status===Ze.HTTP.TOO_MANY_REQUESTS?i=Ze.ErrorStatus.TooManyRequests:t.status===Ze.HTTP.BAD_REQUEST&&(i=Ze.ErrorStatus.BadRequest),fe(s,null,[new Error(i)])}};S(Ze.appendServiceAuthOptions);const d=new me(r,c,Ze.appendServiceAuthOptions({}));d.schedule();const u=a.add(d,"xhr");return u}_sendImmediatelyOrWithUserLocation(e,t,i,s,o){return this.getsUserLocation?this._sendWithUserLocation(e,t,i,s,o):this._send(e,t,i,s,o)}_sendWithUserLocation(e,t,i,s,o){const n=this._requestMap.add({path:e,parameters:t,callback:i,transform:s,name:o},"geo");return this._locate(((e,t)=>{const i=this._requestMap.get(n);i&&(e?console.warn("[MapKit] Unable to get current location:",e.message):i.parameters.userLocation=`${t.latitude},${t.longitude}`,this._send(i.path,i.parameters,i.callback,i.transform,i.name),this._requestMap.remove(n))})),n}_checkOptions(e,t){p(e,"object","[MapKit] The `options` object is invalid."),Object.keys(e).forEach((e=>{-1===t.indexOf(e)&&console.warn("[MapKit] `"+e+"` is not a valid option.")}))}_bestLanguage(e){p(e,"string","[MapKit] `language` is not a string."),"zh"===e.toLowerCase()&&(console.warn("[MapKit] `zh` is an ambiguous language ID. Please specify a script or reginal variant: `zh-Hans`, `zh-Hant`, or `zh-HK`."),Ze.countryCode&&(e="zh-"+Ze.countryCode));const t=R.bestMatch(e);return null===t&&console.warn("[MapKit] "+this._name+": “"+e+"” is not supported."),t}_locate(e){k(kg.userLocation);u(e,"Missing callback"),p(e,"function"),kg.userLocation.locate((function(t){const i=t.coords;e(null,new bi(i.latitude,i.longitude))}),(function(t){let i;switch(t.code){case t.PERMISSION_DENIED:i="PERMISSION_DENIED";break;case t.POSITION_UNAVAILABLE:i="POSITION_UNAVAILABLE";break;case t.TIMEOUT:i="TIMEOUT";break;default:throw new Error("Unknown PositionError code: "+t.code)}e(new Error(i),null)}),Cg)}}j.jsModules.userLocation?kg.userLocation=j.jsModules.userLocation:j.addEventListener("load",(function e(t){t.jsModules.userLocation&&(kg.userLocation=t.jsModules.userLocation,j.removeEventListener("load",e))}));const Sg=kg;const Mg=class extends Sg{constructor(){super("PlaceData",{})}fetch(e,t){const i={mapsId:JSON.stringify({muid:e}),lang:Ze.language};return this._send("placedata",i,t,((e,t)=>{if(t&&t.result)return new Oi(t.result)}),"placedata")}};function Lg(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const xg=function(e){var t;class i extends e{constructor(e,t,i){super(e,t,i),Lg(this,"featureType",""),Lg(this,"pointOfInterestCategory",null)}init(e,t,i){super.init(e,t,i),this._cachedIconMetadata={}}fetchPlace(e){S(this.muid),u(e,"[MapKit] Missing `callback` in call to `MapFeatureAnnotation.fetch()`."),p(e,"function","[MapKit] `callback` passed to `MapFeatureAnnotation.fetch()` is not a function.");return(new Mg).fetch(this.muid,e)}get isAppStyle(){return!0}}return t=i,Lg(i,"StaticStyles",e.StaticStyles),t.prototype.ConstructorOptions=Object.freeze(Object.assign({},e.prototype.ConstructorOptions,{color:"rw",glyphColor:"rw",glyphImage:"rw",selectedGlyphImage:"rw",draggable:"rw",appearanceAnimation:"rw",anchorOffset:"rw",padding:"rw",size:"rw",glyphText:"rw"})),i},Ag=xg(mg),Eg={PointOfInterest:"PointOfInterest",Territory:"Territory",PhysicalFeature:"PhysicalFeature"};class Tg extends vg{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new Ag(this,e,t)}),this._impl.init(this,e,t),this._impl.styleAttributesHasIcon=!1,this._impl.enablesDefaultGlyphImage=!0}get featureType(){return this._impl.featureType}fetchPlace(e){return this._impl.fetchPlace(e)}get pointOfInterestCategory(){return this._impl.pointOfInterestCategory}get map(){return this._impl.map}get collisionMode(){return this._impl.collisionMode}get title(){return this._impl.title}get subtitle(){return this._impl.subtitle}get titleVisibility(){return this._impl.titleVisibility}get subtitleVisibility(){return this._impl.subtitleVisibility}get accessibilityLabel(){return this._impl.accessibilityLabel}static fromMapFeatureRegion(e,t,i){const s=!!(e.calloutGlyphImageUrlTemplate&&e.metadata&&e.metadata.calloutColor),o=new Tg(new Li.MapPoint(e.position[0],e.position[1]).toCoordinate(),{selected:!0,id:dp({muid:e.muid}),title:e.title});switch(e.annotation&&(o._impl.subtitle=e.annotation),o._impl.muid=e.muid,o._impl.styleAttributes=e.styleAttributes,e.category){case"Poi":o._impl.featureType=Eg.PointOfInterest;break;case"Territory":o._impl.featureType=Eg.Territory;break;case"PhysicalFeature":o._impl.featureType=Eg.PhysicalFeature;break;default:k(0,e.category)}if(s){o._impl.styleAttributesHasIcon=!0;const s=e.metadata;s.iconVisibility=!("labelIconSource"in s)||0!==s.labelIconSource,s.labelVisibility=!("labelTextVisibility"in s)||"Never"!==s.labelTextVisibility,s.styleAttributes=e.styleAttributes,s.context=(e.calloutGlyphImageUrlTemplate.match(/context=(\w+)/)||[])[1],o._impl.iconContext=s.context;const{iconStyle:n,tint:a,emphasis:r}=eg(t,i);s.iconStyle=n,s.tint=a,s.emphasis=r;const l=e.calloutGlyphImageUrlTemplate.replace(/emphasis=(standard|muted)/,"emphasis={{emphasis}}");o._impl.setIconMetadata(s,l),o._impl.enablesDefaultGlyphImage=!1,e.poiType&&He[e.poiType]&&(o._impl.pointOfInterestCategory=e.poiType)}return o}}function Ig(e,t){if(Tg.isConstructable)return new Tg(e,t);throw new TypeError("[MapKit] MapFeatureAnnotation may not be constructed.")}function Og(){j.jsModules.fromStyleAttributes&&(Tg.isConstructable=!0,Ig.fromStyleAttributes=j.jsModules.fromStyleAttributes,Ig.IconContext=j.jsModules.IconContext,j.removeEventListener("load",Og))}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(Tg,"isConstructable",!1),Tg.prototype.constructor=Ig,Ig.prototype=Tg.prototype,j.addEventListener("load",Og),Og();const Rg=Tg;const Pg=class{constructor(e){this._annotationsController=e}getMapFeatureAnnotationForRegion(e,t){const i=this._annotationsController.map;let s=Rg.fromMapFeatureRegion(e,i.mapType,i.tileTint);const o=i.annotationForMapFeature;return"function"==typeof o&&(s=fe(o,i.public,[s])||s),s._impl.selected=!0,t&&(s._impl.selectionAccessory=t),s}mapFeatureDidSelect(e){this._annotationsController.addItem(e,0),e._impl.isMapFeature=!0}mapTypeDidChange(){const e=this._annotationsController.selectedItem;e&&e._impl.isMapFeature&&this._annotationsController.items.indexOf(e)>=0&&this._annotationsController.removeItem(e)}annotationSelectionDidChange(e){!e.selected&&e._impl.isMapFeature&&this._annotationsController.items.indexOf(e)>=0&&this._annotationsController.removeItem(e)}},Dg=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const zg=class extends Xm{constructor(e,t,i,s){super(e,t,s)}init(e,t,i,s){this._memberAnnotations=i,super.init(e,t,s)}get memberAnnotations(){return this._memberAnnotations}get n(){return this._memberAnnotations.length}get title(){return Dg(this,"_title")?this._title:this._topAnnotation.title}set title(e){Object.getOwnPropertyDescriptor(xp.prototype,"title").set.call(this,e)}get subtitle(){const e=this.n-1;return Dg(this,"_subtitle")?this._subtitle:es.get("Annotation.Clustering.More"+(e>1?".Plural":""),{n:es.digits(e)})}set subtitle(e){Object.getOwnPropertyDescriptor(xp.prototype,"subtitle").set.call(this,e)}get glyphText(){return Dg(this,"_glyphText")?this._glyphText:Dg(this,"_glyphImage")||Dg(this,"_selectedGlyphImage")?"":es.digits(this.n)}set glyphText(e){Object.getOwnPropertyDescriptor(Xm.prototype,"glyphText").set.call(this,e)}get draggable(){return!1}set draggable(e){}get displayPriority(){return this._topAnnotation.displayPriority}set displayPriority(e){}get clusteringIdentifier(){return this._topAnnotation.clusteringIdentifier}set clusteringIdentifier(e){}get _topAnnotation(){return this._memberAnnotations[0]}get _showDefaultAltText(){return Dg(this,"_glyphText")||Dg(this,"_glyphImage")||Dg(this,"_selectedGlyphImage")}get isAppStyle(){return!!this._topAnnotation._impl.isAppStyle}get isPlaceStyle(){const e=this.isAppStyle;return e||!1}updateLocalizedText(){super.updateLocalizedText(),this.updateGlyph(),this._sceneGraphNode.updateAppearance(!0)}altText(){return this._showDefaultAltText?super.altText():this.title?es.get("Annotation.Clustering.AccessibilityLabel",{n:this.glyphText,title:this.title,subtitle:this.subtitle}):es.get("Annotation.Clustering.NoTitle.AccessibilityLabel",{n:this.glyphText,subtitle:this.subtitle})}};class Ng extends Jm{constructor(e,t,i){super(),Object.defineProperty(this,"_impl",{value:new zg(this,e,t,i)}),this._impl.init(this,e,t,i)}get memberAnnotations(){return this._impl.memberAnnotations}}const Fg=function(){throw new TypeError("[MapKit] ClusterAnnotation may not be constructed.")};Ng.prototype.constructor=Fg,Fg.prototype=Ng.prototype;const Ug=Ng,Gg=Ze.performanceMarkers.frameUpdates;function Wg(e,t){const i=Tp.DisplayPriority.Required,s=e.selected?i:e.displayPriority;return(t.selected?i:t.displayPriority)-s||t._impl.boundingBox.y2-e._impl.boundingBox.y2}function Bg(e,t){return t.displayPriority-e.displayPriority||e._impl.index-t._impl.index}function Zg(e,t){return e._impl.collisionMode===Tp.CollisionMode.None||t._impl.collisionMode===Tp.CollisionMode.None?0:e._impl.boundingBox.x1-t._impl.boundingBox.x1}function Kg(e){k((e._impl.collisionMode,Tp.CollisionMode.None));const t=e._impl.node,i=e._impl.nodePosition(),s=e.padding,o=t.size,n=o.width,a=o.height,r=i.x+s.left,l=i.x+n-s.right,h=i.y+s.top,c=i.y+a-s.bottom;if(e._impl.isAppStyle&&!e.selected){const t=e._impl.iconRect(),i=e._impl.labelRect(),s=Math.min(t.size.width,t.size.height)/2;return{boundType:"circle",x1:t.origin.x,x2:t.origin.x+t.size.width,y1:t.origin.y,y2:t.origin.y+t.size.height,cx:t.origin.x+t.size.width/2,cy:t.origin.y+t.size.height/2,r:s/2,padding:0,iconBoundingBox:{boundType:"circle",x1:t.origin.x,x2:t.origin.x+t.size.width,y1:t.origin.y,y2:t.origin.y+t.size.height,cx:t.origin.x+t.size.width/2,cy:t.origin.y+t.size.height/2,r:s,padding:0},labelBoundingBox:{boundType:"rect",x1:i.origin.x,x2:i.origin.x+i.size.width,y1:i.origin.y,y2:i.origin.y+i.size.height,padding:1}}}return e._impl.collisionMode===Tp.CollisionMode.Circle?{boundType:"circle",x1:r,x2:l,y1:h,y2:c,cx:(r+l)/2,cy:(h+c)/2,r:Math.min(n,a)/2,padding:5}:{boundType:"rect",x1:r,x2:l,y1:h,y2:c,padding:5}}function jg(e){switch(e.boundType){case"circle":return{boundType:e.boundType,x1:e.x1-e.padding,x2:e.x2+e.padding,y1:e.y1-e.padding,y2:e.y2+e.padding,cx:e.cx,cy:e.cy,r:e.r+e.padding,padding:0};case"rect":return{boundType:e.boundType,x1:e.x1-e.padding,x2:e.x2+e.padding,y1:e.y1-e.padding,y2:e.y2+e.padding,padding:0}}}function Hg(e,t){const i=e.cx-c(e.cx,t.x1,t.x2),s=e.cy-c(e.cy,t.y1,t.y2);return i*i+s*s<=e.r*e.r}function qg(e,t){if(!(t.x2>=e.x1&&t.x1<=e.x2&&t.y2>=e.y1&&t.y1<=e.y2))return!1;if("circle"===e.boundType){if("circle"===t.boundType){const i=e.cx-t.cx,s=e.cy-t.cy,o=Math.sqrt(i*i+s*s);return e.r+t.r>=o}return Hg(e,t)}return"circle"!==t.boundType||Hg(t,e)}function Vg(e,t){e._impl.occluded=t,e._impl.updateVisibility(t)}const Yg=class{constructor(e){this._annotationsController=e,this._clusters=[],this._previousClusters=[],this._previousOverlaps=[],this._previousAnnotations=[],this._frameCounter=0}collideAnnotations(e,t,i,s){this._locked||(this._annotations=e,this._zoomLevel=t,this._rotation=i,this._changesSinceLastCollision=s,Mt.scheduleOnNextFrame(this))}setRequiredClusterAnnotationProperties(e,t){return e!==t&&(e||(e=t),e.coordinate=t.coordinate,e.draggable=!1,e.displayPriority=t.memberAnnotations[0].displayPriority,e.clusteringIdentifier=t.memberAnnotations[0].clusteringIdentifier,Object.defineProperty(e,"memberAnnotations",{enumerable:!0,get:function(){return this._impl.memberAnnotations}}),Object.defineProperty(e._impl,"memberAnnotations",{enumerable:!0,value:t.memberAnnotations})),e.animates=t.memberAnnotations.some((e=>!e._impl.wasCollided)),e.selected=!1,e}removedAnnotation(e){e.memberAnnotations||(this._previousClusters=this._previousClusters.filter((function(t){if(t.memberAnnotations.indexOf(e)<0)return!0;this._annotationsController.removeAnyItem(t)}),this))}mapWasDestroyed(){this._annotationsController=null}performScheduledUpdate(){const e=Gg?performance.now():void 0;if(!this._annotationsController)return;if(this._frameCounter=(this._frameCounter+1)%10,1!==this._frameCounter)return void Mt.scheduleOnNextFrame(this);const t=this._needsUpdate();if(!t)return;this._changesSinceLastCollision=!1,this._previousZoomLevel=this._zoomLevel,this._previousRotation=this._rotation,this._previousAnnotations=this._annotations.slice(),this._locked=!0,this._annotationsController.willUpdateCollisions(),"region"===t&&this._annotationsController.deselectClusterAnnotation(),this._overlaps=[];let i=0;for(let e=0,t=this._annotations.length;e<t;++e){const t=this._annotations[e];if(t._impl.needsLayout)return this._frameCounter=0,this._locked=!1,void Mt.scheduleOnNextFrame(this);t._impl.index=e,t._impl.occluded=!1,t._impl.previousCluster=t._impl.cluster,delete t._impl.cluster,t._impl.collisionMode!==Tp.CollisionMode.None&&(t._impl.boundingBox=Kg(t),i=Math.max(i,t._impl.boundingBox.x2-t._impl.boundingBox.x1))}const s=this._annotations.sort(Zg),o={};s.forEach((e=>{if(e.selected||e._impl.collisionMode===Tp.CollisionMode.None)return;const t=e.clusteringIdentifier;t&&(o[t]?o[t].push(e):o[t]=[e])}));const n=this._clusters;this._clusters=[];for(const e in o)o[e].length>1&&(i=this._clusterAnnotationsWithMaxWidth(o[e],i));n.forEach((function(e){this._clusters.indexOf(e)<0&&(Vg(e,!0),e.selected&&(e.selected=!1))}),this),this._collideAnnotationsAndClusters(s,i),this._collideAnnotationLabels([...s,...this._clusters]),this._previousOverlaps=this._overlaps,this._annotationsController.didUpdateCollisions(),this._locked=!1,Gg&&performance.measure("mapkit-map-collision",{start:e})}_clusterAnnotationsWithMaxWidth(e,t){for(let i=0;i<e.length;){const s=e[i];if(k((s._impl.collisionMode,Tp.CollisionMode.None)),s._impl.cluster){++i;continue}const o=s._impl.boundingBox.x2;let n=[s],a=i+1;if(s.memberAnnotations&&i>0){const o=s._impl.boundingBox.x1-t;for(a=i-1;a>0&&e[a]._impl.boundingBox.x1>=o;)a-=1}for(;a<e.length&&e[a]._impl.boundingBox.x1<=o;++a){const t=e[a];!t._impl.cluster&&a!==i&&this._annotationsOverlapExcludingSelected(s,t)&&n.push(t)}if(n.length>1){n=n.reduce(((e,t)=>(t.memberAnnotations?(e=e.concat(t.memberAnnotations),t._impl.cluster=!0,Vg(t,!0)):e.push(t),e)),[]).sort(Bg);const s=this._clusterAnnotationForMemberAnnotations(n);for(s._impl.occluded=!1,s._impl.collisionMode!==Tp.CollisionMode.None&&(s._impl.boundingBox=Kg(s),t=Math.max(t,s._impl.boundingBox.x2-s._impl.boundingBox.x1)),delete s._impl.cluster,a=0;a<n.length;++a)n[a]._impl.occluded=!0,n[a]._impl.cluster=s;for(a=0;a<e.length&&e[a]._impl.boundingBox.x1<s._impl.boundingBox.x1;)a+=1;e.splice(a,0,s),i=Math.min(i+1,a)}else++i}return e.forEach((function(e){e.memberAnnotations&&!e._impl.cluster&&(this._clusters.push(e),e.map||this._annotationsController.addItem(e))}),this),t}_collideAnnotationsAndClusters(e,t){let i=!1;const s=[];for(let t=0,o=0,n=e.length,a=this._clusters.length;t<n||o<a;){const n=e[t],a=this._clusters[o];n?n._impl.cluster||n._impl.collisionMode===Tp.CollisionMode.None?++t:a&&a._impl.boundingBox.x1<n._impl.boundingBox.x1?(a._impl.isRequired()||(i=!0),s.push(a),++o):(n._impl.isRequired()||(i=!0),s.push(n),++t):(a._impl.isRequired()||(i=!0),s.push(a),++o)}i&&this._collideAnnotationsWithMaxWidth(s,t)}_collideAnnotationsWithMaxWidth(e,t){const i=[];for(let t=0,s=e.length;t<s;++t){const o=e[t];k((o._impl.collisionMode,Tp.CollisionMode.None));const n=o._impl.boundingBox.x2;for(let a=t+1;a<s;++a){const t=e[a];if(t._impl.boundingBox.x1>n)break;o._impl.isRequired()&&t._impl.isRequired()||this._annotationsOverlap(o,t)&&i.push(Wg(o,t)<=0?[o,t]:[t,o])}}i.sort(((e,t)=>Wg(e[0],t[0]))).forEach((e=>{e[0]._impl.occluded||(e[1]._impl.occluded=!0)}))}_annotationsOverlapExcludingSelected(e,t){return!e.selected&&!t.selected&&this._annotationsOverlap(e,t)}_annotationsOverlap(e,t){if(k((e._impl.collisionMode,Tp.CollisionMode.None)),k((t._impl.collisionMode,Tp.CollisionMode.None)),e._impl.isLifted()||t._impl.isLifted())return!1;const i=Bg(e,t)<=0?[e,t]:[t,e];let s;for(let e=0,t=this._previousOverlaps.length;e<t&&!s;++e){const t=this._previousOverlaps[e];t[0]===i[0]&&t[1]===i[1]&&(s=t)}const o=function(e,t,i){k((e._impl.collisionMode,Tp.CollisionMode.None)),k((t._impl.collisionMode,Tp.CollisionMode.None));let s=e._impl.boundingBox,o=t._impl.boundingBox;i&&(s=jg(s),o=jg(o));return qg(s,o)}(e,t,s);return o&&this._overlaps.push(i),o}_clusterAnnotationForMemberAnnotations(e){let t;const i=function(e,t){for(let i=0,s=e.length;i<s;++i){const s=e[i],o=t.length;if(s.memberAnnotations.length===o){let e=0;for(;e<o&&t[e]===s.memberAnnotations[e];)e+=1;if(e===o)return i}}return-1}(this._previousClusters,e);if(i>=0)t=this._previousClusters[i],t._impl.resetNodeTransform();else{const i=function(e){let t=0,i=0,s=0;e.forEach((e=>{t+=e.coordinate.latitude;const o=Li.wrapLongitude(e.coordinate.longitude)/180*Math.PI;i+=Math.cos(o),s+=Math.sin(o)}));const o=e.length,n=t/o,a=0===i?s<0?-90:90:180*Math.atan(s/i)/Math.PI+(i<0?180:0);return new Li.Coordinate(n,a)}(e);t=this._annotationsController.addCluster(new Ug(i,e)),this._previousClusters.push(t)}return t}_collideAnnotationLabels(e){for(const t of e){if(t._impl.collisionMode===Tp.CollisionMode.None){t._impl.labelOccluded=!1;continue}const i=t._impl.boundingBox;if(t._impl.occluded){t._impl.labelOccluded=!!i.labelBoundingBox;continue}if(!i.labelBoundingBox){t._impl.labelOccluded=!1;continue}const s=jg(i.labelBoundingBox);let o=!1;for(const i of e){if(t===i)continue;if(t._impl.occluded||t._impl.collisionMode===Tp.CollisionMode.None||i._impl.occluded||i._impl.collisionMode===Tp.CollisionMode.None)continue;if(qg(s,i._impl.boundingBox.iconBoundingBox?i._impl.boundingBox.iconBoundingBox:i._impl.boundingBox)){o=!0;break}if(i._impl.boundingBox.labelBoundingBox&&!i._impl.labelOccluded&&qg(s,jg(i._impl.boundingBox.labelBoundingBox))){o=!0;break}}t._impl.labelOccluded=o}}_needsUpdate(){if(this._zoomLevel!==this._previousZoomLevel||this._rotation!==this._previousRotation)return"region";if(this._changesSinceLastCollision)return"annotations";const e=this._annotations.length;if(this._previousAnnotations.length!==e)return"annotations";for(let t=0;t<e;++t)if(this._annotations[t]!==this._previousAnnotations[t])return"annotations";return""}};const Xg=class extends an{constructor(e){super(),this._element=e}get element(){return this._element}stringInfo(){return"AnnotationsControllerNode"}};const $g=class{constructor(e){!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"delegate",null),this._element=Bo.htmlElement("div",{class:"mk-style-helper"}),this.delegate=e}get element(){return this._element}sizeForElement(e){const t=e.cloneNode(!0),i=[],s=[];!function(e,t,i){if(Bo.supportsShadowDOM){if("slot"===e.localName)t.push(e),i.push(e.name);else{const s=e.getElementsByTagName("slot");0!==s.length&&Array.prototype.forEach.call(s,(e=>{t.push(e),i.push(e.name)}))}t.forEach((e=>{e.name="mk-slot-disabled"}))}}(e,i,s),this._element.appendChild(t),this.delegate&&this.delegate.styleHelperNodeDidMoveToParent&&this.delegate.styleHelperNodeDidMoveToParent(t);let o=t;Bo.supportsShadowDOM&&"slot"===e.localName&&(o=t.assignedNodes()[0]);const n=function(e){if(!e||e.nodeType!==window.Node.ELEMENT_NODE)return;const t=window.getComputedStyle(e),i=parseFloat(t.marginLeft),s=parseFloat(t.marginTop),o=parseFloat(t.marginRight),n=parseFloat(t.marginBottom),a=us.rectFromClientRect(e.getBoundingClientRect()).inset(-i,-s,-o,-n);return a}(o);return this._element.removeChild(t),function(e,t){Bo.supportsShadowDOM&&e.forEach(((e,i)=>{e.name=t[i]}))}(i,s),n&&n.size}backgroundColorForElement(e,t){this._element.appendChild(e),this.delegate&&this.delegate.styleHelperNodeDidMoveToParent&&this.delegate.styleHelperNodeDidMoveToParent(e);let i=e;if(Bo.supportsShadowDOM&&"slot"===e.localName&&(i=e.assignedNodes()[0],!i))return this._element.removeChild(e),null;const s=window.getComputedStyle(i).backgroundColor;return t&&(i.style.backgroundColor="transparent"),this._element.removeChild(e),/^transparent|initial|rgba\(.*, 0\)$/.test(s)?null:s}setAnimationForElement(e,t,i){let s=e;if(Bo.supportsShadowDOM&&"slot"===e.localName&&(s=e.assignedNodes()[0],!s))return;s.style.animation=t;const o=function(e){e.animationName===i&&(s.style.animation="",s.removeEventListener("animationend",o))};s.addEventListener("animationend",o)}};function Jg(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Qg extends _o{toString(){return this.stringInfo()+" →"}}const e_=class{constructor(e){Jg(this,"hostNode",void 0),Jg(this,"_elementNodeMap",{}),this.hostNode=e}appendAssignedElement(e,t){const i=e.slot,s=new Qg(e);this._elementNodeMap[i]=s,this.hostNode.addChild(s),t||this.hostNode.element.appendChild(e)}removeAssignedElement(e,t){const i=e.name,s=this._elementNodeMap[i];delete this._elementNodeMap[i],this.hostNode.removeChild(s),t||this.hostNode.element.removeChild(s.element)}getAssignedElement(e){return this._elementNodeMap[e.name]?this._elementNodeMap[e.name].element:null}};function t_(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const i_=18,s_=8.028,o_=12,n_=8e3/60,a_=5e3/60,r_=5e3/60,l_=30/249,h_=277/249,c_=237/249,d_="mk-selection-accessory",u_="mk-selection-accessory-bubble",p_="mk-selection-accessory-content",m_="mk-selection-accessory-loading",g_="mk-selection-accessory-failed",__="mk-failed-labels",f_="mk-rtl",y_=new ls(243,311),v_=new ls(180,70);class b_ extends sp{constructor(e,{place:t,muid:i,uiStyle:s,side:o,rtl:n}){super(),t_(this,"_tailXAxisShift",0),t_(this,"delegate",null),t_(this,"_scaleAnimationParameters",[[n_,l_,h_],[a_,h_,c_],[r_,c_,1]]),super.init(),this.delegate=e,this._node=new Lo.Node(Bo.htmlElement("div",{class:`${d_} mk-ui-style-${s}`}));const a=this._node.element;this._tailScale=1,this._bubbleElement=Bo.svgElement("path"),this._svgElement=a.appendChild(Bo.svgElement("svg",{class:u_},this._bubbleElement)),this._containerElement=Bo.htmlElement("div"),this._containerElementNode=new Lo.Node(this._containerElement),this._containerContentElement=this._containerElement.appendChild(Bo.htmlElement("div"));this.uiStyle=s,this._controller=new os(this._containerContentElement,{get colorScheme(){return e.tint},get place(){return t||{muid:i}},placeCardSizeDidChange:(e,t)=>this._placeCardSizeDidChange(e,t),loadingDidFail:()=>this._placeCardFrameLoadingDidFail(),uiStyle:s,placeCardDidReveal:e=>this.delegate.placeCardDidReveal("full"===s?"LARGE":"MEDIUM",e),placeCardOpenInMapsClicked:e=>this.delegate.placeCardOpenInMapsClicked("full"===s?"LARGE":"MEDIUM",e)}),this.side=o,this._controller.update(),this._containerElementNode.classList.add(p_),n&&this._containerElementNode.classList.add(f_),a.appendChild(this._containerElement),this._rtl=n,this._loadingCanvasElement=Bo.htmlElement("canvas",{"aria-hidden":"true",class:m_}),this._containerElement.appendChild(this._loadingCanvasElement),this._node.wantsHardwareCompositing=!0}get node(){return this._node}get boundingRect(){const e=this._node.position;return new us(e.x,e.y,this._node.size.width,this._node.size.height)}willMoveToMap(){this._node.transform=(new ao).scale(0)}setAnchorOffset(e){k()}containsElement(e){return e!==this._svgElement&&!!this._containerElement.contains(e)}isCustomCallout(){return!1}updateInfo(e,t){const i=this.placeCardSize?this.placeCardSize.copy():"full"===this.uiStyle?y_.copy():v_.copy();return this._updateSize(i),this.updatePosition(),!0}setPositionWithSide(e,t){switch(k(!this.side||this.side),this.side=t,t){case"top":e.y+=-12*this._tailScale;break;case"left":e.x-=this._node.size.width/2+o_*this._tailScale,e.y+=this._node.size.height/2;break;case"right":e.x+=this._node.size.width/2+o_*this._tailScale,e.y+=this._node.size.height/2;break;case"bottom":e.y+=this._node.size.height+o_*this._tailScale;break;default:k()}return this.setPosition(e)}shiftTailBy(e){if(k(this.side),"left"===this.side||"right"===this.side)return this._tailXAxisShift=0,this._bubbleElement.setAttribute("d",w_(this._bubbleSize,this._tailScale,this.side,this._tailXAxisShift)),0;const t=Math.max(0,(this._bubbleSize.width-36)/2);return this._tailXAxisShift=e<0?Math.min(t,-e):-Math.min(t,e),this._bubbleElement.setAttribute("d",w_(this._bubbleSize,this._tailScale,this.side,this._tailXAxisShift)),this._node.position=new cs(this._node.position.x+this._tailXAxisShift,this._node.position.y),this._tailXAxisShift}animateIn(){if(!this.animates)return this.animatedIn=!0,void(this._node.transform=new ao);this.animatedIn||(this.animatedIn=!0,this._setScaleOffsets(),this._scaleAnimationParameterIndex=0,this._scaleAnimationStartDate=Date.now(),Mt.scheduleOnNextFrame(this))}animateOut(e){!e&&this.visible?(this._scaleAnimationStartDate&&this._finishAnimatingScale(),this._fadeoutAnimationStartDate=Date.now(),Mt.scheduleOnNextFrame(this)):this._node.remove()}mapNodeTintWasSet(e){this.updateInfo(),this._controller.update()}performScheduledUpdate(){this._scaleAnimationStartDate&&this._animateScale(),this._fadeoutAnimationStartDate&&this._animateFadeout()}didRemoveFromParent(){this.delegate.accessoryNodeDidRemove(this)}setSize(e){const t=o_*this._tailScale,i=e.width+20+2*t,s=e.height+20+2*t,o=-10.5-t,n=-10.5-t;this._svgElement.style.width=i+"px",this._svgElement.style.height=s+"px",this._svgElement.style.top=o+"px",this._svgElement.style.left=n+"px",this._svgElement.setAttribute("viewBox",`${n} ${o} ${i} ${s}`),super.setSize(e)}_placeCardSizeDidChange(e,t){if(0===e||0===t)return;let i;switch(this._placeCardDidLoad(),this.uiStyle){case"full":i=new ls(y_.width,Math.min(600,this.delegate.getMaximumSizeForAccessory().height,t));break;case"compact":i=new ls(e,t);break;default:k(),i=new ls}this.placeCardSize=i.copy(),this._updateSize(i),this.delegate.accessorySizeDidChange(this)}_updateLoadingCanvas(e){const t=this._loadingCanvasElement;if(!t)return;t.width=e.width*Bo.devicePixelRatio,t.height=e.height*Bo.devicePixelRatio;const i=t.getContext("2d");if(i.scale(Bo.devicePixelRatio,Bo.devicePixelRatio),this._rtl&&(i.translate(e.width,0),i.scale(-1,1)),"full"===this.uiStyle){const t=e.width-18-.2*e.width*Math.random();i.roundRect(9,12,t,20,5);const s=e.width-18-.2*e.width*Math.random();i.roundRect(9,36,s,13,5),i.fillStyle=this.delegate.tint===Fs.Light?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)",i.fill();const o=e.width-18,n=61,a=46,r=e.height-n-12-a-12,l=n+r+12;i.beginPath(),i.roundRect(9,n,o,r,10),i.roundRect(9,l,o,a,10),i.fillStyle=this.delegate.tint===Fs.Light?"#ffffff":"#242628",i.fill();const h=50,c=[1,1,1,1];c[Math.floor(4*Math.random())]+=1,c[Math.floor(4*Math.random())]+=1;let d=n+9;i.beginPath();for(const t of c){i.roundRect(21,d,h,11,5),d+=13;for(let s=0;s<t;s++)i.roundRect(21,d,e.width-42-.2*e.width*Math.random(),13,5),d+=13+(s+1===t?9:2)}i.arc(35,l+9+14,14,0,2*Math.PI),i.roundRect(58,l+9+7,e.width-42-37-.2*e.width*Math.random(),14,5),i.fillStyle=this.delegate.tint===Fs.Light?"rgba(0, 0, 0, 0.03)":"rgba(255, 255, 255, 0.03)",i.fill()}else{let t=12;for(;t<=e.height-12;){const s=e.width-32-.2*e.width*Math.random();i.roundRect(16,t,s,12,5),t+=18}i.fillStyle=this.delegate.tint===Fs.Light?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)",i.fill()}}_placeCardDidLoad(){this._removeLoadingCanvas(),this._removeLoadingFailureLabel()}_removeLoadingCanvas(){this._loadingCanvasElement&&(this._containerElement.removeChild(this._loadingCanvasElement),this._loadingCanvasElement=null)}_placeCardFrameLoadingDidFail(){this._removeLoadingCanvas(),this._loadingFailureLabel=Bo.htmlElement("div",{class:g_}),this._containerElement.appendChild(this._loadingFailureLabel);const e=this._loadingFailureLabel.appendChild(Bo.htmlElement("div",{class:__}));e.appendChild(Bo.htmlElement("p",es.get("Place.Error.Title"))),e.appendChild(Bo.htmlElement("p",es.get("Place.Error.Message")));const t="full"===this.uiStyle?y_.copy():v_.copy();t.height=e.offsetHeight,this._updateSize(t),this.delegate.accessorySizeDidChange(this)}_removeLoadingFailureLabel(){this._loadingFailureLabel&&(this._containerElement.removeChild(this._loadingFailureLabel),this._loadingFailureLabel=null)}_updateSize(e){this._updateLoadingCanvas(e);const t=e.width-this.node.size.width;this._tailXAxisShift=Math.max(0,this._tailXAxisShift+Math.min(0,t)),this._containerElement.style.width=e.width+"px",this._containerElement.style.height=e.height+"px",e.height+=36,e.height-=36,this.setSize(e),this._bubbleSize=new ls(e.width-36,e.height-36),this._bubbleElement.setAttribute("d",w_(this._bubbleSize,this._tailScale,this.side,this._tailXAxisShift));(this._scaleXOffset||this._scaleYOffset)&&this._setScaleOffsets()}_setScaleOffsets(){const e=this._node.size,t=o_*this._tailScale;switch(this.side){case"top":this._scaleXOffset=-this._tailXAxisShift,this._scaleYOffset=e.height/2;break;case"left":this._scaleXOffset=e.width/2+t,this._scaleYOffset=-t/2;break;case"right":this._scaleXOffset=-e.width/2-t,this._scaleYOffset=-t/2;break;case"bottom":this._scaleXOffset=-this._tailXAxisShift,this._scaleYOffset=-e.height/2;break;default:k()}}_animateScale(){const e=this._scaleAnimationParameters[this._scaleAnimationParameterIndex],t=e[0],i=e[1],s=e[2],o=Date.now(),n=Math.min((o-this._scaleAnimationStartDate)/t,1),a=i+(s-i)*n;if(this._node.transform=(new ao).translate(this._scaleXOffset,this._scaleYOffset).scale(a).translate(-this._scaleXOffset,-this._scaleYOffset),1===n){if(++this._scaleAnimationParameterIndex,!(this._scaleAnimationParameterIndex<this._scaleAnimationParameters.length))return void this._finishAnimatingScale();this._scaleAnimationStartDate=o}Mt.scheduleOnNextFrame(this)}_finishAnimatingScale(){delete this._scaleXOffset,delete this._scaleYOffset,delete this._scaleAnimationStartDate,delete this._scaleAnimationParameterIndex}_animateFadeout(){const e=(Date.now()-this._fadeoutAnimationStartDate)/100,t=Math.max(0,1-e);0!==t?(this._node.opacity=t,Mt.scheduleOnNextFrame(this)):this._node.remove()}animateTailScale(e,t){k()}animateAnchorOffset(e,t){k()}getCenterOffset(e){k()}}function w_(e,t,i,s){const o=15*t,n=o_*t,a=e.width/2-o,r=e.height/2-o,l=10*t,h=12*t;return"M0,18c0,-9.972 8.028,-18 18,-18"+("bottom"===i?"h"+(-s+a)+"c"+l+",0 "+h+","+-n+" "+o+","+-n+"c"+(-h+o)+",0 "+(-l+o)+","+n+" "+o+","+n+"h"+(s+a):"h"+e.width)+"c9.972,0 "+"18,"+s_+" "+"18,"+i_+("left"===i?"v"+r+"c0,"+l+" "+n+","+h+" "+n+","+o+"c0,"+(-h+o)+" "+-n+","+(-l+o)+" "+-n+","+o+"v"+r:"v"+e.height)+"c0,9.972 "+"-8.028,"+"18 "+"-18,"+i_+("top"===i?"h"+(-s-a)+"c"+-l+",0 "+-h+","+n+" "+-o+","+n+"c"+(h-o)+",0 "+(l-o)+","+-n+" "+-o+","+-n+"h"+(s-a):"h"+-e.width)+"c"+"-9.972,0 "+"-18,"+"-8.028 "+"-18,"+-18+("right"===i?"v"+-r+"c0,"+-l+" "+-n+","+-h+" "+-n+","+-o+"c0,"+(h-o)+" "+n+","+(l-o)+" "+n+","+-o+"v"+-r:"z")}t_(b_,"DEFAULT_FULL_SIZE",y_),t_(b_,"DEFAULT_COMPACT_SIZE",v_),t_(b_,"TAIL_LENGTH",o_),t_(b_,"TAIL_DISTANCE_TO_ANCHOR",8);const C_=b_;function k_(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const S_=10.5,M_=3.5826363,L_=3.58028186,x_=8e3/60,A_=5e3/60,E_=5e3/60,T_=30/249,I_=277/249,O_=237/249,R_="white",P_={left:10,right:10,content:{left:4,right:4}},D_={left:7.5,right:10},z_={left:7.5,right:7.5},N_=5.5,F_=0,U_="mk-callout",G_="mk-bubble",W_="mk-title",B_="mk-subtitle",Z_="mk-no-subtitle",K_="mk-no-accessories",j_="mk-standard",H_="mk-standard-content",q_="mk-callout-accessory",V_="mk-callout-content",Y_="mk-custom-content",X_="mk-callout-accessory-content",$_="mk-rtl";class J_ extends _o{constructor(e){super(Bo.htmlElement("div",{class:U_,style:"direction: ltr"})),this._callout=e}didMoveToParent(e){null===e&&this._callout.didRemoveFromParent()}}function Q_(e,t,i){const s=17*t,o=13*t,n=e.width/2-s,a=10*t,r=12*t;return"M0,10.5c0,-6.9197181400000005 3.5826363,-10.5 10.5,-10.5h"+e.width+"c6.9173637,0 "+S_+","+L_+" "+S_+","+S_+"v"+e.height+"c0,6.9197181400000005 "+-M_+","+S_+" "+"-10.5,"+S_+"h"+(-i-n)+"c"+-a+",0 "+-r+","+o+" "+-s+","+o+"c"+(r-s)+",0 "+(a-s)+","+-o+" "+-s+","+-o+"h"+(i-n)+"c"+"-6.9173637,0 "+"-10.5,"+-L_+" "+"-10.5,"+"-10.5z"}function ef(){const e=Math.random().toString(36).substr(2);return document.getElementById(e)?ef():e}const tf=class extends sp{constructor(e,t){super(),k_(this,"_tailShift",0),k_(this,"delegate",null),k_(this,"_scaleAnimationParameters",[[x_,T_,I_],[A_,I_,O_],[E_,O_,1]]),super.init(),this.delegate=e,this._rtl=t.rtl,this._node=new J_(this);const i=this._node.element;function s(t){return e.backgroundColorForElement(t,!0)}function o(e,t){const i=Bo.htmlElement("div",{class:X_},e);i.style.maxWidth="186.5px",t&&(i.style.padding="0");return Bo.htmlElement("div",{class:q_},i)}t.customElement?(this._containerElement=this._customElement=t.customElement,this.setSize(this.delegate.sizeForElement(this._customElement)),i.appendChild(t.customElement)):(this._ignoreCalloutCornerRadiusForLeftAccessory=t.ignoreCalloutCornerRadiusForLeftAccessory,this._tailScale=t.tailScale||1,this._bubbleElement=Bo.svgElement("path"),this._svgElement=i.appendChild(Bo.svgElement("svg",{class:G_},this._bubbleElement)),this._containerElement=Bo.htmlElement("div"),this._containerElementNode=new _o(this._containerElement),t.leftAccessory&&(this._leftAccessoryBackgroundColor=s(t.leftAccessory),this._leftAccessory=o(t.leftAccessory,!this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory),this._containerElement.appendChild(this._leftAccessory)),this._containerContentElement=this._containerElement.appendChild(Bo.htmlElement("div")),this._containerContentElement.className=V_,t.rightAccessory&&(this._rightAccessoryBackgroundColor=s(t.rightAccessory),this._rightAccessory=o(t.rightAccessory,this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory),this._containerElement.appendChild(this._rightAccessory)),(this._leftAccessoryBackgroundColor||this._rightAccessoryBackgroundColor)&&(this._calloutId=ef(),this._linearGradientElement=Bo.svgElement("linearGradient",{id:this._calloutId}),this._svgElement.appendChild(Bo.svgElement("defs",this._linearGradientElement))),t.contentElement?this._setContentElement(t.contentElement):(this._containerElementNode.classList.add(j_),t.rtl&&(this._containerContentElement.className+=" "+$_)),i.appendChild(this._containerElement)),t.position&&this.setPosition(t.position),this._node.wantsHardwareCompositing=!0}get node(){return this._node}get boundingRect(){const e=this._node.position;return new us(e.x,e.y,this._node.size.width,this._node.size.height)}willMoveToMap(){this._node.transform=(new ao).scale(0)}setAnchorOffset(e){this._anchorOffset=e?new window.DOMPoint(e.x,e.y):new window.DOMPoint}containsElement(e){if(e===this._svgElement)return!1;if(this._containerElement.contains(e))return!0;if(!Bo.supportsShadowDOM||!this.isCustomCallout())return!1;const t=this.customOrContentElement.assignedNodes()[0];return!!t&&t.contains(e)}isCustomCallout(){return!!this.customOrContentElement}get customOrContentElement(){return this._customElement||this._contentElement}get customLeftAccessory(){if(this._leftAccessory)return this._leftAccessory.firstChild.firstChild}get customRightAccessory(){if(this._rightAccessory)return this._rightAccessory.firstChild.firstChild}updateInfo(e,t){if(this.isCustomCallout())return!0;if(!e||!e.title)return!1;this._containerContentElement.innerHTML="",this._containerElement.style.width="",this._containerContentElement.classList.add(H_),this._containerContentElement.appendChild(Bo.htmlElement("div",{class:W_,dir:"auto"},e.title)),e.subtitle?(this._containerContentElement.appendChild(Bo.htmlElement("div",{class:B_,dir:"auto"},e.subtitle)),this._containerElementNode.classList.remove(Z_)):(this._containerElementNode.classList.add(Z_),this._containerElementNode.classList.toggle(K_,!this._leftAccessory&&!this._rightAccessory)),this._updateAccessoryViews(),this._containerElement.className=this._containerElementNode.classList.toString();const i=this.delegate.sizeForElement(this._containerElement),s=e.map._impl.ensureVisibleFrame().size.width-2*t-this._extraWidth(this._ignoreCalloutCornerRadiusForLeftAccessory);return i.width=c(i.width,74,c(s,74,373)),0!==this._accessoryHeight&&(i.height=Math.max(this._accessoryHeight,i.height)),this._updateSize(i,!1),this.updatePosition(),!0}shiftTailBy(e){if(this._customElement)return 0;const t=Math.max(0,(this._bubbleSize.width-74-S_)/2);return this._tailShift=e<0?Math.min(t,-e):-Math.min(t,e),this._bubbleElement.setAttribute("d",Q_(this._bubbleSize,this._tailScale,this._tailShift)),this._node.position=new cs(this._node.position.x+this._tailShift,this._node.position.y),this._tailShift}animateIn(){if(!this.animates||this.animates&&this._customElement&&!this.appearanceAnimation)this._node.transform=new ao;else{if(this._appearanceAnimationName)return this._node.transform=new ao,void this.delegate.setAnimationForElement(this._containerElement,this._appearanceAnimation,this._appearanceAnimationName);this._scaleXOffset=-this._tailShift,this._scaleYOffset=this._node.size.height/2,this._scaleAnimationParameterIndex=0,this._scaleAnimationStartDate=Date.now(),Mt.scheduleOnNextFrame(this)}}animateOut(e){!e&&this.visible?(this._scaleAnimationStartDate&&this._finishAnimatingScale(),this._fadeoutAnimationStartDate=Date.now(),Mt.scheduleOnNextFrame(this)):this._node.remove()}mapNodeTintWasSet(e){}performScheduledUpdate(){this._scaleAnimationStartDate&&this._animateScale(),this._fadeoutAnimationStartDate&&this._animateFadeout(),this._tailAnimation&&this._animateTail(),this._anchorOffsetAnimation&&this._animateAnchorOffset()}didRemoveFromParent(){this.delegate.accessoryNodeDidRemove(this)}setSize(e){this._svgElement&&(this._svgElement.style.width=e.width+"px",this._svgElement.style.height=e.height+"px",this._svgElement.setAttribute("viewBox","-0.5 -0.5 "+e.width+" "+e.height)),super.setSize(e)}_updateSize(e,t){const i=this._ignoreCalloutCornerRadiusForLeftAccessory,s=e.width-this.node.size.width-22;this._tailShift=Math.max(0,this._tailShift+Math.min(0,s)),this._containerElement.style.width=e.width+"px";const o=this._extraWidth(i),n=13*this._tailScale,a=22+n;e.width+=o;const r=e.height,l=(i?55:50)+n;e.height+=a,e.height-=S_,e.height=t?e.height:Math.max(e.height,l);const h=t?F_:N_,c=(e.height-r-n)/2;this._containerElement.style.top=r/2+Math.max(h,c)+"px";const d=z_.left,u=z_.right;let p;this._containerElement.style.left=d+"px",this.setSize(e),this._bubbleSize=new ls(e.width-22,e.height-22-n),this._bubbleElement.setAttribute("d",Q_(this._bubbleSize,this._tailScale,this._tailShift)),this._leftAccessoryBackgroundColor&&(p=100*(this._leftAccessoryWidth+d)/e.width,this._updateAccessoryViewBackground(p,this._leftAccessoryBackgroundColor,R_)),this._rightAccessoryBackgroundColor&&(p=100-100*(this._rightAccessoryWidth+u)/e.width,this._updateAccessoryViewBackground(p,R_,this._rightAccessoryBackgroundColor))}_extraWidth(e){return e?D_.left+D_.right:P_.left+P_.right-P_.content.left}_updateAccessoryViews(){if(this._accessoryHeight=0,this._leftAccessory){const e=this.delegate.sizeForElement(this._leftAccessory.children[0]);this._leftAccessoryWidth=(!this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory?0:S_)+e.width,this._accessoryHeight=e.height,this._leftAccessory.style.width=this._leftAccessoryWidth+"px",this._ignoreCalloutCornerRadiusForLeftAccessory&&!this._rtl&&(this._leftAccessory.style.height=this._leftAccessoryWidth+"px",this._leftAccessory.style.overflow="visible"),this._containerContentElement.style.marginLeft=this._leftAccessoryWidth+"px"}if(this._rightAccessory){const e=this.delegate.sizeForElement(this._rightAccessory.children[0]);this._rightAccessoryWidth=(this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory?0:S_)+e.width,this._accessoryHeight=Math.max(this._accessoryHeight,e.height),this._rightAccessory.style.width=this._rightAccessoryWidth+"px",this._ignoreCalloutCornerRadiusForLeftAccessory&&this._rtl&&(this._rightAccessory.style.height=this._rightAccessoryWidth+"px",this._rightAccessory.style.overflow="visible"),this._containerContentElement.style.marginRight=this._rightAccessoryWidth+"px"}}_updateAccessoryViewBackground(e,t,i){this._linearGradientElement.appendChild(Bo.svgElement("stop",{offset:e+"%","stop-color":""+t})),this._linearGradientElement.appendChild(Bo.svgElement("stop",{offset:e+"%","stop-color":""+i})),this._bubbleElement.style.fill="url(#"+this._calloutId+")"}_setContentElement(e){this._updateAccessoryViews(),this._contentElement=e,this._containerContentElement.appendChild(Bo.htmlElement("div",e)),this._containerElementNode.classList.add(Y_),this._containerElement.className=this._containerElementNode.classList.toString();const t=this.delegate.sizeForElement(this._containerElement);t.height=Math.max(t.height,this._accessoryHeight),this._updateSize(t,!0)}_animateScale(){const e=this._scaleAnimationParameters[this._scaleAnimationParameterIndex],t=e[0],i=e[1],s=e[2],o=Date.now(),n=Math.min((o-this._scaleAnimationStartDate)/t,1),a=i+(s-i)*n;if(this._node.transform=(new ao).translate(this._scaleXOffset,this._scaleYOffset).scale(a).translate(-this._scaleXOffset,-this._scaleYOffset),1===n){if(++this._scaleAnimationParameterIndex,!(this._scaleAnimationParameterIndex<this._scaleAnimationParameters.length))return void this._finishAnimatingScale();this._scaleAnimationStartDate=o}Mt.scheduleOnNextFrame(this)}_finishAnimatingScale(){delete this._scaleXOffset,delete this._scaleYOffset,delete this._scaleAnimationStartDate,delete this._scaleAnimationParameterIndex}_animateFadeout(){const e=(Date.now()-this._fadeoutAnimationStartDate)/100,t=Math.max(0,1-e);0!==t?(this._node.opacity=t,Mt.scheduleOnNextFrame(this)):this._node.remove()}animateTailScale(e,t){const i=(new Date).getTime();t=t||0===t?t:500,this._tailAnimation={timeStart:i,timeEnd:i+t,valueStart:this._tailScale,valueEnd:e},this._animateTail()}_animateTail(){if(!this._tailAnimation)return;const e=(new Date).getTime(),t=this._tailAnimation.timeStart,i=this._tailAnimation.timeEnd,s=this._tailAnimation.valueStart,o=this._tailAnimation.valueEnd,n=i<=t?1:(e-t)/(i-t),a=Bo.easeInOut(c(n,0,1)),r=Bo.lerp(a,s,o),l=13*(r-this._tailScale);this._tailScale=r,this.setSize(new ls(this.node.size.width,this.node.size.height+l)),this._bubbleElement.setAttribute("d",Q_(this._bubbleSize,this._tailScale,this._tailShift)),e<i?Mt.scheduleOnNextFrame(this):this._tailAnimation=null}animateAnchorOffset(e,t){const i=(new Date).getTime();t=t||0===t?t:500,this._anchorOffsetAnimation={timeStart:i,timeEnd:i+t,startX:this._anchorOffset.x,startY:this._anchorOffset.y,endX:e.x,endY:e.y},this._animateAnchorOffset()}_animateAnchorOffset(){if(!this._anchorOffsetAnimation)return;const e=(new Date).getTime(),t=this._anchorOffsetAnimation.timeStart,i=this._anchorOffsetAnimation.timeEnd,s=this._anchorOffsetAnimation.startX,o=this._anchorOffsetAnimation.endX,n=this._anchorOffsetAnimation.startY,a=this._anchorOffsetAnimation.endY,r=i<=t?1:(e-t)/(i-t),l=Bo.easeInOut(c(r,0,1)),h=Bo.lerp(l,s,o),d=Bo.lerp(l,n,a);this._anchorOffset.x=h,this._anchorOffset.y=d,this.updatePosition(),e<i?Mt.scheduleOnNextFrame(this):this._anchorOffsetAnimation=null}getCenterOffset(e){const t=13*this._tailScale,i=this._node.size;return new cs(0,(t-i.height-(e?13:0))/2)}},sf="mk-selection-accessory-badge",of="mk-selection-accessory-badge-content",nf="mk-fade-out";const af=class extends sp{constructor(e,{place:t={},muid:i,coordinate:s,title:o}){super(),super.init(),this.style=pp.OpenInMaps,this.placeUrl=this._getPlaceUrl(t,i,s,o),this.delegate=e,this._node=new Lo.Node(Bo.htmlElement("div",{class:sf}));const n=this._node.element;this._containerElement=Bo.htmlElement("button",{role:"link",dir:"auto",type:"button",class:of}),this.handleLinkClickedListener=e=>this._handleLinkClicked(),this._containerElement.addEventListener("click",this.handleLinkClickedListener),this._containerElementNode=new Lo.Node(this._containerElement),this._handleLocaleChangedListener=e=>this._handleLocaleChanged(e),es.addEventListener(es.Events.LocaleChanged,this._handleLocaleChangedListener),this._textElement=this._containerElement.appendChild(Bo.htmlElement("span")),this._textElement.textContent=es.get("OpenInAppleMaps.Label"),n.appendChild(this._containerElement),this.setSize(this.delegate.sizeForElement(n)),this._node.wantsHardwareCompositing=!0,this.analyticsState={place_action_details:{businessID:t.muid||i}},this.delegate.placeCardDidReveal("SMALL",this.analyticsState)}get node(){return this._node}get boundingRect(){const e=this._node.position;return new us(e.x,e.y,this._node.size.width,this._node.size.height)}setPosition(e){e.y+=this._node.size.height,super.setPosition(e)}willMoveToMap(){}setAnchorOffset(e){this._anchorOffset=e?new window.DOMPoint(e.x,e.y):new window.DOMPoint}containsElement(e){return!!this._containerElement.contains(e)}isCustomCallout(){return!1}updateInfo(e,t){return!0}shiftTailBy(){return 0}animateIn(){}animateOut(e){!e&&this.visible||this._node.remove(),this._containerElementNode.classList.add(nf),setTimeout((()=>this._node.remove()),500)}mapNodeTintWasSet(e){}didRemoveFromParent(){this.delegate.accessoryNodeDidRemove(this),es.removeEventListener(es.Events.LocaleChanged,this._handleLocaleChangedListener),this._containerElement.removeEventListener("click",this.handleLinkClickedListener)}_getPlaceUrl(e={},t,i,s){const o=new URLSearchParams;return(e.name||s)&&o.append("name",e.name||s),(e.muid||t)&&o.append("place-id",dp({muid:e.muid||t})),e.formattedAddress&&o.append("address",e.formattedAddress),i=e.coordinate||i,o.append("coordinate",`${i.latitude},${i.longitude}`),`https://maps.apple.com/place?${o.toString()}`}_handleLinkClicked(){window.open(this.placeUrl,"_blank","noopener"),this.delegate.placeCardOpenInMapsClicked("SMALL",this.analyticsState)}_handleLocaleChanged(){this._textElement.textContent=es.get("OpenInAppleMaps.Label"),this.setSize(this.delegate.sizeForElement(this._containerElement))}animateTailScale(e,t){k()}animateAnchorOffset(e,t){k()}getCenterOffset(e){k()}},rf="mk-selection-accessories",lf="mk-selected";class hf{constructor(e){this.delegate=e,this._oldCenterMode=!1,this.node=new Lo.Node(Bo.htmlElement("div")),this.node.classList.add(rf),this._waitingForRegionChangeToEnd=0}get accessoryIsShown(){return!!this._accessory}getAccessoryBoundingRect(){if(this._accessory)return this._accessory.boundingRect}selectedAnnotationVisibilityDidChange(e){this._accessory?this._accessory.visible=e.visible:e.visible&&this.showAccessoryForAnnotation(e,!0)}isElementInAccessory(e){return!!this._accessory&&this._accessory.containsElement(e)}isElementInCustomCallout(e){return!!this._accessory&&this._accessory.isCustomCallout()&&this._accessory.node.element.contains(e)}showAccessoryForAnnotation(e,t){this.hideAccessory(e,t);const{showsSelectionAccessory:i,showsCallout:s,calloutDelegate:o,customCalloutElement:n,customCalloutContentElement:a}=this._canShowSelectionAccessoryForAnnotation(e);if(!i&&!s)return void e._impl.selectionAccessoryWillAppear(!1);e._impl.selectionAccessoryWillAppear(!0);let r=n;if(Bo.supportsShadowDOM&&r){const e="mk-slot-"+Math.random().toString(32).substring(2,10);r.slot=e;const t=Bo.htmlElement("slot");t.name=e,this.delegate.appendElementAssignedToSlot(r),r=t}if(s){const{ignoreCalloutCornerRadiusForLeftAccessory:t,leftAccessory:i,rightAccessory:s}=this._getCalloutPartElements(e,o);this._accessory=new tf(this,{customElement:r,contentElement:a,ignoreCalloutCornerRadiusForLeftAccessory:t,leftAccessory:this.delegate.rtl?s:i,rightAccessory:this.delegate.rtl?i:s,rtl:this.delegate.rtl})}else if(i){const t=e._impl.selectionAccessory.style;if(t===pp.OpenInMaps)this._accessory=new af(this,{place:e._impl.place,muid:e._impl.muid,coordinate:e.coordinate,title:e.title});else if(t===pp.CompactCallout||t===pp.FullCallout){const i=t===pp.CompactCallout;this._accessory=new C_(this,{place:e._impl.place,muid:e._impl.muid,uiStyle:i?"compact":"full",side:this._findSideForAccessorySize(i?C_.DEFAULT_COMPACT_SIZE:C_.DEFAULT_FULL_SIZE)||(this.delegate.rtl?"right":"left"),rtl:this.delegate.rtl})}else{k(t===pp.Automatic||pp.Callout);const i=this._findSideForAccessorySize(C_.DEFAULT_FULL_SIZE),s=this._findSideForAccessorySize(C_.DEFAULT_COMPACT_SIZE),o=i?"full":"compact",n=i||s;n||t===pp.Callout?this._accessory=new C_(this,{place:e._impl.place,muid:e._impl.muid,uiStyle:o,side:n||(this.delegate.rtl?"right":"left"),rtl:this.delegate.rtl}):this._accessory=new af(this,{place:e._impl.place,muid:e._impl.muid,coordinate:e.coordinate,title:e.title})}}else k();this._accessory.animates=!t&&(!o||"function"!=typeof o.calloutShouldAnimateForAnnotation||!!fe(o.calloutShouldAnimateForAnnotation,o,[e],!0));const l=r&&this._accessory.animates&&o&&"function"==typeof o.calloutAppearanceAnimationForAnnotation?fe(o.calloutAppearanceAnimationForAnnotation,o,[e],""):"";if(p(l,"string","[MapKit] calloutAppearanceAnimationForAnnotation() must return a string, but returned `"+l+"` instead."),this._accessory.appearanceAnimation=l,r){let t;o&&"function"==typeof o.calloutAnchorOffsetForAnnotation&&(t=fe(o.calloutAnchorOffsetForAnnotation,o,[e,this._accessory.node.size]),m(t,window.DOMPoint,"[MapKit] calloutAnchorOffsetForAnnotation() must return a DOMPoint, but returned `"+t+"` instead.")),this._accessory.setAnchorOffset(t)}if(this.updateAccessoryInfo(e),e===this.delegate.userLocationAnnotation){S(this.delegate.constructor.AccuracyRingOverlay);const e=this.delegate.constructor.AccuracyRingOverlay.getMode(this.delegate.map.worldSize,100);if(this._oldCenterMode=e,e){const e=this._accessory.getCenterOffset(!0);this._accessory.animateAnchorOffset(e,-1),this._accessory.animateTailScale(0,-1)}else this._accessory.animateAnchorOffset(new cs(0,0),-1),this._accessory.animateTailScale(1,-1)}this.updateAccessoryPositionWithTailShift(e,!1);const h=!t&&this._nudgeMapToShowAccessory();this._accessory.willMoveToMap(),this._accessory.node.classList.add(lf),this.node.addChild(this._accessory.node),this._accessory.appearanceAnimation&&this.node.element.appendChild(this._accessory.node.element),h||this._accessory.animateIn()}hideAccessory(e,t){e._impl.selectionAccessoryWillDisappear(),this._accessory&&(this._accessory.node.classList.remove(lf),this._accessory.animateOut(t),delete this._accessory)}updateCenterMode(){const e=this.delegate.selectedItem===this.delegate.userLocationAnnotation,t=this.delegate.constructor.AccuracyRingOverlay.getMode(this.delegate.map.worldSize,100),i=this._oldCenterMode!==t;if(this._oldCenterMode=t,this._accessory&&e&&i)if(this._accessory.animateTailScale(t?0:1),t){const e=this._accessory.getCenterOffset();e.y=e.y-this.delegate.userLocationAnnotation._impl._node.size.height/4,this._accessory.animateAnchorOffset(e)}else this._accessory.animateAnchorOffset(new cs(0,0))}sizeForElement(e){return this.delegate.sizeForElement(e)}backgroundColorForElement(e){return this.delegate.backgroundColorForElement(e)}setAnimationForElement(e,t,i){return this.delegate.setAnimationForElement(e,t,i)}annotationPropertyDidChange(){}accessorySizeDidChange(e){this._nudgeMapToShowAccessory()}accessoryNodeDidRemove(e){Bo.supportsShadowDOM&&(e.isCustomCallout()&&"slot"===e.customOrContentElement.localName&&this.delegate.removeElementAssignedToSlot(e.customOrContentElement),e.customLeftAccessory&&"slot"===e.customLeftAccessory.localName&&this.delegate.removeElementAssignedToSlot(e.customLeftAccessory),e.customRightAccessory&&"slot"===e.customRightAccessory.localName&&this.delegate.removeElementAssignedToSlot(e.customRightAccessory))}updateAccessoryPositionWithTailShift(e,t){if(this.delegate.selectedItem===e&&this._accessory)return this._accessory.setShown(e._impl.isShown()),this._accessory instanceof tf?this._accessory.setPosition(e._impl.positionForCallout()):this._accessory instanceof af?this._accessory.setPosition(e._impl.positionForSelectionAccessory("bottom",4)):(M(this._accessory),this._accessory.setPositionWithSide(e._impl.positionForSelectionAccessory(this._accessory.side,C_.TAIL_DISTANCE_TO_ANCHOR),this._accessory.side)),t?this.updateAccessoryTailShift(t):void 0}updateAccessoryInfo(e){this._accessory?this._accessory.updateInfo(e,12)||this.hideAccessory(e):this.showAccessoryForAnnotation(e)}updateAccessoryTailShift(e){if(!this._accessory)return!1;const t=e?this._accessory.boundingRect.pad(12):this._boundingRectForSelectedAnnotationAndAccessory().pad(12),i=this._totalMapNudgingTranslation(t,this.delegate.map.ensureVisibleFrame(),e),s=i.x,o=i.y,n=this._accessory.shiftTailBy(s);return 0!==s||0!==o?new cs(-(s+n),-o):void 0}get tint(){return k(this.delegate.map.tint),this.delegate.map.tint}mapNodeTintWasSet(e){this._accessory&&this._accessory.mapNodeTintWasSet(e)}mapRegionChangeWillStart(){this._waitingForRegionChangeToStart&&(this._nudgeStarted=!0,this._waitingForRegionChangeToEnd++)}mapRegionChangeDidEnd(){if(!this._waitingForRegionChangeToEnd)return;this._waitingForRegionChangeToEnd--;0!==this._waitingForRegionChangeToEnd&&this._nudgeMapToShowAccessory()?this._waitingForRegionChangeToEnd=1:(this._waitingForRegionChangeToEnd=0,this.updateAccessoryPositionWithTailShift(this.delegate.selectedItem,!0),this._accessory&&this._accessory.animateIn())}getMaximumSizeForAccessory(){k(this.delegate.selectedItem);const e=this.delegate.selectedItem._impl._node.size,t=this.delegate.map.ensureVisibleFrame().size.copy();return"left"===this._accessory.side||"right"===this._accessory.side?(t.width-=e.width+50+C_.TAIL_LENGTH+C_.TAIL_DISTANCE_TO_ANCHOR,t.height-=50):(t.width-=50,t.height-=e.height+50+C_.TAIL_LENGTH+C_.TAIL_DISTANCE_TO_ANCHOR),t}placeCardDidReveal(e,t){this.delegate.placeCardDidReveal(e,t)}placeCardOpenInMapsClicked(e,t){this.delegate.placeCardOpenInMapsClicked(e,t)}_findSideForAccessorySize(e){k(this.delegate.selectedItem);const t=this.delegate.selectedItem,i=t._impl._node,s=new us(i.position.x,i.position.y,i.size.width,i.size.height).round(),o=this.delegate.map.ensureVisibleFrame(),n=t._impl.positionForSelectionAccessory("left",C_.TAIL_DISTANCE_TO_ANCHOR).y,a=s.minX()-o.minX(),r=o.maxX()-s.maxX();if(n+e.height/2<o.maxY()&&n-e.height/2>o.minY()){const t=e.width<a,i=e.width<r;if(t&&i)return a===r?this.delegate.rtl?"right":"left":a>r?"left":"right";if(t)return"left";if(i)return"right"}const l=s.minY()-o.minY();if(e.height<l)return"top";const h=o.maxY()-s.maxY();return e.height<h?"bottom":o.size.width-s.size.width>e.width+C_.TAIL_LENGTH+C_.TAIL_DISTANCE_TO_ANCHOR?a>=r?"left":"right":o.size.height-s.size.height>e.height+C_.TAIL_LENGTH+C_.TAIL_DISTANCE_TO_ANCHOR?l>=h?"top":"bottom":null}_canShowSelectionAccessoryForAnnotation(e){const t=e._impl.place;if(e._impl.selectionAccessory&&(t&&t.name&&t.coordinate||e.title&&e._impl.muid&&e.coordinate))return e._impl.canShowSelectionAccessory()?{showsSelectionAccessory:!0}:{showsSelectionAccessory:!1,showsCallout:!1};if(!e._impl.canShowCallout())return{showsSelectionAccessory:!1,showsCallout:!1};const i=e._impl.callout;if(i&&"function"==typeof i.calloutShouldAppearForAnnotation&&!fe(i.calloutShouldAppearForAnnotation,i,[e],!0))return{showsSelectionAccessory:!1,showsCallout:!1};let s;let o;i&&"function"==typeof i.calloutElementForAnnotation&&(s=fe(i.calloutElementForAnnotation,i,[e]),le(s,"[MapKit] calloutElementForAnnotation() must return a DOM element, but returned `"+s+"` instead."));let n=!1;if(!s){if(n=i&&"function"==typeof i.calloutContentForAnnotation,n&&(o=fe(i.calloutContentForAnnotation,i,[e]),le(o,"[MapKit] contentElementForAnnotation() must return a DOM element, but returned `"+o+"` instead."),Bo.supportsShadowDOM)){const e="mk-slot-"+Math.random().toString(32).substring(2,10);o.slot=e;const t=Bo.htmlElement("slot");t.name=e,this.delegate.appendElementAssignedToSlot(o),o=t}if(!n&&!e.title)return{showsSelectionAccessory:!1,showsCallout:!1}}return{showsSelectionAccessory:!1,showsCallout:!0,calloutDelegate:i,customCalloutElement:s,customCalloutContentElement:o}}_getCalloutPartElements(e,t){let i;const s=t&&"function"==typeof t.calloutLeftAccessoryForAnnotation;if(s&&(i=fe(t.calloutLeftAccessoryForAnnotation,t,[e]),le(i,"[MapKit] calloutLeftAccessoryForAnnotation() must return a DOM element, but returned `"+i+"` instead."),Bo.supportsShadowDOM)){const e="mk-slot-"+Math.random().toString(32).substr(2,8);i.slot=e;const t=Bo.htmlElement("slot");t.name=e,this.delegate.appendElementAssignedToSlot(i),i=t}let o;const n=t&&"function"==typeof t.calloutRightAccessoryForAnnotation;if(n&&(o=fe(t.calloutRightAccessoryForAnnotation,t,[e]),le(o,"[MapKit] calloutRightAccessoryForAnnotation() must return a DOM element, but returned `"+o+"` instead."),Bo.supportsShadowDOM)){const e="mk-slot-"+Math.random().toString(32).substring(2,10);o.slot=e;const t=Bo.htmlElement("slot");t.name=e,this.delegate.appendElementAssignedToSlot(o),o=t}const a=e._impl.ignoreCalloutCornerRadiusForLeftAccessory&&!s&&!n;return!s&&e._impl.canvasForCalloutAccessory&&(i=e._impl.canvasForCalloutAccessory()),{ignoreCalloutCornerRadiusForLeftAccessory:a,leftAccessory:i,rightAccessory:o}}_boundingRectForSelectedAnnotationAndAccessory(){const e=this.getAccessoryBoundingRect(),t=this.delegate.selectedItem._impl.position(),i=Math.min(e.minX(),t.x),s=Math.min(e.minY(),t.y),o=Math.max(e.maxX(),t.x)-i,n=Math.max(e.maxY(),t.y)-s;return new us(i,s,o,n)}_translationToFitInFrame(e,t){const i={x:0,y:0};return(e.maxX()>t.maxX()||e.minX()<t.minX()||e.maxY()>t.maxY()||e.minY()<t.minY())&&(i.x=e.minX()<t.minX()?e.minX()-t.minX():e.maxX()>t.maxX()?e.maxX()-t.maxX():0,i.y=e.minY()<t.minY()?e.minY()-t.minY():e.maxY()>t.maxY()?e.maxY()-t.maxY():0),i}_totalMapNudgingTranslation(e,t,i){const s=this._translationToFitInFrame(e,t),o=this.delegate.map.getControlBounds(),n=t.midX(),a=t.midY();let r=0,l=0;return e=cf(e,s.x,s.y),o.forEach((t=>{if(e.minX()<t.maxX()&&e.maxX()>t.minX()&&e.minY()<t.maxY()&&e.maxY()>t.minY()){if(r+=t.maxX()<n?e.minX()-t.maxX():e.maxX()-t.minX(),l+=t.maxY()<a?e.minY()-t.maxY():e.maxY()-t.minY(),i)return;0!==l&&Math.abs(r)>Math.abs(l)?r=0:l=0,e=cf(e,r,l)}}),this),s.x+=r,s.y+=l,s}_nudgeMapToShowAccessory(){if(this.delegate.map.cameraIsMoving)return this._waitingForRegionChangeToEnd++,!0;if(!this.delegate.selectedItem||!this.delegate.selectedItem._impl.isShown())return!1;const e=this.updateAccessoryPositionWithTailShift(this.delegate.selectedItem,!0);if(!e)return!1;this._waitingForRegionChangeToStart=!0,this.delegate.map.translateCameraAnimated(e,!0);const t=this._nudgeStarted;return delete this._nudgeStarted,this._waitingForRegionChangeToStart=!1,t}}function cf(e,t,i){return new us(e.origin.x-t,e.origin.y-i,e.size.width,e.size.height)}function df(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const uf=Li.MapRect,pf="mk-annotation-container",mf="mk-annotations",gf="mk-dragging",_f="mk-selected",ff="mk-lifted",yf="mk-text-zoom";let vf=null;class bf extends Ud{constructor(e){super(e),df(this,"itemConstructor",Tp),df(this,"itemName","annotation"),df(this,"capitalizedItemName","Annotation"),df(this,"_rtl",!1),df(this,"_selectionDistance",Math.pow(this._selectionDistance,2)),df(this,"_userLocationAnnotation",null),this._pendingAnnotations=[],this._mapFeatureAnnotationController=new Pg(this),this._clustersController=new Yg(this),es.activeLocale&&(this._rtl=es.activeLocale.rtl),this._node=new Lo.Node(Bo.htmlElement("div",{class:pf})),es.activeLocale&&this._node.element.setAttribute("lang",es.localeId),this._shadowDOMSlotController=new e_(this._node);const t=Bo.htmlElement("div",{class:mf});this._sceneGraphNode=new Xg(t),this._shadowRootNode=Bo.addShadowRootChild(this._node,Ze.shadowDOMMode,':host(.mk-annotation-container.mk-dragging) ::selection,div.mk-annotations ::selection{background:0 0}.mk-invisible{opacity:0;pointer-events:none}.mk-hidden{display:none}div.mk-annotations,div.mk-annotations>div,div.mk-selection-accessories,div.mk-style-helper{position:absolute;top:0;left:0}.mk-selected{z-index:1}.mk-lifted{z-index:2}.mk-callout,.mk-selection-accessory{position:absolute;top:0;left:0;-webkit-user-select:auto;-moz-user-select:text;-ms-user-select:text}.mk-callout:not(.mk-invisible),.mk-selection-accessory:not(.mk-invisible){pointer-events:auto}:host(.mk-annotation-container) .mk-selection-accessory,:host(.mk-annotation-container) .mk-selection-accessory-badge{font:16px sans-serif;--font-size-default:16}:host(.mk-dark-mode) .mk-callout,:host(.mk-dark-mode) .mk-selection-accessory{color:#fff}:host(.mk-annotation-container.mk-text-zoom) .mk-selection-accessory,:host(.mk-annotation-container.mk-text-zoom) .mk-selection-accessory-badge{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-annotation-container.mk-text-zoom) .mk-selection-accessory,:host(.mk-annotation-container.mk-text-zoom) .mk-selection-accessory-badge{font:-apple-system-body;--font-size-default:17}}.mk-callout>*{position:absolute;top:0;left:0}svg.mk-bubble{display:block;width:100%;height:100%}svg.mk-selection-accessory-bubble{position:absolute;display:block;filter:drop-shadow(0 0 5px rgb(0 0 0 / 30%))}div.mk-callout-accessory{position:absolute;top:50%;transform:translateY(-50%);overflow:hidden}div.mk-callout-accessory-content{white-space:nowrap;position:relative;text-align:center;font-size:12px}div.mk-callout-accessory:first-child{left:0}div.mk-callout-accessory:last-child{right:0}div.mk-callout-accessory:first-child .mk-callout-accessory-content{padding-right:8px}div.mk-callout-accessory:last-child .mk-callout-accessory-content{padding-left:8px}div.mk-standard{font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif;box-sizing:border-box;position:relative}:host(.mk-annotation-container) .mk-standard-content{font:16px sans-serif;--font-size-default:16}:host(.mk-annotation-container.mk-text-zoom) .mk-standard-content{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-annotation-container.mk-text-zoom) .mk-standard-content{font:-apple-system-body;--font-size-default:17}}div.mk-selection-accessory-content{box-sizing:border-box;position:relative;overflow:auto;color-scheme:light;top:0;left:0;border-radius:18px}div.mk-selection-accessory-content.mk-rtl{direction:rtl}.mk-ui-style-compact div.mk-selection-accessory-content{overflow:hidden}:host(.mk-dark-mode) div.mk-selection-accessory-content{color-scheme:dark}:host(.mk-panning) div.mk-selection-accessory-content{pointer-events:none}.mk-ui-style-compact div.mk-selection-accessory-content>div{width:243px}div.mk-custom-content,div.mk-standard{transform:translateY(-50%)}div.mk-standard .mk-callout-content>div{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}div.mk-standard .mk-callout-content{padding:0 4px}.mk-callout-content.mk-rtl{direction:rtl}.mk-callout-content.mk-rtl *{text-align:right}div.mk-callout-accessory:first-child+.mk-callout-content{padding-left:8px}div.mk-standard .mk-callout-content:nth-last-child(2){padding-right:8px}div.mk-standard .mk-title{font-size:calc(100% * 17 / var(--font-size-default));font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:500;color:#000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;letter-spacing:.025em}:host(.mk-dark-mode) div.mk-standard .mk-title{color:#fff}div.mk-standard .mk-subtitle{font-size:calc(100% * 13 / var(--font-size-default));font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif;color:rgb(0 0 0 / 70%);letter-spacing:.025em}:host(.mk-dark-mode) div.mk-standard .mk-subtitle{color:rgb(255 255 255 / 70%)}svg.mk-bubble path{fill:white;stroke:rgb(0 0 0 / 20%)}svg.mk-selection-accessory-bubble path{fill:rgb(239 239 239);stroke:rgb(239 239 239 / 70%);stroke-width:2px}:host(.mk-dark-mode) svg.mk-bubble path{fill:#3e3e3e;stroke:rgb(0 0 0 / 50%)}:host(.mk-dark-mode) svg.mk-selection-accessory-bubble path{fill:rgb(54 54 54);stroke:rgb(54 54 54 / 70%);stroke-width:2px}.mk-selection-accessory-loading{display:block;width:100%;height:100%}.mk-selection-accessory-failed{display:flex;height:100%;align-items:center;justify-content:center;color:#000;opacity:.55;font-family:-apple-system-font,"Helvetica Neue",Helvetica,Arial,sans-serif}:host(.mk-dark-mode) .mk-selection-accessory-failed{color:#fff}.mk-selection-accessory-failed .mk-failed-labels{padding:0 20px}.mk-ui-style-compact .mk-selection-accessory-failed .mk-failed-labels{flex-grow:1}.mk-selection-accessory-failed p{margin:0;font-size:calc(100% * 12 / var(--font-size-default));font-weight:400}.mk-ui-style-full .mk-selection-accessory-failed p{margin:2px 0;text-align:center}.mk-selection-accessory-failed p:first-child{font-size:calc(100% * 14 / var(--font-size-default));font-weight:500}.mk-ui-style-compact .mk-selection-accessory-failed p:first-child{margin-top:10px}.mk-ui-style-compact .mk-selection-accessory-failed p:last-child{margin-bottom:10px}.mk-ui-style-full .mk-selection-accessory-failed p:first-child{margin-top:60px}.mk-ui-style-full .mk-selection-accessory-failed p:last-child{margin-bottom:60px}.mk-selection-accessory-badge-content{cursor:pointer;padding:4px 8px;font-size:calc(100% * 13 / var(--font-size-default));font-family:13px -apple-system-font,HelveticaNeue-Medium,Helvetica,Arial,sans-serif;font-weight:500;border:1px solid rgb(0 0 0 / 10%);border-radius:13px;color:#007aff;background-color:rgb(255 255 255);box-shadow:0 0 5px 0 rgb(0 0 0 / 30%);animation:fade-in .5s}.mk-selection-accessory-badge-content.mk-fade-out{transition:visibility .5s,opacity .5s;opacity:0;visibility:hidden}.mk-selection-accessory-badge-content span{opacity:.8}.mk-selection-accessory-badge-content:hover span{opacity:1}.mk-selection-accessory-badge-content:active{background-color:rgb(229 229 229)}.mk-selection-accessory-badge-content:focus-visible{outline:0;background-color:rgb(204 229 255);box-shadow:0 0 5px 0 rgb(0 0 0 / 30%),0 0 0 2px rgb(0 124 255)}.mk-selection-accessory-badge-content:active:focus-visible{background-color:rgb(127 189 255)}@keyframes fade-in{from{opacity:0}to{opacity:1}}:host(.mk-dark-mode) .mk-selection-accessory-badge-content{color:#0a84ff;background-color:rgb(54 54 54)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:active{background-color:rgb(42 42 42)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:focus-visible{background-color:rgb(12 49 89)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:active:focus-visible{color:#64b1ff;background-color:rgb(3 102 207)}@supports ((backdrop-filter:blur(30px)) or (-webkit-backdrop-filter:blur(30px))){.mk-selection-accessory-badge-content{-webkit-backdrop-filter:blur(30px);backdrop-filter:blur(30px);background-color:rgb(255 255 255 / 75%)}.mk-selection-accessory-badge-content:active{background-color:rgb(229 229 229 / 60%)}.mk-selection-accessory-badge-content:focus-visible{background-color:rgb(204 229 255 / 60%)}.mk-selection-accessory-badge-content:active:focus-visible{background-color:rgb(127 189 255 / 60%)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content{background-color:rgb(18 18 18 / 60%)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:active{background-color:rgb(42 42 42 / 60%)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:focus-visible{background-color:rgb(12 49 89 / 60%)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:active:focus-visible{background-color:rgb(3 102 207 / 60%)}}',Ze.nonce),this._annotationsNode=this._shadowRootNode.addChild(new Lo.Node(t)),this._selectionAccessoryController=new hf(this),this._shadowRootNode.addChild(this._selectionAccessoryController.node),this._styleHelper=new $g(this),this._shadowRootNode.addChild(new Lo.Node(this._styleHelper.element)),this._annotationDraggingMapPanningController=new Ju(e),this.textZoom=e.textZoom}get sceneGraphNode(){return this._sceneGraphNode}isItemExposed(e){return e!==this._userLocationAnnotation&&!e.memberAnnotations}get map(){return this._map}get userLocationAnnotation(){return this._userLocationAnnotation}get dragging(){return!!this._draggedAnnotation}get rtl(){return this._rtl}set rtl(e){this._rtl!==e&&(this._rtl=e,this._selectedItem&&this._selectionAccessoryController.accessoryIsShown&&this._selectionAccessoryController.showAccessoryForAnnotation(this._selectedItem,!0))}get textZoom(){return this._node.classList.contains(yf)}set textZoom(e){this._node.classList.toggle(yf,e)}preAddedAnnotation(e){if(!e._impl.updatedPosition())return!1;const t=!e.map,i=Bo.supportsShadowDOM&&this._annotationsNode&&e._impl.renderedByDOMElement&&!e.element.parentNode;return i&&this._shadowDOMSlotController.appendAssignedElement(e.element,!1),t&&e._impl.setDelegate(this),t||i}resetAnnotation(e){Bo.supportsShadowDOM&&this._annotationsNode&&e._impl.renderedByDOMElement&&e.element.parentNode&&this._shadowDOMSlotController.removeAssignedElement(e._impl.elementInAnnotationDOM,!1),-1===this._items.indexOf(e)&&(e._impl.delegate=null)}addItems(e){e=super.addItems(e);if(this._shouldAnnotationBePending())return e;e.sort(((e,t)=>t.coordinate.latitude-e.coordinate.latitude));const t=this._map.camera.toMapRect(),i=t.size.width,s=t.size.height,o=t.origin.x-i,n=o+3*i,a=t.origin.y-s,r=a+3*s;let l=0;e.forEach((e=>{if(e._impl.doesAnimate()&&e.visible){e._impl.x+(e._impl.x<o?1:0)<=n&&e._impl.y>=a&&e._impl.y<=r&&(e._impl.delayRank=l,++l)}}));const h=Math.min(50*l,3e3),c=0===l?0:h/l;return e.forEach((e=>{e._impl.delayMs=e._impl.delayRank*c,delete e._impl.delayRank}),this),e}addWaitingAnnotations(e){const t="function"==typeof e;this._waitingAnnotations?(t&&(this._completionCallback=e),window.clearTimeout(this._tileLoadingTimeout),delete this._tileLoadingTimeout,this._waitingAnnotations.forEach((function(e){e.map&&this._addAnnotationWaitingForTiles(e,!1,!t)}),this),this._updateSceneGraph(),delete this._waitingAnnotations,Mt.scheduleOnNextFrame((()=>this._checkCompletion()))):t&&e()}annotationsInMapRect(e){m(e,uf,"[MapKit] Map.annotationsInMapRect expects a MapRect as its argument, got `"+e+"` instead.");const t=l(e.origin.x,1),i=t+e.size.width,s=e.origin.y,o=s+e.size.height;return this._items.filter((function(e){if(!this.isItemExposed(e))return!1;const n=e._impl.x+(e._impl.x<t?1:0),a=e._impl.y;return n>=t&&n<=i&&a>=s&&a<=o}),this)}removeItem(e){return e===this._userLocationAnnotation?(console.warn("[MapKit] Map.removeAnnotation: the user location annotation cannot be removed. Set showsUserLocation to false instead."),e):super.removeItem(e)}removeUserLocationAnnotation(){this._userLocationAnnotation&&(this._userLocationAnnotation._impl.removedFromMap(),super.removeAnyItem(this._userLocationAnnotation),delete this._userLocationAnnotation)}updateUserLocationAnnotation(e,t){if(!e.coordinate)return;S(bf.UserLocationAnnotation),S(bf.UserLocationAnnotation);const i=this._userLocationAnnotation||new bf.UserLocationAnnotation(e);if(this._userLocationAnnotation||(this._userLocationAnnotation=i,this.addItem(i,0)),e.stale)return delete this._lastGeocoderRequestCoordinate,delete this._lastUserLocationAnnotationSubtitle,void(i._impl.stale=!0);if(i._impl.stale=!1,i._impl.setCoordinate(e.coordinate),vf){if(!t&&this._lastGeocoderRequestCoordinate&&this._lastGeocoderRequestCoordinate.latitude===i._impl.coordinate.latitude&&this._lastGeocoderRequestCoordinate.longitude===i._impl.coordinate.longitude)return void(this._userLocationAnnotation.subtitle=this._lastUserLocationAnnotationSubtitle)}else vf=new bf.Geocoder;this._lastGeocoderRequestCoordinate=i._impl.coordinate.copy(),wf(vf,i,this)}mapSizeDidUpdate(){if(0===this._pendingAnnotations.length)return;const e=this._map.shouldWaitForTilesAndControls();this._pendingAnnotations.forEach((function(t){t._impl.isPending&&this._addAnnotationWaitingForTiles(t,e)}),this),this._updateSceneGraph(),this._pendingAnnotations=[]}updateVisibleAnnotations(){0!==this._items.length&&(this._updateVisibleAnnotations(this._items),this._updateSceneGraph())}startDraggingAnnotation(e,t){this._map.annotationDraggingWillStart(),this._draggedAnnotation=e,this._pendingDragStart=!0,e.selected&&this._selectionAccessoryController.hideAccessory(e),this._node.classList.add(gf),this._draggedAnnotation._impl.node.classList.add(ff),this._draggedAnnotation._impl.lift(),this._updateSceneGraph()}mapNodeTintWasSet(e){this._items.forEach((e=>{e._impl.updateLayout()})),this._selectionAccessoryController.mapNodeTintWasSet(e)}mapTypeDidChange(){this._mapFeatureAnnotationController.mapTypeDidChange()}fontSizeDidChange(){this._items.forEach((e=>{e._impl.updateLayout(!1,!0)}))}devicePixelRatioDidChange(){this._items.forEach((e=>{"function"==typeof e._impl.updateGlyphImages&&e._impl.updateGlyphImages()}))}styleHelperNodeDidMoveToParent(e){if(!Bo.supportsShadowDOM)return;const t=e.assignedNodes?e:e.querySelector("slot"),i=t&&this._shadowDOMSlotController.getAssignedElement(t);t&&i&&i.parentNode&&0===t.assignedNodes().length&&(this._node.element.removeChild(i),this._node.element.appendChild(i))}getShadowDOMTargetFromEvent(e){if(this._shadowRootNode.domNode)return Bo.getShadowDOMTargetFromEvent(this._shadowRootNode.domNode,e)}performScheduledUpdate(){this.dispatchDraggingEvent()}dispatchDraggingEvent(){if(!this._draggedAnnotation||this._mapWasDestroyed)return;const e=this._draggedAnnotation._impl.dispatchDraggingEvent();this._map.dispatchEventWithAnnotation(e.type,this._draggedAnnotation,{coordinate:e.coordinate})}addedItem(e,t){for(const t of e._impl.getMuidList())this.map.setPoiFiltered(t,!0);super.addedItem(e,t),e._impl.isWaiting=!0,t&&(e._impl.delayRank=0);const i=this._shouldAnnotationBePending(e);i&&(e._impl.isPending=!0,this._pendingAnnotations.push(e)),this._updateAnnotation(e),e._impl.selected&&this._didSelectAnnotation(e),i||this._addAnnotationWaitingForTiles(e,this._map.shouldWaitForTilesAndControls())}manyItemsAdded(e){this._updateSceneGraph()}removedItem(e,t){for(const t of e._impl.getMuidList())this.map.setPoiFiltered(t,!1);delete e._impl.wasCollided,"function"==typeof e._impl.node.remove&&(Bo.supportsShadowDOM&&e._impl.node.parent&&this._shadowDOMSlotController.removeAssignedElement(e._impl.elementInAnnotationDOM,!e._impl.renderedByDOMElement),e._impl.node.remove()),super.removedItem(e),e._impl.labelRegion&&this._removeLabelRegionForAnnotation(e),t||this._updateVisibleAnnotations([e]),this._clustersController.removedAnnotation(e),e.memberAnnotations||this._updateCollisions(this._items)}manyItemsRemoved(e){this._updateVisibleAnnotations(this.items),this._updateSceneGraph()}manyItemsChanged(e){this._updateVisibleAnnotations(this.items),this._updateSceneGraph()}removedReferenceToMap(){this._userLocationAnnotation&&this._userLocationAnnotation._impl.removedFromMap()}pickableItemsCloseToPoint(e,t){const i=e.filter((function(e,i){const s=e._impl.distanceToPoint(t);return s<=this._selectionDistance&&(e._impl.distance=s,e._impl.index=i,!0)}),this).sort(((e,t)=>e._impl.distance-t._impl.distance||t._impl.index-e._impl.index));return i.forEach((e=>{delete e._impl.distance,delete e._impl.index})),i}annotationDraggingDidChange(e){this._draggedAnnotation&&!this._draggedAnnotation._impl.shouldPreventDrag&&(this._pendingDragStart&&(delete this._pendingDragStart,this._draggedAnnotation._impl.draggingDidStart(),this._map.dispatchEventWithAnnotation(kp.Events.DragStart,this._draggedAnnotation)),Mt.scheduleASAP(this),this._draggedAnnotation._impl.setDraggingTranslationForMapFrameSize(e,this._map.ensureRenderingFrame().size),this._annotationDraggingMapPanningController.update(this._draggedAnnotation,this._draggedAnnotation._impl.node))}annotationDraggingDidEnd(e){this._draggedAnnotation&&(this._annotationDraggingMapPanningController.stop(),this._draggedAnnotation._impl.dropAfterDraggingAndRevertPosition(!e),this._draggedAnnotation._impl.node.classList.remove(ff),this._node.classList.remove(gf),this._map.annotationDraggingDidEnd(),this._map.dispatchEventWithAnnotation(kp.Events.DragEnd,this._draggedAnnotation),delete this._draggedAnnotation,this._updateSceneGraph())}annotationPropertyDidChange(e,t){switch(t){case"selected":e.selected?this._didSelectAnnotation(e):this._didDeselectAnnotation(e);break;case"coordinate":if(!e._impl.updatedPosition())return;break;case"":case"displayPriority":case"collisionMode":case"clusteringIdentifier":case"padding":break;case"calloutOffset":0,this._selectionAccessoryController.updateAccessoryPositionWithTailShift(e,!0);break;case"selectionAccessoryOffset":0;break;case"visible":this._selectedItem===e&&this._selectionAccessoryController.selectedAnnotationVisibilityDidChange(e),e._impl.needsColliding=!0;break;case"draggable":this._draggedAnnotation!==e||e.draggable||this._map.stopDraggingAnnotation();break;case"title":case"subtitle":this._selectedItem===e&&(this._selectionAccessoryController.updateAccessoryInfo(e),this._selectionAccessoryController.updateAccessoryTailShift());break;default:k()}e.map&&e.map===this._map.public&&(this._annotationsDidChangeSinceLastCollision=!0,this._updateVisibleAnnotations([e]),this._updateSceneGraph(),this._updateLabelRegionForAnnotation(e))}mapForAnnotation(e){return this._map?this._map.public:null}sizeForElement(e){if(this._map.isRooted())return this._styleHelper.sizeForElement(e)}backgroundColorForElement(e,t){return this._styleHelper.backgroundColorForElement(e,t)}setAnimationForElement(e,t,i){return this._styleHelper.setAnimationForElement(e,t,i)}selectedAnnotationDidMoveToMap(e){this._updateSceneGraph(),this._selectionAccessoryController.showAccessoryForAnnotation(e)}supportsLabelRegions(){return this._map.supportsLabelRegions()}annotationFinishedAnimating(e){this._checkCompletion()}isElementInAccessory(e){return this._selectionAccessoryController.isElementInAccessory(e)}isElementInCustomCallout(e){return this._selectionAccessoryController.isElementInCustomCallout(e)}mapPanningDuringAnnotationDrag(){this.dispatchDraggingEvent()}mapSupportForLabelRegionsAdded(){this._items.forEach((e=>{e._impl.updateLayout(),this._updateLabelRegionForAnnotation(e)}))}mapSupportForLabelRegionsUpdated(){this.mapSupportForLabelRegionsAdded()}mapSupportForLabelRegionsRemoved(){this._items.forEach((e=>{delete e._impl.labelRegion}))}containsMarkerAnnotation(){return this._items.some((e=>"string"==typeof e.glyphText))}paddingForAnnotation(e){let t=0,i=0;e.size?(t=e.size.width,i=e.size.height):console.warn("[MapKit] Computing padding for showItems() when an annotation was not yet added the DOM can cause the annotation to not be entirely visible. The `size` property of the annotation can be changed to ensure that it shows up properly.");const s={top:e._impl._anchorPoint.y,right:t-e._impl._anchorPoint.x,bottom:i-e._impl._anchorPoint.y,left:e._impl._anchorPoint.x};if(e===this.selectedItem&&this._selectionAccessoryController.accessoryIsShown){const t=this._selectionAccessoryController.getAccessoryBoundingRect(),i=e._impl.position();s.top=Math.max(s.top,i.y-t.minY()),s.right=Math.max(s.right,t.maxX()-i.x),s.bottom=Math.max(s.bottom,t.maxY()-i.y),s.left=Math.max(s.left,i.x-t.minX())}return s}appendElementAssignedToSlot(e){this._shadowDOMSlotController.appendAssignedElement(e)}removeElementAssignedToSlot(e){this._shadowDOMSlotController.removeAssignedElement(e)}mapFeatureRegionCloseToPoint(e,t){if(!t.length)return;let i,s,o=1/0;for(const n of t){const t=new Li.MapPoint(n.position[0],n.position[1]);this.map.wrapMapPointToViewport(t);const a=this.map.camera.transformMapPoint(t);for(const t of n.rects){const r=t.size,l=a.x+t.offset[0],h=a.y+t.offset[1];if(l<e.x&&e.x<l+r[0]&&h<e.y&&e.y<h+r[1]){i=n;break}const c=l,d=c+r[0],u=c-e.x,p=d-e.x,m=u<=0&&p>=0?0:Math.min(Math.abs(u),Math.abs(p)),g=h,_=g+r[1],f=g-e.y,y=_-e.y,v=f<=0&&y>=0?0:Math.min(Math.abs(f),Math.abs(y)),b=m*m+v*v;o>b&&(o=b,s=n)}if(i)break;if(n.circles&&n.circles.length){const t=this.map.ensureRenderingFrame().size.height;for(const a of n.circles){const r=a.x,l=t-a.y,h=a.radius,c=Math.abs(e.x-r),d=Math.abs(e.y-l),u=c*c+d*d;if(u<h*h){i=n;break}o>u&&(o=u,s=n)}}if(i)break}return i||(s&&o<this._selectionDistance?s:void 0)}getMapFeatureAnnotationForRegion(e,t){return this._mapFeatureAnnotationController.getMapFeatureAnnotationForRegion(e,t)}mapFeatureDidSelect(e){this._mapFeatureAnnotationController.mapFeatureDidSelect(e)}mapRegionChangeWillStart(){this._selectionAccessoryController.mapRegionChangeWillStart()}mapRegionChangeDidEnd(){this._selectionAccessoryController.mapRegionChangeDidEnd()}localeChanged(){this._node.setAttribute("lang",es.localeId),this.rtl=es.activeLocale.rtl}placeCardDidReveal(e,t){this._map.annotationPlaceSelectionAccessoryDidReveal(e,t)}placeCardOpenInMapsClicked(e,t){this._map.annotationPlaceSelectionAccessoryOpenInMapsClicked(e,t)}_addAnnotationToMapAsync(e){this._addAnnotationToMap(e,!1),this._updateSceneGraph()}_addAnnotationToMap(e,t){if(this._shouldAnnotationBePending())return void(e._impl.isPending=!0);Bo.supportsShadowDOM&&this._annotationsNode&&this._shadowDOMSlotController.appendAssignedElement(e.element,!e._impl.renderedByDOMElement),e._impl.willMoveToMap(e._impl.canAnimate&&!t),delete e._impl.timeout,delete e._impl.isWaiting,delete e._impl.canAnimate,delete e._impl.delayMs;const i=this._items.indexOf(e);this._annotationsNode&&this._annotationsNode.addChild(e._impl.node,i),e._impl.sceneGraphNode&&this._sceneGraphNode.addChild(e._impl.sceneGraphNode,i),this._updateAnnotation(e),e.selected&&this._selectionAccessoryController.showAccessoryForAnnotation(e),this._updateLabelRegionForAnnotation(e),e._impl.didMoveToMap()}_addAnnotationWaitingForTiles(e,t,i){if("canAnimate"in e._impl||(e._impl.canAnimate=!e._impl.isPending),delete e._impl.isPending,t&&e!==this._userLocationAnnotation){if(!this._items.some((e=>e!==this._userLocationAnnotation&&e._impl.mayBeDrawn())))return void(this._waitingAnnotations?this._waitingAnnotations.push(e):(this._waitingAnnotations=[e],this._tileLoadingTimeout=window.setTimeout((()=>this.addWaitingAnnotations(r)),3e3)))}!i&&e._impl.doesAnimate()&&e._impl.delayMs>0?e._impl.timeout=window.setTimeout((()=>this._addAnnotationToMapAsync(e)),e._impl.delayMs):this._addAnnotationToMap(e,i)}_didDeselectAnnotation(e){e._impl.node.classList.remove(_f),this.selectedItem=null,this._selectionAccessoryController.hideAccessory(e),this._map.annotationSelectionDidChange(e),this._mapFeatureAnnotationController.annotationSelectionDidChange(e)}_didSelectAnnotation(e){e._impl.node.classList.add(_f),this.selectedItem=e,this._map.annotationSelectionDidChange(e),this._mapFeatureAnnotationController.annotationSelectionDidChange(e),e._impl.visible&&this._selectionAccessoryController.showAccessoryForAnnotation(e)}_shouldAnnotationBePending(){return!this._map.isRooted()}mapWasDestroyed(){super.mapWasDestroyed(),this._annotationDraggingMapPanningController&&this._annotationDraggingMapPanningController.mapWasDestroyed(),this._clustersController.mapWasDestroyed(),this._mapWasDestroyed=!0}_updateLabelRegionForAnnotation(e){const t=e._impl;if(!t.shouldHideLabels)return;t.labelRegion||(t.labelRegion=this._map.createLabelRegion());const i=t.labelRegion;if(i){const e=t.node.size,s=e.width,o=e.height;i.x=null==t.visibleX?t.x:t.visibleX,i.y=1-t.y,i.width=s,i.height=o,i.xOffset=s/2-t._anchorPoint.x-t._anchorOffset.x,i.yOffset=t._anchorPoint.y+t._anchorOffset.y-o/2,this._map.updatedLabelRegion()}}_removeLabelRegionForAnnotation(e){this._map.unregisterLabelRegion(e._impl.labelRegion),delete e._impl.labelRegion}_updateVisibleAnnotations(e,t){t||this._deletePreviousPointForPickingItem();const i=this._userLocationAnnotation,s=this._map;if(i){0,S(bf.AccuracyRingOverlay);const e=bf.AccuracyRingOverlay.getMode(s.worldSize);i._impl.isRingMode=e,this._selectionAccessoryController.updateCenterMode()}const o=s.camera.toRenderingMapRect(),n=o.size.width,a=Math.min(1.5*n,.5),r=o.midX(),l=o.size.height,h=o.minY()-l,c=h+3*l;e.forEach((function(e){if(e===this._draggedAnnotation&&this._annotationDraggingMapPanningController.panning)return;let t=NaN;const i=e._impl.y;if(n>0&&l>0&&i>=h&&i<=c){const i=e._impl.x,o=e.anchorOffset.x/s.worldSize;let n=a;for(let e=-1;e<=1;++e){const s=Math.abs(i-o+e-r);s<n&&(n=s,t=i+e)}}isNaN(t)?e._impl.setShown(!1):(e._impl.isShown()||e!==this._selectedItem||this._selectionAccessoryController.showAccessoryForAnnotation(e,!0),e._impl.setShown(!0),e._impl.setPosition(s.adjustMapItemPoint(s.camera.transformMapPoint(new cs(t,i)))),e._impl.visibleX!==t&&(e._impl.visibleX=t,this._updateLabelRegionForAnnotation(e)))}),this),this._selectionAccessoryController.updateAccessoryPositionWithTailShift(this._selectedItem,!0),t||this._updateCollisions(e)}_updateCollisions(e){let t=!1;const i=this._items.filter((e=>{const i=e.visible&&e._impl.isShown(),s=i||e._impl.needsColliding;return delete e._impl.needsColliding,s&&(e.displayPriority<Tp.DisplayPriority.Required||e.clusteringIdentifier)&&(t=!0),s&&i&&!e.memberAnnotations}),this);if(t){const e=this._map;this._clustersController.collideAnnotations(i,e.zoomLevel,e.rotation,this._annotationsDidChangeSinceLastCollision)}this._annotationsDidChangeSinceLastCollision=!1}addCluster(e){let t="function"==typeof this._map.annotationForCluster?fe(this._map._annotationForCluster,this._map.public,[e],null):e;return t&&t instanceof Tp||(console.warn("[MapKit] Expects Map.annotationForCluster to return an annotation."),t=e),t=this._clustersController.setRequiredClusterAnnotationProperties(t,e),this.addItem(t),t._impl.customCluster=t!==e,t._impl.updateLayout(!0),this._updateLabelRegionForAnnotation(t),t}willUpdateCollisions(){this._items.forEach((e=>{e._impl.wasOccluded=e._impl.occluded,e._impl.previousCluster=e._impl.cluster}))}didUpdateCollisions(){this._items.forEach((function(e){const t=e._impl;t.wasCollided||t.occluded||(t.wasCollided=!0),e.memberAnnotations&&e.memberAnnotations[0]._impl.cluster!==e&&(t.cluster=t.memberAnnotations[0]._impl.cluster),t.updateVisibility(t.occluded),t.occluded!==t.wasOccluded&&t.animateOcclusion(),delete t.previousCluster,t.shouldHideLabels&&(t.occluded||t.labelRegion?t.occluded&&t.labelRegion&&this._removeLabelRegionForAnnotation(e):this._updateLabelRegionForAnnotation(e))}),this),this._items.forEach((e=>{delete e._impl.wasOccluded})),this._updateVisibleAnnotations(this._items,!0),this._updateSceneGraph()}deselectClusterAnnotation(){this._selectedItem&&this._selectedItem.memberAnnotations&&(this._selectedItem.selected=!1)}_updateAnnotation(e){e._impl.updatedPosition()&&this._updateVisibleAnnotations([e])}_updateSceneGraph(){const e=this._selectedItem,t=this._draggedAnnotation,i=this._items.filter((i=>i._impl.isDrawn()&&i!==e&&i!==t)).map((e=>e._impl.sceneGraphNode));e&&e._impl.isDrawn()&&i.push(e._impl.sceneGraphNode),t&&t._impl.isDrawn()&&i.push(t._impl.sceneGraphNode),this._sceneGraphNode.children=i}_checkCompletion(){if(this._mapWasDestroyed)return;if(this._annotationsDidChangeSinceLastCollision=!0,this._updateVisibleAnnotations(this._items),this._updateSceneGraph(),!this._completionCallback)return;this._items.some((e=>!e._impl.isStable()))||"function"!=typeof this._completionCallback||(this._completionCallback(),delete this._completionCallback)}}bf.Annotation=Tp;const wf=xt(((e,t,i)=>{i._geocoderRequestId&&e.cancel(i._geocoderRequestId);const s=e.reverseLookup(t._impl.coordinate,((e,o)=>{s===i._geocoderRequestId&&(delete i._geocoderRequestId,e?(console.error("[MapKit] Error getting address for user location: "+e.message),t.subtitle=null):o.results.length>0?i._lastUserLocationAnnotationSubtitle=t.subtitle=o.results[0].formattedAddress:t.subtitle=null)}));i._geocoderRequestId=s}),1e3),Cf=["UserLocationAnnotation","AccuracyRingOverlay","Geocoder"];function kf(){let e=!0;for(let t=0;t<Cf.length;t++){const i=Cf[t];!bf[i]&&j.jsModules[i]?bf[i]=j.jsModules[i]:e=!1}e&&j.removeEventListener("load",kf)}j.addEventListener("load",kf),kf();const Sf=bf,Mf=Li.MapPoint,Lf="mk-map-features-container",xf="mk-map-features";const Af=class{constructor(e){this.map=e,window.document&&(this.node=new Lo.Node(Bo.htmlElement("div",{class:Lf})),this._shadowRootNode=Bo.addShadowRootChild(this.node,Ze.shadowDOMMode,":host(.mk-map-features-container) .mk-map-features>div{position:absolute;top:0;left:0}",Ze.nonce),this._featuresContainer=this._shadowRootNode.addChild(new Lo.Node(Bo.htmlElement("div",{class:xf}))))}update(e,t){this._featuresContainer.children=[];for(let i=0;i<e.length;i++){const s=e[i];let o,n;const a=new Mf(s.position[0],s.position[1]);a.x<t.minX()&&(a.x+=1);const r=t.transformMapPoint(a);if(s.rects&&s.rects.length){let e=1/0,t=0,i=1/0,a=0;for(const o of s.rects){const s=r.x+o.offset[0],n=s+o.size[0],l=r.y+o.offset[1],h=l+o.size[1];e>s&&(e=s),t<n&&(t=n),i>l&&(i=l),a<h&&(a=h)}o=new ls(t-e,a-i),n=new cs(e,i)}else if(s.circles&&s.circles.length){let e=1/0,t=0,i=1/0,a=0;const r=this.map.ensureRenderingFrame().size.height;for(const o of s.circles){const s=o.x-o.radius,n=o.x+o.radius,r=o.y-o.radius,l=o.y+o.radius;e>s&&(e=s),t<n&&(t=n),i>r&&(i=r),a<l&&(a=l)}o=new ls(t-e,a-i),n=new cs(e,r-a)}if(!o)continue;const l=new Lo.Node(Bo.htmlElement("div",{"aria-label":s.title}));l.position=n,l.size=o,this._featuresContainer.addChild(l)}}};const Ef=class extends hn{constructor(e){super(),this._annotation=e}get position(){return this._annotation.nodePosition()}};function Tf(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class If{constructor(e){Tf(this,"glyphText",""),Tf(this,"useSquareBalloon",!1),this._realAnnotation=e}get glyphColor(){const e=this._realAnnotation.map;return e?Ym.DefaultGlyphColor[e._impl.currentColorScheme]:Ym.DefaultGlyphColor.light}get isAppStyle(){return!1}get isPlaceStyle(){return!1}get balloonVisible(){return!0}get selectedFillColor(){return this.fillColor}get fillColor(){const e=this._realAnnotation.map;return e?Ym.DefaultColor[e._impl.currentColorScheme]:Ym.DefaultColor.light}get fillWithGradient(){return!0}get selectedStrokeColor(){return this.defaultStrokeColor}get strokeColor(){return this.defaultStrokeColor}get defaultStrokeColor(){const e=this._realAnnotation.map;return e?Ym.DefaultStrokeColor[e._impl.currentColorScheme]:Ym.DefaultStrokeColor.light}}const Of=class extends Ns{constructor(e){super(),Tf(this,"enablesDefaultGlyphImage",!0),Tf(this,"frozen",!0),Tf(this,"state","default"),Tf(this,"params",Pm.Params.default),this._realAnnotation=e,this.annotation=new If(e),this._renderer=new em(this);const t=2*this.params.balloonRadius;this.size=new ls(t,this.params.height+this.params.offset),this._renderer.isFallbackGlyphTextPending&&this._renderer.addPendingNode(this),this.needsDisplay=!0}get position(){return this._realAnnotation.nodePosition()}stringInfo(){return"ImageAnnotationFallbackNode"}freeze(){}};const Rf=function(e){var t;class i extends e{constructor(t,i,s){super(t,i,e.div,s)}init(t,i,s){if(this._sceneGraphNode=new Ef(this),super.init(t,i,e.div,s),!this.url)throw new Error("[MapKit] No URL for image of ImageAnnotation");this._waitingForImageSize=!this._userSetSize,this._setSceneGraphNode()}get url(){return this._url}set url(e){this._pendingGlyphImage=e,zm(e,(t=>{if(this._pendingGlyphImage!==e)return;if(delete this._pendingGlyphImage,!t)throw new Error("[MapKit] No URL for image of ImageAnnotation");const i=t.ratio,s=t.glyphImageUrl;this._ratio=i,this._url=e,this._setSceneGraphNode(),this._removeImageEventListener();const o=Bo.htmlElement("img",{src:s});o.complete?(this._sceneGraphNode.setImage(o,s),this.updateSize()):(this._userSetSize||(this._waitingForImageSize=!0),this._pendingImage={image:o,url:s},this._addImageEventListener())})),this._url=e}centerOffsetForSelectionAccessory(){return this._sceneGraphNode instanceof Ef?super.centerOffsetForSelectionAccessory():(M(this._sceneGraphNode),new cs(-this._sceneGraphNode.params.balloonRadius,-this._sceneGraphNode.params.balloonRadius))}positionForCallout(){if(this._sceneGraphNode instanceof Ef)return super.positionForCallout();M(this._sceneGraphNode);const e=this._node.size,t=new cs(-e.width/2,0),i=this.nodePosition(),s=new cs(0,1);return new cs(i.x-t.x-s.x,i.y-t.y-s.y)}calculateNodePosition(){return this._sceneGraphNode instanceof Ef?super.calculateNodePosition():(M(this._sceneGraphNode),new cs(this._position.x-this._anchorPoint.x,this._position.y-this._anchorPoint.y))}handleEvent(e){switch(e.type){case"load":k((e.target,this._pendingImage.image)),this._removeImageEventListener(),this._sceneGraphNode.setImage(this._pendingImage.image,this._pendingImage.url),this._pendingImage=null,this._handleImageLoaded();break;case"error":k((e.target,this._pendingImage.image)),this._removeImageEventListener(),this._sceneGraphNode.setImage(this._pendingImage.image,this._pendingImage.url),this._pendingImage=null,this._handleImageError();break;default:return void super.handleEvent(e)}}resetNodeTransform(){this.sceneGraphNode.transform=new ys}updateSize(){let e;if(this._waitingForImageSize=!1,this._sceneGraphNode instanceof Ef){if(this._userSetSize)e=this._node.size;else{const t=this._sceneGraphNode.image;e=new ls(t.naturalWidth/this._ratio,t.naturalHeight/this._ratio),k(e.width),k(e.height),this.setSize(e)}this._sceneGraphNode.size=e}else M(this._sceneGraphNode),e=this._sceneGraphNode.size,this._userSetSize&&console.warn("[MapKit] Size set on the ImageAnnotation is removed."),this.setSize(e),this._userSetSize=!1;this._setElementSize(e),super.updateSize()}willMoveToMap(){this._isMoving=this.doesAnimate()}canShowCallout(){return!this._waitingForImageSize&&super.canShowCallout()}_addImageEventListener(){M(this._sceneGraphNode),k(this._pendingImage),this._pendingImage.image.addEventListener("load",this),this._pendingImage.image.addEventListener("error",this)}_removeImageEventListener(){M(this._sceneGraphNode),this._pendingImage&&(this._pendingImage.image.removeEventListener("load",this),this._pendingImage.image.removeEventListener("error",this))}_handleImageLoaded(){this.updateSize()}_handleImageError(){this._sceneGraphNode.image&&console.error("[MapKit] Could not load image for ImageAnnotation at URL: "+this._sceneGraphNode.url),this._setSceneGraphNodeToFallback(),this.updatePosition(),this.updateSize()}_setElementSize(e){this._element.style.width=e.width+"px",this._element.style.height=e.height+"px"}_setSceneGraphNode(){if(this._sceneGraphNode instanceof Ef)return;const e=this._sceneGraphNode;this._sceneGraphNode=new Ef(this),e.parent&&e.parent.replaceChild(this._sceneGraphNode,e)}_setSceneGraphNodeToFallback(){if(this._sceneGraphNode instanceof Of)return;this._removeImageEventListener();const e=this._sceneGraphNode;this._sceneGraphNode=new Of(this),e.parent&&e.parent.replaceChild(this._sceneGraphNode,e)}}return(t=i).prototype.renderedByDOMElement=!1,t.prototype.ConstructorOptions=Object.freeze(Object.assign({},e.prototype.ConstructorOptions,{url:"rw"})),i},Pf=Rf(xp);const Df=class extends Tp{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new Pf(this,e,t)}),this._impl.init(this,e,t)}get url(){return this._impl._url}set url(e){this._impl.url=e}},zf={AnnotationsController:Sf,MapFeaturesLayerController:Af,LayerItemsController:Ud,ItemCollection:tu,PlaceSelectionAccessory:mp,MapFeatureType:Eg,mapkit:{MapFeatureType:Eg,Annotation:Tp,PlaceAnnotation:vg,PlaceSelectionAccessory:mp,ImageAnnotation:Df,MarkerAnnotation:Jm,MapFeatureAnnotation:Rg.prototype.constructor}},Nf=Math.pow(2,21);function Ff(e){const t=e.toMapPoint(),i=Nf*ni;return{x:Math.floor(t.x*i),y:Math.floor(t.y*i),z:21}}const Uf={shift:function(e,t){const i=Ze.locationShiftUrl;S(),function(e,t,i){const s={getDataToSend:function(){return e},loaderDidSucceed:function(e,t){if(t.status<200||t.status>=300)i(new Error("HTTP error:"+t.status));else try{S(t.responseText),i(null,JSON.parse(t.responseText))}catch(e){return void i(e instanceof SyntaxError?new Error("Failed to parse response: "+t.responseText):new Error)}},loaderDidFail:function(e,t){i(new Error("Network error"))}},o=new me(t,s,{method:"POST",withCredentials:Ze.urlWithCredentials(t)});0;o.schedule()}(JSON.stringify({pixelPoint:Ff(e)}),i,(function(e,i){e?t(new Error,void 0):i&&i.shiftedPixelPoint?t(null,function(e){function t(e){return e/Nf/ni}const i=new Ci(t(e.x),t(e.y));return i.toCoordinate()}(i.shiftedPixelPoint)):t(new Error,void 0)}))}},Gf=Uf;function Wf(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Bf=Object.freeze({Change:"user-location-change",Error:"user-location-error"});let Zf;let Kf=null;const jf=new class extends P{constructor(){super(),Wf(this,"_location",void 0),Wf(this,"_coordinate",void 0),Wf(this,"_stale",void 0),Wf(this,"_watchId",void 0),Wf(this,"_watchers",void 0),Wf(this,"errorCode",void 0),Wf(this,"Events",Bf),this._location=null,this._coordinate=null,this._stale=!1,this._watchers=0,this.errorCode=0,Ze.addEventListener(Ze.Events.Changed,this),Ze.addEventListener(Ze.Events.Error,this)}get location(){return this._location}get coordinate(){return this._coordinate}get stale(){return this._stale}get mapAccuracyRadius(){const e=this.location;return!this.stale&&e.accuracy>0?e.accuracy:0}get isAvailable(){return window.navigator.geolocation&&"function"==typeof window.navigator.geolocation.watchPosition&&"function"==typeof window.navigator.geolocation.getCurrentPosition}getMapRect(){S(this.coordinate);const e=this.location&&this.location.accuracy||0,t=this.coordinate.latitude,i=this.coordinate.toMapPoint(),s=e*Li.mapUnitsPerMeterAtLatitude(t);return new Si(i.x-s,i.y-s,2*s,2*s)}watch(){this._watchId||(window.navigator.geolocation.watchPosition?(qf(),this._watchId=window.navigator.geolocation.watchPosition(Yf,$f),Zf=setTimeout((()=>{qf(),$f({code:3,message:"Timeout expired"})}),15e3)):console.warn("[MapKit] User location is unavailable."))}locate(e,t,i){window.navigator.geolocation.getCurrentPosition?(k(Ze.ready),Hf&&this._watchId?Vf(Hf,e,t):window.navigator.geolocation.getCurrentPosition((i=>Vf(i,e,t)),t,i)):console.warn("[MapKit] User location is unavailable.")}addEventListener(e,t,i){const s=super.addEventListener(e,t,i);return s&&++this._watchers,s}removeEventListener(e,t,i){const s=super.removeEventListener(e,t,i);return s?(--this._watchers,0===this._watchers&&this._watchId&&(window.navigator.geolocation.clearWatch(this._watchId),this._watchId=void 0),s):s}handleEvent(e){switch(e.type){case Ze.Events.Changed:case Ze.Events.Error:if(Kf&&(Hf=Kf,Kf=null),!Hf)return;Yf(Hf)}}reset(){qf(),this._watchers=0,this._watchId=void 0,Hf=null}};let Hf=null;function qf(){clearTimeout(Zf),Zf=void 0}function Vf(e,t,i){if(k(Ze.ready),"AutoNavi"===Ze.tileProvider){const s=new bi(e.coords.latitude,e.coords.longitude);Gf.shift(s,((s,o)=>{if(s)return void(i&&i({message:"Position Unavailable",code:2,POSITION_UNAVAILABLE:2,PERMISSION_DENIED:1,TIMEOUT:3}));const n={coords:{accuracy:e.coords.accuracy,altitude:e.coords.altitude,altitudeAccuracy:e.coords.altitudeAccuracy,heading:e.coords.heading,floorLevel:e.coords.floorLevel,speed:e.coords.speed,latitude:o.latitude,longitude:o.longitude,toJSON(){return JSON.stringify(this)}},timestamp:e.timestamp,toJSON(){return JSON.stringify(this)}};t&&t(n)}))}else t&&t(e)}function Yf(e){qf(),Hf=e,Ze.error?$f({code:4,message:"MapKit not initialized."}):Ze.ready?!jf._stale&&jf._coordinate&&e.coords.latitude===jf._coordinate.latitude&&e.coords.longitude===jf._coordinate.longitude||Vf(e,Xf,$f):Kf=e}function Xf(e){jf._stale=!1,jf._location=e.coords,jf._coordinate=new bi(e.coords.latitude,e.coords.longitude),jf.errorCode=0,jf.dispatchEvent(new Jf(jf._coordinate,e.coords.floorLevel))}function $f(e){Kf=null,Hf=null,jf._stale=!0,jf.errorCode=e.code,jf.dispatchEvent(new Qf(e))}class Jf extends D{constructor(e,t){super(Bf.Change),Wf(this,"coordinate",void 0),Wf(this,"floorLevel",void 0),Wf(this,"timestamp",void 0),this.coordinate=e,this.floorLevel=t,this.timestamp=new Date}}class Qf extends D{constructor(e){super(Bf.Error),Wf(this,"code",void 0),Wf(this,"message",void 0),this.code=e.code,this.message=e.message}}const ey=jf;function ty(e,t){sy(e,t),t.add(e)}function iy(e,t,i){sy(e,t),t.set(e,i)}function sy(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function oy(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}function ny(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,ry(e,t,"get"))}function ay(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,ry(e,t,"set"),i),i}function ry(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}var ly=new WeakMap,hy=new WeakMap,cy=new WeakMap,dy=new WeakSet,uy=new WeakMap,py=new WeakSet;function my(e){ey.errorCode=0,this._delegate.userLocationDidChange(e)}function gy(e){ey.errorCode=e.code,this._delegate.userLocationDidError(e)}const _y=class{constructor(e){ty(this,py),ty(this,dy),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"_delegate",void 0),iy(this,ly,{writable:!0,value:void 0}),iy(this,hy,{writable:!0,value:void 0}),iy(this,cy,{writable:!0,value:e=>oy(this,dy,my).call(this,e)}),iy(this,uy,{writable:!0,value:e=>oy(this,py,gy).call(this,e)}),this._delegate=e,ay(this,ly,!1),ay(this,hy,!1)}get showsUserLocation(){return ny(this,ly)}set showsUserLocation(e){!e||ey.isAvailable?(ay(this,ly,e),e?(ey.addEventListener(ey.Events.Change,ny(this,cy)),ey.addEventListener(ey.Events.Error,ny(this,uy)),ey.watch()):(ey.removeEventListener(ey.Events.Change,ny(this,cy)),ey.removeEventListener(ey.Events.Error,ny(this,uy)))):console.warn("[MapKit] User location is unavailable.")}get tracksUserLocation(){return ny(this,hy)}set tracksUserLocation(e){!e||ey.isAvailable?(ay(this,hy,e),e?(ey.addEventListener(ey.Events.Change,ny(this,cy)),ey.addEventListener(ey.Events.Error,ny(this,uy)),ey.watch()):(ey.removeEventListener(ey.Events.Change,ny(this,cy)),ey.removeEventListener(ey.Events.Error,ny(this,uy)))):console.warn("[MapKit] User location is unavailable.")}get userLocation(){return ey}mapWasDestroyed(){this._delegate=null,ey.removeEventListener(ey.Events.Change,ny(this,cy)),ey.removeEventListener(ey.Events.Error,ny(this,uy))}},fy=[],yy=function e(){const t=fy.length;if(t>0){for(let e=0;e<t;++e)Mt.scheduleASAP(fy[e]);Mt.scheduleOnNextFrame(e)}},vy={setIsAnimated:function(e,t){const i=fy.indexOf(e);t&&i<0&&(fy.push(e),1===fy.length&&Mt.scheduleASAP(yy)),!t&&i>-1&&fy.splice(i,1)},getIsAnimated:function(e){return fy.indexOf(e)>-1}},by=new pu({lineWidth:2,strokeColor:"white"}),wy=function(e,t){const i=ey.location,s=void 0===t?56:t,o=(i&&i.accuracy||0)<=3e4;return ey.getMapRect().size.width*e>=s&&o},Cy=Bo.lerp,ky=function(e,t,i){return c((e-t)/(i-t),0,1)},Sy=function(){const e=ey.location,t=e&&e.accuracy||0;return t>3e4?0:t};class My extends Pu{constructor(e){super(e.coordinate,Sy(),{style:by}),vy.setIsAnimated(this,!0),this._isRingMode=!1,this._isShown=!1,this._fadeClock=0}updateIsShown(e,t,i){const s=Date.now(),o=wy(t),n=o!==this._isRingMode?s:this._fadeClock,a=s-n<1e3,r=this._impl.shown&&(o||a);r!==this._isShown&&vy.setIsAnimated(this,r),this._impl.shown=r,this._fadeClock=n,this._isRingMode=o,this._isShown=r,this._mapRegion=e,this._worldSize=t,this._colorSchemeOrSatellite=i}performScheduledUpdate(){const e=Date.now(),t=ey.stale,i=this._mapRegion&&this._mapRegion.toMapRect(),s=i?i.size.width*this._worldSize:0,o=ey.getMapRect().size.width*this._worldSize,n=$s[Fs.Light],a=$s[Fs.Dark],r=this._colorSchemeOrSatellite===Fs.Light?t?n.gray:n.blue:t?a.gray:a.blue;this.style.fillColor="rgb("+r.join(",")+")",this.style.strokeColor=this._colorSchemeOrSatellite===Fs.Dark?"rgba("+n.gray3.join(",")+", 0.5)":"white";const l=ky(o,56,940),h=(t?.2:.14)*("satellite"===this._colorSchemeOrSatellite?2:1);this.style.fillOpacity=Math.pow(1-l,2)*h;const c=e-this._fadeClock,d=ky(c,0,1e3),u=this._isRingMode?d:1-d;this._impl.node.opacity=u;const p=ky(o,56,s),m=Cy(p,2,2.5),g=Cy(p,4,5),_=e%2e3/2e3,f=Bo.easeInOut(1-Math.abs(2*_-1));this.style.lineWidth=Cy(f,m,g)}updateForUserLocation(e){this.coordinate=ey.coordinate,this.radius=Sy()}}Object.defineProperties(My,{getMode:{value:wy}});const Ly=My;const xy=class extends Qo{constructor(e){super(e),this.opacity=null,this.opacityTime=0}draw(e){const t=this._node._annotation.stale,i=this._node._annotation.style,s=Date.now(),o=s-this.opacityTime,n=Math.min(o,500)/500,a=Bo.lerp(n,1-this.opacity,this.opacity);if(a>0){const o=i.ANIMATION_HALF_DURATION_MS,n=s%i.ANIMATION_DURATION_MS,c=Bo.easeInOut(n<o?1-n/o:(n-o)/o),d=Bo.lerp(c,i.ANIMATION_SCALE_TO,i.ANIMATION_SCALE_FROM),u=e.globalAlpha,p=i.INNER_RADIUS*d,m=i.OUTER_RADIUS-p,g=p+m/2,_=i.TOTAL_RADIUS,f=i.TOTAL_RADIUS;e.save(),e.globalAlpha=a,e.beginPath(),e.arc(_,f,g,0,2*Math.PI),e.strokeStyle="rgb("+i.OUTER_FILL.join(",")+")",e.shadowColor="rgba("+i.SHADOW_COLOR.join(",")+")",e.shadowBlur=i.SHADOW_BLUR,e.lineWidth=m,e.stroke(),e.restore(),e.globalAlpha=a,e.beginPath(),e.arc(_,f,p,0,2*Math.PI),e.fillStyle=t?"rgb("+i.STALE_FILL.join(",")+")":(r=i.ANIMATION_FILL_FROM,l=i.ANIMATION_FILL_TO,h=c,"rgb("+r.map(((e,t)=>Math.round(e+(l[t]-e)*h))).join(", ")+")"),e.fill(),e.globalAlpha=u}var r,l,h}};const Ay=class extends Ns{constructor(e){super(),this._annotation=e,this._renderer=new xy(this)}stringInfo(){return"UserLocationAnnotationNode< "+(this._renderer.stale?"stale ":"live ")+(1!==this._renderer.opacity?`opacity: ${this._renderer.opacity} `:"")+">"}get size(){return this._annotation.node.size}get position(){return this._annotation.nodePosition()}};class Ey extends xp{constructor(e,t){super(e,t.coordinate,xp.div),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"_collisionMode",xp.CollisionMode.None)}init(e,t){const i=$s.default,s={INNER_RADIUS:8,OUTER_RADIUS:11,SHADOW_BLUR:10,TOTAL_RADIUS:0,OUTER_FILL:[255,255,255],STALE_FILL:i.gray2,SHADOW_COLOR:[0,0,0,.25],ANIMATION_DURATION_MS:3e3,ANIMATION_HALF_DURATION_MS:0,ANIMATION_SCALE_FROM:1,ANIMATION_SCALE_TO:.81,ANIMATION_FILL_FROM:i.blue,ANIMATION_FILL_TO:i.blue};s.TOTAL_RADIUS=s.OUTER_RADIUS+s.SHADOW_BLUR,s.ANIMATION_HALF_DURATION_MS=s.ANIMATION_DURATION_MS/2;const o=s.TOTAL_RADIUS,n=s.SHADOW_BLUR,a=window.DOMPoint;super.init(e,t.coordinate,xp.div),this.style=s,this.stale=!1,this._animationScheduler=vy,this._anchorOffset=new a(0,-o),this._calloutAnchorPoint=new a(-o,-n),this._updateTitleAndSubtitleForLocale();const r=2*o;this.setSize(new ls(r,r)),this._userSetSize=!0,this._sceneGraphNode=new Ay(this),this.shownPropertyWasUpdated(!0)}get coordinate(){return this._coordinate}set coordinate(e){this._coordinate?console.warn("[MapKit] The `coordinate` property of the user location annotation cannot be set."):this._coordinate=e.copy()}get draggable(){return!1}set draggable(e){console.warn("[MapKit] The `draggable` property of the user location annotation cannot be set.")}get size(){return this._node.size.copy()}set size(e){console.warn("[MapKit] The `size` property of the user location annotation cannot be set.")}get node(){return this._node}handleEvent(e){e.type===es.Events.LocaleChanged&&this._updateTitleAndSubtitleForLocale()}set isRingMode(e){this.enabled=!e;const t=this._sceneGraphNode._renderer,i=e?0:1;i!==t.opacity&&(t.opacity=i,t.opacityTime=Date.now())}shownPropertyWasUpdated(e){vy.setIsAnimated(this,e)}removedFromMap(){vy.setIsAnimated(this,!1),es.removeEventListener(es.Events.LocaleChanged,this)}setCoordinate(e){Object.getOwnPropertyDescriptor(xp.prototype,"coordinate").set.call(this,e)}performScheduledUpdate(){const e=this.map&&this.map._impl.tint,t=this.map&&this.map.mapType,i=$s.default,s=$s[Fs.Light],o=$s[Fs.Dark],n=$s[e]||i,a=t===Bs.Satellite||t===Bs.Hybrid?"satellite":e;this.style.OUTER_FILL=a===Fs.Dark?s.gray3:[255,255,255],this.style.STALE_FILL=a===Fs.Light?s.gray:o.gray2,this.style.ANIMATION_FILL_FROM=n.blue,this.style.ANIMATION_FILL_TO=n.blue,this.style.SHADOW_COLOR=[0,0,0,a===Fs.Light?.25:.3],this._sceneGraphNode.needsDisplay=!0}_updateTitleAndSubtitleForLocale(){this.title=es.get("Location.Title"),this.subtitle=es.get("Location.Subtitle")}}Ey.prototype.renderedByDOMElement=!1;const Ty=Ey;class Iy extends Tp{constructor(e){super(),Object.defineProperty(this,"_impl",{value:new Ty(this,e)}),this._impl.init(this,e)}set coordinate(e){this._impl.coordinate=e}get coordinate(){return this._impl.coordinate}get draggable(){return this._impl.draggable}set draggable(e){this._impl.draggable=e}get size(){return this._impl.size}set size(e){this._impl.size=e}}function Oy(){throw new TypeError("[MapKit] UserLocationAnnotation may not be constructed.")}Iy.prototype.constructor=Oy,Oy.prototype=Iy.prototype;const Ry=Iy;const Py=class{constructor(e,t){this._impl=new Sg(e,t)}get getsUserLocation(){return this._impl.getsUserLocation}set getsUserLocation(e){this._impl.getsUserLocation=e}get language(){return this._impl.language}set language(e){this._impl.language=e}cancel(e){return this._impl.cancel(e)}},Dy=Li.Coordinate,zy=["language","getsUserLocation"],Ny=["language","region","coordinate","limitToCountries"],Fy=["language"];const Uy=class extends Sg{constructor(e){super("Geocoder",e=_(e)),this._checkOptions(e,zy)}lookup(e,t,i){const s={};i=_(i),this._checkOptions(i,Ny),u(e,"[MapKit] Missing `address` in call to `Geocoder.lookup()`."),p(e,"string","[MapKit] `address` passed to `Geocoder.lookup()` is not a string."),u(t,"[MapKit] Missing `callback` in call to `Geocoder.lookup()`."),p(t,"function","[MapKit] `callback` passed to `Geocoder.lookup()` is not a function."),s.q=e;const o=i.region,n=i.coordinate,a=i.limitToCountries;let r=this.language||Ze.language;if(o){const e=o.toBoundingRegion();s.searchRegion=[e.northLatitude,e.eastLongitude,e.southLatitude,e.westLongitude].join(",")}else n&&(s.searchLocation=[n.latitude,n.longitude].join(","));return i.language&&(r=this._bestLanguage(i.language)),r&&(s.lang=r),a&&(p(a,"string","[MapKit] `limitToCountries` is not a string."),s.limitToCountries=a),this._sendImmediatelyOrWithUserLocation("geocode",s,t,this._transform,"geocode")}reverseLookup(e,t,i){const s={};let o=this.language||Ze.language;return i=_(i),this._checkOptions(i,Fy),u(e,"[MapKit] Missing `coordinate` in call to `Geocoder.reverseLookup()`."),m(e,Dy,"[MapKit] `coordinate` passed to `Geocoder.reverseLookup()` is not a Coordinate."),u(t,"[MapKit] Missing `callback` in call to `Geocoder.reverseLookup()`."),p(t,"function","[MapKit] `callback` passed to `Geocoder.reverseLookup()` is not a function."),s.loc=e.latitude+","+e.longitude,i.language&&(o=this._bestLanguage(i.language)),o&&(s.lang=o),this._send("reverseGeocode",s,t,this._transform,"reverseGeocode")}_transform(e,t){const i={status:t.status,results:[]};return t.results&&(i.results=t.results.map((e=>new Oi(e)))),i}};const Gy=class extends Py{constructor(e){super(),Object.defineProperty(this,"_impl",{value:new Uy(e)})}lookup(e,t,i){return this._impl.lookup(e,t,i)}reverseLookup(e,t,i){return this._impl.reverseLookup(e,t,i)}},Wy={mapkit:{}};[Ed,$u,zf,{AnnotationsController:Sf,MapFeaturesLayerController:Af,OverlaysController:Jd,UserLocationController:_y,LayerItemsController:Ud,ItemCollection:tu,AccuracyRingOverlay:Ly,UserLocationAnnotation:Ry,Geocoder:Gy,userLocation:ey,mapkit:{}}].forEach((e=>{Object.keys(e).forEach((t=>{"mapkit"!==t?Object.defineProperty(Wy,t,Object.getOwnPropertyDescriptor(e,t)):Object.keys(e.mapkit).forEach((t=>{Object.defineProperty(Wy.mapkit,t,Object.getOwnPropertyDescriptor(e.mapkit,t))}))}))}));const By=Wy,Zy=Object.freeze({Country:"Country",AdministrativeArea:"AdministrativeArea",SubAdministrativeArea:"SubAdministrativeArea",Locality:"Locality",SubLocality:"SubLocality",PostalCode:"PostalCode"});function Ky(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function jy(e){return e.map((e=>{if(!d(e,Zy))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.AddressCategory.");return e}))}class Hy{constructor(e){if(Ky(this,"_includes",null),Ky(this,"_excludes",null),void 0!==(e=_(e)).includes&&void 0!==e.excludes)throw new Error("[MapKit] `includes` and `excludes` may not be specified at the same time.");if(void 0===e.includes&&void 0===e.excludes)throw new Error("[MapKit] Either `includes` or `excludes` should be specified.");void 0!==e.includes&&(this._includes=jy(e.includes)),void 0!==e.excludes&&(this._excludes=jy(e.excludes))}includesCategory(e){if(!d(e,Zy))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.AddressCategory.");return this._includes?-1!==this._includes.indexOf(e):this._excludes?-1===this._excludes.indexOf(e):void 0}excludesCategory(e){if(!d(e,Zy))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.AddressCategory.");return this._includes?-1===this._includes.indexOf(e):this._excludes?-1!==this._excludes.indexOf(e):void 0}static including(e){return g(e,"[MapKit] AddressFilter.including expected an array of categories."),new Hy({includes:e})}static excluding(e){return g(e,"[MapKit] AddressFilter.excluding expected an array of categories."),new Hy({excludes:e})}}const qy=function(){throw new Error("[MapKit] `AddressFilter` may not be constructed directly. Use the mapkit.AddressFilter.including or the mapkit.AddressFilter.excluding methods.")};Hy.prototype.constructor=qy,qy.prototype=Hy.prototype,Hy.exposedConstructor=qy,Object.defineProperties(Hy,{filterIncludingAllCategories:{get:function(){const e=this.excluding([]);return Object.defineProperty(this,"filterIncludingAllCategories",{value:e,configurable:!0}),e},configurable:!0},filterExcludingAllCategories:{get:function(){const e=this.including([]);return Object.defineProperty(this,"filterExcludingAllCategories",{value:e,configurable:!0}),e},configurable:!0}}),Object.defineProperties(qy,{including:{get:function(){return Hy.including},configurable:!0},excluding:{get:function(){return Hy.excluding},configurable:!0},includingAllCategories:{get:function(){return Hy.filterIncludingAllCategories},configurable:!0},excludingAllCategories:{get:function(){return Hy.filterExcludingAllCategories},configurable:!0}});const Vy=Hy,Yy=Object.freeze({Default:"Default",Required:"Required"});function Xy(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const $y=Li.BoundingRegion,Jy=Li.CoordinateRegion,Qy=Li.Coordinate,ev=["language","getsUserLocation","coordinate","region","includeAddresses","includePointsOfInterest","includePhysicalFeatures","includeQueries","pointOfInterestFilter","addressFilter","limitToCountries","regionPriority"],tv=["language","region","coordinate","includeAddresses","includePointsOfInterest","includePhysicalFeatures","pointOfInterestFilter","addressFilter","limitToCountries","regionPriority"],iv=tv.concat(["includeQueries"]);class sv extends Sg{constructor(e){super("Search",e=_(e)),Xy(this,"_coordinate",null),Xy(this,"_region",null),Xy(this,"_includeAddresses",!0),Xy(this,"_includePointsOfInterest",!0),Xy(this,"_includePhysicalFeatures",void 0),Xy(this,"_includeQueries",!0),Xy(this,"_pointOfInterestFilter",null),Xy(this,"_addressFilter",null),Xy(this,"_limitToCountries",null),Xy(this,"_regionPriority",Yy.Default),this._checkOptions(e,ev),this.coordinate=e.coordinate,this.region=e.region,void 0!==e.includeAddresses&&(this.includeAddresses=e.includeAddresses),void 0!==e.includePointsOfInterest&&(this.includePointsOfInterest=e.includePointsOfInterest),void 0!==e.includePhysicalFeatures&&(this.includePhysicalFeatures=e.includePhysicalFeatures),void 0!==e.includeQueries&&(this.includeQueries=e.includeQueries),void 0!==e.pointOfInterestFilter&&(this.pointOfInterestFilter=e.pointOfInterestFilter),void 0!==e.addressFilter&&(this.addressFilter=e.addressFilter),void 0!==e.limitToCountries&&(this.limitToCountries=e.limitToCountries),void 0!==e.regionPriority&&(this.regionPriority=e.regionPriority)}get coordinate(){return this._coordinate}set coordinate(e){null!=e&&(m(e,Qy,"[MapKit] Search.coordinate expected a Coordinate value."),e=e.copy()),this._coordinate=e||null}get region(){return this._region}set region(e){null!=e&&(m(e,Jy,"[MapKit] Search.region expected a CoordinateRegion value."),e=e.copy()),this._region=e||null}get includeAddresses(){return this._includeAddresses}set includeAddresses(e){this._includeAddresses=!!e}get includePointsOfInterest(){return this._includePointsOfInterest}set includePointsOfInterest(e){this._includePointsOfInterest=!!e}get includePhysicalFeatures(){return void 0===this._includePhysicalFeatures?this._includePointsOfInterest:this._includePhysicalFeatures}set includePhysicalFeatures(e){this._includePhysicalFeatures=!!e}get includeQueries(){return this._includeQueries}set includeQueries(e){this._includeQueries=!!e}get pointOfInterestFilter(){return this._pointOfInterestFilter}set pointOfInterestFilter(e){e&&m(e,$e,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),this._pointOfInterestFilter=e||null}get addressFilter(){return this._addressFilter}set addressFilter(e){e&&m(e,Vy,"[MapKit] Unknown value for `addressFilter`. It must be an instance of mapkit.AddressFilter."),this._addressFilter=e||null}get limitToCountries(){return this._limitToCountries}set limitToCountries(e){e&&p(e,"string","[MapKit] `limitToCountries` is not a string."),this._limitToCountries=e||null}get regionPriority(){return this._regionPriority}set regionPriority(e){if(e&&!d(e,Yy))throw new Error("[MapKit] Unknown value for `Search.regionPriority`. Choose from Search.RegionPriority.");this._regionPriority=e}search(e,t,i){return i=_(i),this._checkOptions(i,tv),this._request("search","search",this._searchTransform,e,t,i)}autocomplete(e,t,i){return i=_(i),this._checkOptions(i,iv),this._request("autocomplete","searchAutocomplete",this._autocompleteTransform,e,t,i)}_request(e,t,i,s,o,n){if("object"==typeof o){const t=o;o=function(i,s){const o="search"===e?t.searchDidError:t.autocompleteDidError,n="search"===e?t.searchDidComplete:t.autocompleteDidComplete;i?"function"==typeof o&&o.call(t,i):"function"==typeof n&&n.call(t,s)}}const a={},r="Search."+e+"()";if(u(s,"[MapKit] Missing `query` in call to `"+r+"`."),u(o,"[MapKit] Missing `callback` in call to `"+r+"`."),p(o,"function","[MapKit] `callback` passed to `"+r+"` is not a function."),s instanceof lp)t=s._completionUrl;else{if("string"!=typeof s)throw new TypeError("[MapKit] `query` passed to `"+r+"` is neither a string nor SearchAutocompleteResult.");a.q=s}const l=n.region||this.region,h=n.coordinate||this.coordinate;let c=this.language||Ze.language;if(l){const e=l.toBoundingRegion();a.searchRegion=[e.northLatitude,e.eastLongitude,e.southLatitude,e.westLongitude].join(",")}else h&&(a.searchLocation=[h.latitude,h.longitude].join(","));if(n.language&&(c=this._bestLanguage(n.language)),c&&(a.lang=c),n.pointOfInterestFilter&&m(n.pointOfInterestFilter,$e,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),n.addressFilter&&m(n.addressFilter,Vy,"[MapKit] Unknown value for `addressFilter`. It must be an instance of mapkit.AddressFilter."),n.limitToCountries&&p(n.limitToCountries,"string","[MapKit] `limitToCountries` is not a string."),(n.limitToCountries||this.limitToCountries)&&(a.limitToCountries=n.limitToCountries||this.limitToCountries),n.regionPriority&&!d(n.regionPriority,Yy))throw new Error("[MapKit] Unknown value for `regionPriority`. Choose from Search.RegionPriority.");a.searchRegionPriority=n.regionPriority||this.regionPriority;const g=n.pointOfInterestFilter||this.pointOfInterestFilter;let _=!0;g&&(n.includePointsOfInterest||this.includePointsOfInterest||console.warn("[MapKit] `includePointsOfInterest` is false but `pointOfInterestFilter` is set."),g._includes&&(0===g._includes.length?_=!1:a.includePoiCategories=g._includes.join(",")),g._excludes&&(a.excludePoiCategories=g._excludes.join(",")));const f=n.addressFilter||this.addressFilter;let y=!0;f&&(n.includeAddresses||this.includeAddresses||console.warn("[MapKit] `includeAddresses` is false but `addressFilter` is set."),f._includes&&(0===f._includes.length?y=!1:a.includeAddressCategories=f._includes.join(",")),f._excludes&&(a.excludeAddressCategories=f._excludes.join(",")));const v=[],b=sv.ResultTypeFilterValueMap;if(f?y&&v.push(b.address):void 0!==n.includeAddresses?n.includeAddresses&&v.push(b.address):this.includeAddresses&&v.push(b.address),g?_&&v.push(b.poi):void 0!==n.includePointsOfInterest?n.includePointsOfInterest&&v.push(b.poi):this.includePointsOfInterest&&v.push(b.poi),void 0!==n.includePhysicalFeatures)n.includePhysicalFeatures&&v.push(b.physicalFeature);else switch(this._includePhysicalFeatures){case!0:v.push(b.physicalFeature);break;case!1:break;case void 0:g?_&&v.push(b.physicalFeature):void 0!==n.includePointsOfInterest?n.includePointsOfInterest&&v.push(b.physicalFeature):this.includePointsOfInterest&&v.push(b.physicalFeature)}if("searchAutocomplete"===t&&(void 0!==n.includeQueries?n.includeQueries&&v.push(b.query):this.includeQueries&&v.push(b.query)),0===v.length)throw new Error("[MapKit] At least one of the types needs to be included in the search/autocomplete request.");return a.resultTypeFilter=v.join(","),this._sendImmediatelyOrWithUserLocation(t,a,o,i,e)}_searchTransform(e,t){const i={places:[]};if(e.q&&(i.query=e.q),t.displayMapRegion){const e=new $y(t.displayMapRegion.northLat,t.displayMapRegion.eastLng,t.displayMapRegion.southLat,t.displayMapRegion.westLng);i.boundingRegion=e.toCoordinateRegion()}return t.results&&(i.places=t.results.map((e=>new Oi(e)))),i}_autocompleteTransform(e,t){const i={query:e.q,results:[]};return t.results&&(i.results=t.results.map((e=>new lp(e)))),i}}Xy(sv,"ResultTypeFilterValueMap",Object.freeze({address:"Address",poi:"PointOfInterest",physicalFeature:"PhysicalFeature",query:"Query"}));const ov=sv;class nv extends Py{constructor(e){super(),Object.defineProperty(this,"_impl",{value:new ov(e)})}get coordinate(){return this._impl.coordinate}set coordinate(e){this._impl.coordinate=e}get region(){return this._impl.region}set region(e){this._impl.region=e}get regionPriority(){return this._impl.regionPriority}set regionPriority(e){this._impl.regionPriority=e}get includeAddresses(){return this._impl.includeAddresses}set includeAddresses(e){this._impl.includeAddresses=e}get includePointsOfInterest(){return this._impl.includePointsOfInterest}set includePointsOfInterest(e){this._impl.includePointsOfInterest=e}get includePhysicalFeatures(){return this._impl.includePhysicalFeatures}set includePhysicalFeatures(e){this._impl.includePhysicalFeatures=e}get includeQueries(){return this._impl.includeQueries}set includeQueries(e){this._impl.includeQueries=e}get addressFilter(){return this._impl.addressFilter}set addressFilter(e){this._impl.addressFilter=e}get pointOfInterestFilter(){return this._impl.pointOfInterestFilter}set pointOfInterestFilter(e){this._impl.pointOfInterestFilter=e}get limitToCountries(){return this._impl.limitToCountries}set limitToCountries(e){this._impl.limitToCountries=e}search(e,t,i){return this._impl.search(e,t,i)}autocomplete(e,t,i){return this._impl.autocomplete(e,t,i)}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(nv,"RegionPriority",Yy);const av=nv,rv=["language"],lv=["language"];const hv=class extends Sg{constructor(e){super("PlaceLookup",e=_(e)),this._checkOptions(e,rv)}getPlace(e,t,i){if(i=_(i),this._checkOptions(i,lv),"string"!=typeof e)throw new Error("[MapKit] `id` argument is not a string.");const s=i.language?this._bestLanguage(i.language):this.language||Ze.language,o=s?{lang:s}:{};return this._send("place/"+e,o,t,this._transform,"placeLookup")}_transform(e,t){return new Oi(t)}};const cv=class extends Py{constructor(e){super(),Object.defineProperty(this,"_impl",{value:new hv(e)})}getPlace(e,t,i){return this._impl.getPlace(e,t,i)}};function dv(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const uv=["language"],pv=["origin","destination","transportType","requestsAlternateRoutes","arrivalDate","departureDate","avoidTolls"],mv=["origin","destinations","transportType","departureDate"];class gv extends Sg{constructor(e){super("Directions",e=_(e)),this._checkOptions(e,uv)}eta(e,t){if(u(e,"[MapKit] Missing `request` in call to `Directions.eta()`."),_(e,"[MapKit] `request` is not a valid object."),u(t,"[MapKit] Missing `callback` in call to `Directions.eta()`."),p(t,"function","[MapKit] `callback` passed to `Directions.eta()` is not a function."),this._checkOptions(e,mv),u(e.origin,"[MapKit] Missing required property `origin` in `request` object."),u(e.destinations,"[MapKit] Missing required property `destinations` in `request` object."),!Array.isArray(e.destinations))throw new Error("[MapKit] Required property `destinations` in `request` object must be an array.");if(e.destinations.length>10)throw new Error("[MapKit] `destinations` array must be less than 10 destinations.");if(m(e.origin,bi,"[MapKit] `origin` property in `request` is not a Coordinate."),e.destinations.forEach((e=>{m(e,bi,"[MapKit] One of the values in `destinations` property in `request` is not a Coordinate.")})),"CN"===Ze.countryCode)return void setTimeout((()=>{const e=new Error("[MapKit] ETA Requests are not supported in China yet.");fe(t,null,[e])}));const i={origin:`${e.origin.latitude},${e.origin.longitude}`,destinations:e.destinations.map((e=>e.latitude+","+e.longitude)).join("|")},s=e.transportType;if(s){for(const e in gv.Transport){const t=gv.Transport[e];t&&s===t&&(i.transportType=t)}if("CN"===Ze.countryCode&&i.transportType===gv.Transport.Cycling)return void setTimeout((()=>{const e=new Error("[MapKit] Cycling transit type is not available in China yet.");fe(t,null,[e])}));if(!i.transportType)throw new TypeError("[MapKit] transportType must be a value of `Directions.Transport`.")}const o=e.departureDate;o&&(_v(o,"departureDate"),i.departureDate=o.toISOString());const n=this.language||Ze.language;return n&&(i.lang=n),this._send("etas",i,t,((t,i)=>this._handleEtaResponse(e,t,i)),"etas")}route(e,t){u(e,"[MapKit] Missing `request` in call to `Directions.route()`."),_(e,"[MapKit] `request` is not a valid object."),u(t,"[MapKit] Missing `callback` in call to `Directions.route()`."),p(t,"function","[MapKit] `callback` passed to `Directions.route()` is not a function."),this._checkOptions(e,pv);const i=e.origin,s=e.destination,o=e.transportType,n=e.arrivalDate,a=e.departureDate,r=e.avoidTolls,l=o===gv.Transport.Automobile,h=o===gv.Transport.Walking,c=o===gv.Transport.Cycling;u(i,"[MapKit] Missing required property `origin` in `request` object."),u(s,"[MapKit] Missing required property `destination` in `request` object.");const d={wps:JSON.stringify([fv(i),fv(s)])};if(o){if(!(l||h||c))throw new TypeError("[MapKit] transportType must be a value of `Directions.Transport`.");d.transport=o}if("CN"===Ze.countryCode&&c)return void setTimeout((()=>{const e=new Error("[MapKit] Cycling transit type is not available in China yet.");fe(t,null,[e])}));n&&a?console.warn("[MapKit] `Directions.route()` should not be sent an `arrivalDate` and `departureDate` in the same request. These parameters have been dropped from the request."):"CN"===Ze.countryCode&&(n||a)?console.warn("[MapKit] `arrivalDate` and `departureDate` are not supported in China yet. These parameters have been dropped from the request."):n?(_v(n,"arrivalDate"),d.arrivalDate=n.toISOString()):a&&(_v(a,"departureDate"),d.departureDate=a.toISOString()),void 0!==e.requestsAlternateRoutes?d.n=e.requestsAlternateRoutes?"3":"1":d.n="1";const m=this.language||Ze.language;return m&&(d.lang=m),r&&h?console.warn("[MapKit] When `transportType` is `Directions.Transport.Walking`, the `avoidTolls` parameter has no effect. The `avoidTolls` parameter has been dropped from the request."):r&&c?console.warn("[MapKit] When `transportType` is `Directions.Transport.Cycling`, the `avoidTolls` parameter has no effect. The `avoidTolls` parameter has been dropped from the request."):r&&"CN"===Ze.countryCode?console.warn("[MapKit] `avoidTolls` is not supported in China yet. This parameter has been dropped from the request."):r&&(d.avoid="tolls"),this._send("directions",d,t,((t,i)=>this._handleResponse(e,t,i)),"directions")}_handleEtaResponse(e,t,i){return{request:t,origin:e.origin.copy(),etas:i.etas.map(((t,i)=>({destination:e.destinations[i]?e.destinations[i].copy():void 0,transportType:t.transportType,distance:t.distanceMeters,expectedTravelTime:t.expectedTravelTimeSeconds,staticTravelTime:t.staticTravelTimeSeconds})))}}_handleResponse(e,t,i){const s=i.stepPaths.map((e=>e.map((e=>new bi(e.lat,e.lng))))),o=i.steps.map((e=>new kv(e,s,i.shieldDomains))),n=i.routes.map((e=>new vv(e,o,s)));return{request:t,origin:yv(e.origin,i.origin),destination:yv(e.destination,i.destination),routes:n}}}function _v(e,t){if(!(e instanceof Date)||isNaN(e.getTime()))throw new TypeError("[MapKit] Expected a `Date` object for `"+t+"`, but got `"+e+"` instead.")}function fv(e){if("string"==typeof e)return{q:e};if(e instanceof Oi){if(e.muid)return{muid:e.muid};e.coordinate&&(e=e.coordinate)}if(e instanceof bi)return{loc:{lat:e.latitude,lng:e.longitude}};throw new Error("[MapKit] Location must be an address (string), Coordinate object or Place object.")}function yv(e,t){return t?new Oi(t):e instanceof Oi?e:e instanceof bi?e.copy():void 0}dv(gv,"Transport",{Automobile:"AUTOMOBILE",Walking:"WALKING",Cycling:"CYCLING"});class vv{constructor(e,t,i){dv(this,"_polyline",void 0),this.name=e.name,this.distance=e.distanceMeters,this.expectedTravelTime=e.durationSeconds,this.transportType=e.transportType;const s=e.avoidTolls;this.hasTolls="boolean"==typeof s?!s:void 0,this._path=e.stepIndexes.map((e=>i[e])),this.steps=e.stepIndexes.map((e=>t[e]))}get path(){return console.warn("[MapKit] The `Route.path` property is deprecated and will be removed in a future release."),this._path}get polyline(){throw new Error("[MapKit] Route.polyline is available after loading the following library: overlays.")}}const bv=function(){throw new TypeError("[MapKit] Route may not be constructed.")};function wv(e){Object.defineProperty(vv.prototype,"polyline",{enumerable:!0,configurable:!0,get:function(){return this._polyline||(this._polyline=new e(this._path.reduce(((e,t)=>e.concat(t)),[]))),this._polyline}})}vv.prototype.constructor=bv,bv.prototype=vv.prototype,j.jsModules.mapkit.PolylineOverlay?wv(j.jsModules.mapkit.PolylineOverlay):j.addEventListener("load",(function e(t){j.jsModules.mapkit&&j.jsModules.mapkit.PolylineOverlay&&(j.removeEventListener("load",e),wv(j.jsModules.mapkit.PolylineOverlay))})),gv.Route=vv;const Cv=["ON_RAMP","OFF_RAMP","HIGHWAY_OFF_RAMP_LEFT","HIGHWAY_OFF_RAMP_RIGHT","CHANGE_HIGHWAY","CHANGE_HIGHWAY_LEFT","CHANGE_HIGHWAY_RIGHT"];class kv{constructor(e,t,i){if(this.instructions=e.instructions,this.pathIndex=e.stepPathIndex,this.distance=e.distanceMeters,this.transportType=e.transportType,this.path=t[e.stepPathIndex],!i||!i.length||!e.maneuver)return;const s=i[e.stepPathIndex%i.length],o=e.maneuver;let n,a;if(o.names&&o.names.length){const e=o.names.filter((e=>e.type&&e.shieldUrl));e.length&&(n="//"+s+e[0].shieldUrl)}o.arrowUrl&&(a="//"+s+o.arrowUrl);const r=n&&-1!==Cv.indexOf(o.type);this._imageUrl=r?n:a}}kv.prototype.constructor=bv,kv.prototype;const Sv=gv;class Mv extends Py{constructor(e){super("Directions"),this._impl=new Sv(e)}eta(e,t){return this._impl.eta(e,t)}route(e,t){return this._impl.route(e,t)}}Mv.Transport=Sv.Transport;const Lv=Mv;function xv(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Av=Li.CoordinateRegion,Ev=Li.Coordinate,Tv=["language","getsUserLocation","center","radius","region","pointOfInterestFilter"];const Iv=class extends Sg{constructor(e){super("PointsOfInterestsSearch",e=_(e)),xv(this,"_center",null),xv(this,"_radius",null),xv(this,"_region",null),xv(this,"_pointOfInterestFilter",null),this._checkOptions(e,Tv),void 0!==e.center&&(this.center=e.center),void 0!==e.radius&&(this.radius=e.radius),void 0!==e.region&&(this.region=e.region),e.pointOfInterestFilter&&(this.pointOfInterestFilter=e.pointOfInterestFilter)}get center(){return this._center}set center(e){null!=e&&(m(e,Ev,"[MapKit] PointsOfInterestSearch.center expected a Coordinate value."),e=e.copy()),this._center=e||null}get radius(){return this._radius}set radius(e){null!=e&&p(e,"number","[MapKit] PointsOfInterestSearch.radius expected a number value."),this._radius=e||null}get region(){return this._region}set region(e){null!=e&&(m(e,Av,"[MapKit] PointsOfInterestSearch.region expected a CoordinateRegion value."),e=e.copy()),this._region=e||null}get getsUserLocation(){return!1}set getsUserLocation(e){throw new TypeError("[MapKit] getsUserLocation on PointsOfInterestSearch has not effect.")}get pointOfInterestFilter(){return this._pointOfInterestFilter}set pointOfInterestFilter(e){e&&m(e,$e,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),this._pointOfInterestFilter=e||null}search(e,t){if(t=_(t),this._checkOptions(t,Tv),"object"==typeof e){const t=e;e=function(e,i){const s=t.searchDidError,o=t.searchDidComplete;e?"function"==typeof s&&s.call(t,e):"function"==typeof o&&o.call(t,i)}}if("CN"===Ze.countryCode)return void setTimeout((()=>{const t=new Error("[MapKit] PointsOfInterestSearch is not supported in China yet.");fe(e,null,[t])}));const i={};t.pointOfInterestFilter&&m(t.pointOfInterestFilter,$e,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),u(e,"[MapKit] Missing `callback` in call to `search`."),p(e,"function","[MapKit] `callback` passed to `search` is not a function.");const s=t.center||this.center,o=t.radius||this.radius,n=t.region||this.region;if((s||o)&&n)return void setTimeout((()=>{const t=new Error("[MapKit] Setting both `center`/`radius` and region are not allowed. Expects either a circular region defined by `center`/`radius` or a rectangular region defined by `region`.");fe(e,null,[t])}));if(!s&&!o&&!n)return void setTimeout((()=>{const t=new Error("[MapKit] No search region specified. Expects either a circular region defined by `center`/`radius` or a rectangular region defined by `region`.");fe(e,null,[t])}));if(s||o)m(s,Ev,"[MapKit] `center` should be a Coordinate when specify a circular search region."),i.center=[s.latitude,s.longitude].join(","),o&&(i.radius=o.toString(10));else if(n){m(n,Av,"[MapKit] `region` should be a CoordinateRegion when specify a rectangular search region.");const e=n.toBoundingRegion();i.mapRegion=[e.northLatitude,e.eastLongitude,e.southLatitude,e.westLongitude].join(",")}else k();if(void 0!==t.getsUserLocation)throw Error("[MapKit] getsUserLocation on PointsOfInterestSearch has not effect.");let a=this.language||Ze.language;t.language&&(a=this._bestLanguage(t.language)),a&&(i.lang=a);const r=t.pointOfInterestFilter||this.pointOfInterestFilter;if(r){if(r._includes){if(0===r._includes.length)return void setTimeout((()=>fe(e,null,[null,this._nearbyPoiTransform(void 0,{})])));i.includePoiCategories=r._includes.join(",")}r._excludes&&(i.excludePoiCategories=r._excludes.join(","))}return this._send("nearbyPoi",i,e,this._nearbyPoiTransform,"nearbyPoi")}_checkOptions(e,t){if((void 0!==e.center||void 0!==e.radius)&&void 0!==e.region)throw new Error("[MapKit] Setting both `center`/`radius` and region are not allowed. Expects either a circular region defined by `center`/`radius` or a rectangular region defined by `region`.");return super._checkOptions(e,t)}_nearbyPoiTransform(e,t){const i={places:[]};return t.results&&(i.places=t.results.map((e=>new Oi(e)))),i}};class Ov extends Py{constructor(e){super(),Object.defineProperty(this,"_impl",{value:new Iv(e)})}get center(){return this._impl.center}set center(e){this._impl.center=e}get radius(){return this._impl.radius}set radius(e){this._impl.radius=e}get region(){return this._impl.region}set region(e){this._impl.region=e}get pointOfInterestFilter(){return this._impl.pointOfInterestFilter}set pointOfInterestFilter(e){this._impl.pointOfInterestFilter=e}search(e,t){return this._impl.search(e,t)}}Object.defineProperty(Ov,"MaxRadius",{enumerable:!0,value:2e3});const Rv=Ov,Pv={userLocation:ey,mapkit:{CoordinateRegion:Li.CoordinateRegion,CoordinateSpan:Li.CoordinateSpan,Coordinate:Li.Coordinate,BoundingRegion:Li.BoundingRegion,MapPoint:Li.MapPoint,MapRect:Li.MapRect,MapSize:Li.MapSize,Geocoder:Gy,Search:av,PlaceLookup:cv,Directions:Lv,PointsOfInterestSearch:Rv,Place:Oi.prototype.constructor,SearchAutocompleteResult:lp.prototype.constructor,PointOfInterestCategory:He,PointOfInterestFilter:$e.exposedConstructor,AddressCategory:Zy,AddressFilter:Vy.exposedConstructor,get filterIncludingAllCategories(){return $e.filterIncludingAllCategories},get filterExcludingAllCategories(){return $e.filterExcludingAllCategories}}},Dv={Feature:"Feature",FeatureCollection:"FeatureCollection",GeometryCollection:"GeometryCollection",MultiPoint:"MultiPoint",MultiLineString:"MultiLineString",MultiPolygon:"MultiPolygon",Point:"Point",LineString:"LineString",Polygon:"Polygon",Position:"Position"},zv={Feature:function(e){return Nv(e,e.geometry&&e.geometry.type)},FeatureCollection:function(e){if(!(e instanceof Object&&e.features instanceof Array))return!1;for(const t in e.features){const i=e.features[t];if(i.geometry&&!Nv(i,i.geometry.type))return!1}return!0},Position:function(e){return function(e){if(!Array.isArray(e)||e.length<2)return!1;for(let t=0;t<2;++t)if("number"!=typeof e[t]||isNaN(e[t]))return!1;return!0}(e)},Point:function(e){return Fv(e,Dv.Point)},MultiPoint:function(e){return Fv(e,Dv.MultiPoint)},LineString:function(e){return Fv(e,Dv.LineString)},MultiLineString:function(e){return Fv(e,Dv.MultiLineString)},Polygon:function(e){return Fv(e,Dv.Polygon)},MultiPolygon:function(e){return Fv(e,Dv.MultiPolygon)},GeometryCollection:function(e){if(!(e instanceof Object&&e.geometries instanceof Array))return!1;for(const t in e.features){if(!Fv(e,e.geometries[t].type))return!1}return!0}};function Nv(e,t){return e instanceof Object&&(e.type===Dv.Feature&&!!Fv(e.geometry,t))}function Fv(e,t){return e instanceof Object&&((!t||e.type===t)&&(((i=e.type)instanceof String||"string"==typeof i)&&(e.type===Dv.GeometryCollection?zv.GeometryCollection(e):e.type===Dv.MultiLineString||e.type===Dv.MultiPolygon||e.type===Dv.MultiPoint?function(e){for(let t=0;t<e.length;t+=1)if(!(e[t]instanceof Array))return!1;return!0}(e.coordinates):e.coordinates instanceof Array)));var i}const Uv={isValid:function(e){return!!zv[e.type]&&zv[e.type](e)},isPosition:function(e){return zv.Position(e)}},Gv={Point:Jm,LineString:ju,Polygon:Xu},Wv={MultiPoint:Dv.Point,MultiLineString:Dv.LineString,MultiPolygon:Dv.Polygon},Bv=[Dv.MultiPoint,Dv.MultiLineString,Dv.MultiPolygon];class Zv extends Error{constructor(e){super(e)}}function Kv(e,t,i){const s=function(){const t=i(s.collection?s.collection.items[s.index]:e.scheduledTaskItem);s.collection?s.collection.items[s.index]=t:e.scheduledTaskItem=t};return t&&(s.collection=t,s.index=t.items.length),Mt.scheduleInBackground(s,Mt.Priority.Highest),s}function jv(e){if(!Uv.isPosition(e))throw new Zv("[MapKit] Expected a GeoJSON Position type, instead got "+e);return new bi(e[1],e[0])}function Hv(e,t,i){const s=Bv.indexOf(e.type)>-1,o="GeometryCollection"===e.type;let n;if(s||o){const a=s?e.coordinates:e.geometries;if(s)switch(e.type){case Dv.MultiPoint:n=t.delegate.itemForMultiPoint;break;case Dv.MultiLineString:n=t.delegate.itemForMultiLineString;break;case Dv.MultiPolygon:n=t.delegate.itemForMultiPolygon}o&&(n=t.delegate.itemForPoint);const r=new tu([],e);return a.forEach((i=>{s&&(i={type:Wv[e.type],coordinates:i}),r.items.push(Hv(i,t,r))})),t.hasCallbackOrDelegate&&Kv(t,i,(()=>(r._impl.items=r.items.filter((e=>!!e)),n?fe(n,t.delegate,[r,e],r):r))),r}const a=Gv[e.type];if(!a)throw new Zv("[MapKit] Expected a GeoJSON "+e.type+" type, instead got "+e);const r=function(e,t){switch(t){case Dv.MultiPoint:case Dv.LineString:return e.map((e=>jv(e)));case Dv.Polygon:return e.map((e=>e.map((e=>jv(e)))));default:return jv(e)}}(e.coordinates,e.type);let l,h;switch(e.type){case Dv.Point:n=t.delegate.itemForPoint,l=r;break;case Dv.LineString:n=t.delegate.itemForLineString,h=t.delegate.styleForOverlay;break;case Dv.Polygon:n=t.delegate.itemForPolygon,h=t.delegate.styleForOverlay}function c(){const i=new a(r,{data:e}),s=n?fe(n,t.delegate,[l||i,e],i):i;return s?(++t.itemCount,h&&(s.style=fe(h,t.delegate,[i,e],i)),s):null}return t.hasCallbackOrDelegate?Kv(t,i,c):c()}function qv(e,t,i){let s;switch(e.type){case Dv.Feature:return s=function(e,t,i){if(null===e.geometry)return t.hasCallbackOrDelegate?Kv(t,i,(()=>null)):null;if(!Uv.isValid(e))throw new Zv("[MapKit] Expected a GeoJSON "+e.type+" type, instead got "+e);const s=Hv(e.geometry,t,i);if(!s)throw new Zv("[MapKit] "+e+" is an unknown GeoJSON type");return s}(e,t,i),t.delegate.itemForFeature&&Kv(t,i,(i=>fe(t.delegate.itemForFeature,t.delegate,[i,e],i))),s;case Dv.FeatureCollection:return s=new tu([],e),e.features.forEach((e=>{const i=qv(e,t,s);i&&s.items.push(i)})),t.hasCallbackOrDelegate&&Kv(t,i,(()=>(s._impl.items=s.items.filter((e=>!!e)),t.delegate.itemForFeatureCollection?fe(t.delegate.itemForFeatureCollection,t.delegate,[s,e],s):s))),s;case Dv.GeometryCollection:case Dv.MultiPoint:case Dv.MultiLineString:case Dv.MultiPolygon:case Dv.Point:case Dv.LineString:case Dv.Polygon:case Dv.Position:return Hv(e,t,i);default:throw"string"==typeof e.type?new Zv('[MapKit] "'+e.type+'" is an unknown GeoJSON type.'):new Zv("[MapKit] importGeoJSON expects an object with a known GeoJSON `type` property.")}}const Vv={importGeoJSON:function(e,t){const i={delegate:{},itemCount:0,hasCallbackOrDelegate:!1};t&&(i.delegate=t,i.hasCallbackOrDelegate=!0);try{const s="[MapKit] importGeoJSON expects an Object and was passed ";if(!e)throw new Zv(s+"a falsy value");if(!(e instanceof Object))throw new Zv(s+e);if(Array.isArray(e))throw new Zv(s+"an array");let o=qv(e,i);return i.hasCallbackOrDelegate?void Mt.scheduleInBackground((()=>{let s=void 0===i.scheduledTaskItem?o:i.scheduledTaskItem;s instanceof tu||(s=new tu(s,e)),"function"==typeof t?fe(t,null,[null,s]):i.delegate.geoJSONDidComplete?(0===i.itemCount&&console.warn("[MapKit] No item is imported with importGeoJSON, either because GeoJSON has no geometries, or the delegate methods did not return any item."),fe(i.delegate.geoJSONDidComplete,i.delegate,[s,e])):console.warn("[MapKit] importGeoJSON was called asynchronously with a delegate object but no `geoJSONDidComplete` method was defined.")}),Mt.Priority.Highest):(o instanceof tu||(o=new tu(o,e)),o)}catch(s){if(!(s instanceof Zv))throw s;"function"==typeof i.delegate.geoJSONDidError?fe(i.delegate.geoJSONDidError,i.delegate,[s,e]):"function"==typeof t?fe(t,null,[s]):console.error(s.message)}},constants:Dv,validate:Uv},Yv=me;const Xv=function(e,t){const i="function"==typeof t,s="object"==typeof t&&null!==t,o="string"==typeof e;if(o&&!i&&!s)throw new Error("[MapKit] For GeoJSON file imports, a callback must be provided as a second argument");return o?function(e,t){const i=new Yv(e,{loaderDidSucceed:function(i,s){let o;try{o=JSON.parse(s.responseText)}catch(i){return void t(new Error("[MapKit] The response of "+e+" does not appear to be valid JSON:"+s.responseText))}t(null,o)},loaderDidFail:function(i,s){t(new Error("[MapKit] Failed to load "+e))}});return i.schedule(),i.id}(e,((e,o)=>{if(!e)return Vv.importGeoJSON(o,t);s&&t.geoJSONDidError?fe(t.geoJSONDidError,t,[e]):i&&fe(t,null,[e])})):Vv.importGeoJSON(e,t)},$v={mapkit:{importGeoJSON:Xv}},Jv=Math.min(Bo.imagePixelRatio,3),Qv=(Jv>1?"_"+Jv+"x":"")+".png";let eb;const tb={};let ib=[],sb=!1;function ob(){const e={};function t(t,s){const o=It.createImageUrl("pins/pin"+(t?"-":"")+t+"-"+s+Qv),n=Bo.htmlElement("img",{src:o}),a={handleEvent:function(o){switch(n.removeEventListener("load",a),n.removeEventListener("error",a),o.type){case"load":e[t][s]=n;break;case"error":console.warn("[MapKit] Error loading pin annotation image "+o.target.src+"; pin annotations may not display correctly."),sb=!0}--i,0===i&&(eb=e,ib.forEach((e=>{e.needsDisplay=!0})),ib=void 0)}};n.crossOrigin=fa.getCorsAttribute(Ze.urlWithCredentials(o)),n.addEventListener("load",a),n.addEventListener("error",a)}let i=["","floating","down1","down2","down3"].reduce(((i,s)=>(e[s]={},t(s,"base"),t(s,"head"),i+2)),1);t("","shadow")}let nb=!1;const ab=class extends Qo{constructor(e){super(e),function(){if(nb)return;if(nb=!0,Ze.state===Ze.States.PENDING||Ze.state===Ze.States.READY)return void ob();Ze.addEventListener(Ze.Events.Initialized,(function e(){Ze.removeEventListener(Ze.Events.Initialized,e),ob()}))}()}draw(e){if(!eb)return void(ib.indexOf(this._node)<0&&ib.push(this._node));const t=this._node,i=t.size.width,s=t.size.height;if(sb){return void function(e,t,i,s){e.strokeStyle="#ff4040",e.lineWidth=2,e.strokeRect(0,t,i,s-t),e.beginPath(),e.moveTo(0,t),e.lineTo(i,s),e.moveTo(0,s),e.lineTo(i,t),e.stroke()}(e,s-t._annotation.size.height,t._annotation.size.width,s)}const o=t._state,n=t._annotation.color;if(tb[n]||(tb[n]={}),!tb[n][o]){const e=document.createElement("canvas");e.width=i*Jv,e.height=s*Jv;const t=e.getContext("2d");t.fillStyle=n,t.fillRect(0,0,e.width,e.height),t.save(),t.globalCompositeOperation="destination-in",t.drawImage(eb[o].head,0,0),t.restore(),t.drawImage(eb[o].base,0,0),tb[n][o]=e}t.shadowTransform&&e.drawImage(eb[""].shadow,t.shadowTransform.e,t.shadowTransform.f,i,s),e.drawImage(tb[n][o],0,0,i,s)}};const rb=class extends Ns{constructor(e){super(),this.size=new ls(32,39),this._annotation=e,this._renderer=new ab(this),this.updateState()}get position(){return this._annotation.nodePosition()}stringInfo(){return"PinAnnotationNode"+(this._state?"<"+this._state+">":"")}updateState(e){e=this._annotation.floating?"floating":e||"",this._state!==e&&(this._state=e,this.needsDisplay=!0)}},lb=[1,2,3,2,1],hb=Math.tan(.820304748437335);const cb=class extends Mp{get isBouncing(){return this._bounceAnimationFrameIndex>=0}animateDropAfterLift(){const e=Math.max(this._dropAnimationStartP-Math.min((Date.now()-this._dropAfterLiftAnimationStartDate)/this.liftDurationMs,1),0);let t=this.liftAmount*e;this._annotation.sceneGraphNode.transform=(new ys).translate(0,-t),this._dropAnimationRevert||(t*=1.25),this._annotation.sceneGraphNode.shadowTransform=(new ys).translate(hb*t,-t),0===e&&(delete this._annotation.floating,this._annotation.sceneGraphNode.updateState(),delete this._dropAfterLiftAnimationStartDate,delete this._dropAnimationStartP,delete this._dropAnimationRevert,this._dequeueNextAnimation()),Mt.scheduleOnNextFrame(this)}animateLift(){const e=Math.min((Date.now()-this._liftAnimationStartDate)/this.liftDurationMs,1);let t=this.liftAmount*e;this._annotation.sceneGraphNode.transform=(new ys).translate(this.translation.x,this.translation.y-t),this._shadowLiftDamping&&(t=this.liftAmount*(1+.25*e)),this._annotation.sceneGraphNode.shadowTransform=(new ys).translate(hb*t,-t),e<1?(Mt.scheduleOnNextFrame(this),this._liftAnimationProgress=e):(delete this._liftAnimationStartDate,delete this._liftAnimationProgress,delete this._shadowLiftDamping,this._dequeueNextAnimation())}drop(){const e=this._annotation.position().y;this._pinVerticalTranslation=-e-4,this._shadowHorizontalTranslation=hb*-this._pinVerticalTranslation,this._shadowVerticalTranslation=this._pinVerticalTranslation;const t=e/this._annotation.delegate.mapForAnnotation(this._annotation._public)._impl.ensureRenderingFrame().size.height;this._dropDurationMs=1e3*Math.min(.35*(t+(1-t)/2),3),this._dropAnimationStartDate=Date.now(),this._annotation.floating=!0,this._annotation.sceneGraphNode.updateState(),this._animateDrop(),this._annotation._isAnimating=!0,this._animationQueue=[this._bounce,()=>this._annotation.finishedAnimating()],Mt.scheduleOnNextFrame(this)}dropAnnotationAfterDraggingAndRevertPosition(e){const t=()=>this._annotation.droppedAfterLift();this._bounceAnimationFrameIndex>=0?this._animationQueue=[t]:(this._liftAnimationStartDate?(this._dropAnimationStartP=this._liftAnimationProgress,delete this._liftAnimationStartDate,delete this._liftAnimationProgress):this._dropAnimationStartP=1,e?(this._dropAfterLift(),this._animationQueue=[this._bounce,t]):(this._annotation.draggingDidEnd(),this._shadowLiftDamping=!0,this._animationQueue=[this._dropAfterLift,this._bounce,t],super.lift(this.nominalLiftAmount)),this._dropAnimationRevert=e,Mt.scheduleOnNextFrame(this))}lift(e){this.nominalLiftAmount=e,this._animationQueue=[this._liftAfterBounce],this._bounce(),Mt.scheduleOnNextFrame(this)}setTranslation(e){this.translation=e,this._bounceAnimationFrameIndex>=0||this._liftAnimationStartDate||(this._annotation.sceneGraphNode.transform=(new ys).translate(e.x,e.y-this.liftAmount),this._annotation.sceneGraphNode.shadowTransform=(new ys).translate(hb*this.liftAmount,-this.liftAmount))}performScheduledUpdate(){this._dropAnimationStartDate?this._animateDrop():this._bounceAnimationFrameIndex>=0?this._animateBounce():super.performScheduledUpdate()}_animateBounce(){this._bounceAnimationFrameIndex<lb.length?(this._annotation.sceneGraphNode.updateState("down"+lb[this._bounceAnimationFrameIndex]),++this._bounceAnimationFrameIndex):(delete this._bounceAnimationFrameIndex,this._dequeueNextAnimation()),Mt.scheduleOnNextFrame(this)}_animateDrop(){const e=Math.min((Date.now()-this._dropAnimationStartDate)/this._dropDurationMs,1),t=1-e;this._annotation.sceneGraphNode.transform=(new ys).translate(0,t*this._pinVerticalTranslation),this._annotation.sceneGraphNode.shadowTransform=(new ys).translate(t*this._shadowHorizontalTranslation,t*this._shadowVerticalTranslation),1===e&&(delete this._pinVerticalTranslation,delete this._shadowHorizontalTranslation,delete this._shadowVerticalTranslation,delete this._dropAnimationStartDate,delete this._dropDurationMs,this._annotation.floating=!1,this._annotation.sceneGraphNode.updateState(),this._dequeueNextAnimation()),Mt.scheduleOnNextFrame(this)}_bounce(){this._bounceAnimationFrameIndex=0}_dequeueNextAnimation(){this._animationQueue.length>0&&this._animationQueue.shift().call(this)}_dropAfterLift(){delete this.translation,this._dropAfterLiftAnimationStartDate=Date.now(),Mt.scheduleOnNextFrame(this)}_liftAfterBounce(){super.lift(this.nominalLiftAmount),this._annotation.floating=!0,this._annotation.sceneGraphNode.updateState()}};function db(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const ub=new ls(15,36),pb={Red:"#ff3d38",Green:"#54d669",Purple:"#c969e0"},mb=new window.DOMPoint(8,35),gb=new window.DOMPoint(-8,0);function _b(e){var t;class i extends e{constructor(t,i,s){super(t,i,e.div,s),db(this,"dragOffset",new cs(0,2))}init(t,i,s){this._animationController=new cb(this),this._dragController=this._animationController,this._sceneGraphNode=new rb(this),super.init(t,i,e.div,s),this.setSize(ub)}get size(){return ub.copy()}set size(e){console.warn("[MapKit] The `size` property of a pin annotation cannot be set.")}get color(){return this._color}set color(e){p(e,"string","[MapKit] Expected a string value for PinAnnotation.color, but got `"+e+"` instead"),e!==this._color&&(this._color=e,this.updateLocalizedText(),this._sceneGraphNode.needsDisplay=!0)}centerOffsetForSelectionAccessory(){return new cs(-8,-2)}get shouldPreventDrag(){return this._animationController.isBouncing}doesAnimate(){return this._animates}willMoveToMap(e){this._isMoving=e&&this.animates}didMoveToMap(){const e=this._isMoving;super.didMoveToMap(),this.delegate&&e&&this.visible&&!this._appearanceAnimation&&this._shown&&(this._isAnimating=!0,this._animationController.drop())}droppedAfterLift(){this.resetNodeTransform(),this._sceneGraphNode.updateState(),super.droppedAfterLift()}finishedAnimating(){this._sceneGraphNode.updateState(),super.finishedAnimating()}altText(){return super.altText()||(this._color===pb.Green?es.get("Annotation.Pin.Green.AccessibilityLabel"):this._color===pb.Purple?es.get("Annotation.Pin.Purple.AccessibilityLabel"):this._color===pb.Red?es.get("Annotation.Pin.Red.AccessibilityLabel"):es.get("Annotation.Pin.AccessibilityLabel"))}draggingDidEnd(){super.draggingDidEnd(),super.updatePosition()}resetNodeTransform(){this.sceneGraphNode.transform=new ys}}return t=i,db(i,"Colors",pb),t.prototype._animates=!0,t.prototype._color=pb.Red,t.prototype._anchorPoint=mb,t.prototype._calloutAnchorPoint=gb,t.prototype.renderedByDOMElement=!1,t.prototype.ConstructorOptions=Object.freeze(Object.assign({},e.prototype.ConstructorOptions,{color:"rw"})),i}_b.Colors=pb;const fb=_b,yb=fb(xp);class vb extends Tp{constructor(e,t){super(),console.warn("[MapKit] mapkit.PinAnnotation is deprecated and will be removed in a future release. Please use the newer mapkit.MarkerAnnotation class instead."),Object.defineProperty(this,"_impl",{value:new yb(this,e,t)}),this._impl.init(this,e,t)}get size(){return this._impl.size}set size(e){this._impl.size=e}get color(){return this._impl._color}set color(e){this._impl.color=e}}vb.Colors=fb.Colors;const bb={mapkit:{}};[By,{mapkit:{PinAnnotation:vb}},$v,Pv].forEach((e=>{Object.keys(e).forEach((t=>{"mapkit"!==t?bb[t]=e[t]:Object.keys(e.mapkit).forEach((t=>{bb.mapkit[t]=e.mapkit[t]}))}))}));const wb=bb;const Cb=e=>{if(!e)return null;try{return JSON.parse((t=ts(e.trim(),is),(new TextDecoder).decode(new Uint8Array(atob(t).split("").map((e=>e.charCodeAt(0)))))))}catch(e){if(e instanceof DOMException)return null;if(e instanceof SyntaxError)return null;throw e}var t};class kb extends Ke{constructor(){throw super(),new TypeError("[MapKit] MapKit may not be constructed.")}init(e){Ze.init(e),Ze.addEventListener(Ze.Events.Changed,Sb),Ze.addEventListener(Ze.Events.Error,Sb)}get version(){return e.version}get build(){return e.build+""+Ze.buildTags}get language(){return Ze.language}set language(e){Ze.language=e}toString(){return["MapKit JS",this.version,"("+this.build+")"].join(" ")}get _tileProvider(){return Ze.tileProvider}get _countryCode(){return Ze.countryCode}set _countryCode(e){Ze._c(Y).setForcedCountryCode(e)}_login(){Ze.login()}_restore(){Ze._restore()}get _environment(){return Ze.environment}}const Sb=function(e){const t=new D(e.type);t.status=e.status,e.message&&(t.message=e.message),e.responseIdentifier&&(t.responseIdentifier=e.responseIdentifier),Ab.dispatchEvent(t)},Mb=Object.keys({importGeoJSON:["geojson"],FeatureVisibility:["map","look-around"],CoordinateRegion:["map","services"],CoordinateSpan:["map","services"],Coordinate:["map","services","look-around"],BoundingRegion:["map","services"],MapPoint:["map","services"],MapRect:["map","services"],MapSize:["map","services"],Padding:["map","look-around"],CameraZoomRange:["map"],MapFeatureType:["annotations"],Style:["overlays"],LineGradient:["overlays"],CircleOverlay:["overlays"],PolylineOverlay:["overlays"],PolygonOverlay:["overlays"],Geocoder:["services"],Search:["services"],PlaceLookup:["services"],Directions:["services"],PointsOfInterestSearch:["services"],Map:["map"],maps:["map"],Annotation:["annotations"],PinAnnotation:["annotations"],ImageAnnotation:["annotations"],MarkerAnnotation:["annotations"],MapFeatureAnnotation:["annotations"],TileOverlay:["overlays"],Place:["services"],SearchAutocompleteResult:["services"],PointOfInterestCategory:["map","services"],PointOfInterestFilter:["map","services"],filterIncludingAllCategories:["map","services"],filterExcludingAllCategories:["map","services"],AddressCategory:["services"],AddressFilter:["services"],PlaceDetail:["map"],PlaceSelectionAccessory:["annotations"],LookAround:["look-around"],LookAroundPreview:["look-around"],LookAroundScene:["look-around"],lookAroundViews:["look-around"]});let Lb=!1;!function(e){e.loadAll=function(){this._chunkLoaded(wb,(()=>this._dispatchLoadEndEvent(["all"])))}}(j),j.addEventListener(j.Events.LOAD,(e=>{const t=e.jsModules;if(t.mapkit)for(const e of Object.keys(t.mapkit)){const i=Mb.indexOf(e);-1!==i&&(delete kb.prototype[e],Mb.splice(i,1)),Object.defineProperty(kb.prototype,e,Object.getOwnPropertyDescriptor(t.mapkit,e))}if(!Lb&&j.jsModules.css&&j.jsModules.utils){const e=j.jsModules.utils.htmlElement("style",j.jsModules.css);e.nonce=Ze.nonce,document.head.appendChild(e),Lb=!0}}));const xb=It.findScriptAndSetBasePath();xb&&xb.nonce&&(Ze.nonce=xb.nonce,Ze.scriptBaseUrl=It.scriptBaseUrl),j.loadAll(),k(Mb.length),function(e){if(!e)return;const t=e.dataset.callback,i=e.dataset.language,s=e.dataset.libraries,o=void 0!==e.dataset.token?e.dataset.token:e.dataset.initialToken,n=e.dataset.distUrl,a=e.dataset.proxyPrefixes,r=e.dataset.proxyPrefix,l=e.dataset.countryCode,h=!("false"===e.dataset.shouldLogin),c=e.dataset.teamId,d=Cb(e.dataset.options),u={_shouldLogin:h,_teamId:c,...d};for(const[t,i]of Object.entries(e.dataset))"`ha\\aHe_"===V(t)&&(u["_"+t]=i);if(e.src&&-1!==e.src.indexOf("sourcemap=1")&&(Ze.enableSourceMap=!0),Ze.setPerformanceMarkers(e.dataset.performanceMarkers),!(t||i||s||void 0!==o||n||r||l||c||d))return;if(i&&(u.language=i),(o||""===o&&r)&&(u.authorizationCallback=function(e){e(o)}),n&&(u._distUrl=n),a){const e={};new URLSearchParams(a).forEach(((t,i)=>{e[i]=t})),u._proxyPrefixes=e}else r&&(u._proxyPrefixes={"*":r});l&&(u.countryCode=l),Ze.init(u,!0),t&&setTimeout((()=>{"function"==typeof window[t]&&window[t]()}))}(xb),Ze.state!==Ze.States.UNINITIALIZED&&(Ze.addEventListener(Ze.Events.Changed,Sb),Ze.addEventListener(Ze.Events.Error,Sb));const Ab=Object.create(kb.prototype);Ze.performanceMarkers.loading&&performance.mark("mapkit-core-load");const Eb=Ab;window.mapkit&&window.mapkit.init&&console.warn("[MapKit] Mapkit namespace already exists; did you import MapKit more than once?"),window.mapkit=Eb})();